function julian(t){return t/864e5+2440587.5}function GMST(t){return(18.697374558+24.06570982441908*(t-2451545))%24}var Terminator=L.Polygon.extend({options:{color:"#00",opacity:.5,fillColor:"#00",fillOpacity:.5,resolution:2},initialize:function(t){this.version="0.1.0",this._R2D=180/Math.PI,this._D2R=Math.PI/180,L.Util.setOptions(this,t);var i=this._compute(this.options.time);this.setLatLngs(i)},setTime:function(t){this.options.time=t;var i=this._compute(t);this.setLatLngs(i)},_sunEclipticPosition:function(t){var i=t-2451545,n=280.46+.9856474*i,s=357.528+.9856003*i;return s%=360,{lambda:(n%=360)+1.915*Math.sin(s*this._D2R)+.02*Math.sin(2*s*this._D2R),R:1.00014-.01671*Math.cos(s*this._D2R)-.0014*Math.cos(2*s*this._D2R)}},_eclipticObliquity:function(t){var i=(t-2451545)/36525;return 23.43929111-i*(46.836769/3600-i*(1831e-7/3600+i*(5.565e-7-i*(1.6e-10-4.34e-8*i/3600))))},_sunEquatorialPosition:function(t,i){var n=Math.atan(Math.cos(i*this._D2R)*Math.tan(t*this._D2R))*this._R2D,s=Math.asin(Math.sin(i*this._D2R)*Math.sin(t*this._D2R))*this._R2D;return{alpha:n+=90*Math.floor(t/90)-90*Math.floor(n/90),delta:s}},_hourAngle:function(t,i,n){return 15*(n+t/15)-i.alpha},_latitude:function(t,i){return Math.atan(-Math.cos(t*this._D2R)/Math.tan(i.delta*this._D2R))*this._R2D},_compute:function(t){for(var i=julian(t?new Date(t):new Date),n=GMST(i),s=[],o=this._sunEclipticPosition(i),a=this._eclipticObliquity(i),h=this._sunEquatorialPosition(o.lambda,a),e=0;e<=720*this.options.resolution;e++){var r=e/this.options.resolution-360,u=this._hourAngle(r,h,n);s[e+1]=[this._latitude(u,h),r]}return h.delta<0?(s[0]=[90,-360],s[s.length]=[90,360]):(s[0]=[-90,-360],s[s.length]=[-90,360]),s}});