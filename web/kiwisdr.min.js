

/* web/extensions/ext.min.js */
var extint={ws:null,extname:null,param:null,override_pb:!1,displayed:!1,help_displayed:!1,spectrum_used:!1,current_ext_name:null,using_data_container:!1,default_w:525,default_h:300,prev_mode:null,seq:0,no_lockout:["noise_blank","noise_filter","ant_switch","iframe","colormap","devl"],excl_devl:["devl","s4285"],OPT_NOLOCAL:1},devl={p0:0,p1:0,p2:0,p3:0,p4:0,p5:0,p6:0,p7:0};function ext_switch_to_client(e,t,n){recv_websocket(extint.ws,n),ext_send("SET ext_switch_to_client="+e+" first_time="+(t?1:0)+" rx_chan="+rx_chan),w3_call(e+"_focus")}function ext_send(e,t){null==t&&(t=extint.ws);try{return t.send(e),0}catch(e){console.log("CATCH ext_send('"+s+"') ex="+e),kiwi_trace()}}function ext_panel_show(e,t,n){extint_panel_show(e,t,n)}function ext_set_data_height(e){var t=w3_el("id-ext-data-container");e?t&&(t.style.height=px(e)):t&&(t.style.height="")}function ext_set_controls_width_height(e,t){panel_set_width_height("ext-controls",e,t)}var EXT_SAVE=!0,EXT_NO_SAVE=!1;function ext_get_cfg_param(e,t,n){var _;e=w3_add_toplevel(e);try{_=getVarFromString(e)}catch(e){_=null}return null!=_&&null!=_||null==t||(_=t,setVarFromString(e,_),null!=n&&n!=EXT_SAVE||cfg_save_json(e,extint.ws)),_}function ext_get_cfg_param_string(e,t,n){return decodeURIComponent(ext_get_cfg_param(e,t,n))}function ext_set_cfg_param(e,t,n){e=w3_add_toplevel(e),setVarFromString(e,t),null!=n&&n==EXT_SAVE&&cfg_save_json(e,extint.ws)}function ext_get_freq_range(){var e=cfg.freq_offset;return{lo_kHz:cfg.sdr_hu_lo_kHz+e,hi_kHz:cfg.sdr_hu_hi_kHz+e,offset_kHz:e}}var extint_isAdmin_cb,extint_authkey_cb,ext_zoom={TO_BAND:0,IN:1,OUT:-1,ABS:2,WHEEL:3,NOM_IN:8,MAX_IN:9,MAX_OUT:-9},extint_ext_is_tuning=!1;function ext_tune(e,t,n,_,i,o){var a=null!=i&&null!=o;extint_ext_is_tuning=!0,freqmode_set_dsp_kHz(e,t),a&&ext_set_passband(i,o),null!=n?zoom_step(n,_):zoom_step(ext_zoom.TO_BAND),extint_ext_is_tuning=!1}function ext_get_freq_Hz(){return{displayed:freq_displayed_Hz,carrier:freq_car_Hz,passband_center:freq_passband_center()}}function ext_get_freq(){return freq_displayed_Hz}function ext_get_freq_kHz(){return(freq_displayed_Hz/1e3).toFixed(2)}function ext_get_carrier_freq(){return freq_car_Hz}function ext_get_passband_center_freq(){return freq_passband_center()}function ext_get_mode(){return cur_mode}function ext_is_IQ_or_stereo_mode(e){return"drm"==e||"iq"==e||"sas"==e||"qam"==e}function ext_is_IQ_or_stereo_curmode(){return ext_is_IQ_or_stereo_mode(cur_mode)}function ext_get_prev_mode(){return extint.prev_mode}function ext_set_mode(e,t,n){var _="drm"==e;_&&(extint.prev_mode=cur_mode),demodulator_analog_replace(e,t);var i=w3_opt(n,"open_ext",!1),o=w3_opt(n,"no_drm_proc",!1),a="undefined"!=typeof drm&&drm.active;w3_show_hide("id-chan-null","sam"==e),o||(_&&i?a?toggle_panel("ext-controls",1):extint_open("drm"):!_&&a&&(extint_panel_hide(),demodulator_analog_replace(e,t)))}function ext_get_passband(){var e=demodulators[0];return{low:e.low_cut,high:e.high_cut}}function ext_set_passband(e,t,n,_){var i=demodulators[0],o=i.filter;null==e&&(e=i.low_cut),null==t&&(t=i.high_cut);Math.abs(t-e);e=e<o.low_cut_limit?o.low_cut_limit:e,t=t>o.high_cut_limit?o.high_cut_limit:t;var a=!1;Math.abs(t-e)>=o.min_passband&&e<t&&(i.low_cut=e,i.high_cut=t,a=!0),isArg(n)&&n&&a&&(passbands[cur_mode].last_lo=e,passbands[cur_mode].last_hi=t),null!=_&&null!=_&&(_*=1e3,freq_car_Hz=freq_dsp_to_car(_)),extint_ext_is_tuning=!0,demodulator_set_offset_frequency(0,freq_car_Hz-center_freq),extint_ext_is_tuning=!1}function ext_get_tuning(){return{low:demod.low_cut,high:demod.high_cut,mode:cur_mode,freq_dial_kHz:freq_displayed_Hz/1e3}}function ext_get_zoom(){return zoom_level}function ext_agc_delay(e){var t=w3_el("input-decay").value;return isDefined(e)&&setDecay(!0,e),t}function ext_get_optbar(){return readCookie("last_optbar")}function ext_set_optbar(e){extint.optbars[e]&&(writeCookie("last_optbar",e),w3_el("id-nav-"+e).click())}function ext_hasCredential(e,t,n,_){var i;"mfg"==e&&(e="admin"),"admin"==e?(deleteCookie("admin"),deleteCookie("admin-pwd"),i=""):i=(i=readCookie(e))?decodeURIComponent(i):"",extint_pwd_cb=t,extint_pwd_cb_param=n,ext_valpwd(e,i,_)}function ext_valpwd(e,t,n){t=encodeURIComponent(t),"admin"!=e&&writeCookie(e,t),extint_conn_type=e,t=""!=t?t:"#";var _=null,i=readCookie("iplimit"),o=kiwi_url_param(["pwd","password"],"","");""!=o?_=o:i&&""!=i&&(_=i),_=_?" ipl="+_:"",null!=kiwi_url_param(["p","prot","protected"],"true",null)&&"admin"!=e&&(e="prot");var a=0;kiwi_url_param("nolocal")&&(a|=extint.OPT_NOLOCAL),0!=a&&ext_send("SET options="+a),ext_send("SET auth t="+e+" p="+t+_,n)}function ext_isAdmin(e){extint_isAdmin_cb=e,ext_send("SET is_admin")}function ext_get_authkey(e){ext_send("SET get_authkey"),extint_authkey_cb=e}extint.optbars={"optbar-wf":0,"optbar-audio":1,"optbar-agc":2,"optbar-users":3,"optbar-status":4,"optbar-off":5};var extint_adc_clock_Hz=0;function ext_adc_clock_Hz(){return extint_adc_clock_Hz}var extint_adc_gps_clock_corr=0;function ext_adc_gps_clock_corr(){return extint_adc_gps_clock_corr}var extint_adc_clock_nom_Hz=0;function ext_adc_clock_nom_Hz(){return extint_adc_clock_nom_Hz}var extint_srate=0;function ext_sample_rate(){return extint_srate}var extint_audio_data_cb=null;function ext_register_audio_data_cb(e){extint_audio_data_cb=e}function ext_unregister_audio_data_cb(){extint_audio_data_cb=null}function ext_param(){var e=extint.param;return extint.param=null,e}function ext_panel_set_name(e){extint.current_ext_name=e}function ext_mobile_info(e){var t=window.innerWidth,n=window.innerHeight,_={width:t,height:n};_.wh_unchanged=e&&e.width==t&&e.height==n?1:0;var i=t<n||mobile_laptop_test?1:0;return _.orient_unchanged=e&&e.isPortrait==i?1:0,_.isPortrait=i?1:0,_.iPad=i&&t<=768?1:0,_.small=i&&t<768?1:0,_.narrow=i&&n<=600?1:0,_}function extint_news(e){var t=w3_el("id-news");t.style.width="400px",t.style.height="300px",t.style.visibility="visible",t.style.zIndex=9999,w3_innerHTML("id-news-inner",e)}function ext_panel_init(){w3_el("id-panels-container").innerHTML+='<div id="id-ext-controls" class="class-panel" data-panel-name="ext-controls" data-panel-pos="bottom-left" data-panel-order="0" data-panel-size="'+extint.default_w+","+extint.default_h+'"></div>';w3_el("id-ext-data-container");w3_el("id-ext-controls").innerHTML=w3_div("id-ext-controls-container w3-relative|width:100%;height:100%;")+w3_div("id-ext-controls-vis class-vis")+w3_div("id-ext-controls-help cl-ext-help",w3_button('id-ext-controls-help-btn w3-green w3-small w3-padding-small w3-disabled||onclick="extint_help_click()"',"help")),w3_el("id-kiwi-body").addEventListener("keyup",function(e){"Escape"==e.key&&extint.displayed&&!confirmation.displayed&&1!=w3_call(extint.current_ext_name+"_escape_key_cb")&&w3_el("id-ext-controls-close").click()},!0)}function ext_show_spectrum(){w3_show_block("id-spectrum-container"),extint.spectrum_used=!0}function ext_hide_spectrum(){w3_hide("id-spectrum-container"),extint.spectrum_used=!1}function extint_panel_show(e,t,n,_){var i;extint.using_data_container=!!t,extint.using_data_container?(toggle_or_set_spec(toggle_e.SET,0),w3_hide("id-top-container"),w3_show_block(w3_innerHTML("id-ext-data-container",t))):(w3_hide("id-ext-data-container"),spec.source_wf||w3_show_block("id-top-container")),ext_hide_spectrum(),1==extint.help_displayed&&(confirmation_panel_close(),extint.help_displayed=!1),(i=w3_el("id-ext-controls-close")).onclick=function(){toggle_panel("ext-controls"),extint_panel_hide()},ext_set_data_height(),w3_el("id-ext-controls").style.zIndex=150,w3_create_attribute("id-ext-controls-close-img","src","icons/close.24.png"),(i=w3_el("id-ext-controls-container")).innerHTML=e,n&&n(),(i=w3_el("id-ext-controls")).style.zIndex=150,w3_visible(i,!0),i.panelShown=1,toggle_or_set_hide_panels(0),w3_el("id-confirmation-container").style.height="",_=isDefined(_)?_:w3_call(extint.current_ext_name+"_help",!1),w3_set_props("id-ext-controls-help-btn","w3-disabled",isUndefined(_)||0==_),w3_show_hide("id-ext-controls-help-btn","off"!=_),extint.displayed=!0}function ext_panel_displayed(e){return extint.displayed&&(!e||e==extint.current_ext_name)}function ext_panel_redisplay(e){w3_innerHTML("id-ext-controls-container",e)}function extint_panel_hide(){extint.using_data_container&&(w3_hide("id-ext-data-container"),ext_hide_spectrum(),w3_show_block("id-top-container"),extint.using_data_container=!1,1==extint.help_displayed&&(confirmation_panel_close(),extint.help_displayed=!1)),w3_visible("id-ext-controls",!1),extint_blur_prev(1),w3_select_value("id-select-ext",-1),resize_waterfall_container(!0),freqset_select(),extint.displayed=!1}function extint_help_click_now(){extint.help_displayed=w3_call(extint.current_ext_name+"_help",!0)}function extint_help_click(e){w3_contains("id-ext-controls-help-btn","w3-disabled")||(console.log(extint.current_ext_name+"_help_click CLICKED"),e?setTimeout(function(){extint_help_click_now()},2e3):extint_help_click_now())}function extint_environment_changed(e){setTimeout(function(){extint.current_ext_name&&w3_call(extint.current_ext_name+"_environment_changed",e),w3_call("injection_environment_changed",e)},100)}var extint_pwd_cb=null,extint_pwd_cb_param=null,extint_conn_type=null;function extint_valpwd_cb(e){extint_pwd_cb&&extint_pwd_cb(e,extint_pwd_cb_param)}function extint_open_ws_cb(){ext_hasCredential("kiwi",null,null),setTimeout(function(){setInterval(function(){ext_send("SET keepalive")},5e3)},5e3)}function extint_connect_server(){return extint.ws=open_websocket("EXT",extint_open_ws_cb,null,extint_msg_cb),extint.ws}function extint_msg_cb(e,t){switch(e[0]){case"keepalive":break;case"ext_client_init":console.log("ext_client_init is_locked="+ +e[1]),extint_focus(+e[1]);break;default:return!1}return!0}function extint_blur_prev(e){null!=extint.current_ext_name&&(w3_call(extint.current_ext_name+"_blur"),recv_websocket(extint.ws,null),e&&ext_set_controls_width_height(),extint.current_ext_name=null,time_display_setup("id-topbar-right-container")),extint.ws&&ext_send("SET ext_blur="+rx_chan)}function extint_focus(e){var t=extint.current_ext_name;if(console.log("extint_focus: loading "+t+".js"),e&&!extint.no_lockout.includes(t))return extint_panel_show(w3_text("w3-medium w3-text-css-yellow","Cannot use extensions while <br> another channel is in DRM mode."),null,null,"off"),void ext_set_controls_width_height(300,75);kiwi_load_js_dir("extensions/"+t+"/"+t,[".js",".css"],function(){console.log("extint_focus: calling "+t+"_main()"),ext_set_controls_width_height(),w3_call(t+"_main")},function(e){if(console.log("extint_focus: "+t+" loaded="+e),e){extint_panel_show("loading extension...",null,null,"off"),ext_set_controls_width_height(325,45),kiwi.is_locked&&console.log("==== IS_LOCKED =================================================")}})}var extint_names,extint_first_ext_load=!0;function extint_select(e){extint_blur_prev(0),e=+e,w3_select_value("id-select-ext",e);var t,n=w3_el("id-select-ext").childNodes[e+1].innerHTML.toLowerCase();console.log("extint_select val="+e+" name="+n),extint_names_enum(function(e,_,i,o){i.toLowerCase().includes(n)&&(console.log("extint_select HIT id="+i+" id_en="+o+" i="+e+" value="+_),t=e)}),extint.current_ext_name=extint_names[t],extint_first_ext_load?(extint.ws=extint_connect_server(),extint_first_ext_load=!1):ext_send("SET ext_is_locked_status")}function extint_list_json(e){extint_names=JSON.parse(decodeURIComponent(e))}function extint_names_enum(e){var t,n;for(t=n=0;t<extint_names.length;t++){var _=extint_names[t];if((dbgUs||!extint.excl_devl.includes(_))&&("sig_gen"!=_||!(0!=rx_chan||rx_chans>=14))){"wspr"==_&&(_="WSPR");var i=_;"cw_decoder"==i&&(i="cw"),"SSTV"==i&&(i="sstv"),"TDoA"==i&&(i="tdoa"),e(t,n,_,i),n++}}}function extint_select_build_menu(){var e="";return extint_names&&isArray(extint_names)&&extint_names_enum(function(t,n,_,i){var o=ext_get_cfg_param(i+".enable");console.log("extint_select_menu id_en="+i+" en="+o),(null==o||kiwi.is_local[rx_chan])&&(o=!0),"DRM"==_&&(kiwi.DRM_enable=o),e+="<option value="+dq(n)+" kiwi_idx="+dq(t)+" "+(o?"":"disabled")+">"+_+"</option>"}),e}function extint_open(e,t){e=e.toLowerCase();var n=0;extint_names_enum(function(_,i,o,a){var l=ext_get_cfg_param(a+".enable");(null==l||kiwi.is_local[rx_chan])&&(l=!0),!n&&l&&o.toLowerCase().includes(e)&&(t?setTimeout(function(){extint_select(i)},t):extint_select(i),n=1)})}function extint_audio_data(e,t){isFunction(extint_audio_data_cb)&&extint_audio_data_cb(e,t)}




/* web/kiwi/kiwi.min.js */
var kiwi={is_local:[],loaded_files:{},WSPR_rgrid:"",GPS_fixes:0,wf_fps:0,inactivity_panel:!1,is_multi_core:0,volume:50,volume_f:0,muted:!1,unmuted_color:"lime",queued:0,modes_l:["am","amn","usb","lsb","cw","cwn","nbfm","iq","drm","usn","lsn","sam","sal","sau","sas"],modes_u:[],modes_s:{},RX4_WF4:0,RX8_WF2:1,RX3_WF3:2,RX14_WF0:3,cmap_s:["Kiwi","CuteSDR","grey","linear","turbo","SdrDx","custom 1","custom 2","custom 3","custom 4"],cmap_e:{kiwi:0,CuteSDR:1,greyscale:2,linear:3,turbo:4,SdrDx:5,custom_1:6,custom_2:7,custom_3:8,custom_4:9},aper_s:["man","auto"],aper_e:{man:0,auto:1}};kiwi.modes_l.forEach(function(e,i){kiwi.modes_u.push(e.toUpperCase()),kiwi.modes_s[e]=i});var rx_chans,wf_chans,wf_chans_real,rx_chan,max_camp,conn_type,timestamp,gmap,WATERFALL_CALIBRATION_DEFAULT=-13,SMETER_CALIBRATION_DEFAULT=-13,try_again="",seriousError=!1,types=["active","watch-list","sub-band","DGPS","special event","interference","masked"],types_s={active:0,watch_list:1,sub_band:2,DGPS:3,special_event:4,interference:5,masked:6},type_colors={0:"cyan",16:"lightPink",32:"aquamarine",48:"lavender",64:"violet",80:"violet",96:"lightGrey"},optbar_prefix_color="w3-text-css-orange",dbgUs=!1,dbgUsFirst=!0;function kiwi_bodyonload(e){if(""!=e)kiwi_serious_error(e);else{initCookie("ident","").startsWith("ZL/KF6VO")&&(dbgUs=!0),"undefined"==(conn_type=html("id-kiwi-container").getAttribute("data-type"))&&(conn_type="kiwi"),console.log("conn_type="+conn_type),w3int_init();var i=new Date;timestamp=i.getTime(),extint.ws="kiwi"==conn_type?owrx_ws_open_snd(kiwi_open_ws_cb,{conn_type:conn_type}):kiwi_ws_open(conn_type,kiwi_open_ws_cb,{conn_type:conn_type})}}function kiwi_open_ws_cb(e){"kiwi"!=e.conn_type&&setTimeout(function(){setInterval(function(){ext_send("SET keepalive")},5e3)},5e3),seriousError||ext_hasCredential(e.conn_type,kiwi_valpwd1_cb,e)}function kiwi_load_js_polled(e,i){return e.started||(kiwi_load_js(i,function(){e.finished=!0}),e.started=!0,e.finished=!1),e.finished}function kiwi_load_js_dir(e,i,t,r){for(var o=0;o<i.length;o++)i[o]=e+i[o];kiwi_load_js(i,t,r)}function kiwi_load_js(e,i,t){console.log("DYNLOAD START"),e.push("kiwi/kiwi_js_load.js"),console.log(e);var r=!1;e.forEach(function(t){if(kiwi.loaded_files[t])console.log("already loaded: "+t);else{if(t.includes("kiwi_js_load.js")){if(!r)return}else kiwi.loaded_files[t]=1,r=!0;var o,n=!1;t.endsWith(".js")||t.includes("/js?key=")?((o=document.createElement("script")).src=t,o.type="text/javascript","kiwi/kiwi_js_load.js"==t&&(o.kiwi_js=e[0],o.kiwi_cb=i)):t.endsWith(".css")?((o=document.createElement("link")).rel="stylesheet",o.href=t,o.type="text/css"):n=!0,n?console.log("UNKNOWN FILETYPE "+t):(o.async=!1,document.head.appendChild(o),console.log("loading "+t))}}),console.log("DYNLOAD FINISH"),r?t&&w3_call(t,!0):(t&&w3_call(t,!1),i&&w3_call(i))}function kiwi_ask_pwd_cb(e,i,t){ext_valpwd(conn_type,i)}function kiwi_queue_or_camp_cb(e,i,t){var r=window.location.href;console.log(r),r+=kiwi_add_search_param(window.location,"camp"),console.log("--\x3e "+r),window.location.href=r}function kiwi_ask_pwd(e){console.log("kiwi_ask_pwd chan_no_pwd_true="+chan_no_pwd_true+" client_public_ip="+client_public_ip);var i="",t="";e&&chan_no_pwd_true&&(i="All channels busy that don't require a password ("+chan_no_pwd_true+"/"+rx_chans+")<br>",t="<br> <b>OR</b> <br><br> click to queue for an available channel, <br>or camp on an existing channel: <br>"+w3_button("w3-medium w3-padding-smaller w3-aqua w3-margin-T-8","Queue or Camp","kiwi_queue_or_camp_cb")),kiwi_url_param(["p","prot","protected"],!0,!1)&&e&&(i="You have requested a password protected channel<br>"),kiwi_show_msg("KiwiSDR: software-defined receiver <br>"+i+try_again+w3_input("w3-retain-input-focus w3-margin-TB-8/w3-label-inline w3-label-not-bold/kiwi-pw|padding:1px|size=40","Password:","id-pwd","","kiwi_ask_pwd_cb")+t),w3_field_select("id-pwd",{mobile:1})}var override_freq,override_mode,override_zoom,override_max_dB,override_min_dB,override_9_10,body_loaded=!1;function kiwi_valpwd1_cb(e,i){if(!seriousError)if(1==e)kiwi_ask_pwd("kiwi"==i.conn_type),try_again="Try again. ";else{if(2==e)return void kiwi_show_msg("Still determining local interface address.<br>Please try reloading page in a few moments.");if(3==e)return void kiwi_show_msg("Admin connections not allowed from this ip address.");if(4==e)return void kiwi_show_msg("No admin password set. Can only connect from same local network as Kiwi.<br>Client ip = "+client_public_ip);if(5==e)return void kiwi_show_msg("Multiple connections from the same ip address not allowed.<br>Client ip = "+client_public_ip);0==e&&("kiwi"==i.conn_type?extint.ws=owrx_ws_open_wf(kiwi_open_ws_cb2,i):kiwi_valpwd2_cb(0,i))}}function kiwi_open_ws_cb2(e){ext_hasCredential(e.conn_type,kiwi_valpwd2_cb,e)}function kiwi_valpwd2_cb(e,i){if(!seriousError)if(kiwi_show_msg(""),body_loaded)console.log("kiwi_valpwd2_cb: body_loaded previously!");else{body_loaded=!0,"kiwi"!=i.conn_type&&(w3_hide("id-kiwi-msg-container"),w3_show_block("id-kiwi-container"),w3_el("id-kiwi-body").style.overflow="hidden");try{kiwi_init(),w3_call(i.conn_type+"_main")}catch(e){console.log("EX: "+e),console.log("kiwi_valpwd2_cb: no interface routine for "+i.conn_type+"?")}}}function kiwi_init(){}function kiwi_xdLocalStorage_init(){if(dbgUs){for(var e=[],i=0;i<5;i++)e[i]=dbgUs&&0==i?"http://kiwisdr.com/pkgs/xdLocalStorage/xdLocalStorage-min.html":"http://pub"+i+".kiwisdr.com:8073/pkgs/xdLocalStorage/xdLocalStorage-min.html";xdLocalStorageHA.init({iframeUrls:e,initCallback:function(){console.log("xdLocalStorageHA READY")}})}}function kiwi_get_init_settings(){var e=null==init_frequency?7020:init_frequency;e=ext_get_cfg_param("init.freq",e,EXT_NO_SAVE),init_frequency=override_freq||e;var i=null==init_mode?kiwi.modes_s.lsb:kiwi.modes_s[init_mode];i=ext_get_cfg_param("init.mode",i,EXT_NO_SAVE),init_mode=override_mode||kiwi.modes_l[i],"drm"===init_mode&&(init_mode="am");var t=null==init_zoom?0:init_zoom;t=ext_get_cfg_param("init.zoom",t,EXT_NO_SAVE),init_zoom=override_zoom||t;var r=null==init_max_dB?-10:init_max_dB;r=ext_get_cfg_param("init.max_dB",r,EXT_NO_SAVE),init_max_dB=override_max_dB||r;var o=null==init_min_dB?-110:init_min_dB;o=ext_get_cfg_param("init.min_dB",o,EXT_NO_SAVE),init_min_dB=override_min_dB||o,console.log("INIT f="+init_frequency+" m="+init_mode+" z="+init_zoom+" min="+init_min_dB+" max="+init_max_dB),w3_call("init_scale_dB");var n=ext_get_cfg_param("rx_antenna"),s=w3_el("rx-antenna");null!=s&&n&&(s.innerHTML="Antenna: "+decodeURIComponent(n)),kiwi.WSPR_rgrid=ext_get_cfg_param_string("WSPR.grid","",EXT_NO_SAVE)}var cfg={},adm={};function cfg_save_json(e,i){var t;null!=i&&null!=i&&(e.startsWith("adm.")?(t=encodeURIComponent(JSON.stringify(adm)),i.send("SET save_adm="+t)):(t=encodeURIComponent(JSON.stringify(cfg)),i.send("SET save_cfg="+t)),console.log("cfg_save_json: DONE"))}var server_time_utc,server_time_local,server_time_tzid,server_time_tzname,server_tz,geo={geo:"",json:"",retry:0};function kiwi_geolocate(e){var i=kiwi_isFirefox();if(!(i&&i<=28)){var t;switch(null==e&&(e=(new Date).getSeconds()),e%=3){case 0:t="ipapi.co/json";break;case 1:t="extreme-ip-lookup.com/json";break;case 2:t="get.geojs.io/v1/ip/geo.json"}kiwi_ajax("https://"+t,function(i){void 0===i.AJAX_error?(console.log("GEOLOC "+t),console.log(i),geoloc_json(i)):geo.retry++<=3&&kiwi_geolocate(e+1)},null,5e3)}}function geoloc_json(e){if(null==e.AJAX_error){window.JSON&&window.JSON.stringify?geo.json=JSON.stringify(e):geo.json=e.toString();var i=e.country_name||e.country;"United States"==i&&e.region&&(i=e.region+", USA"),geo.geo="",e.city&&(geo.geo+=e.city),i&&(geo.geo+=(e.city?", ":"")+i),console.log("GEOLOC "+geo.geo)}}function kiwi_geo(){return encodeURIComponent(geo.geo)}function kiwi_geojson(){return encodeURIComponent(geo.json)}var time_display_current=!0;function time_display_cb(e){isUndefined(e.tu)||(server_time_utc=e.tu,server_time_local=e.tl,server_time_tzid=decodeURIComponent(e.ti),server_time_tzname=decodeURIComponent(e.tn).replace(/\\/g,"").replace(/_/g," "),server_tz=server_time_tzname,server_time_tzid&&(server_tz+=" ("+server_time_tzid+")"),time_display_started?time_display(time_display_current):(time_display_periodic(),time_display_started=!0))}function time_display(e){if(w3_el("id-time-display-text-inner")){var i=""==server_time_local||"null"==server_time_tzname;w3_set_innerHTML("id-time-display-UTC",server_time_utc||"?"),w3_set_innerHTML("id-time-display-local",i?"?":server_time_local),w3_set_innerHTML("id-time-display-tzname",i?"Lat/lon needed for local time":server_tz),w3_el("id-time-display-logo-inner").style.opacity=e?0:1,w3_el("id-time-display-inner").style.opacity=e?1:0}}function time_display_periodic(){time_display(time_display_current),time_display_current^=1,setTimeout(function(){time_display_periodic()},time_display_current?5e4:1e4)}var time_display_prev,time_display_started=!1;function time_display_setup(e){var i;0==e.startsWith("id-")&&(e+="-time-display"),time_display_prev&&(i=w3_el(time_display_prev))&&(i.innerHTML=""),time_display_prev=e,(i=w3_el(e)).innerHTML=w3_div("id-time-display-inner",w3_div("id-time-display-text-inner",w3_inline("",w3_div("id-time-display-UTC"),w3_div("cl-time-display-text-suffix","UTC")),w3_inline("",w3_div("id-time-display-local"),w3_div("cl-time-display-text-suffix","Local")),w3_div("id-time-display-tzname")))+w3_div("id-time-display-logo-inner",w3_div("id-time-display-logo-text","Powered by"),'<a href="https://github.com/ha7ilm/openwebrx" target="_blank"><img id="id-time-display-logo" src="gfx/openwebrx-top-logo.png" /></a>'),time_display(time_display_current)}function time_display_width(){return 200}function time_display_html(e){return w3_div(e+"-time-display|top:50px; background-color:black; position:relative;")}var perf_status_anim,perf_status_timeout,pref={},pref_default={p:"default-p"};function show_pref(){pref_load(function(){var e=w3_divs("w3-text-css-yellow/w3-tspace-16",w3_div("w3-medium w3-text-aqua","<b>User preferences</b>"),w3_col_percent("",w3_input("","Pref","pref.p",pref.p,"pref_p_cb","something"),30),w3_div("w3-show-inline-block w3-hspace-16",w3_button("","Export","pref_export_btn_cb"),w3_button("","Import","pref_import_btn_cb"),"<b>Status:</b> "+w3_div("id-pref-status w3-show-inline-block w3-snap-back")));extint_panel_hide(),ext_panel_set_name("show_pref"),ext_panel_show(e,null,show_pref_post),ext_set_controls_width_height(1024,250),freqset_select()})}function pref_p_cb(e,i){w3_string_cb(e,i),pref_save()}function pref_refresh_ui(){w3_set_value("pref.p",pref.p)}function pref_status(e,i){var t=w3_el("id-pref-status");if(perf_status_anim)return kiwi_clearTimeout(perf_status_timeout),w3_remove_then_add(t,"w3-fade-out","w3-snap-back"),void setTimeout(function(){perf_status_anim=!1,pref_status(e,i)},1e3);t.style.color=e,t.innerHTML=i,w3_remove_then_add(t,"w3-snap-back","w3-fade-out"),perf_status_anim=!0,perf_status_timeout=setTimeout(function(){t.innerHTML="",w3_remove_then_add(t,"w3-fade-out","w3-snap-back"),perf_status_anim=!1},1500)}function pref_export_btn_cb(e,i){console.log("pref_export_btn_cb"),pref_save(function(){console.log("msg_send pref_export"),msg_send("SET pref_export id="+encodeURIComponent(pref.id)+" pref="+encodeURIComponent(JSON.stringify(pref)))}),pref_status("lime","preferences exported")}function pref_import_btn_cb(e,i){console.log("pref_import_btn_cb");var t=ident_user||"_blank_";msg_send("SET pref_import id="+encodeURIComponent(t))}function pref_import_cb(e,i){var t=decodeURIComponent(e);console.log("pref_import_cb "+t),"null"!=t?(pref=JSON.parse(t),console.log(pref),pref_save(),pref_refresh_ui(),pref_status("lime","preferences successfully imported from RX"+i)):pref_status("yellow","no preferences previously exported")}function pref_load(e){var i=ident_user||"_blank_";xdLocalStorageHA.getItem("pref."+i,function(t){console.log("xdLocalStorage.getItem pref."+i),console.log(t),pref=null==t.value?pref_default:JSON.parse(t.value),console.log(pref),e&&e()})}function pref_save(e){var i=ident_user||"_blank_";pref.id=i;var t=JSON.stringify(pref);xdLocalStorageHA.setItem("pref."+i,t,function(t){console.log("xdLocalStorage.setItem pref."+i),console.log(t),e&&e()})}function show_pref_post(){console.log("show_pref_post")}function show_pref_blur(){console.log("show_pref_blur")}var ansi={colors:[[0,0,0],[194,54,33],[37,188,36],[173,173,39],[73,46,225],[211,56,211],[51,187,200],[203,204,205],[129,131,131],[252,57,31],[49,231,34],[234,236,35],[88,51,255],[249,53,248],[20,240,240],[233,235,235]]};function kiwi_output_msg(e,i,t){var r=w3_el(e);if(r){var o;try{o=decodeURIComponent(t.s)}catch(e){console.log("decodeURIComponent FAIL:"),console.log(t.s),o=t.s}t.init||(t.el=w3_appendElement(r,"pre",""),t.esc={s:"",state:0},t.sgr={span:0,bright:0,fg:null,bg:null},t.init=!0);var n="",s=w3_el(i),_=null;isUndefined(t.tstr)&&(t.tstr=""),isUndefined(t.col)&&(t.col=0),!t.process_return_alone||"\r"!=o.charAt(0)||1!=o.length&&"\n"==o.charAt(1)||(o=o.substring(1),t.tstr=n="",t.col=0),t.remove_returns&&(o=o.replace(/\r/g,""));for(var a=0;a<o.length;a++){var c=o.charAt(a);if("\f"==c){for(;r.firstChild;)r.removeChild(r.firstChild);t.el=w3_appendElement(r,"pre",""),t.tstr=n="",t.col=0}else if("\t"==c)for(n+="&nbsp;",t.col++;0!=(7&t.col);)n+="&nbsp;",t.col++;else if(""==c)t.esc.s="",t.esc.state=1;else if(1==t.esc.state)if(c<"@"||"["==c)t.esc.s+=c;else{t.esc.s+=c;var l=t.esc.s.charAt(0),d=t.esc.s.charAt(1),p=0;if("["==l)if("m"==c){for(var w,f=0,u=0,m=t.esc.s.substr(1).split(";"),g=m.length,k=0;k<g&&0==p;k++)if(0==(w=""==m[k]||"m"==m[k]?0:parseInt(m[k])))t.sgr.fg=t.sgr.bg=null,f=1;else if(isNaN(w))p=2;else if(1==w)t.sgr.bright=8;else if(2==w)t.sgr.bright=0;else if(22==w)t.sgr.bright=0;else if(7==w){var b=t.sgr.fg;t.sgr.fg=t.sgr.bg,t.sgr.bg=b,null==t.sgr.fg&&(t.sgr.fg=[255,255,255]),null==t.sgr.bg&&(t.sgr.bg=[0,0,0]),u=1}else if(27==w)t.sgr.fg=t.sgr.bg=null,u=1;else if(w>=30&&w<=37)t.sgr.fg=ansi.colors[w-30+t.sgr.bright],u=1;else if(w>=90&&w<=97)t.sgr.fg=ansi.colors[w-90+8],u=1;else if(39==w)t.sgr.fg=null,u=1;else if(w>=40&&w<=47)t.sgr.bg=ansi.colors[w-40+t.sgr.bright],u=1;else if(w>=100&&w<=107)t.sgr.bg=ansi.colors[w-100+8],u=1;else if(49==w)t.sgr.bg=null,u=1;else if(38==w||48==w){var v,h,x,y,S,T;3!=g||5!=parseInt(m[1])||isNaN(v=parseInt(m[2]))?5!=g||2!=parseInt(m[1])||isNaN(h=parseInt(m[2]))||isNaN(x=parseInt(m[3]))||isNaN(y=parseInt(m[4]))?p=2:(S=[h=w3_clamp(h,0,255),x=w3_clamp(x,0,255),y=w3_clamp(y,0,255)],38==w?t.sgr.fg=S:t.sgr.bg=S,u=1):(k+=2,v<=15?(S=ansi.colors[v],38==w?t.sgr.fg=S:t.sgr.bg=S,u=1):v<=231?(v-=16,v-=36*(h=Math.floor(v/36)),y=v-=6*(x=Math.floor(v/6)),S=[h=Math.floor(255*h/5),x=Math.floor(255*x/5),y=Math.floor(255*y/5)],38==w?t.sgr.fg=S:t.sgr.bg=S,u=1):v<=255?(S=[T=8+10*(v-232),T,T],38==w?t.sgr.fg=S:t.sgr.bg=S,u=1):p=2)}else p=2;f?t.sgr.span&&(n+="</span>",t.sgr.span=0):u?(t.sgr.span&&(n+="</span>"),n+='<span style="'+(t.sgr.fg?"color:"+kiwi_rgb(t.sgr.fg)+";":"")+(t.sgr.bg?"background-color:"+kiwi_rgb(t.sgr.bg)+";":"")+'">',t.sgr.span=1):p=2}else"K"==c?p="erase in line":"P"==c?p="del # chars":"?"==d?p="set/reset mode":"r"==c||(p="l"==c?"reset mode":"J"==c?"2"==d||"3"==d?"erase whole display":"1"==d?"erase start to cursor":2:"H"==c?"move row,col":"d"==c?"move row":"G"==c?"move col":2);else"("==l||(p=2);1===p?console.log("ESC "+JSON.stringify(t.esc.s)+" IGNORED"):2===p?console.log("ESC "+JSON.stringify(t.esc.s)+" UNKNOWN"):isString(p)&&console.log("ESC "+JSON.stringify(t.esc.s)+" "+p),t.esc.state=0}else(c>=" "&&c<="~"||"\n"==c)&&("<"==c?(n+="&lt;",t.col++):">"==c?(n+="&gt;",t.col++):("\n"!=c&&(n+=c,t.col++),"\n"!=c&&t.col!=t.ncol||(_=kiwi_isScrolledDown(s),t.tstr+=n,""==t.tstr&&(t.tstr="&nbsp;"),t.el.innerHTML=t.tstr,t.tstr=n="",t.el=w3_appendElement(r,"pre",""),t.col=0,w3_contains(s,"w3-scroll-down")&&(!t.scroll_only_at_bottom||t.scroll_only_at_bottom&&_)&&(s.scrollTop=s.scrollHeight))))}_=kiwi_isScrolledDown(s),t.tstr+=n,t.el.innerHTML=t.tstr,w3_contains(s,"w3-scroll-down")&&(!t.scroll_only_at_bottom||t.scroll_only_at_bottom&&_)&&(s.scrollTop=s.scrollHeight)}else console.log("kiwi_output_msg NOT_FOUND id="+e)}function gps_stats_cb(e,i,t,r,o,n){var s=(e?"yes":"pause")+", track "+i+", good "+t+", fixes "+r.toUnits();w3_el_softfail("id-msg-gps").innerHTML="GPS: acquire "+s,w3_innerHTML("id-status-gps",w3_text(optbar_prefix_color,"GPS"),w3_text("","acq "+s)),extint_adc_clock_Hz=1e6*o,extint_adc_gps_clock_corr=n,n&&(s=o.toFixed(6)+" ("+n.toUnits()+" avgs)",w3_el_softfail("id-msg-gps").innerHTML+=", ADC clock "+s,w3_innerHTML("id-status-adc",w3_text(optbar_prefix_color,"ADC clock "),w3_text("",s)))}function admin_stats_cb(e,i,t,r,o,n,s,_){if(null!=e){var a=w3_el("id-msg-errors");if(a&&(a.innerHTML="Stats: "+e.toUnits()+" dropped, "+i.toUnits()+" underruns, "+t.toUnits()+" sequence, "+r.toUnits()+" realtime"),a=w3_el("id-status-dp-hist")){for(var c="Datapump: ",l=0;l<o;l++)c+=(l?", ":"")+n[l].toUnits();a.innerHTML=c}if(a=w3_el("id-status-in-hist")){for(c="SoundInQ: ",l=0;l<s;l++)c+=(l?", ":"")+_[l].toUnits();a.innerHTML=c}}}function kiwi_too_busy(e){kiwi_show_msg("Sorry, the KiwiSDR server is too busy right now ("+e+' users max). <br>There is also a limit on the total number of channel queuers and campers. <br>Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.')}function kiwi_exclusive_use(){kiwi_show_msg('Sorry, this Kiwi has been locked for special use. <br>This happens when using an extension (e.g. DRM decoder) that requires all available resources. <br>Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide. <br><br>Áî≥„ÅóË®≥„ÅÇ„Çä„Åæ„Åõ„Çì„Åå„ÄÅ„Åì„ÅÆ„Ç≠„Éº„Ç¶„Ç£„ÅØÁâπÂà•„Å™‰ΩøÁî®„ÅÆ„Åü„ÇÅ„Å´„É≠„ÉÉ„ÇØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ <br>„Åì„Çå„ÅØ„ÄÅÂà©Áî®ÂèØËÉΩ„Å™„Åô„Åπ„Å¶„ÅÆ„É™„ÇΩ„Éº„Çπ„ÇíÂøÖË¶Å„Å®„Åô„ÇãÊã°ÂºµÊ©üËÉΩÔºàDRM „Éá„Ç≥„Éº„ÉÄ„Éº„Å™„Å©Ôºâ„Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„Å´Áô∫Áîü„Åó„Åæ„Åô„ÄÇ <br>‰∏ñÁïå‰∏≠„ÅßÂà©Áî®„Åß„Åç„Çã KiwiSDR „É¨„Ç∑„Éº„Éê„Éº„Å´„Å§„ÅÑ„Å¶„ÅØ„ÄÅ<a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> „ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ')}function kiwi_ip_limit_pwd_cb(e){console.log("kiwi_ip_limit_pwd_cb pwd="+e),writeCookie("iplimit",encodeURIComponent(e)),window.location.reload(!0)}function kiwi_show_error_ask_exemption_cb(e,i,t){kiwi_ip_limit_pwd_cb(i)}function kiwi_show_error_ask_exemption(e){kiwi_show_msg(e+="<br><br>If you have an exemption password from the KiwiSDR owner/admin <br> please enter it here: "+w3_input("w3-retain-input-focus w3-margin-TB-8/w3-label-inline w3-label-not-bold/kiwi-pw|padding:1px|size=40","Password:","id-epwd","","kiwi_show_error_ask_exemption_cb")),w3_field_select("id-epwd",{mobile:1})}function kiwi_inactivity_timeout(e){kiwi_show_msg("Sorry, this KiwiSDR has an inactivity timeout after "+e+" minutes.<br>Reload the page to continue.")}function kiwi_24hr_ip_limit(e,i){kiwi_show_error_ask_exemption("Sorry, this KiwiSDR can only be used for "+e+' minutes every 24 hours by each IP address.<br>Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.')}function kiwi_password_entry_timeout(){kiwi_show_msg("Timeout. Please reload page to continue.")}function kiwi_up(e){seriousError||(w3_hide("id-kiwi-msg-container"),w3_show_block("id-kiwi-container"),w3_el("id-kiwi-body").style.overflow="hidden")}function kiwi_down(e,i,t){var r;1==(e=+e)?(r='Sorry, software update in progress. Please check back in a few minutes.<br>Or check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.',i>0&&i<9e3?r+="<br>Build: compiling file #"+i:9997==i?r+="<br>Build: linking":9998==i?r+="<br>Build: installing":9999==i&&(r+="<br>Build: done")):2==e?r="Backup in progress.":(null!=t&&""!=t||(t='Sorry, this KiwiSDR server is being used for development right now. <br>Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.'),r=t),kiwi_show_msg(r)}var stats_interval=1e4,need_config=!0;function stats_init(){need_config&&(msg_send("SET GET_CONFIG"),need_config=!1),stats_update()}function stats_update(){msg_send("SET STATS_UPD ch="+rx_chan);var e=new Date,i=Math.ceil(e/stats_interval)*stats_interval-e;i<stats_interval/2&&(i+=stats_interval),setTimeout(stats_update,i)}function status_periodic(){w3_innerHTML("id-status-stats-cpu",kiwi_cpu_stats_str),w3_innerHTML("id-status-stats-xfer",kiwi_xfer_stats_str),w3_innerHTML("id-msg-stats-cpu",kiwi_cpu_stats_str_long),w3_innerHTML("id-msg-stats-xfer",kiwi_xfer_stats_str_long)}var kiwi_xfer_stats_str="",kiwi_xfer_stats_str_long="";function xfer_stats_cb(e,i,t,r,o){kiwi_xfer_stats_str=w3_text(optbar_prefix_color,"Net")+w3_text("","aud "+e.toFixed(0)+", wf "+i.toFixed(0)+", http "+r.toFixed(0)+", total "+o.toFixed(0)+" kB/s"),kiwi_xfer_stats_str_long="Network (all channels): audio "+e.toFixed(0)+" kB/s, waterfall "+i.toFixed(0)+" kB/s ("+t.toFixed(0)+" fps), http "+r.toFixed(0)+" kB/s, total "+o.toFixed(0)+" kB/s ("+(8*o).toFixed(0)+" kb/s)"}var kiwi_cpu_stats_str="",kiwi_cpu_stats_str_long="",kiwi_config_str="",kiwi_config_str_long="";function cpu_stats_cb(e,i,t,r){d%=100;var o=e.cc?e.cc:0,n=9*o/5+32,s=e.cc?e.cc>=60?"w3-text-css-red w3-bold":e.cc>=50?"w3-text-css-yellow":"w3-text-css-lime":"",_=o?o.toFixed(0)+"&deg;C "+n.toFixed(0)+"&deg;F ":"",a=e.cf>=1e3?(e.cf/1e3).toFixed(1)+" GHz":e.cf.toFixed(0)+" MHz";kiwi_cpu_stats_str=w3_text(optbar_prefix_color,"BB ")+w3_text("",e.cu[0]+","+e.cs[0]+","+e.ci[0]+" usi% ")+(o?w3_text(s,_):"")+w3_text("",a+" ")+w3_text(optbar_prefix_color,"FPGA")+w3_text("",t.toFixed(0)+"%"),kiwi.wf_fps=r;for(var c="",l="",d="",p=!0,w=0;w<e.cu.length;w++)c+=(p?"":" ")+e.cu[w]+"%",l+=(p?"":" ")+e.cs[w]+"%",d+=(p?"":" ")+e.ci[w]+"%",p=!1;var f="cpu";if(e.cu.length>1){f+="0";for(w=1;w<e.cu.length;w++)f+=" cpu"+w}kiwi_cpu_stats_str_long=w3_inline("",w3_text("w3-text-black","Beagle: "+f+" "+c+" usr | "+l+" sys | "+d+" idle,"+(o?"":" "))+(o?"&nbsp;"+w3_text(s+" w3-text-outline w3-large",_)+"&nbsp;":"")+w3_text("w3-text-black",a+", ")+w3_text("w3-text-black","FPGA eCPU: "+t.toFixed(0)+"%"));var u=i,m=Math.trunc(u%60);u=Math.trunc(u/60);var g=Math.trunc(u%60);u=Math.trunc(u/60);var k=Math.trunc(u%24),b=u=Math.trunc(u/24),v=" ";b&&(v+=b+"d:"),v+=k+":"+g.leadingZeros(2)+":"+m.leadingZeros(2),w3_innerHTML("id-status-config",w3_text(optbar_prefix_color,"Up"),w3_text("",v+", "+kiwi_config_str)),v=" | Uptime: ",b&&(v+=b+" "+(b>1?"days":"day")+" "),v+=k+":"+g.leadingZeros(2)+":"+m.leadingZeros(2);var h=""==server_time_local||"null"==server_time_tzname;server_time_utc&&(v+=" | UTC: "+server_time_utc),isDefined(server_time_tzname)&&(v+=" | Local: ",h||(v+=server_time_local+" "),v+=h?"Lat/lon needed for local time":server_tz),w3_innerHTML("id-msg-config",kiwi_config_str_long+v)}function config_str_update(e,i,t,r){kiwi_config_str="v"+t+"."+r+", "+e+" SDR ch, "+i+" GPS ch",w3_innerHTML("id-status-config",kiwi_config_str),kiwi_config_str_long="Config: v"+t+"."+r+", "+e+" SDR channels, "+i+" GPS channels",w3_innerHTML("id-msg-config",kiwi_config_str)}var config_net={};function config_cb(e,i,t,r,o,n,s,_,a,c,l){config_str_update(e,i,c,l);var d=w3_el("id-net-config");d&&(d.innerHTML=w3_div("",w3_col_percent("",w3_div("","Public IP address (outside your firewall/router): "+r+" [port "+o+"]"),50,w3_div("","Ethernet MAC address: "+a.toUpperCase()),30,w3_div("","KiwiSDR serial number: "+t),20),w3_col_percent("",w3_div("","Private IP address (inside your firewall/router): "+n+" [port "+s+"]"),50,w3_div("","Private netmask: /"+_),50)),config_net.pub_ip=r,config_net.pub_port=o,config_net.pvt_ip=r,config_net.pvt_port=s,config_net.mac=a,config_net.serno=t)}function update_cb(e,i,t,r,o,n,s,_,a,c,l){config_str_update(r,o,n,s);var d,p=w3_el("id-msg-update");p&&(d="Installed version: v"+n+"."+s+", built "+c+" "+l,d+=e?"<br>Cannot build, filesystem is FULL!":t?"<br>Update to version v"+ +_+"."+a+" in progress":i?"<br>Update check pending":-1==_?"<br>Error determining the latest version -- check log":n==_&&s==a?"<br>Running most current version":"<br>Available version: v"+_+"."+a,p.innerHTML=d)}var users_interval=2500,user_init=!1;function users_init(e){if(kiwi.called_from_admin=e.admin,kiwi.called_from_user=e.user,kiwi.called_from_monitor=e.monitor,kiwi.called_from_admin||kiwi.called_from_monitor)for(var i,t=kiwi.called_from_admin?"id-admin-user-":"id-monitor-user-",r="",o=0;o<rx_chans;o++)kiwi.called_from_admin&&(r=w3_button("id-user-kick-"+o+" w3-small w3-white w3-border w3-border-red w3-round-large w3-padding-0 w3-padding-LR-8","Kick","status_user_kick_cb",o)),i=w3_div("id-campers-"+o+" w3-css-orange w3-padding-LR-8"),w3_el("id-users-list").innerHTML+=w3_inline("/w3-hspace-8","RX"+o,w3_div(t+o),r,i);users_update(),w3_call("users_setup"),user_init=!0}function users_update(){msg_send("SET GET_USERS"),setTimeout(users_update,users_interval)}function user_cb(e){var i=kiwi.called_from_admin?"id-admin-user-":"id-monitor-user-",t=kiwi_url_origin();e.forEach(function(e){var r="",o="",n=e.i,s=e.n,_=e.f,a=e.g,c=isDefined(e.a)&&""!=e.a?e.a+", ":"",l=e.m,d=e.z,p=e.t,w="";if(e.rt){var f=1==e.rt?" act":" 24h";w=" "+w3_text("w3-text-css-orange|vertical-align:bottom",e.rs+f)}var u=e.e;if(isDefined(s)){var m,g=!1;do{try{m=decodeURIComponent(s),g=!0}catch(e){s=s.slice(0,-1)}}while(!g);var k=kiwi_strip_tags(m,"");""!=k&&(k='"'+k+'" ');var b="(null)"==a||""==a?"unknown location":decodeURIComponent(a);b="("+(c=c.replace(/::ffff:/,""))+b+") ";var v,h,x=(v=((v=_+1e3*cfg.freq_offset)/1e3).toFixed(v>1e8?1:2))+" kHz ",y=(_/1e3).toFixed(2);kiwi.called_from_admin?(h=t+"/?f="+y+l+"z"+d,' target="_blank"'):(h="javascript:"+(kiwi.called_from_user?"tune("+y+","+sq(l)+","+d+")":"camp("+n+")"),""),""!=u&&(u=decodeURIComponent(u)+" "),r=k+b,o=w3_link("w3-link-darker-color",h,x+l+" z"+d)+" "+u+p+w}if(user_init)if(kiwi.called_from_user)w3_innerHTML("id-optbar-user-"+n,""!=r?r+"<br>"+o:"");else{w3_innerHTML(i+n,r+o+"");var S="id-user-kick-"+n;w3_el(S)&&(""!=r?w3_show_inline_block(S):w3_hide(S))}if(n==rx_chan&&isDefined(e.c)){var T=w3_el("id-sam-carrier");T&&w3_innerHTML(T,"carrier "+e.c.toFixed(1)+" Hz")}if(w3_innerHTML("id-campers-"+n,e.ca?e.ca+plural(e.ca," camper"):""),n==rx_chan&&e.rn&&e.rn<=55&&!kiwi.inactivity_panel){var I="Inactivity timeout in one minute.<br>Close this panel to avoid disconnection.";confirmation_show_content(I,350,55,function(){msg_send("SET inactivity_ack"),confirmation_panel_close(),kiwi.inactivity_panel=!1},"red"),kiwi.inactivity_panel=!0}if(n==rx_chan&&e.rn>55&&kiwi.inactivity_panel&&(confirmation_panel_close(),kiwi.inactivity_panel=!1),n==rx_chan&&isNumber(e.fo)&&e.fo!=cfg.freq_offset&&!confirmation.displayed){I=w3_div("","Frequency scale offset changed. Page must be reloaded.",w3_inline("w3-halign-space-around/",w3_button("w3-margin-T-16 w3-aqua","OK","freq_offset_page_reload")));confirmation_show_content(I,425,100)}})}function freq_offset_page_reload(){window.location.reload(!0)}var toggle_e={SET:1,SET_URL:2,FROM_COOKIE:4,WRITE_COOKIE:8};function kiwi_toggle(e,i,t,r){var o=null;if(e&toggle_e.SET_URL&&(null!=i||null!=i))o=i;else if(e&toggle_e.FROM_COOKIE&&null!=(o=readCookie(r))){var n=parseFloat(o);isNaN(n)||(o=n)}return null==o&&e&toggle_e.SET&&(o=i),null==o&&(o=t),o}function kiwi_plot_max(e){var i=bi[e];return 1024/(i.samplerate/i.plot_samplerate)}function kiwi_fft_mode(){setmaxdb(-30)}function kiwi_mapPinSymbol(e,i){return{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z",fillColor:e=e||"red",fillOpacity:1,strokeColor:i=i||"white",strokeWeight:1,scale:1}}var comp_ctr,chan_no_pwd,chan_no_pwd_true,pref_import_ch,client_public_ip,reason_disabled="",version_maj=-1,version_min=-1,tflags={INACTIVITY:1,WF_SM_CAL:2,WF_SM_CAL2:4},kiwi_output_msg_p={scroll_only_at_bottom:!0,process_return_alone:!1};function kiwi_msg(e,i){var t=!0;switch(e[0]){case"version_maj":version_maj=parseInt(e[1]);break;case"version_min":version_min=parseInt(e[1]);break;case"client_public_ip":client_public_ip=e[1].replace(/::ffff:/,""),console.log("client public IP: "+client_public_ip);break;case"badp":console.log("badp="+e[1]),extint_valpwd_cb(parseInt(e[1]));break;case"chan_no_pwd":chan_no_pwd=parseInt(e[1]);break;case"chan_no_pwd_true":chan_no_pwd_true=parseInt(e[1]);break;case"rx_chans":rx_chans=parseInt(e[1]);break;case"wf_chans":wf_chans=parseInt(e[1]);break;case"wf_chans_real":wf_chans_real=parseInt(e[1]);break;case"rx_chan":rx_chan=parseInt(e[1]);break;case"max_camp":max_camp=parseInt(e[1]);break;case"load_cfg":var r=decodeURIComponent(e[1]);cfg=JSON.parse(r),owrx_cfg();break;case"load_adm":var o=decodeURIComponent(e[1]);adm=JSON.parse(o);break;case"request_dx_update":dx_update();break;case"mkr":dx_label_cb(JSON.parse(e[1]));break;case"user_cb":user_cb(JSON.parse(e[1]));break;case"config_cb":config_cb((n=JSON.parse(e[1])).r,n.g,n.s,n.pu,n.pe,n.pv,n.pi,n.n,n.m,n.v1,n.v2,n.ai);break;case"update_cb":update_cb((n=JSON.parse(e[1])).f,n.p,n.i,n.r,n.g,n.v1,n.v2,n.p1,n.p2,decodeURIComponent(n.d),decodeURIComponent(n.t));break;case"stats_cb":try{var n;null!=(n=JSON.parse(e[1])).ce&&cpu_stats_cb(n,n.ct,n.ce,n.fc),xfer_stats_cb(n.ac,n.wc,n.fc,n.ah,n.as),extint_srate=n.sr,gps_stats_cb(n.ga,n.gt,n.gg,n.gf,n.gc,n.go),n.gr&&(kiwi.WSPR_rgrid=decodeURIComponent(n.gr),kiwi.GPS_fixes=n.gf),admin_stats_cb(n.ad,n.au,n.ae,n.ar,n.an,n.ap,n.an2,n.ai),time_display_cb(n)}catch(i){console.log("<"+e[1]+">"),console.log("kiwi_msg() stats_cb: JSON parse fail"),console.log(i)}break;case"status_msg_text":kiwi_output_msg_p.s=e[1],kiwi_output_msg("id-output-msg","id-output-msg",kiwi_output_msg_p);break;case"status_msg_html":var s=decodeURIComponent(e[1]);w3_innerHTML("id-status-msg",s),w3_innerHTML("id-msg-status",s);break;case"is_admin":extint_isAdmin_cb(e[1]);break;case"is_local":var _=e[1].split(",");console.log("kiwi_msg rx_chan="+_[0]+" is_local="+_[1]),kiwi.is_local[+_[0]]=+_[1];break;case"is_multi_core":kiwi.is_multi_core=1;break;case"authkey_cb":extint_authkey_cb(e[1]);break;case"down":kiwi_down(e[1],comp_ctr,reason_disabled);break;case"too_busy":kiwi_too_busy(parseInt(e[1]));break;case"monitor":kiwi_monitor();break;case"exclusive_use":kiwi_exclusive_use();break;case"inactivity_timeout":kiwi_inactivity_timeout(e[1]);break;case"ip_limit":_=decodeURIComponent(e[1]).split(",");kiwi_24hr_ip_limit(parseInt(_[0]),_[1]);break;case"password_timeout":kiwi_password_entry_timeout();break;case"comp_ctr":comp_ctr=e[1];break;case"reason_disabled":reason_disabled=decodeURIComponent(e[1]);break;case"sample_rate":extint_srate=parseFloat(e[1]);break;case"pref_import_ch":pref_import_ch=+e[1];break;case"pref_import":pref_import_cb(e[1],pref_import_ch);break;case"adc_clk_nom":extint_adc_clock_nom_Hz=+e[1];break;default:t=!1}return t}function kiwi_debug(e){console.log(e),msg_send("SET dbug_msg="+encodeURIComponent(e))}function kiwi_show_msg(e){html("id-kiwi-msg").innerHTML=e,""==e?(w3_hide("id-kiwi-msg-container"),w3_el("id-kiwi-body").style.overflow="hidden"):(w3_hide("id-kiwi-container"),w3_show_block("id-kiwi-msg-container"),w3_el("id-kiwi-body").style.overflow="scroll")}function kiwi_server_error(e){kiwi_show_msg('Hmm, there seems to be a problem. <br>The server reported the error: <span style="color:red">'+e+"</span>"),seriousError=!0}function kiwi_serious_error(e){kiwi_show_msg(e),seriousError=!0,console.log(e)}function kiwi_trace(e){e&&console.log("kiwi_trace: "+e);try{console.trace()}catch(e){}}function kiwi_trace_mobile(e){alert(e+" "+Error().stack)}




/* web/kiwi/kiwi_ui.min.js */
var DX_MODE=15,DX_TYPE=240,DX_TYPE_SFT=4,DX_FLAG=65280,dxo={};function dx_update_check(o){if(-1!=(o=+o)){console.log("### dx_update_check idx="+o),dxo.gid=o;var d=dxo.tags[o];dxo.tag=d;var _=function(d){return w3_get_value("dxo."+d+"_"+o)};dxo.f=+_("f"),dxo.o=+_("o"),console.log("dxo:"),console.log(dxo);var x=dxo.m;x|=dxo.y<<DX_TYPE_SFT,dxo.f-=cfg.freq_offset,dxo.f<0&&(dxo.f=0),console.log("SET DX_UPD g="+dxo.gid+" f="+dxo.f+" lo="+dxo.lo.toFixed(0)+" hi="+dxo.hi.toFixed(0)+" o="+dxo.o.toFixed(0)+" m="+x+" t="+d+" i="+dxo.i+" n="+dxo.n+" p="+dxo.p)}}function dx_num_cb(o,d,_){if(!_){var x=w3_remove_trailing_index(o,"_");w3_num_cb(x.el,d),dx_update_check(x.idx)}}function dx_sel_cb(o,d,_){if(!_){console.log("dx_sel_cb path="+o+" val="+d+" first="+_);var x=w3_remove_trailing_index(o,"_");w3_string_cb(x.el,d),dx_update_check(x.idx)}}function dx_string_cb(o,d,_){if(!_){var x=w3_remove_trailing_index(o,"_");w3_string_cb(x.el,d),dx_update_check(x.idx)}}function dx_passband_cb(o,d,_){if(!_){var x=d.split(/[,\s]/),i=x.length;if(console.log("dx_passband_cb path="+o+" val="+d+" a.len="+i),console.log(x),1==i&&""!=x[0]){var e=Math.round(x[0].parseFloatWithUnits("kM")/2);dxo.lo=-e,dxo.hi=e}else i>=1&&""!=x[0]&&""!=x[i-1]?(dxo.lo=Math.round(x[0].parseFloatWithUnits("kM")),dxo.hi=Math.round(x[i-1].parseFloatWithUnits("kM"))):dxo.lo=dxo.hi=0;console.log("dx_passband_cb lo="+dxo.lo+" hi="+dxo.hi),dx_update_check(w3_remove_trailing_index(o,"_").idx)}}

/* web/kiwi/kiwi_util.min.js */
function isUndefined(i){return void 0===i}function isDefined(i){return void 0!==i}function isNull(i){return null===i}function isNumber(i){return"number"==typeof i}function isBoolean(i){return"boolean"==typeof i}function isString(i){return"string"==typeof i}function isArray(i){return Array.isArray(i)}function isFunction(i){return"function"==typeof i}function isObject(i){return"object"==typeof i}function isArg(i){return!isUndefined(i)&&!isNull(i)}try{String.prototype.includes||(String.prototype.includes=function(i){return this.indexOf(i)>=0})}catch(i){console.log("kiwi_util: String.prototype.includes")}try{String.prototype.startsWith||(String.prototype.startsWith=function(i){return 0==this.indexOf(i)})}catch(i){console.log("kiwi_util: String.prototype.startsWith")}try{String.prototype.endsWith||(String.prototype.endsWith=function(i,e){return(void 0===e||e>this.length)&&(e=this.length),this.substring(e-i.length,e)===i})}catch(i){console.log("kiwi_util: String.prototype.endsWith")}var kiwi_iOS,kiwi_OSX,kiwi_linux,kiwi_Windows,kiwi_android,kiwi_safari,kiwi_firefox,kiwi_chrome,kiwi_opera,kiwi_smartTV,kiwi_util={};function kiwi_is_iOS(){return kiwi_iOS}function kiwi_isOSX(){return kiwi_OSX}function kiwi_isWindows(){return kiwi_Windows}function kiwi_isLinux(){return kiwi_linux}function kiwi_isAndroid(){return kiwi_android}function kiwi_isMobile(){return kiwi_isAndroid()||kiwi_is_iOS()}function kiwi_isSafari(){return kiwi_safari?kiwi_safari[1]:NaN}function kiwi_isFirefox(){return kiwi_firefox?kiwi_firefox[1]:NaN}function kiwi_isChrome(){return kiwi_chrome?kiwi_chrome[1]:NaN}function kiwi_isOpera(){return kiwi_opera?kiwi_opera[1]:NaN}function kiwi_isSmartTV(){return kiwi_smartTV?kiwi_smartTV[1]:NaN}document.onreadystatechange=function(){if("complete"==document.readyState){var i=navigator.userAgent;console.log(i),kiwi_iOS=i.includes("iPhone")||i.includes("iPad"),kiwi_OSX=i.includes("OS X"),kiwi_linux=i.includes("Linux"),kiwi_Windows=i.includes("Win"),kiwi_android=i.includes("Android"),kiwi_safari=/safari\/([0-9]+)/i.exec(i),kiwi_browserVersion=/version\/([0-9]+)/i.exec(i),kiwi_firefox=/firefox\/([0-9]+)/i.exec(i),kiwi_chrome=/chrome\/([0-9]+)/i.exec(i),(kiwi_opera=/opera\/([0-9]+)/i.exec(i))||(kiwi_opera=/OPR\/([0-9]+)/i.exec(i)),kiwi_smartTV=/SmartTV\/([0-9]+)/i.exec(i),console.log("iOS="+kiwi_iOS+" OSX="+kiwi_OSX+" Linux="+kiwi_linux+" Windows="+kiwi_Windows+" android="+kiwi_android),kiwi_opera?kiwi_chrome=kiwi_safari=null:kiwi_chrome?kiwi_safari=null:kiwi_safari&&kiwi_browserVersion&&(kiwi_safari[1]=kiwi_browserVersion[1]),console.log("safari="+kiwi_isSafari()+" firefox="+kiwi_isFirefox()+" chrome="+kiwi_isChrome()+" opera="+kiwi_isOpera()),"undefined"!=typeof kiwi_check_js_version?kiwi_ajax("/VER","kiwi_version_cb"):"undefined"!=typeof kiwi_bodyonload&&kiwi_bodyonload("")}};var kiwi_version_fail=!1;function kiwi_version_cb(i){version_maj=i.maj,version_min=i.min;var e="";kiwi_check_js_version.forEach(function(i){i.VERSION_MAJ==version_maj&&i.VERSION_MIN==version_min||(0==kiwi_version_fail&&(e="Your browser is trying to use incorrect versions of the KiwiSDR Javascript files.<br>Please clear your browser cache and try again.<br>Or click the button below to continue anyway.<br><br>v"+version_maj+"."+version_min+": KiwiSDR server<br>",kiwi_version_fail=!0),e+="v"+i.VERSION_MAJ+"."+i.VERSION_MIN+": "+i.file+"<br>")}),kiwi_version_fail&&(e+="<br>"+w3_button("w3-css-yellow","Continue anyway","kiwi_version_continue_cb")),kiwi_bodyonload(e)}function kiwi_version_continue_cb(){seriousError=!1,kiwi_bodyonload("")}function sq(i){return"'"+i+"'"}function dq(i){return'"'+i+'"'}function plural(i,e){return 1==i?e:e+"s"}function arrayBufferToString(i){return String.fromCharCode.apply(null,new Uint8Array(i))}function arrayBufferToStringLen(e,r){var n=new Uint8Array(e),t=String();for(r=Math.min(r,n.length),i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}function kiwi_shallow_copy(i){return Object.assign({},i)}function kiwi_deep_copy(i){return JSON.parse(JSON.stringify(i))}function getFirstChars(i,e){arrayBufferToStringLen(i,e)}function kiwi_inet4_d2h(i){var e=i.split(".");return(255&e[0])<<24|(255&e[1])<<16|(255&e[2])<<8|255&e[3]}function kiwi_h2n_32(i,e){var r;switch(e){case 0:r=i>>24;break;case 1:r=i>>16;break;case 2:r=i>>8;break;case 3:r=i;break;default:r=0}return 255&r}function kiwi_ip_str(i){var e="";return isNumber(i)?e=kiwi_h2n_32(i,0)+"."+kiwi_h2n_32(i,1)+"."+kiwi_h2n_32(i,2)+"."+kiwi_h2n_32(i,3):isArray(i)?e=i[3]+"."+i[2]+"."+i[1]+"."+i[0]:isObject(i)&&(e=i.a+"."+i.b+"."+i.c+"."+i.d),e}function kiwi_clearTimeout(i){try{clearTimeout(i)}catch(i){}}function kiwi_clearInterval(i){try{clearInterval(i)}catch(i){}}Number.prototype.leadingZeros=function(i){var e=String(this);for(isNumber(i)||(i=2);e.length<i;)e="0"+e;return e},String.prototype.leadingZeros=function(i){var e=String(this);for(isNumber(i)||(i=2);e.length<i;)e="0"+e;return e},Number.prototype.fieldWidth=function(i){var e=String(this);if(!isNumber(i))return e;for(;e.length<i;)e=" "+e;return e},String.prototype.fieldWidth=function(i){var e=String(this);if(!isNumber(i))return e;for(;e.length<i;)e=" "+e;return e},String.prototype.filterInt=function(){var i=String(this);return/^(\-|\+)?([0-9]+|Infinity)$/.test(i)?Number(i):NaN},String.prototype.withSign=function(){var i=this;return Number(i)<0?i:"+"+i},String.prototype.positiveWithSign=function(){var i=this;return Number(i)<=0?i:"+"+i},Number.prototype.toHex=function(i){isNumber(i)||(i=0);var e=i<0?0:1;i=Math.abs(i);for(var r=Number(this),n=(r>>>=0).toString(16);n.length<i;)n="0"+n;return e&&(n="0x"+n),n},Number.prototype.toUnits=function(){var i=Number(this);return i<1e3?i.toString():i<1e6?(i/1e3).toFixed(1)+"k":i<1e9?(i/1e6).toFixed(1)+"M":(i/1e9).toFixed(1)+"G"},String.prototype.parseFloatWithUnits=function(i,e){var r=String(this),n=parseFloat(r);return isNaN(n)?NaN:(i&&!i.includes("k")||new RegExp("([-0-9.]*k)").test(r)&&(n*=1e3,e&&(n*=e)),i&&!i.includes("M")||new RegExp("([-0-9.]*M)").test(r)&&(n*=1e6,e&&(n*=e)),n)},Number.prototype.withSign=function(){var i=Number(this),e=i.toString();return i<0?e:"+"+e};var littleEndian=function(){var i=new ArrayBuffer(2);return new DataView(i).setInt16(0,256,!0),256===new Int16Array(i)[0]}();function _nochange(i){if(0!=arguments.length)return void 0===i}function _default(i){return 0==arguments.length?NaN:isNaN(i)}function _change(i){return!_nochange(i)&&!_default(i)}function console_log(){for(var i,e=0;e<arguments.length;e++){var r=arguments[e];0==e?i=r+": ":i+="arg"+(e-1)+"="+r+" "}console.log("CONSOLE_LOG "+i)}function console_log_fqn(){for(var i,e=0;e<arguments.length;e++){var r=arguments[e];if(0==e)i=r+": ";else{var n;try{n=getVarFromString(r)}catch(i){n="[not defined]"}var t=r.lastIndexOf(".");i+=(-1==t?r:r.substr(t+1))+"="+n+" "}}console.log("FQN "+i)}function console_log_dbgUs(){if(dbgUs){s="";for(var i=0;i<arguments.length;i++)s+=arguments[i].toString();console.log(s)}}function kiwi_log(i){setTimeout(function(i){console.log(i)},1,i)}function kiwi_trace_log(i){setTimeout(function(i){kiwi_trace(i)},1,i)}function kiwi_rateLimit(i,e){var r=!1;return function(){if(!r){r=!0;var n=arguments;setTimeout(function(){r=!1,i.apply(this,n)},e)}}}function kiwi_UTC_minutes(){var i=new Date;return 60*i.getUTCHours()+i.getUTCMinutes()}function kiwi_hh_mm(i){if(isNumber(i))return i;if(isString(i)){var e=i.split(":"),r=+e[0];if(e.length>1){var n=+e[1]/60;r=r<0?r-n:r+n}return"-0"!=e[0]&&"-00"!=e[0]||(r=-r),r}return null}function kiwi_UTCdoyToDate(i,e,r,n,t){return new Date(Date.UTC(e,0,i,r,n,t))}function kiwi_clean_html(i){return i.replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}function kiwi_clean_newline(i){return i.replace(/[\r\n\f\v]/g,"").replace(/\t/g," ")}function kiwi_isScrolledDown(i){return i.scrollHeight-i.scrollTop===i.clientHeight}function kiwi_url_origin(){var i;try{i=window.location.origin}catch(e){i=(i=this.location.href).split("?")[0]}return i}function kiwi_url_param(i,e,r){var n=isArray(i);null==e&&(e=!0),null==r&&(r=null);var t=window.location&&window.location.search&&window.location.search.substr(1);if(!t)return r;var o=r;return t.split("&").forEach(function(r){var t=r.split("=");n?i.forEach(function(i){i==t[0]&&(o=t.length>=2?t[1]:e)}):i==t[0]&&(o=t.length>=2?t[1]:e)}),o}function kiwi_add_search_param(i,e){var r=i.search;return console.log("qs=<"+r+">"),(""==r?"/?":r.includes("?")?"&":"/?")+e}function kiwi_remove_search_param(i,e){return i=i.replace("?"+e+"&","?").replace("&"+e+"&","&").replace("?"+e,"").replace("&"+e,"")}var kiwiint_dummy_elem={};function html(i){var e=w3_el(i);try{e.value}catch(r){console.log("html('"+i+"')="+e+" FAILED"),dbgUs&&dbgUsFirst&&(dbgUsFirst=!1)}return null==e&&(e=kiwiint_dummy_elem),e}function px(i){if(!isArg(i)||""==i)return"0";var e=parseFloat(i);return isNaN(e)?(console.log("px num="+i),kiwi_trace(),"0"):e.toFixed(0)+"px"}function css_style(i,e){return getComputedStyle(i,null).getPropertyValue(e)}function css_style_num(i,e){var r=parseInt(css_style(i,e));return isNaN(r)&&(r=0),r}function html_LR_border_pad(i){return css_style_num(i,"border-left-width")+css_style_num(i,"border-right-width")+css_style_num(i,"padding-left")+css_style_num(i,"padding-right")}function cancelEvent(i){return(i=i||window.event).stopPropagation&&i.stopPropagation(),i.preventDefault&&i.preventDefault(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),i.cancelBubble=!0,i.cancel=!0,i.returnValue=!1,!1}function ignore(i){return cancelEvent(i)}function kiwi_rgb(i,e,r){return null==i?"":(isArray(i)&&(e=i[1],r=i[2],i=i[0]),"rgb("+Math.floor(i)+","+Math.floor(e)+","+Math.floor(r)+")")}function hsl(i,e,r){return(e=Math.floor(e))<0&&(e=0),e>100&&(e=100),(r=Math.floor(r))<0&&(r=0),r>100&&(r=100),"hsl("+Math.round(i)+","+e+"%,"+r+"%)"}function createCookie(i,e,r){var n="";if(r){var t=new Date;t.setTime(t.getTime()+24*r*60*60*1e3),n="; expires="+t.toGMTString()}document.cookie=i+"="+e+n+"; path=/"}function readCookie(i,e){for(var r=i+"=",n=document.cookie.split(";"),t=0;t<n.length;t++){for(var o=n[t];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(r))return o.substring(r.length,o.length)}return isDefined(e)?e:null}function writeCookie(i,e){createCookie(i,e,15330)}function initCookie(i,e){var r=readCookie(i);return null==r?(writeCookie(i,e),e):r}function updateCookie(i,e){var r=readCookie(i);return(null==r||r!=e)&&(writeCookie(i,e),!0)}function deleteCookie(i){null!=readCookie(i)&&createCookie(i,0,-1)}function getVarFromString(e){var r=window,n=e.split(".");for(i=0;i<n.length-1;i++){var t=n[i];if(isUndefined(r=r[t]))throw console.log("getVarFromString: NO SCOPE "+e+" scope_name="+t),"no scope"}return r[n[n.length-1]]}function setVarFromString(e,r){var n=window,t=e.split(".");for(i=0;i<t.length-1;i++)null==n[t[i]]&&(n[t[i]]={}),n=n[t[i]];n[t[t.length-1]]=r}function getType(i){return i&&i.constructor&&i.constructor.name}function kiwi_parseQuery(i){var e=new Object;if(!i)return e;for(var r=i.split(/[;&]/),n=0;n<r.length;n++){var t=r[n].split("=");if(t&&2==t.length){var o=unescape(t[0]),a=unescape(t[1]);a=a.replace(/\+/g," "),e[o]=a}}return e}function kiwi_GETrequest(i,e,r){var n=w3_opt(r,"debug",0),t=document.createElement("iframe"),o=i+"_"+(new Date).toUTCString().substr(17,8);document.body.appendChild(t),t.style.display="none",t.contentWindow.name=o,w3_add(t,"id-kiwi_GETrequest");var a=document.createElement("form");return a.target=o,a.action=e,a.method="GET",w3_add(a,"id-kiwi_GETrequest"),n&&console.log("kiwi_GETrequest: "+o),{iframe:t,form:a,debug:n}}function kiwi_GETrequest_submit(i,e){var r=w3_opt(e,"no_submit",0),n=w3_opt(e,"gc",0);r?console.log("kiwi_GETrequest_submit: NO SUBMIT"):(document.body.appendChild(i.form),i.form.submit(),i.debug&&console.log("kiwi_GETrequest_submit: SUBMITTED")),n&&setTimeout(function(){document.body.removeChild(i.form),document.body.removeChild(i.iframe)},6e4)}function kiwi_GETrequest_param(i,e,r){var n=document.createElement("input");n.type="hidden",n.name=e,n.value=r,i.form.appendChild(n),i.debug&&console.log("kiwi_GETrequest_param: "+e+"="+r)}var ajax_state={DONE:4};function kiwi_ajax(i,e,r,n,t){kiwi_ajax_prim("GET",null,i,e,r,n,void 0,void 0,t)}function kiwi_ajax_progress(i,e,r,n,t,o,a){kiwi_ajax_prim("GET",null,i,e,r,n,t,o,a)}function kiwi_ajax_send(i,e,r,n,t,o){kiwi_ajax_prim("PUT",i,e,r,n,t,void 0,void 0,o)}var ajax_id=0,ajax_requests={};function kiwi_ajax_prim(i,e,r,n,t,o,a,s,u){var c;ajax_id++;var l=function(i){u&&console.log(i)};try{c=new XMLHttpRequest}catch(i){try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(i){return!1}}}return c.kiwi_id=ajax_id,ajax_requests[ajax_id]={},ajax_requests[ajax_id].didTimeout=!1,ajax_requests[ajax_id].timer=-1,(o=o||0)&&(ajax_requests[ajax_id].timer=setTimeout(function(){var i=c.kiwi_id;ajax_requests[i].didTimeout=!0,ajax_requests[i].timer=-1,l("AJAX TIMEOUT occurred, recovered id="+i+" url="+r);var e={AJAX_error:"timeout"};isFunction(n)?n(e,t):isString(n)&&w3_call(n,e,t),c.abort(),delete ajax_requests[i]},Math.abs(o))),a&&(l("AJAX with progress_cb="+a),c.onprogress=function(){var i=c.responseText.toString()||"";l("XHR.onprogress="+i),isFunction(a)?a(i,s):isString(a)&&w3_call(a,i,s)}),c.onerror=function(i){l("XHR.onerror="+i),u&&console.log(i)},c.onabort=function(i){l("XHR.onabort="+i),u&&console.log(i)},c.onload=function(i){l("XHR.onload="+i),u&&console.log(i)},c.onloadstart=function(i){l("XHR.onloadstart="+i),u&&console.log(i)},c.onreadystatechange=function(){if(l("XHR.onreadystatechange readyState="+c.readyState),c.readyState!=ajax_state.DONE)return!1;var i=c.kiwi_id,e=ajax_requests[i].timer;if(l("AJAX ORSC ENTER recovered id="+i+" timer="+e+" cb="+n),-1!=e&&(l("AJAX ORSC CLEAR_TIMER recovered id="+i+" timer="+e),kiwi_clearTimeout(e),ajax_requests[i].timer=-1),ajax_requests[i].didTimeout)l("AJAX ORSC TIMED_OUT recovered id="+i);else{var o;if(l("XHR.status="+c.status),l("XHR.statusText="+c.statusText),l("XHR.responseType="+c.responseType),l("XHR.response="+c.response),l("XHR.responseText="+c.responseText),l("XHR.responseURL="+c.responseURL),u&&console.log(c),200!=c.status)l("AJAX bad status="+c.status+" url="+r),o={AJAX_error:"status",status:c.status};else{var a=c.responseText.toString();if(null==a&&(a=""),a.startsWith("<?xml"))o={XML:!0,text:a};else{var s=a.charAt(0);if("{"!=s&&"["!=s)l("AJAX: response didn't begin with JSON '{' or '[' ? "+a),o={AJAX_error:"JSON prefix",response:a};else try{for(;-1!=(cb=a.indexOf("\n//"));)ce=a.indexOf("\n",cb+3),a=a.slice(0,cb)+a.slice(ce),!0;o=JSON.parse(a),l("AJAX JSON response:"),l(a),l(o)}catch(i){l("AJAX response JSON.parse failed: <"+a+">"),l(i),o={AJAX_error:"JSON parse",JSON_ex:i.toString(),response:a}}}}l("AJAX ORSC CALLBACK recovered id="+i+" callback="+typeof n),isFunction(n)?n(o,t):isString(n)&&w3_call(n,o,t)}l("AJAX ORSC ABORT/DELETE"),c.abort(),delete ajax_requests[i]},o>=0&&(c.open(i,r,!0),l("AJAX SEND id="+ajax_id+" url="+r),c.send(e)),!0}function kiwi_scrollbar_width(){return kiwi_isOSX()?10:15}function kiwi_strip_tags(i,e){e=(((e||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return i.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(i,r){return e.indexOf("<"+r.toLowerCase()+">")>-1?i:""})}function kiwi_pie(i,e,r,n){var t=2*e;return'<svg width="'+t+'" height="'+t+'" viewbox="0 0 '+t+" "+t+'"><circle cx="'+e+'" cy="'+e+'" r="'+e+'" fill="'+r+'" /><path class="'+i+'" style="fill:'+n+'" transform="translate('+e+", "+e+')" /></svg>'}function kiwi_draw_pie(i,e,r){var n=360*r,t=n*Math.PI/180,o=Math.sin(t)*e,a=Math.cos(t)*-e,s=n>=180?1:0;360==n&&(s=1,o=-.1,a=-e);var u="M 0 0 v "+-e+" A "+e+" "+e+" 1 "+s+" 1 "+o+" "+a+" z";w3_iterate_classname(i,function(i){i.setAttribute("d",u)})}function enc(i){return i.replace(/./gi,function(i){return String.fromCharCode(3^i.charCodeAt(0))})}var sendmail=function(i,e){var r="mailto:"+enc(decodeURIComponent(i))+(isDefined(e)?"?subject="+e:"");window.location.href=r};function line_stroke(i,e,r,n,t,o,a,s){var u=Math.floor(r/2),c=e?r:a-t+1,l=e?s-o+1:r,_=t-(e?u:0),f=o-(e?0:u);i.fillStyle=n,i.fillRect(_,f,c,l)}var wsockets=[];function msg_send(i){for(var e=0;e<wsockets.length;e++){var r=wsockets[e].ws;if(r.up)try{return r.send(i),0}catch(e){return console.log("CATCH msg_send('"+i+"') ex="+e),kiwi_trace(),-1}}return-1}function open_websocket(i,e,r,n,t,o){if(!("WebSocket"in window&&"CLOSING"in WebSocket))return console.log("WEBSOCKET TEST"),kiwi_serious_error("Your browser does not support WebSocket, which is required for OpenWebRX to run. <br> Please use an HTML5 compatible browser."),null;var a=kiwi_url_origin().split("://")[1],s="ws://";"https:"===window.location.protocol&&(s="wss://");var u=window.location.href.includes("?no_wf")||window.location.href.includes("&no_wf");a=s+a+"/"+(u?"no_wf/":"kiwi/")+timestamp+"/"+i,u&&(wf.no_wf=!0);var c=new WebSocket(a);return wsockets.push({ws:c,name:i}),c.up=!1,c.stream=i,c.open_cb=e,c.open_cb_param=r,c.msg_cb=n,c.recv_cb=t,c.error_cb=o,c.onopen=function(){if(c.up=!0,c.open_cb)try{c.open_cb(c.open_cb_param)}catch(i){console.log(i)}},c.onmessage=function(i){on_ws_recv(i,c)},c.onclose=function(i){c.up=!1,console.log("WS-CLOSE: "+c.stream)},c.binaryType="arraybuffer",c.onerror=function(i){if(c.error_cb)try{c.error_cb(i,c)}catch(i){console.log(i)}},c}var kiwi_flush_recv_input=!0;function recv_websocket(i,e){"SND"!=i.stream&&"W/F"!=i.stream&&(i.recv_cb=e,null==e&&(kiwi_flush_recv_input=!0))}function on_ws_recv(i,e){var r=i.data;if(r instanceof ArrayBuffer){if(!seriousError){var n=arrayBufferToStringLen(r,3);if("CLI"!=n){var t=!1;if("MSG"==n){var o=arrayBufferToString(r);params=o.substring(4).split(" ");for(var a=0;a<params.length;a++){var s=params[a].split("=");"EXT"==e.stream&&"EXT-STOP-FLUSH-INPUT"==s[0]&&(kiwi_flush_recv_input=!1),0==(t=kiwi_msg(s,e))&&e.msg_cb&&(t=e.msg_cb(s,e)),0==t&&console.log(">>> "+e.stream+": message not claimed: "+params[a])}}else!e.recv_cb||"EXT"==e.stream&&0!=kiwi_flush_recv_input||(e.recv_cb(r,e,n),isDefined(kiwi_gc_recv)&&kiwi_gc_recv&&(r=null))}}}else console.log("on_ws_recv: not an ArrayBuffer?")}window.onbeforeunload=function(){var i;for(i=0;i<wsockets.length;i++){var e=wsockets[i].ws;e&&(e.onclose=function(){},e.close())}};




/* web/kiwi/w3_util.min.js */
function visible_block(){}function w3_console_obj(t,n){var e=n?n+" ":"";isObject(t)?e+=JSON.stringify(t,null,1):isString(t)?e+='"'+t.toString()+'"':e+=t.toString(),console.log(e),isObject(t)&&console.log(t)}function w3_strip_quotes(t){return!isString(t)||-1==t.indexOf("'")&&-1==t.indexOf('"')?t:t.replace(/'/g,"").replace(/"/g,"")+" [quotes stripped]"}function w3_esc_dq(t){return isString(t)&&-1!=t.indexOf('"')?t.replace(/"/g,"&quot;"):t}function w3_call(t,n,e,i,r,l){var o=void 0;if(!isArg(t))return o;try{if(isString(t)){var _=getVarFromString(t);isFunction(_)&&(o=_(n,e,i,r,l))}else isFunction(t)?o=t(n,e,i,r,l):console.log("w3_call: func not a string or function")}catch(t){console.log("w3_call: while in func this exception occured:"),console.log(t)}return o}function w3_first_value(t){if(null==t)return"null";var n=typeof t;return"number"===n||"boolean"===n||"string"===n?t:isArray(t)?t[0]:"object"===n?w3_obj_seq_el(t,0):n}function w3_opt(t,n,e){return isDefined(t)&&isDefined(t[n])?t[n]:e}function w3_obj_num(t){return isUndefined(t)||isNull(t)||isObject(t)?t:isNumber(t)?{num:t}:isBoolean(t)?{num:t?1:0}:isString(t)?{num:parseFloat(t)}:t}function w3_obj_seq_el(t,n){return t[Object.keys(t)[n]]}function w3_obj_enum(t,n,e){var i=w3_opt(e,"key_match",void 0),r=w3_opt(e,"value_match",void 0);Object.keys(t).forEach(function(e,l){isDefined(i)?e==i&&n(e,l):isDefined(r)?t[e]==r&&n(e,l):n(e,l)})}function w3_ext_param_array_match_str(t,n,e){var i=!1;return t.forEach(function(t,r){var l=t.toString().toLowerCase();!i&&l.startsWith(n)&&(e&&e(r,t.toString()),i=!0)}),i}function w3_ext_param_array_match_num(t,n,e){var i=!1;return t.forEach(function(t,r){var l=parseFloat(t);i||l!=n||(e&&e(r,n),i=!0)}),i}function w3_ext_param(t,n){return p=n.toLowerCase().split(":"),t.startsWith(p[0])?(rv={match:!0},p.length>1?(rv.has_value=!0,rv.num=parseFloat(p[1]),rv.string=p[1]):(rv.has_value=!1,rv.num=0,rv.string=""),rv):{match:!1}}function w3_clamp(t,n,e,i){if(isObject(n)){var r=n;try{void 0===r.clamp?t=Math.max(r.min,Math.min(r.max,t)):(t<r.min||t>r.max)&&(t=r.clamp)}catch(t){return console.log("w3_clamp: bad obj:"),void console.log(r)}}else null==i?t=Math.max(n,Math.min(e,t)):(t<n||t>e)&&(t=i);return t}function w3_add_id(t,n){return""==(t=t||"")?"":(t=t.startsWith("id-")?t:"id-"+t)+(n=n||"")}function w3int_w3_el(t){if(!t||""==t)return null;var n=document.getElementById(t);return null==n&&null!=(n=document.getElementsByName(t))&&(n=n[0]),null==n&&null!=(n=document.getElementsByClassName(t))&&(n=n[0]),n}function w3int_w3_els(t){if(!t||""==t)return null;var n,e=document.getElementById(t);return null!=e?n=[e]:(null!=(e=document.getElementsByName(t))&&0!=e.length||(e=document.getElementsByClassName(t)),n=e),0==n.length&&(n=null),n}function w3_el(t){if(isString(t)){if(""==t)return null;if("body"==t)return document.body;var n=w3int_w3_el(t);return null==n&&null==(n=w3int_w3_el("id-"+t))&&null==(n=w3int_w3_el(t=w3_add_toplevel(t)))&&(n=w3int_w3_el("id-"+t)),n}return t}function w3_els(t,n){if(isString(t)){if(""==t)return null;if("body"==t)return document.body;var e=w3int_w3_els(t);if(null==e&&null==(e=w3int_w3_els("id-"+t))&&null==(e=w3int_w3_els(t=w3_add_toplevel(t)))&&(e=w3int_w3_els("id-"+t)),e&&n)for(var i=0;i<e.length;i++)n(e[i],i);return e}return t}function w3_el_softfail(t){var n=w3_el(t);try{n.innerHTML}catch(n){console.log('w3_el_softfail("'+t+'") SOFTFAIL')}return null==n&&((n=document.createElement("div")).id=t,n.classList.add("NB-SOFTFAIL"),n.style.display="none",document.body.appendChild(n)),n}function w3_id(t){var n=w3_el(t);if(!n)return null;if(n.id&&n.id.startsWith("id-"))return n.id;var e=!1,i=null;return w3_iterate_classList(n,function(t,n){t.startsWith("id-")&&!e&&(i=t,e=!0)}),i}function w3_innerHTML(t){for(var n=w3_el_softfail(t),e="",i=arguments.length,r=1;r<i;r++)e+=arguments[r];return n.innerHTML=e,n}function w3_set_innerHTML(t){var n=w3_el(t);if(!n)return null;for(var e="",i=arguments.length,r=1;r<i;r++)e+=arguments[r];return n.innerHTML=e,n}function w3_get_innerHTML(t){var n=w3_el(t);return n?n.innerHTML:null}function w3_iterate_classname(t,n){var e=document.getElementsByClassName(t);if(null!=e)for(var i=0;i<e.length;i++)n(e[i],i)}function w3_iterate_classList(t,n){var e=w3_el(t);if(e&&e.classList)for(var i=0;i<e.classList.length;i++)n(e.classList.item(i),i);return e}function w3_appendElement(t,n,e){var i=document.createElement(n);return w3_innerHTML(i,e),w3_el(t).appendChild(i),i}function w3_iterate_parent(t,n){var e=w3_el(t),i=0;do{if(null!=n(e,i))break;e=e.parentNode,i++}while(e)}function w3_iterate_children(t,n){for(var e=w3_el(t),i=0;i<e.children.length;i++){n(e.children[i],i)}}function w3_iterateDeep_children(t,n){for(var e=w3_el(t),i=0;i<e.children.length;i++){var r=e.children[i];n(r),r.hasChildNodes&&w3_iterateDeep_children(r,n)}}function w3_iterate_childNodes(t,n){for(var e=w3_el(t),i=0;i<e.childNodes.length;i++){n(e.childNodes[i],i)}}function w3_boundingBox_children(t,n){var e={x1:1e99,x2:0,y1:1e99,y2:0,w:0,h:0};return w3_iterateDeep_children(t,function(t){if("DIV"==t.nodeName||"IMG"==t.nodeName){var i=css_style(t,"position");if("static"!=i&&0!=t.offsetHeight){n&&console.log(t),n&&console.log(t.nodeName+" el.oL="+t.offsetLeft+" el.oW="+t.offsetWidth+" el.oT="+t.offsetTop+" el.oH="+t.offsetHeight+" "+i),e.x1=Math.min(e.x1,t.offsetLeft);var r=t.offsetLeft+t.offsetWidth;e.x2=Math.max(e.x2,r),e.y1=Math.min(e.y1,t.offsetTop);var l=t.offsetTop+t.offsetHeight;e.y2=Math.max(e.y2,l)}}}),e.w=e.x2-e.x1,e.h=e.y2-e.y1,n&&console.log("BBOX x1="+e.x1+" x2="+e.x2+" y1="+e.y1+" y2="+e.y2+" w="+e.w+" h="+e.h),e}function w3_center_in_window(t,n){var e=w3_el(t);return window.innerHeight/2-e.clientHeight/2}function w3_field_select(t,n){var e=w3_el(t);if(e=e&&isFunction(e.select)?e:null){var i=0,r=0,l=0;n.mobile&&kiwi_isMobile()?l=1:i=r=1,n.blur&&(l=1),n.focus_select&&(i=r=1),n.focus_only&&(i=1,r=0),n.select_only&&(r=1),i&&e.focus(),r&&e.select(),l&&e.blur()}}function w3_add(t,n){var e=w3_el(t);return e&&n?((n=n.replace(/\s+/g," ").split(" ")).forEach(function(t){e.classList.add(t)}),e):null}function w3_remove(t,n){var e=w3_el(t);return e&&n?((n=n.replace(/\s+/g," ").split(" ")).forEach(function(t){e.classList.remove(t)}),e):null}function w3_remove_wildcard(t,n){var e=w3_el(t);if(!e)return null;for(var i=0;i<e.classList.length;i++){var r=e.classList.item(i);r.startsWith(n)&&e.classList.remove(r)}return e}function w3_set_props(t,n,e){return e?w3_add(t,n):w3_remove(t,n),t}function w3_remove_then_add(t,n,e){w3_remove(t,n),w3_add(t,e)}function w3_contains(t,n){var e=w3_el(t);if(!e)return 0;var i=e.classList;return i&&i.contains(n)?1:0}function w3_parent_with(t,n){var e=w3_el(t);if(e){var i=null;return w3_iterate_parent(e,function(t){!i&&w3_contains(t,n)&&(i=t)}),i}}function w3_toggle(t,n){var e=w3_el(t);if(e)return w3_contains(e,n)?w3_remove(e,n):w3_add(e,n),e}function w3_appendAllClass(t,n){w3_iterate_classname(t,function(t){t.classList.add(n)})}function w3_setAllHref(t,n){w3_iterate_classname(t,function(t){t.href=n})}function w3_show(t,n){var e=w3_el(t);return w3_remove(e,"w3-hide"),w3_add(e,n||"w3-show-inline-block"),e}function w3_create_attribute(t,n,e){var i=w3_el(t);if(null!=i){var r=document.createAttribute(n);r.value=e,i.setAttributeNode(r)}}function w3_attribute(t,n,e,i){var r=w3_el(t);if(null==r)return null;isUndefined(i)||1==i?r.setAttribute(n,e):r.removeAttribute(n)}function w3_show_block(t){return w3_show(t,"w3-show-block")}function w3_show_inline_block(t){return w3_show(t,"w3-show-inline-block")}function w3_show_inline(t){return w3_show(t,"w3-show-inline-new")}function w3_show_table_cell(t){return w3_show(t,"w3-show-table-cell")}function w3_hide(t){return w3_add(t=w3_iterate_classList(t,function(n,e){n.startsWith("w3-show-")&&w3_remove(t,n)}),"w3-hide"),t}function w3_show_hide(t,n,e){return n?w3_show(t,e||"w3-show-block"):w3_hide(t)}function w3_show_hide_inline(t,n){w3_show_hide(t,n,"w3-show-inline-new")}function w3_visible(t,n){var e=w3_el(t);return e.style.visibility=n?"visible":"hidden",e}var w3_highlight_time=250,w3_highlight_color="w3-selection-green",w3_selection_green="#4CAF50";function w3_highlight(t){var n=w3_el(t);w3_add(n,n.w3int_highlight_color||w3_highlight_color)}function w3_unhighlight(t){var n=w3_el(t);w3_remove(n,n.w3int_highlight_color||w3_highlight_color)}function w3_isHighlighted(t){var n=w3_el(t);return w3_contains(n,n.w3int_highlight_color||w3_highlight_color)}function w3_schedule_highlight(t){var n=w3_el(t);w3_highlight(n),setTimeout(function(){w3_unhighlight(n)},w3_highlight_time)}function w3_set_highlight_color(t,n){var e=w3_el(t);return e?(w3_isHighlighted(e)?(w3_unhighlight(e),e.w3int_highlight_color=n,w3_highlight(e)):e.w3int_highlight_color=n,e):null}var w3_flag_color="w3-override-yellow";function w3_flag(t){w3_add(w3_el(t),w3_flag_color)}function w3_unflag(t){w3_remove(w3_el(t),w3_flag_color)}function w3_color(t,n,e,i){var r=w3_el(t);if(!r)return null;var l=r.style.color,o=r.style.backgroundColor;return i=isUndefined(i)||i,isArg(n)&&(r.style.color=i?n:""),isArg(e)&&(r.style.backgroundColor=i?e:""),{color:l,backgroundColor:o}}function w3_background_color(t,n){var e=w3_el(t),i=e.style.backgroundColor;return null!=n&&null!=n&&(e.style.backgroundColor=n),i}function w3_colors(t,n){var e=w3_el(t);if(!e)return null;var i=n?n.split(","):null,r=null,l=null;i&&i.length>0&&(r=i[0]),i&&i.length>1&&(l=i[1]),r&&r.startsWith("w3-")?w3_add(e,r):e.style.backgroundColor=r,l&&l.startsWith("w3-")?w3_add(e,l):e.style.color=l}function w3_check_restart_reboot(t){var n=w3_el(t);n&&w3_iterate_parent(n,function(t){return w3_contains(t,"w3-restart")?(w3_restart_cb(),t):w3_contains(t,"w3-reboot")?(w3_reboot_cb(),t):null})}function w3_set_value(t,n){var e=w3_el(t);e&&(e.value=n)}function w3_set_decoded_value(t,n){var e=w3_el(t);e&&(e.value=decodeURIComponent(n))}function w3_get_value(t){var n=w3_el(t);return n?n.value:null}function w3_add_toplevel(t){return t.startsWith("cfg.")||t.startsWith("adm.")?t:"cfg."+t}function w3_not_toplevel(t){return t.startsWith("cfg.")||t.startsWith("adm.")?t.substr(t.indexOf(".")+1):t}function w3_basename(t){var n=t.lastIndexOf(".");return n>=0?t.substr(n+1):t}function w3_psa3(t){return t=t||"",arr=t.split("/"),1==arr.length?{left:"",middle:"",right:arr[0]}:2==arr.length?{left:"",middle:arr[0],right:arr[1]}:3==arr.length?{left:arr[0],middle:arr[1],right:arr[2]}:{left:"",middle:"",right:""}}function w3_psa(t,n,e,i){if(t&&t.startsWith("class="))return t;var r=function(t){return t&&""!=t?t:""},l=function(t){return t&&""!=t?" ":""},o=t?t.split("|"):[];t="";var _=r(o[0]);n&&(_+=l(_)+n),""!=_&&(t="class="+dq(_));var a=r(o[1]);e&&(a+=l(a)+e),""!=a&&(t+=l(t)+"style="+dq(a));var w=r(o[2]);return i&&(w+=l(w)+i),""!=w&&(t+=l(t)+w),t}function w3_psa_mix(t,n,e,i){var r=function(t){return t&&""!=t?t:""},l=function(t){return t&&""!=t?" ":""},o=t?t.split("|"):[];t="";var _=r(o[0]);n&&(_+=l(_)+n),""!=_&&(t+=_);var a,w=r(o[1]);e&&(w+=((a=w)&&""!=a?"; ":"")+e),""!=w&&(t+="|"+w);var c=r(o[2]);return i&&(c+=l(c)+i),""!=c&&(t+="|"+c),t}function w3int_init(){}function w3int_post_action(){w3_call("freqset_select")}function w3_fillText(t,n,e,i,r,l,o,_){r&&(t.fillStyle=r),l&&(t.font=l),o&&(t.textAlign=o),_&&(t.textBaseline=_);var a=t.measureText(i).width;t.fillText(i,n-a/2,e)}function w3_copy_to_clipboard(t){var n=document.createElement("input");n.setAttribute("type","text"),n.setAttribute("value",t),document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}function w3_hr(t){for(var n="<hr "+w3_psa(t)+">",e=arguments.length,i=1;i<e;i++)n+=arguments[i];return n}function w3_click_nav(t,n,e){var i="id-nav-"+t,r=null,l=null,o=null;w3_iterate_children(w3_el(i).parentNode,function(t,n){"A"==t.nodeName&&(w3_contains(t,"w3int-cur-sel")&&(r=t.id.substring(7),w3_remove(t,"w3int-cur-sel"),w3_iterate_classList(t,function(t,n){t.startsWith("id-nav-cb-")&&(o=t.substring(10))})),t.id==i&&(l=t))}),r&&w3_toggle(r,"w3-show-block"),r&&o&&w3_call(o+"_blur",r),l&&(w3_add(l,"w3int-cur-sel"),w3_check_restart_reboot(l)),w3_toggle(t,"w3-show-block"),"null"!=n&&w3_call(n+"_focus",t,e)}function w3int_anchor(t,n,e,i,r){return void 0===i&&(i=e),"<a "+w3_psa(t,(i?"id-nav-cb-"+i:"")+(r?" w3int-cur-sel":""),"",'id="id-nav-'+e+'" onclick="w3_click_nav('+sq(e)+", "+sq(i)+')"')+' href="javascript:void(0)">'+n+"</a>"}function w3_navbar(t){for(var n="<nav "+w3_psa(t,"w3-navbar")+">",e=arguments.length,i=1;i<e;i++)n+=arguments[i];return n+="</nav>"}function w3_sidenav(t){for(var n="<nav "+w3_psa(t,"w3-sidenav w3-static w3-left w3-sidenav-full-height w3-light-grey")+">",e=arguments.length,i=1;i<e;i++)n+=arguments[i];return n+="</nav>"}function w3_nav(t,n,e,i,r){return w3int_anchor(t,n,e,i,r)}function w3_navdef(t,n,e,i){return setTimeout(function(){w3_toggle(e,"w3-show-block")},w3_highlight_time),w3int_anchor(t,n,e,i,!0)}function w3_label(t,n,e,i){return arguments.length>=4&&console.log("### w3_label ext="+i),n=n||"",i=i||"",""==(t=t||"")&&""==n&&""==i?"":n.startsWith("<label ")?n:"<label "+w3_psa(t,w3_add_id(e,"-label"))+">"+n+i+"</label>"}function w3_get_label(t,n){return w3_get_innerHTML(w3_add_id(n,"-label"))}function w3_set_label(t,n){w3_innerHTML(w3_add_id(n,"-label"),t)}function w3int_link_click(t,n,e){console.log("w3int_link_click cb="+n+" cb_param="+e),console.log(t);var i=t.currentTarget;console.log(i),w3_check_restart_reboot(i),n&&w3_call(n,i,e,!1),w3int_post_action()}function w3_link(t,n,e,i,r,l){var o,_=n;n.startsWith("javascript:")?o="":(n.startsWith("http://")||n.startsWith("https://")||(_="http://"+n),o=' target="_blank"'),e=e||"",""!=(i=i||"")&&(i=" title="+dq(i));var a=r&&""!=r?"w3-pointer":"";l=l||0;var w=r?' onclick="w3int_link_click(event, '+sq(r)+", "+sq(l)+')"':"";return"<a "+w3_psa(t,a,"","href="+dq(_)+o+i+w)+">"+e+"</a>"}var w3_SELECTED=!0,w3_NOT_SELECTED=!1;function w3_radio_unhighlight(t){w3_iterate_classname("id-"+t,function(t){w3_unhighlight(t)})}function w3int_radio_click(t,n,e,i){w3_radio_unhighlight(n),w3_highlight(t.currentTarget);var r=-1;w3_iterate_classname("id-"+n,function(t,n){w3_isHighlighted(t)&&(r=n)}),w3_check_restart_reboot(t.currentTarget),e&&w3_call(e,n,r,!1,i),w3int_post_action()}function w3_radio_btn(t,n,e,i,r){r=arguments.length>4?arguments[4]:null;return'<button class="w3-btn w3-ext-btn'+(" id-"+n+(e?" "+w3_highlight_color:"")+(r?" "+r:""))+'" '+('onclick="w3int_radio_click(event, '+sq(n)+", "+sq(i)+')"')+">"+t+"</button>"}function w3_radio_button(t,n,e,i,r,l){l=l||0;var o=r?'onclick="w3int_radio_click(event, '+sq(e)+", "+sq(r)+", "+sq(l)+')"':"";return"<button "+w3_psa(t,"id-"+e+(i?" "+w3_highlight_color:"")+" w3-btn w3-ext-btn","",o)+">"+n+"</button>"}function w3_radio_button_get_param(t,n,e,i,r,l,o){return w3_radio_button(t,n,e,ext_get_cfg_param(e,null==r?null:r)==i?w3_SELECTED:w3_NOT_SELECTED,l,o)}var w3_SWITCH_YES_IDX=0,w3_SWITCH_NO_IDX=1;function w3_switch(t,n,e,i,r,l,o){return w3_radio_button(w3_psa_mix(t,"w3int-switch-0"),n,i,r?1:0,l,o)+w3_radio_button(w3_psa_mix(t,"w3int-switch-1"),e,i,r?0:1,l,o)}function w3_switch_get_param(t,n,e,i,r,l,o,_){var a=ext_get_cfg_param(i,null==l?null:l)==r?w3_SELECTED:w3_NOT_SELECTED;return w3_radio_button(w3_psa_mix(t,"w3int-switch-0"),n,i,a?1:0,o,_)+w3_radio_button(w3_psa_mix(t,"w3int-switch-1"),e,i,a?0:1,o,_)}function w3_switch_set_value(t,n){var e="w3int-switch-"+n;w3_iterate_classname("id-"+t,function(t,n){w3_contains(t,e)&&t.click()})}function w3int_button_click(t,n,e,i){w3_contains(n,"w3-disabled")||(w3_check_restart_reboot(t.currentTarget),e&&w3_call(e,n,i,!1)),w3int_post_action()}var w3int_btn_grp_uniq=0;function w3_btn(t,n){return console.log("### DEPRECATED: w3_btn"),w3_button("",t,n)}function w3_button(t,n,e,i){var r="id-btn-grp-"+w3int_btn_grp_uniq.toString();w3int_btn_grp_uniq++,i=i||0;var l=e?'onclick="w3int_button_click(event, '+sq(r)+", "+sq(e)+", "+sq(i)+')"':"";e&&t.includes("w3-momentary")&&(l+=' onmousedown="w3int_button_click(event, '+sq(r)+", "+sq(e)+', 0)"',l+=' ontouchstart="w3int_button_click(event, '+sq(r)+", "+sq(e)+', 0)"');var o=t.includes("w3-round-")?"":" w3-round-large",_=w3_psa3(t),a=w3_psa(_.left),w="<button "+w3_psa(_.right,r+" w3-btn w3-ext-btn"+o,"",l)+">"+n+"</button>";return""!=a&&(w="<div "+a+">"+w+"</div>"),w}function w3_button_text(t,n,e,i){var r=w3_el(t);return r?(r.innerHTML=n,e&&(e.startsWith("w3-")?(w3_remove(r,i),w3_add(r,e)):r.style.color=e),r):null}function w3_icon(t,n,e,i,r,l){var o=r&&""!=r?" w3-pointer":"",_="id-btn-grp-"+w3int_btn_grp_uniq.toString();w3int_btn_grp_uniq++,l=l||0;var a=null;isNumber(e)&&e>=0?a=px(e):isString(e)&&(a=e),a=a?" font-size:"+a+";":"";var w=(i=i||"").split("|");i="",""!=w[0]&&(i=" color:"+w[0]+";"),w.length>=2&&""!=w[1]&&(i+=" background-color:"+w[1]+";");var c=r?'onclick="w3int_button_click(event, '+sq(_)+", "+sq(r)+", "+sq(l)+')"':"";return r&&t.includes("w3-momentary")&&(c+=' onmousedown="w3int_button_click(event, '+sq(_)+", "+sq(r)+', 0)"',c+=' ontouchstart="w3int_button_click(event, '+sq(_)+", "+sq(r)+', 0)"'),"<i "+w3_psa(t,_+o+" fa "+n,a+i,c)+"></i>"}function w3int_input_key(t,n,e){var i=t.key.toUpperCase(),r=t.ctrlKey,l=w3_el(n);if(l){e=e.split("|"),r&&"CD\\".includes(i)&&e[1]&&w3_call(e[1],i);var o=w3_contains(l,"w3-input-any-change");"Enter"==t.key&&(o?w3_input_change(n,e[0]):""==l.value&&w3_input_change(n,e[0])),"Backspace"==t.key&&o&&0==l.selectionStart&&l.selectionEnd==l.value.length&&(l.value="",w3_input_change(n,e[0]))}}function w3_input_change(t,n,e){var i=w3_el(t);i&&(w3_check_restart_reboot(i),w3_schedule_highlight(i),n&&w3_call((n=n.split("|"))[0],t,i.value,!1,e)),w3_contains(i,"w3-retain-input-focus")?w3_field_select(t,{mobile:1}):w3int_post_action()}function w3_input(t,n,e,i,r,l){var o=w3_add_id(e);r=r||"";var _=l?' placeholder="'+l+'"':"",a=t.includes("w3-custom-events"),w=e&&!a?' onchange="w3_input_change('+sq(e)+", "+sq(r)+')" onkeydown="w3int_input_key(event, '+sq(e)+", "+sq(r)+')"':"",c=(i=" value="+dq(w3_esc_dq(i)||""),t.includes("w3-label-inline")),s=!t.includes("w3-label-not-bold"),u=""!=(n=n||"")&&c?" w3int-margin-input":"",d="type="+(t.includes("w3-password")?'"password"':'"text"'),f=w3_psa3(t),v=w3_psa(f.left,c?"w3-show-inline-new":""),h=w3_psa_mix(f.middle,""!=n&&s?"w3-bold":""),p=""!=o?o+" ":"",g=w3_psa(f.right,p+"w3-input w3-border w3-hover-shadow"+u,"",d+_);return"<div "+v+">"+w3_label(h,n,e)+"<input id="+dq(o)+" "+g+i+w+"></div>"}function w3_input_get(t,n,e,i,r,l){var o=ext_get_cfg_param(e,null==r?null:r);return w3_input(t,n,e,o=decodeURIComponent(o),i,l)}function w3_input_get_param(t,n,e,i,r){var l=ext_get_cfg_param(n,null==i?null:i);return w3_input("",t,n,l=decodeURIComponent(l),e,r)}function w3_textarea(t,n,e,i,r,l,o){var _=w3_add_id(e),a=""!=n?" w3-margin-T-8":"",w=' onchange="w3_input_change('+sq(e)+", "+sq(o)+')" onkeydown="w3int_input_key(event, '+sq(e)+", "+sq(o)+')"';i=i||"";return w3_div("",n,"<textarea "+w3_psa(t,"w3-input w3-border w3-hover-shadow "+_+a,"",'rows="'+r+'" cols="'+l+'"')+w+">"+i+"</textarea>")}function w3_textarea_get_param(t,n,e,i,r,l,o){var _=ext_get_cfg_param(e,null==o?null:o);return w3_textarea(t,n,e,_=decodeURIComponent(_),i,r,l)}function w3int_checkbox_change(t,n,e){var i=w3_el(t);w3_check_restart_reboot(i),n&&(w3_schedule_highlight(i),w3_call(n,t,i.checked,!1,e)),w3_contains(i,"w3-retain-input-focus")?w3_field_select(t,{mobile:1}):w3int_post_action()}function w3_checkbox(t,n,e,i,r,l){var o=w3_add_id(e),_=' onchange="w3int_checkbox_change('+sq(e)+", "+sq(r)+", "+sq(l)+')"',a=i?" checked":"",w=t.includes("w3-label-inline"),c=t.includes("w3-label-left"),s=!t.includes("w3-label-not-bold"),u=""!=n&&w?c?" w3-margin-L-8":" w3-margin-R-8":"",d=w3_psa3(t),f=w3_psa(d.left,w?"w3-show-inline-new":""),v=w3_psa_mix(d.middle,""!=n&&s?"w3-bold":""),h=w3_psa(d.right,"w3-input w3-width-auto w3-border w3-pointer w3-hover-shadow "+o+u,"",'type="checkbox"'),p=w3_label(v,n,e),g="<input "+h+a+_+">",m="<div "+f+">"+(c?p+g:g+p)+"</div>";return r&&setTimeout(function(){w3_call(r,e,i,!0,l)},500),m}function w3_checkbox_get_param(t,n,e,i,r){return w3_checkbox(t,n,e,ext_get_cfg_param(e,null==r?null:r),i)}function w3_checkbox_get(t){var n=w3_el(t);if(n)return!!n.checked}function w3_checkbox_set(t,n){var e=w3_el(t);e&&(e.checked=!!n)}var w3int_menu_close_cur_id,W3_SELECT_SHOW_TITLE=-1;function w3int_select_change(t,n,e,i){var r=t.currentTarget;w3_check_restart_reboot(r),e&&w3_call(e,n,r.value,!1,i),w3int_post_action()}function w3int_select(t,n,e,i,r,l,o,_){var a=w3_add_id(i),w="";""!=e?w='<option value="-1" '+(r==W3_SELECT_SHOW_TITLE?"selected":"")+" disabled>"+e+"</option>":r==W3_SELECT_SHOW_TITLE&&(r=0);var c=t.includes("w3-label-inline"),s=!t.includes("w3-label-not-bold"),u=""==n||c?"":" w3-margin-T-8";c&&(u+=" w3-margin-left"),null==o&&(o="");var d='onchange="w3int_select_change(event, '+sq(i)+", "+sq(o)+", "+sq(_)+')"',f=w3_psa3(t),v=w3_psa(f.left,c?"w3-show-inline-new":""),h=w3_psa_mix(f.middle,""!=n&&s?"w3-bold":""),p=w3_psa(f.right,a+" w3-pointer"+u,"",d),g="<div "+v+">"+w3_label(h,n,i)+(c||""==n?"":"<br>")+"<select "+p+">"+w+l+"</select></div>";return o&&r!=W3_SELECT_SHOW_TITLE&&setTimeout(function(){w3_call(o,i,r,!0,_)},500),g}function w3int_select_options(t,n){var e="";if(isString(n)){var i=n.split(":");if(2==i.length)for(var r=+i[0],l=+i[1],o=0,_=r;_<=l;_++)e+="<option value="+dq(o)+" "+(o==t?"selected":"")+">"+_+"</option>",o++}else isArray(n)?n.forEach(function(n,i){isObject(n)&&(n=n[Object.keys(n)[0]]);e+="<option value="+dq(i)+" "+(i==t?"selected":"")+">"+n+"</option>"}):isObject(n)&&w3_obj_enum(n,function(i,r){e+="<option value="+dq(r)+" "+(r==t?"selected":"")+">"+n[i]+"</option>"});return e}function w3_select(t,n,e,i,r,l,o,_){return w3int_select(t,n,e,i,r,w3int_select_options(r,l),o,_)}function w3_select_hier(t,n,e,i,r,l,o,_){var a="",w=0;if(isObject(l))return w3_obj_enum(l,function(t,n){as=t.split("\\"),as.forEach(function(t){a+="<option value="+dq(w++)+" disabled>"+t+"</option> "});var e=l[t];isArray(e)&&e.forEach(function(t,e){var i=w3_first_value(t);a+="<option value="+dq(w++)+' id="id-'+n+"-"+e+'">'+i.toString()+"</option> "})}),w3int_select(t,n,e,i,r,a,o,_)}function w3_select_conditional(t,n,e,i,r,l,o,_){var a="",w=0;if(isArray(l))return l.forEach(function(t){isArray(t)&&(a+="<option value="+dq(w++)+" "+(t[1]?"":"disabled")+">"+t[0]+"</option> ")}),w3int_select(t,n,e,i,r,a,o,_)}function w3_select_set_disabled(t,n,e){w3_iterate_children("id-"+t,function(t,i){t.value==n&&(t.disabled=!!e)})}function w3_select_get_param(t,n,e,i,r,l,o){return w3_select(t,n,e,i,ext_get_cfg_param(i,null==o?0:o),r,l)}function w3_select_enum(t,n){(t=w3_el(t))&&w3_iterate_children(t,n)}function w3_select_value(t,n,e){if(w3_opt(e,"all"))w3_els(t,function(t){t.value=n});else{var i=w3_el(t);if(!i)return;i.value=n}}function w3_select_set_if_includes(t,n){var e=!1,i=RegExp(n);return w3_select_enum(t,function(n){i.test(n.innerHTML)&&(e||(w3_select_value(t,n.value),e=!0))}),e}function w3int_slider_change(t,n,e,i,r){var l=t.currentTarget;w3_check_restart_reboot(l),i&&w3_call(i,e,l.value,n,!1,r),n&&w3int_post_action()}function w3_slider_old(t,n,e,i,r,l,o){e=null==e?"":w3_strip_quotes(e);var _='oninput="w3int_slider_change(event, 0, '+sq(n)+", "+sq(o)+')" ',a='onchange="w3int_slider_change(event, 1, '+sq(n)+", "+sq(o)+')" ',w=w3_label("w3-bold",t,n)+'<br><input id="id-'+n+'" class="" value=\''+e+'\' type="range" min="'+i+'" max="'+r+'" step="'+l+'" '+_+a+">";return o&&setTimeout(function(){w3_call(o,n,e,!0,!0)},500),w}function w3_slider(t,n,e,i,r,l,o,_,a){var w=w3_add_id(e),c=t.includes("w3-label-inline"),s=!t.includes("w3-label-not-bold"),u=""!=n&&c?" w3-margin-L-8":"";c&&(u+=" w3-margin-left"),value=null==i?"":w3_strip_quotes(i),value="value="+dq(value),a=a||0;var d=' oninput="w3int_slider_change(event, 0, '+sq(e)+", "+sq(_)+", "+sq(a)+')"',f=' onchange="w3int_slider_change(event, 1, '+sq(e)+", "+sq(_)+", "+sq(a)+')"',v=w3_psa3(t),h=w3_psa(v.left,c?"w3-show-inline-new":""),p=w3_psa_mix(v.middle,""!=n&&s?"w3-bold":""),g=w3_psa(v.right,w+u,"",value+' type="range" min='+dq(r)+" max="+dq(l)+" step="+dq(o)+d+f),m="<div "+h+">"+w3_label(p,n,e)+(c||""==n?"":"<br>")+"<input "+g+"></div>";return _&&setTimeout(function(){w3_call(_,e,i,!0,!0,a)},500),m}function w3_slider_set(t,n,e){w3_set_value(t,n),w3_call(e,t,n,!0,!1)}function w3_slider_setup(t,n,e,i,r){var l=w3_el(t);return l?(l.min=n,l.max=e,l.step=i,l.value=r,l):l}function w3_menu(t,n){var e=t.replace(/\s+/g," ").split(" |")[0];n=n||"";var i="<div "+w3_psa(t,"w3-menu w3-round-large","",'onclick="w3int_menu_onclick(event, '+sq(e)+", "+sq(n)+')" oncontextmenu="w3int_menu_onclick(event, '+sq(e)+", "+sq(n)+')"')+"></div>";w3_el("id-w3-main-container").innerHTML+=i}function w3_menu_items(t,n){var e,i,r,l="",o=0;if(isArray(n))r=n;else{r=[];for(var _=1;_<arguments.length;_++)r.push(arguments[_])}for(_=0;_<r.length;_++)"<hr>"==r[_]?(e="w3-menu-item-hr",i=""):"!"==r[_].charAt(0)?(e="w3-menu-item-disabled",i="id="+dq(o),r[_]=r[_].substr(1),o++):(e="w3-menu-item",i="id="+dq(o),o++),l+=w3_div(e+"||"+i,r[_]);w3_el(t).innerHTML=l}function w3_menu_popup(t,n,e){var i=w3_el(t);-1==n&&(n=window.innerWidth/2),-1==e&&(e=window.innerHeight/2),i.style.top=px(e),i.style.left=px(n),i.style.visibility="visible",i.w3_menu_x=n,w3int_menu_close_cur_id=t,window.addEventListener("keyup",w3int_menu_close,!1),window.addEventListener("click",w3int_menu_close,!1)}function w3int_menu_onclick(t,n,e){var i=w3_el(n);if(i.style.visibility="hidden",window.removeEventListener("keyup",w3int_menu_close,!1),window.removeEventListener("click",w3int_menu_close,!1),null!=t&&null!=e){var r=t.target.id,l=+r;(""==r||isNaN(l))&&(r=t.target.parentNode.id),l=+r,(""==r||isNaN(l))&&(l=-1),w3_call(e,l,i.w3_menu_x)}if(null!=t)return cancelEvent(t)}function w3int_menu_close(t){("keyup"==t.type&&"Escape"==t.key||"click"==t.type&&2!=t.button)&&w3int_menu_onclick(null,w3int_menu_close_cur_id)}function w3_num_cb(t,n){var e=parseFloat(n);""==n&&(e=0),isNaN(e)&&(w3_set_value(t,0),e=0),setVarFromString(t,e)}function w3_bool_cb(t,n){v=+n,setVarFromString(t,v)}function w3_string_cb(t,n){setVarFromString(t,n.toString())}function w3_num_set_cfg_cb(t,n,e){var i=parseFloat(n);isNaN(i)&&(i=0),ext_set_cfg_param(t,i,null==e||!e)}function w3_int_set_cfg_cb(t,n,e){var i=parseInt(n);isNaN(i)&&(i=0),w3_set_value(t,i),ext_set_cfg_param(t,i,null==e||!e)}function w3_bool_set_cfg_cb(t,n,e){var i;i=1==n||1==n,ext_set_cfg_param(t,i,null==e||!e)}function w3_string_set_cfg_cb(t,n,e){var i=null==e||!e;ext_set_cfg_param(t,encodeURIComponent(n.toString()),i)}function w3_remove_trailing_index(t,n){n=n||"-";var e,i=new RegExp("(.*)"+n+"([-]?[0-9]+)").exec(t);return i?(e=i[2],i=i[1]):(e=-1,i=t),{el:i,idx:e}}function w3_table(t){for(var n="<table "+w3_psa(t,"w3-table w3-table-default")+">",e=1;e<arguments.length;e++)n+=arguments[e];return n+="</table>"}function w3_table_heads(t){for(var n=w3_psa(t,"w3-table-head"),e="",i=1;i<arguments.length;i++)null!=arguments[i]&&(e+="<th "+n+">",e+=arguments[i],e+="</th>");return e}function w3_table_row(t){for(var n="<tr "+w3_psa(t,"w3-table-row")+">",e=1;e<arguments.length;e++)null!=arguments[e]&&(n+=arguments[e]);return n+="</tr>"}function w3_table_cells(t){for(var n=w3_psa(t,"w3-table-cell"),e="",i=1;i<arguments.length;i++)null!=arguments[i]&&(e+="<td "+n+">",e+=arguments[i],e+="</td>");return e}function w3_inline(t,n){var e=arguments.length;if(""==t&&""==n&&e>2){console.log("### w3_inline OLD API DEPRECATED");var i=Array.prototype.splice.call(arguments,0);return i.splice(0,1),w3_inline.apply(null,i)}for(var r=w3_psa3(t),l=w3_psa(r.middle,"w3-show-inline-new"),o=w3_psa(r.right),_="<div w3d-inlo "+l+">",a=1;a<e;a++){var w=arguments[a],c=!1;w.startsWith("w3-")||w.startsWith("id-")?(t=w3_psa(r.right,w),w=arguments[++a],c=!0):t=o,""==r.right&&!c&&w.startsWith("<div ")?_+=w:_+="<div w3d-inli-"+(a-1)+" "+t+">"+w+"</div>"}return _+="</div>"}function w3_inline_percent(t){for(var n=w3_psa3(t),e=w3_psa(n.middle,"w3-show-inline-new"),i=arguments.length,r=0,l="<div w3d-inlpo "+e+">",o=1;o<i;o+=2){var _;o+1<i?(_="width:"+arguments[o+1]+"%",r+=arguments[o+1]):_="width:"+(100-r)+"%",l+="<div w3d-inlpi-"+(o-1)/2+" "+w3_psa(n.right,"",_)+">"+arguments[o]+"</div>"}return l+="</div>"}function w3_div(t){for(var n="<div w3d-div "+w3_psa(t)+">",e=arguments.length,i=1;i<e;i++)n+=arguments[i];return n+="</div>"}function w3_span(t){for(var n="<div w3d-span "+w3_psa(t,"w3-show-span")+">",e=arguments.length,i=1;i<e;i++)n+=arguments[i];return n+="</div>"}function w3_divs(t,n){var e,i,r=arguments.length;if(""==t&&""==n)return console.log("### w3_divs OLD API 1 DEPRECATED"),e=w3_div.apply(null,Array.prototype.splice.call(arguments,1));if(""!=t&&""==n&&r>2)return console.log("### w3_divs OLD API 2 DEPRECATED"),(i=Array.prototype.splice.call(arguments,0)).splice(1,1),e=w3_div.apply(null,i);if(""==t&&n&&n.startsWith("w3-")&&r>2)return console.log("### w3_divs OLD API 3 DEPRECATED"),(i=Array.prototype.splice.call(arguments,0)).splice(0,1),e=w3_divs.apply(null,i);if(""!=t&&n&&n.startsWith("w3-")&&r>2)return console.log("### w3_divs OLD API 4 DEPRECATED"),(i=Array.prototype.splice.call(arguments,2)).splice(0,0,arguments[0]+"/"+arguments[1]),e=w3_divs.apply(null,i);var l=w3_psa3(t),o=w3_psa(l.middle),_=w3_psa(l.right);e="<div w3d-divso "+o+">";for(var a=1;a<r;a++)e+="<div w3d-divsi-"+(a-1)+" "+_+">"+arguments[a]+"</div>";return e+="</div>"}function w3_col_percent(t){for(var n=w3_psa3(t),e=w3_psa(n.middle,"w3-row"),i=arguments.length,r="<div w3d-colpo "+e+">",l=1;l<i;l+=2){var o,_;l+1<i?(o="w3-col",_="width:"+arguments[l+1]+"%"):(o="w3-rest",_=""),r+="<div w3d-colpi-"+(l-1)/2+" "+w3_psa(n.right,o,_)+">"+arguments[l]+"</div>"}return r+="</div>"}function w3_text(t,n){return w3_div(w3_psa_mix(t,"w3-text","padding:0 4px 0 0; background-color:inherit"),n||" ")}function w3_code(t,n){for(var e=arguments.length,i='<pre class="'+t+'"><code>',r=2;r<e;r++)i+='<div class="'+n+'">'+arguments[r]+"</div>";return i+="</code></pre>"}function w3_half(t,n,e,i,r,l){return null==r&&(r=""),null==l&&(l=""),'<div class="w3-row '+t+'"><div class="w3-col w3-half '+n+r+'">'+e+'</div><div class="w3-col w3-half '+n+l+'">'+(i||"")+"</div></div>"}function w3_third(t,n,e,i,r){return'<div class="w3-row '+t+'"><div class="w3-col w3-third '+n+'">'+e+'</div><div class="w3-col w3-third '+n+'">'+(i||"")+'</div><div class="w3-col w3-third '+n+'">'+(r||"")+"</div></div>"}function w3_quarter(t,n,e,i,r,l){return'<div class="w3-row '+t+'"><div class="w3-col w3-quarter '+n+'">'+e+'</div><div class="w3-col w3-quarter '+n+'">'+(i||"")+'</div><div class="w3-col w3-quarter '+n+'">'+(r||"")+'</div><div class="w3-col w3-quarter '+n+'">'+(l||"")+"</div></div>"}function w3_canvas(t,n,e,i){var r="",l=w3_opt(i,"pad",null),o=w3_opt(i,"pad_top",0),_=w3_opt(i,"pad_bottom",0);isNull(l)||(o=_=l),(l=o+_)&&(r+=sprintf(" padding-top:%dpx; padding-bottom:%dpx;",o,_));var a=w3_opt(i,"left","");""!=a&&(r+=sprintf(" left:%dpx;",a));var w=w3_opt(i,"right","");""!=w&&(r+=sprintf(" right:%dpx;",w));var c=w3_opt(i,"top","");return""!=c&&(r+=sprintf(" top:%dpx;",c)),r="<canvas "+w3_psa(t,null,"position:absolute;"+r,sprintf('width="%d" height="%d"',n,e))+"></canvas>"}




/* web/kiwi/monitor.min.js */
var monitor={init:!1};function kiwi_queue_cb(){kiwi.queued^=1,w3_innerHTML("id-queue-button",kiwi.queued?"Exit queue":"Enter queue"),kiwi.queued||w3_innerHTML("id-queue-pos",""),msg_send("SET MON_QSET="+(kiwi.queued?1:0))}function kiwi_monitor(){console.log("n_camp="+cfg.n_camp);var e=cfg.n_camp?"To camp (listen) to the audio of an existing connection <br>click on one of the channel links below.":"No audio camping allowed on this Kiwi.",i=w3_div("",w3_text("w3-text-black","All Kiwi channels busy. Click button to wait in queue for an available channel."),w3_inline("w3-margin-L-8 w3-margin-T-4/w3-margin-right w3-valign",w3_button("id-queue-button w3-medium w3-padding-smaller w3-green","Enter queue","kiwi_queue_cb"),w3_text("id-queue-pos w3-text-black")),w3_text("id-queue-status w3-margin-T-4 w3-text-black",""),w3_div("id-camp-container",w3_hr("w3-margin-16"),w3_text("w3-margin-T-4 w3-text-black w3-show-block",e),w3_text("id-camp-status w3-margin-T-4 w3-text-black","")),w3_hr("w3-margin-16"),w3_div("id-users-list w3-margin-T-10"));kiwi_show_msg(i),kiwi.unmuted_color="mediumSeaGreen",users_init({monitor:1}),pwd_prot=chan_no_pwd_true?rx_chans-chan_no_pwd_true:0,console.log("rx_chans="+rx_chans+" chan_no_pwd_true="+chan_no_pwd_true+" pwd_prot="+pwd_prot);var n=plural(pwd_prot," channel"),t=1==pwd_prot?"is":"are";pwd_prot?(i="<br>Note that "+pwd_prot+n+" on this Kiwi "+t+" password protected. <br>This is why you may see empty channels you cannot access.",w3_innerHTML("id-queue-status",i)):w3_innerHTML("id-queue-status",""),setInterval(function(){msg_send("SET keepalive"),kiwi.queued&&msg_send("SET MON_QPOS")},2500),ws_any().msg_cb=function(e){var i=e[1]?e[1].split(","):null;switch(e[0]){case"qpos":var n=i[0],t=i[1];if(+i[2]){var a=kiwi_remove_search_param(window.location.href,"camp");window.location.href=a}var o="";kiwi.queued&&(o+="You are "+n+" of "+t+" in queue."),w3_innerHTML("id-queue-pos",o);break;case"camp":var w=+i[0],u=+i[1];w?(monitor.init||(check_suspended_audio_state(),monitor.init=!0),o=w3_inline("w3-margin-T-4/w3-margin-right w3-valign",w3_text("id-queue-pos w3-text-black","Camping on RX"+u),w3_button("w3-medium w3-padding-smaller w3-red","Stop","kiwi_camp_stop_cb"),w3_slider("w3-margin-L-16/w3-label-inline w3-label-not-bold/","Volume","kiwi.volume",kiwi.volume,0,200,1,"setvolume"),w3_div('|background-color: #e0e0e0; padding:2px; border-radius:8px|title="mute"',w3_div("id-mute-no fa-stack|width:28px; color:"+kiwi.unmuted_color,w3_icon("","fa-volume-up fa-stack-2x fa-nudge-up",24,"inherit","toggle_or_set_mute")),w3_div("id-mute-yes fa-stack w3-hide|width:28px;color:magenta;",w3_icon("","fa-volume-off fa-stack-2x fa-nudge-left fa-nudge-up",24,"","toggle_or_set_mute"),w3_icon("","fa-times fa-right",12,"","toggle_or_set_mute"))))):o="Too many campers on channel RX"+u,w3_innerHTML("id-camp-status",o),toggle_or_set_mute(0);break;case"camp_stop":kiwi_camp_stop_cb();break;default:owrx_msg_cb(e)}}}function camp(e,i,n,t){console.log("camp ch"+e),cfg.n_camp&&msg_send("SET MON_CAMP="+e)}function kiwi_camp_stop_cb(){console.log("camp STOP"),w3_innerHTML("id-camp-status",""),msg_send("SET MON_CAMP=-1")}




/* web/openwebrx/openwebrx.min.js */
var owrx={mobile:null,last_freq:-1,last_mode:"",last_locut:-1,last_hicut:-1,last_mode_el:null,dseq:0,sMeter_dBm_biased:0,sMeter_dBm:0,squelched_overload:!1,prev_squelched_overload:!1,touch_hold_pressed:!1,tuning_locked:0,dx_click_gid_last:void 0,chan_null:0,chan_null_s:["normal","null LSB","null USB"]},bandwidth,center_freq,wf_fft_size,height_top_bar_parts=67,height_spectrum_canvas=200,cur_mode,wf_fps,wf_fps_max,ws_snd,ws_wf,spectrum_show=0,spectrum_param=-1,gen_freq=0,gen_attn=0,squelch_threshold=0,wf_rate="",wf_mm="",wf_compression=1,debug_v=0,sb_trace=0,kiwi_gc=1,kiwi_gc_snd=0,kiwi_gc_wf=-1,kiwi_gc_recv=-1,kiwi_gc_wspr=-1,override_ext=null,muted_initially=0,peak_initially=null,param_nocache=!1,nocache=!1,param_ctrace=!1,ctrace=!1,no_clk_corr=!1,override_pbw="",override_pbc="",nb_click=!1,no_geoloc=!1,mobile_laptop_test=!1,user_url=null,freq_memory=[],freq_memory_pointer=-1,wf_rates={0:0,off:0,1:1,"1hz":1,s:2,slow:2,m:3,med:3,f:4,fast:4},okay_waterfall_init=!1;function kiwi_main(){override_freq=parseFloat(readCookie("last_freq")),override_mode=readCookie("last_mode"),override_zoom=parseFloat(readCookie("last_zoom")),override_9_10=parseFloat(readCookie("last_9_10")),override_max_dB=parseFloat(readCookie("last_max_dB")),override_min_dB=parseFloat(readCookie("last_min_dB"));var e=readCookie("freq_memory");e&&(freq_memory=JSON.parse(e),freq_memory_pointer=freq_memory.length-1),console.log("LAST f="+override_freq+" m="+override_mode+" z="+override_zoom+" 9_10="+override_9_10+" min="+override_min_dB+" max="+override_max_dB);console.log("URL: "+window.location.href);var t=function(e){var t={};return e&&e.split("&").forEach(function(e){var a=e.split("=");t[a[0]]=a[1]?a[1]:1}),t},a=window.location.search&&window.location.search.substr(1),_=[],i=[];for(w=1;w<=16;w++){var n="&win"+(w+1)+"&";_[w]=a&&a.split(n)[0],a=a&&a.split(n)[1],i[w]=t(_[w]),i[w].WID=w}var o=window.location.href.split("?")[0];for(g_qs_idx=2,w=2;w<=16;w++)_[w]&&setTimeout(function(){var e=o+"?"+_[g_qs_idx];g_qs_idx++,null==window.open(e,"_blank")&&alert("Do you have popups blocked for this site? "+e)},2e3*(w-1));a=i[1];if(s="f",a[s]){var r=new RegExp("([0-9.,kM]*)([/:][-0-9.,k]*)?([^z]*)?z?([0-9]*)").exec(a[s]);r[1]&&(override_freq=r[1].replace(",",".").parseFloatWithUnits("M",.001)),r[1]&&console.log("p="+r[1]+" override_freq="+override_freq),r[2]&&console.log("override_pbw/pbc="+r[2]),r[2]&&"/"==r[2].charAt(0)&&(override_pbw=r[2].substr(1)),r[2]&&":"==r[2].charAt(0)&&(override_pbc=r[2].substr(1)),r[3]&&(override_mode=r[3].toLowerCase()),r[4]&&(override_zoom=r[4])}if(s="ext",a[s]&&isString(a[s])){var l=a[s].split(",");override_ext=l[0],extint.param=l.slice(1).join(","),console.log("URL: ext="+override_ext+" ext_p="+extint.param)}if(s="pbw",a[s]&&(override_pbw=a[s]),s="pb",a[s]&&(override_pbw=a[s]),s="pbc",a[s]&&(override_pbc=a[s]),s="sp",a[s]&&(spectrum_show=a[s]),s="spp",a[s]&&(spectrum_param=parseFloat(a[s])),s="vol",a[s]&&(kiwi.volume=parseInt(a[s]),kiwi.volume=Math.max(0,Math.min(400,kiwi.volume))),s="mute",a[s]&&(muted_initially=parseInt(a[s])),s="wf",a[s]&&(wf_rate=a[s]),s="wfm",a[s]&&(wf_mm=a[s]),s="cmap",a[s]&&(wf.cmap_override=w3_clamp(parseInt(a[s]),0,kiwi.cmap_s.length-1,0)),s="sqrt",a[s]&&(wf.sqrt=w3_clamp(parseInt(a[s]),0,4,0)),s="peak",a[s]&&(peak_initially=parseInt(a[s])),s="no_geo",a[s]&&(no_geoloc=!0),s="keys",a[s]&&(shortcut.keys=a[s]),s="user",a[s]&&(user_url=a[s]),s="u",a[s]&&(user_url=a[s]),s="sqth",a[s]&&(squelch_threshold=parseFloat(a[s])),s="click",a[s]&&(nb_click=!0),s="nocache",a[s]&&(param_nocache=!0,nocache=parseInt(a[s])),s="ncc",a[s]&&(no_clk_corr=parseInt(a[s])),s="wfdly",a[s]&&(waterfall_delay=parseFloat(a[s])),s="wf_comp",a[s]&&(wf_compression=parseInt(a[s])),s="gen",a[s]&&(gen_freq=parseFloat(a[s])),s="attn",a[s]&&(gen_attn=parseInt(a[s])),s="blen",a[s]&&(audio_buffer_min_length_sec=parseFloat(a[s])/1e3),s="audio",a[s]&&(audio_meas_dly_ena=parseFloat(a[s])),s="gc",a[s]&&(kiwi_gc=parseInt(a[s])),s="gc_snd",a[s]&&(kiwi_gc_snd=parseInt(a[s])),s="gc_wf",a[s]&&(kiwi_gc_wf=parseInt(a[s])),s="gc_recv",a[s]&&(kiwi_gc_recv=parseInt(a[s])),s="gc_wspr",a[s]&&(kiwi_gc_wspr=parseInt(a[s])),s="ctrace",a[s]&&(param_ctrace=!0,ctrace=parseInt(a[s])),s="mobile",a[s]&&(mobile_laptop_test=!0),s="v",a[s]&&console.log("URL: debug_v = "+(debug_v=a[s])),-1==kiwi_gc_snd&&(kiwi_gc_snd=kiwi_gc),-1==kiwi_gc_wf&&(kiwi_gc_wf=kiwi_gc),-1==kiwi_gc_recv&&(kiwi_gc_recv=kiwi_gc),-1==kiwi_gc_wspr&&(kiwi_gc_wspr=kiwi_gc),console.log("GC: snd="+kiwi_gc_snd+" wf="+kiwi_gc_wf+" recv="+kiwi_gc_recv+" wspr="+kiwi_gc_wspr),""!=wf_mm){wf_mm=wf_mm.split(",");var d=parseInt(wf_mm[0]);!isNaN(d)&&d>=-190&&d<=-30&&(override_min_dB=d),wf_mm.length>=2&&(d=parseInt(wf_mm[1]),!isNaN(d)&&d>=-100&&d<=20&&(override_max_dB=d))}if(kiwi_xdLocalStorage_init(),kiwi_get_init_settings(),no_geoloc||kiwi_geolocate(),init_rx_photo(),right_click_menu_init(),keyboard_shortcut_init(),confirmation_panel_init(),ext_panel_init(),place_panels(),init_panels(),okay_waterfall_init=!0,confirmation_panel_init2(),smeter_init(),time_display_setup("id-topbar-right-container"),window.setInterval(send_keepalive,5e3),window.addEventListener("resize",openwebrx_resize),param_nocache&&console.log("### nocache="+(nocache?1:0)),param_ctrace&&console.log("### ctrace="+(ctrace?1:0)),snd_send("SERVER DE CLIENT openwebrx.js SND"),snd_send("SET dbug_v="+debug_v),0!=gen_attn){var c=gen_attn,f=Math.pow(10,-c/20);gen_attn=131071*f,console.log("### GEN dB="+c+" ampl_gain="+f+" attn="+gen_attn+" / "+gen_attn.toHex())}(gen_freq||gen_attn)&&set_gen(gen_freq,gen_attn),snd_send("SET mod=am low_cut=-4000 high_cut=4000 freq=1000"),set_agc(),snd_send("SET browser="+navigator.userAgent),wf_send("SERVER DE CLIENT openwebrx.js W/F"),wf_send("SET send_dB=1"),wf_send("SET zoom=0 start=0"),wf_send("SET maxdb=0 mindb=-100"),0==wf_compression&&wf_send("SET wf_comp=0"),null==(wf_speed=wf_rates[wf_rate])&&(wf_speed=WF_SPEED_FAST),wf_send("SET wf_speed="+wf_speed)}var ptype={HIDE:0,POPUP:1,TOGGLE:2},popt={CLOSE:-1,PERSIST:0},visBorder=10,visIcon=24,readme_color="blueViolet",show_news=!1,news_color="#ff00bf";function init_panels(){init_panel_toggle(ptype.TOGGLE,"id-control",!1,popt.PERSIST);var e=updateCookie("readme","seen2");kiwi_isMobile()&&(e=!1),init_panel_toggle(ptype.TOGGLE,"id-readme",!1,e?popt.PERSIST:popt.CLOSE,readme_color);var t=null==readCookie("news","seen");init_panel_toggle(ptype.POPUP,"id-news",!1,show_news&&t?popt.PERSIST:popt.CLOSE),init_panel_toggle(ptype.POPUP,"id-ext-controls",!1,popt.CLOSE),init_panel_toggle(ptype.POPUP,"id-confirmation",!1,popt.CLOSE)}function init_panel_toggle(e,t,a,_,i){var n=w3_el(t);n.ptype=e;var o=w3_el(t+"-vis");n.scrollable=1==a;var s=n.scrollable?-kiwi_scrollbar_width():visBorder,r="right"==n.getAttribute("data-panel-pos");if(n.panelShown=1,e==ptype.TOGGLE){var l=r?"right":"left",d=r?"left":"right";o.innerHTML='<a id="'+t+'-hide" onclick="toggle_panel('+sq(t)+');"><img src="icons/hide'+l+'.24.png" width="24" height="24" /></a><a id="'+t+'-show" class="class-vis-show" onclick="toggle_panel('+sq(t)+');"><img src="icons/hide'+d+'.24.png" width="24" height="24" /></a>'}else o.innerHTML='<a id="'+t+'-close" onclick="toggle_panel('+sq(t)+');"><img id='+dq(t+"-close-img")+' src="icons/close.24.png" width="24" height="24" /></a>';var c=n.activeWidth-visIcon;if(r?o.style.right=px(0):o.style.left=px(c+s),o.style.top=px(visBorder),null!=_&&(_?setTimeout(function(){toggle_panel(t)},_):_==popt.CLOSE?toggle_panel(t):e==ptype.POPUP&&(n.style.visibility="visible")),null!=i){var f=w3_el(t+"-show");null!=f&&(f.style.backgroundColor=f.style.borderColor=i)}}function toggle_panel(e,t){var a=w3_el(e),_=w3_el(e+"-vis");if(isDefined(t)&&(a.panelShown=1^t),a.ptype==ptype.POPUP)return a.style.visibility=a.panelShown?"hidden":"visible",a.panelShown^=1,updateCookie(e,"seen"),void freqset_select();var i,n,o=a.activeWidth+30,s="right"==a.getAttribute("data-panel-pos");o=-o,a.panelShown?(i=0,n=o):(i=o,n=kiwi_scrollbar_width()),animate(a,s?"right":"left","px",i,n,.93,kiwi_isMobile()?1:1e3,60,0),w3_hide(e+"-"+(a.panelShown?"hide":"show")),w3_show_block(e+"-"+(a.panelShown?"show":"hide")),a.panelShown^=1;var r=a.activeWidth-visIcon,l=a.scrollable?-kiwi_scrollbar_width():visBorder;console.log("toggle_panel "+e+" right="+s+" shown="+a.panelShown),s?_.style.right=px(a.panelShown?0:r+visIcon+2*visBorder):_.style.left=px(r+(a.panelShown?l:visIcon+2*visBorder)),freqset_select()}function openwebrx_resize(e){e=isString(e)&&e.startsWith("orient")?e:"event",resize_canvases(),resize_waterfall_container(!0),extint_environment_changed({resize:1}),resize_scale(e),check_top_bar_congestion()}var offsetDiff_init=!1,p_left,p_owner,p_mid,p_right;function offsetDiff(e,t,a,_){var i=w3_el("id-tbar-"+e.toLowerCase()+"-bbox");i.style.left=px(a.x1),i.style.width=px(a.w),i.style.height=px(a.h),i.style.backgroundColor=t,console.log(e+" L/R/W="+a.x1+"/"+a.x2+"/"+a.w+" ("+(_.x1-a.x1)+"/"+(_.x2-a.x2)+"/"+(_.w-a.w)+")")}function check_top_bar_congestion(){var e=w3_boundingBox_children("id-left-info-container"),t=w3_boundingBox_children("id-mid-owner-container"),a=w3_boundingBox_children("id-mid-info-container"),_=w3_boundingBox_children("id-topbar-right-container"),i=e.x2+(a.x1-e.x2)/2-t.w/2;w3_el("id-owner-info").style.left=px(i),t=w3_boundingBox_children("id-mid-owner-container"),w3_visible("id-mid-owner-container",t.x1>=e.x2),w3_visible("id-mid-info-container",a.x1>=e.x2),w3_visible("id-topbar-right-container",_.x1>=e.x2),w3_el("id-rx-details-arrow").style.left=px(e.x2)}var rx_photo_spacer_height=height_top_bar_parts;function init_rx_photo(){w3_el("id-top-photo-img").style.paddingLeft=RX_PHOTO_LEFT_MARGIN?"50px":0,RX_PHOTO_HEIGHT+=rx_photo_spacer_height,w3_el("id-top-photo-clip").style.maxHeight=px(RX_PHOTO_HEIGHT),dbgUs||kiwi_isMobile()?close_rx_photo():window.setTimeout(function(){close_rx_photo()},3e3)}var rx_photo_state=1;function open_rx_photo(){rx_photo_state=1,html("id-rx-photo-desc").style.opacity=1,html("id-rx-photo-title").style.opacity=1,animate_to(html("id-top-photo-clip"),"maxHeight","px",RX_PHOTO_HEIGHT,.93,kiwi_isMobile()?1:1e3,60,function(){resize_waterfall_container(!0)}),w3_hide("id-rx-details-arrow-down"),w3_show_block("id-rx-details-arrow-up")}function close_rx_photo(){rx_photo_state=0,animate_to(html("id-top-photo-clip"),"maxHeight","px",rx_photo_spacer_height,.93,kiwi_isMobile()?1:1e3,60,function(){resize_waterfall_container(!0)}),w3_show_block("id-rx-details-arrow-down"),w3_hide("id-rx-details-arrow-up")}function dont_toggle_rx_photo(){dont_toggle_rx_photo_flag=1}function toggle_rx_photo(){dont_toggle_rx_photo_flag?dont_toggle_rx_photo_flag=0:(rx_photo_state?close_rx_photo():open_rx_photo(),freqset_select())}function animate(e,t,a,_,i,n,o,s,r){isUndefined(r)&&(r=0),e.style[t]=_.toString()+a,e.anim_i=0,n_of_iters=o/(1e3/s),n_of_iters<1&&(n_of_iters=1),change=(i-_)/n_of_iters,isDefined(e.anim_timer)&&window.clearInterval(e.anim_timer),e.anim_timer=window.setInterval(function(){e.anim_i++<n_of_iters?1==n?e.style[t]=(parseFloat(e.style[t])+change).toString()+a:(remain=parseFloat(e.style[t])-i,Math.abs(remain)>9||"px"!=a?new_val=i+n*remain:Math.abs(remain)<2?new_val=i:new_val=i+remain-remain/Math.abs(remain),e.style[t]=new_val.toString()+a):(e.style[t]=i.toString()+a,window.clearInterval(e.anim_timer),delete e.anim_timer),0!=r&&r()},1e3/s)}function animate_to(e,t,a,_,i,n,o,s){from=parseFloat(style_value(e,t)),animate(e,t,a,from,_,i,n,o,s)}function style_value(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?document.defaultView.getComputedStyle(e,null)[t]:e.style[t]}function demodulators_get_next_color(){return demodulator_color_index>=demodulator_colors.length&&(demodulator_color_index=0),demodulator_colors[demodulator_color_index++]}function demod_envelope_draw(e,t,a,_,i){isUndefined(_)&&(_="#ffff00"),env_bounding_line_w=5,env_att_w=5,env_h1=17,env_h2=5,env_lineplus=1,env_line_click_area=8,env_slop=5,from_px=scale_px_from_freq(t,e),to_px=scale_px_from_freq(a,e),to_px<from_px&&(temp_px=to_px,to_px=from_px,from_px=temp_px),pb_adj_cf.style.left=from_px+"px",pb_adj_cf.style.width=to_px-from_px+"px",pb_adj_lo.style.left=from_px-env_bounding_line_w-2*env_slop+"px",pb_adj_lo.style.width=env_bounding_line_w+env_att_w+2*env_slop+"px",pb_adj_hi.style.left=to_px-env_bounding_line_w+"px",pb_adj_hi.style.width=env_bounding_line_w+env_att_w+2*env_slop+"px",from_px-=env_att_w+env_bounding_line_w,to_px+=env_att_w+env_bounding_line_w,scale_ctx.lineWidth=3,scale_ctx.strokeStyle=_,scale_ctx.fillStyle=_;var n={envelope_on_screen:!1,line_on_screen:!1};return to_px<0||from_px>window.innerWidth||(n.beginning={x1:from_px,x2:from_px+env_bounding_line_w+env_att_w+env_slop},n.ending={x1:to_px-env_bounding_line_w-env_att_w-env_slop,x2:to_px},n.whole_envelope={x1:from_px,x2:to_px},n.envelope_on_screen=!0,scale_ctx.beginPath(),scale_ctx.moveTo(from_px,env_h1),scale_ctx.lineTo(from_px+env_bounding_line_w,env_h1),scale_ctx.lineTo(from_px+env_bounding_line_w+env_att_w,env_h2),scale_ctx.lineTo(to_px-env_bounding_line_w-env_att_w,env_h2),scale_ctx.lineTo(to_px-env_bounding_line_w,env_h1),scale_ctx.lineTo(to_px,env_h1),scale_ctx.globalAlpha=.3,scale_ctx.fill(),scale_ctx.globalAlpha=1,scale_ctx.stroke()),isDefined(i)&&(line_px=scale_px_from_freq(i,e),line_px<0||line_px>window.innerWidth||(n.line={x1:line_px-env_line_click_area/2,x2:line_px+env_line_click_area/2},n.line_on_screen=!0,scale_ctx.moveTo(line_px,env_h1+env_lineplus),scale_ctx.lineTo(line_px,env_h2-env_lineplus),scale_ctx.stroke(),pb_adj_car.style.left=n.line.x1+"px",pb_adj_car.style.width=env_line_click_area+"px")),n}function demod_envelope_where_clicked(e,t,a){if(in_range=function(e,t){return t.x1<=e&&t.x2>=e},dr=demodulator.draggable_ranges,a.shiftKey){if(t.line_on_screen&&in_range(e,t.line))return dr.bfo;if(t.envelope_on_screen&&in_range(e,t.whole_envelope))return dr.pbs}if(a.altKey){if(t.envelope_on_screen&&in_range(e,t.beginning))return dr.bwlo;if(t.envelope_on_screen&&in_range(e,t.ending))return dr.bwhi}if(t.envelope_on_screen){if(in_range(e,t.beginning))return dr.beginning;if(in_range(e,t.ending))return dr.ending;if(in_range(e,t.whole_envelope))return dr.anything_else}return dr.none}dont_toggle_rx_photo_flag=0,demodulators=[],demodulator_color_index=0,demodulator_colors=["#ffff00","#00ff00","#00ffff","#058cff","#ff9600","#a1ff39","#ff4e39","#ff5dbd"],demodulator=function(e){this.offset_frequency=e,this.has_audio_output=!0,this.has_text_output=!1,this.envelope={},this.color=demodulators_get_next_color(),this.stop=function(){}},demodulator.draggable_ranges={none:0,beginning:1,ending:2,anything_else:3,bfo:4,pbs:5,bwlo:6,bwhi:7},demodulator_response_time=100;var passbands={am:{lo:-4900,hi:4900},amn:{lo:-2500,hi:2500},sam:{lo:-4900,hi:4900},sal:{lo:-4900,hi:0},sau:{lo:0,hi:4900},sas:{lo:-4900,hi:4900},qam:{lo:-4900,hi:4900},drm:{lo:-5e3,hi:5e3},lsb:{lo:-2700,hi:-300},lsn:{lo:-2400,hi:-300},usb:{lo:300,hi:2700},usn:{lo:300,hi:2400},cw:{lo:300,hi:700,pbw:400},cwn:{lo:470,hi:530,pbw:60},nbfm:{lo:-6e3,hi:6e3},iq:{lo:-5e3,hi:5e3}},scale_ctx,band_ctx,dx_ctx,pb_adj_cf,pb_adj_cf_ttip,pb_adj_lo,pb_adj_lo_ttip,pb_adj_hi,pb_adj_hi_ttip,pb_adj_car,pb_adj_car_ttip,scale_canvas,band_canvas,dx_div,dx_canvas;function demodulator_default_analog(e,t,a,_){null==passbands[t]&&(t="am"),demodulator.call(this,e),this.subtype=t,this.envelope.dragged_range=demodulator.draggable_ranges.none;var i=audio_input_rate?audio_input_rate/2:5e3;this.filter={min_passband:4,high_cut_limit:i,low_cut_limit:-i},this.server_mode=t;var n=isNaN(a)?passbands[t].last_lo:a,o=isNaN(_)?passbands[t].last_hi:_;if("undefined"!=n&&null!=n||(n=passbands[t].last_lo=passbands[t].lo),"undefined"!=o&&null!=o||(o=passbands[t].last_hi=passbands[t].hi),""!=override_pbw){var s=n+(o-n)/2,r=this.filter.min_passband,l=(override_pbw=decodeURIComponent(override_pbw)).split(",");console.log("p.len="+l.length);var d=l[0].parseFloatWithUnits("k");console.log('nlo="'+l[0]+'" '+d);var c=NaN;l.length>1&&(c=l[1].parseFloatWithUnits("k"),console.log('nhi="'+l[1]+'" '+d)),1==l.length&&!isNaN(d)&&d>=r?(n=s-d/2,o=s+d/2):2==l.length&&!isNaN(d)&&!isNaN(c)&&d<c&&c-d>=r&&(n=d,o=c),override_pbw="",extint.override_pb=!0}if(""!=override_pbc){var f=(o-n)/2,p=(r=this.filter.min_passband,(l=(override_pbc=decodeURIComponent(override_pbc)).split(","))[0].parseFloatWithUnits("k"));console.log('pbc="'+l[0]+'" '+d);var u=NaN;l.length>1&&(u=l[1].parseFloatWithUnits("k"),console.log('pbw="'+l[1]+'" '+d)),1!=l.length||isNaN(p)?2==l.length&&!isNaN(p)&&!isNaN(u)&&u>=r&&(n=p-u/2,o=p+u/2):(n=p-f,o=p+f),override_pbc="",extint.override_pb=!0}switch(this.low_cut=Math.max(n,this.filter.low_cut_limit),this.high_cut=Math.min(o,this.filter.high_cut_limit),this.usePBCenter=!1,this.isCW=!1,t){case"am":case"amn":case"sam":case"sal":case"sau":case"sas":case"qam":case"drm":case"nbfm":case"iq":break;case"lsb":case"lsn":case"usb":case"usn":this.usePBCenter=!0;break;case"cw":case"cwn":this.usePBCenter=!0,this.isCW=!0;break;default:console.log("DEMOD-new: unknown subtype="+t)}this.wait_for_timer=!1,this.set_after=!1,this.set=function(){this.wait_for_timer?this.set_after=!0:(this.doset(),this.set_after=!1,this.wait_for_timer=!0,timeout_this=this,window.setTimeout(function(){timeout_this.wait_for_timer=!1,timeout_this.set_after&&timeout_this.set()},demodulator_response_time))},this.doset=function(){var e=(freq_car_Hz/1e3).toFixed(3),t=this.server_mode,a=this.low_cut.toString(),_=this.high_cut.toString();snd_send("SET mod="+t+" low_cut="+a+" high_cut="+_+" freq="+e+("sam"==t?" param="+owrx.chan_null:""));var i=null;e!=owrx.last_freq&&((i=i||{}).freq=1,owrx.last_freq=e),t!=owrx.last_mode&&((i=i||{}).mode=1,owrx.last_mode=t),a==owrx.last_locut&&_==owrx.last_hicut||((i=i||{}).passband=1,owrx.last_locut=a,owrx.last_hicut=_),null!=i&&extint_environment_changed(i),muted_until_freq_set&&(toggle_or_set_mute(muted_initially),muted_until_freq_set=!1),audio_meas_dly_ena&&(audio_meas_dly_start=(new Date).getTime())},this.envelope.parent=this,this.envelope.draw=function(e){this.visible_range=e,this.drag_ranges=demod_envelope_draw(g_range,center_freq+this.parent.offset_frequency+this.parent.low_cut,center_freq+this.parent.offset_frequency+this.parent.high_cut,this.color,center_freq+this.parent.offset_frequency);var t=Math.abs(this.parent.high_cut-this.parent.low_cut);pb_adj_lo_ttip.innerHTML="lo "+this.parent.low_cut.toString()+", bw "+t.toString(),pb_adj_hi_ttip.innerHTML="hi "+this.parent.high_cut.toString()+", bw "+t.toString(),pb_adj_cf_ttip.innerHTML="cf "+(this.parent.low_cut+Math.abs(this.parent.high_cut-this.parent.low_cut)/2).toString(),pb_adj_car_ttip.innerHTML=((center_freq+this.parent.offset_frequency)/1e3+cfg.freq_offset).toFixed(2)+" kHz"},this.envelope.drag_start=function(e,t){return this.key_modifiers=t,this.dragged_range=demod_envelope_where_clicked(e,this.drag_ranges,t),this.drag_origin={x:e,low_cut:this.parent.low_cut,high_cut:this.parent.high_cut,offset_frequency:this.parent.offset_frequency},this.dragged_range!=demodulator.draggable_ranges.none},this.envelope.drag_move=function(e){var t=demodulator.draggable_ranges;if(this.dragged_range==t.none)return!1;freq_change=Math.round(this.visible_range.hpp*(e-this.drag_origin.x));var a=this.dragged_range==t.bfo,_=this.dragged_range==t.beginning,i=this.dragged_range==t.ending,n=this.dragged_range==t.bwlo,o=this.dragged_range==t.bwhi,s=a||this.dragged_range==t.pbs||n||o,r=a||o?-1:1,l=a||n?-1:1,d=this.drag_origin.low_cut,c=_||s;c&&(d+=r*freq_change);var f=this.drag_origin.high_cut,p=i||s;if(p&&(f+=l*freq_change),c){if(d<this.parent.filter.low_cut_limit)return!0;if(f-d<this.parent.filter.min_passband)return!0;if(d>=f)return!0}if(p){if(f>this.parent.filter.high_cut_limit)return!0;if(f-d<this.parent.filter.min_passband)return!0;if(f<=d)return!0}if(c&&(passbands[this.parent.server_mode].last_lo=this.parent.low_cut=d),p&&(passbands[this.parent.server_mode].last_hi=this.parent.high_cut=f),this.dragged_range==t.anything_else||a){if(new_value=this.drag_origin.offset_frequency+freq_change,new_value>bandwidth/2||new_value<-bandwidth/2)return!0;this.parent.offset_frequency=new_value}return mkenvelopes(this.visible_range),freqset_car_Hz(this.parent.offset_frequency+center_freq),this.parent.set(),freqset_update_ui(),!0},this.envelope.drag_end=function(e){return to_return=this.dragged_range!=demodulator.draggable_ranges.none,this.dragged_range=demodulator.draggable_ranges.none,to_return}}function mkenvelopes(e){scale_ctx.clearRect(0,0,scale_ctx.canvas.width,22);for(var t=0;t<demodulators.length;t++)demodulators[t].envelope.draw(e)}function demodulator_remove(e){demodulators[e].stop(),demodulators.splice(e,1)}function demodulator_add(e){demodulators.push(e),waterfall_setup_done&&mkenvelopes(get_visible_freq_range())}function demodulator_analog_replace(e,t){null==passbands[e]&&(e="am");var a=0,_=0,i=!1,n=!1,o=!1,s=e.substr(0,2);if(w3_show_hide("id-sam-carrier-container","sa"==s||"qa"==s),demodulators.length)i=demodulators[0].isCW,a=demodulators[0].offset_frequency,_=passband_offset(),demodulator_remove(0);else{var r=Math.round(1e3*(init_frequency-cfg.freq_offset));a=r<=0||r>bandwidth?0:r-center_freq,e=init_mode}if(isArg(t)&&(a=t-center_freq),demodulator_add(new demodulator_default_analog(a,e,NaN,NaN)),!i&&demodulators[0].isCW&&(n=!0),i&&!demodulators[0].isCW&&(o=!0),isArg(t))a=(freq_car_Hz=freq_dsp_to_car(t))-center_freq,wf.audioFFT_clear_wf=!0;else{var l=0;n&&(l=-passband_offset()),o&&(l=_),a+=l,(n||o)&&(wf.audioFFT_clear_wf=!0)}"drm"!=cur_mode&&(extint.prev_mode=cur_mode),cur_mode=e,(n||o)&&set_agc(),demodulator_set_offset_frequency(0,a),try_modeset_update_ui(e)}function demodulator_set_offset_frequency(e,t){if(!(t>bandwidth/2||t<-bandwidth/2)){freqset_car_Hz((t=Math.round(t))+center_freq);var a=demodulators[0];a.offset_frequency=t,a.set(),try_freqset_update_ui()}}function owrx_cfg(){var e=passbands.cw;e.lo=cfg.init.cw_offset-e.pbw/2,e.hi=cfg.init.cw_offset+e.pbw/2;var t=passbands.cwn;t.lo=cfg.init.cw_offset-t.pbw/2,t.hi=cfg.init.cw_offset+t.pbw/2}function scale_setup(){w3_el("id-scale-container").addEventListener("mouseout",scale_container_mouseout,!1),scale_canvas=html("id-scale-canvas"),scale_ctx=scale_canvas.getContext("2d"),add_scale_listner(scale_canvas),(pb_adj_car=html("id-pb-adj-car")).innerHTML='<span id="id-pb-adj-car-ttip" class="class-passband-adjust-car-tooltip class-tooltip-text"></span>',pb_adj_car_ttip=html("id-pb-adj-car-ttip"),add_scale_listner(pb_adj_car),(pb_adj_lo=html("id-pb-adj-lo")).innerHTML='<span id="id-pb-adj-lo-ttip" class="class-passband-adjust-cut-tooltip class-tooltip-text"></span>',pb_adj_lo_ttip=html("id-pb-adj-lo-ttip"),add_scale_listner(pb_adj_lo),(pb_adj_hi=html("id-pb-adj-hi")).innerHTML='<span id="id-pb-adj-hi-ttip" class="class-passband-adjust-cut-tooltip class-tooltip-text"></span>',pb_adj_hi_ttip=html("id-pb-adj-hi-ttip"),add_scale_listner(pb_adj_hi),(pb_adj_cf=html("id-pb-adj-cf")).innerHTML='<span id="id-pb-adj-cf-ttip" class="class-passband-adjust-cf-tooltip class-tooltip-text"></span>',pb_adj_cf_ttip=html("id-pb-adj-cf-ttip"),add_scale_listner(pb_adj_cf),band_canvas=html("id-band-canvas"),band_ctx=band_canvas.getContext("2d"),add_canvas_listner(band_canvas),add_canvas_listner(dx_div=html("id-dx-container")),dx_canvas=html("id-dx-canvas"),dx_ctx=dx_canvas.getContext("2d"),add_canvas_listner(dx_canvas),resize_scale("setup")}function add_scale_listner(e){e.addEventListener("mousedown",scale_canvas_mousedown,!1),e.addEventListener("mousemove",scale_canvas_mousemove,!1),e.addEventListener("mouseup",scale_canvas_mouseup,!1),e.addEventListener("contextmenu",scale_canvas_contextmenu,!1),kiwi_isMobile()&&(e.addEventListener("touchstart",scale_canvas_touchStart,!1),e.addEventListener("touchmove",scale_canvas_touchMove,!1),e.addEventListener("touchend",scale_canvas_touchEnd,!1))}function scale_canvas_contextmenu(e){return cancelEvent(e)}demodulator_default_analog.prototype=new demodulator;var scale_canvas_drag_params={mouse_down:!1,drag:!1,start_x:0,last_x:0,start_y:0,last_y:0,key_modifiers:{shiftKey:!1,altKey:!1,ctrlKey:!1}};function scale_canvas_mousedown(evt){with(scale_canvas_drag_params)drag=!1,start_x=evt.pageX,start_y=evt.pageY,key_modifiers.shiftKey=evt.shiftKey,key_modifiers.altKey=evt.altKey,key_modifiers.ctrlKey=evt.ctrlKey;scale_canvas_start_drag(evt,1),evt.preventDefault()}function scale_canvas_touchStart(evt){if(1==evt.targetTouches.length){with(scale_canvas_drag_params)drag=!1,last_x=start_x=evt.targetTouches[0].pageX,last_y=start_y=evt.targetTouches[0].pageY,key_modifiers.shiftKey=!1,key_modifiers.altKey=!1,key_modifiers.ctrlKey=!1;scale_canvas_start_drag(evt,0)}evt.preventDefault()}var scale_canvas_ignore_mouse_event=!1;function scale_canvas_start_drag(e,t){if(e.button==mouse.right&&!e.ctrlKey)return right_click_menu(scale_canvas_drag_params.start_x,scale_canvas_drag_params.start_y),scale_canvas_drag_params.mouse_down=!1,void(scale_canvas_ignore_mouse_event=!0);scale_canvas_drag_params.mouse_down=!0,t&&scale_canvas_mousemove(e)}function scale_offset_carfreq_from_px(e,t){isUndefined(t)&&(t=get_visible_freq_range());var a=passband_offset();return t.start+t.bw*(e/canvas_container.clientWidth)-center_freq-a}function scale_canvas_drag(e,t){if(!scale_canvas_ignore_mouse_event){var a=0;Math.abs(t-scale_canvas_drag_params.start_x);if(scale_canvas_drag_params.mouse_down&&!scale_canvas_drag_params.drag){scale_canvas_drag_params.drag=!0;for(var _=0;_<demodulators.length;_++)a|=demodulators[_].envelope.drag_start(t,scale_canvas_drag_params.key_modifiers);e.target.style.cursor="move"}if(scale_canvas_drag_params.drag){for(_=0;_<demodulators.length;_++)a|=demodulators[_].envelope.drag_move(t);a||demodulator_set_offset_frequency(0,scale_offset_carfreq_from_px(t)),scale_canvas_drag_params.last_x=t}}}function scale_canvas_mousemove(e){scale_canvas_drag(e,e.pageX)}function scale_canvas_touchMove(e){for(var t=0;t<e.touches.length;t++)scale_canvas_drag(e,e.touches[t].pageX);e.preventDefault()}function scale_canvas_end_drag(e,t){if(scale_canvas_ignore_mouse_event)scale_canvas_ignore_mouse_event=!1;else{scale_canvas_drag_params.drag=!1;var a=!1;if(1==scale_canvas_drag_params.mouse_down){for(var _=0;_<demodulators.length;_++)a|=demodulators[_].envelope.drag_end(t);a||demodulator_set_offset_frequency(0,scale_offset_carfreq_from_px(t))}scale_canvas_drag_params.mouse_down=!1,e.target.style.cursor=null}}function scale_canvas_mouseup(e){scale_canvas_end_drag(e,e.pageX)}function scale_canvas_touchEnd(e){scale_canvas_end_drag(e,scale_canvas_drag_params.last_x),e.preventDefault()}function scale_container_mouseout(e){var t=e.relatedTarget;(t=isObject(t)&&null!=t&&isDefined(t.id)?t.id:null)&&(t.startsWith("id-pb-adj")||t.startsWith("id-scale"))||scale_canvas_mouseup(e)}function scale_px_from_freq(e,t){return Math.round((e-t.start)/t.bw*canvas_container.clientWidth)}function get_visible_freq_range(){if(out={},wf.audioFFT_active&&cur_mode){var e,t,a=Math.round(audio_input_rate||12e3);ext_is_IQ_or_stereo_curmode()?(e=0,t=a):!cur_mode||"ls"!=cur_mode.substr(0,2)&&"sal"!=cur_mode?(e=a/4,t=a/2):(e=0,t=a/2),out.center=center_freq+demodulators[0].offset_frequency+e,out.start=out.center-t,out.end=out.center+t,x_bin=freq_to_bin(out.start),out.bw=out.end-out.start,out.hpp=out.bw/scale_canvas.clientWidth}else{var _=bins_at_cur_zoom();out.start=bin_to_freq(x_bin),out.center=bin_to_freq(x_bin+_/2),out.end=bin_to_freq(x_bin+_),out.bw=out.end-out.start,out.hpp=out.bw/scale_canvas.clientWidth}return out}var scale_markers_levels=[{hz_per_large_marker:1e7,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:0},{hz_per_large_marker:5e6,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:0},{hz_per_large_marker:1e6,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:0},{hz_per_large_marker:5e5,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:1},{hz_per_large_marker:1e5,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:1},{hz_per_large_marker:5e4,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:2},{hz_per_large_marker:1e4,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:2},{hz_per_large_marker:5e3,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:3},{hz_per_large_marker:1e3,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:3}],scale_min_space_btwn_texts=50,scale_min_space_btwn_small_markers=7,g_range;function get_scale_mark_spacing(e){out={},fcalc=function(t){return out.numlarge=e.bw/t,out.pxlarge=canvas_container.clientWidth/out.numlarge,out.ratio=5,out.pxsmall=out.pxlarge/out.ratio,!(out.pxsmall<scale_min_space_btwn_small_markers)&&(out.pxsmall/2>=scale_min_space_btwn_small_markers&&"5"!=t.toString()[0]&&(out.pxsmall/=2,out.ratio*=2),out.smallbw=t/out.ratio,!0)};for(var t=scale_markers_levels.length-1;t>=0&&(mp=scale_markers_levels[t],!(fcalc(mp.hz_per_large_marker)&&out.pxlarge-mp.estimated_text_width>scale_min_space_btwn_texts));t--);return out.params=mp,out}function mk_freq_scale(){mkenvelopes(g_range=get_visible_freq_range()),scale_ctx.clearRect(0,22,scale_ctx.canvas.width,scale_ctx.canvas.height-22),scale_ctx.strokeStyle="#fff",scale_ctx.font="bold 12px sans-serif",scale_ctx.textBaseline="top",scale_ctx.fillStyle="#fff";var e,t=get_scale_mark_spacing(g_range);marker_hz=Math.ceil(g_range.start/t.smallbw)*t.smallbw,text_y_pos=32+(kiwi_isFirefox()?3:0);for(var a,_=function(a){var _=t.params.pre_divide,i=t.params.decimals;(a+=1e3*cfg.freq_offset)<1e6&&(_/=1e3,i=0),e=format_frequency(t.params.format+(a<1e6?"kHz":"MHz"),a,_,i)},i=0;!(++i>1e3);){if((r=scale_px_from_freq(marker_hz,g_range))>window.innerWidth)break;if(scale_ctx.beginPath(),scale_ctx.moveTo(r,22),marker_hz%t.params.hz_per_large_marker==0){if(isUndefined(n))var n=marker_hz;a=marker_hz,scale_ctx.lineWidth=3.5,scale_ctx.lineTo(r,33),_(marker_hz);var o=scale_ctx.measureText(e);scale_ctx.textAlign="center",0==zoom_level&&g_range.start+t.smallbw*t.ratio>marker_hz?r<o.width/2&&scale_px_from_freq(marker_hz+t.smallbw*t.ratio,g_range)-o.width>=scale_min_space_btwn_texts&&(scale_ctx.textAlign="left",scale_ctx.fillText(e,0,text_y_pos)):0==zoom_level&&g_range.end-t.smallbw*t.ratio<marker_hz&&r>window.innerWidth-o.width/2?window.innerWidth-o.width-scale_px_from_freq(marker_hz-t.smallbw*t.ratio,g_range)>=scale_min_space_btwn_texts&&(scale_ctx.textAlign="right",scale_ctx.fillText(e,window.innerWidth,text_y_pos)):scale_ctx.fillText(e,r,text_y_pos)}else scale_ctx.lineWidth=2,scale_ctx.lineTo(r,30);marker_hz+=t.smallbw,scale_ctx.stroke()}if(i>1e3&&(console.log("CONV_CT > 1000!!!"),kiwi_trace()),0!=zoom_level){scale_ctx.textAlign="center";var s=n-t.smallbw*t.ratio,r=scale_px_from_freq(s,g_range);_(s);var l=scale_ctx.measureText(e).width;r+l/2>0&&scale_ctx.fillText(e,r,32),r=scale_px_from_freq(s=a+t.smallbw*t.ratio,g_range),_(s),r-(l=scale_ctx.measureText(e).width)/2<window.innerWidth&&scale_ctx.fillText(e,r,32)}}var dx_car_size=8,dx_car_border=3,dx_car_w=dx_car_h=2*dx_car_border+dx_car_size;function resize_scale(e){band_ctx.canvas.width=window.innerWidth,band_ctx.canvas.height=band_canvas_h,dx_div.style.width=window.innerWidth+"px",dx_ctx.canvas.width=dx_car_w,dx_ctx.canvas.height=dx_car_h,dx_canvas.style.top=scale_canvas_top-dx_car_h+"px",dx_canvas.style.left=0,dx_canvas.style.zIndex=99,dx_ctx.beginPath(),dx_ctx.lineWidth=dx_car_border-1,dx_ctx.strokeStyle="black";var t=dx_car_border,a=dx_car_size;dx_ctx.moveTo(t,t),dx_ctx.lineTo(t+a,t),dx_ctx.lineTo(t+a/2,t+a),dx_ctx.lineTo(t,t),dx_ctx.stroke(),dx_ctx.fillStyle="yellow",dx_ctx.fill(),scale_ctx.canvas.width=window.innerWidth,scale_ctx.canvas.height=scale_canvas_h,mkscale(),dx_schedule_update()}function format_frequency(e,t,a,_){return out=e.replace("{x}",(t/a).toFixed(_)),out}function mkscale(){mk_freq_scale(),mk_bands_scale()}function bins_at_zoom(e){return wf_fft_size<<zoom_levels_max-e}function bins_at_cur_zoom(){return bins_at_zoom(zoom_level)}function norm_to_bins(e){return Math.round(e*bins_at_cur_zoom())}function bin_to_freq(e){var t=wf_fft_size<<zoom_levels_max;return Math.round(e/t*bandwidth)}function freq_to_bin(e){var t=wf_fft_size<<zoom_levels_max;return Math.round(e/bandwidth*t)}function bins_to_pixels_frac(e,t,a){var _=t/bins_at_zoom(a);return sb_trace&&console.log("bins_to_pixels_frac bins="+t+" z="+a+" ratio="+_),_>1&&(_=1),_<-1&&(_=-1),wf_fft_size*_}function bins_to_pixels(e,t,a){var _=bins_to_pixels_frac(e,t,a);return Math.round(_)}function freq_to_pixel(e){var t=freq_to_bin(e)-x_bin;return t>=0&&t<bins_at_cur_zoom()||(console.log("freq_to_pixel: bins="+t+" bins_at_cur_zoom="+bins_at_cur_zoom()),console.assert("assert fail")),bins_to_pixels(0,t,zoom_level)}function clamp_xbin(e){e<0&&(e=0);var t=(wf_fft_size<<zoom_levels_max)-bins_at_cur_zoom();return e>t&&(e=t),e}function passband_visible(){if(isUndefined(demodulators[0]))return x_bin;var e=freq_to_bin(freq_passband_center());return e=e>=x_bin&&e<x_bin+bins_at_cur_zoom()?e:-e-1}var debug_canvas_drag=!1;function canvas_log(e){"$"==e.charAt(0)?owrx.news_acc_s="<br><br>"+e:owrx.news_acc_s+=(""!=owrx.news_acc_s?" | ":"")+e,extint_news(owrx.news_acc_s)}function canvas_contextmenu(e){return e.target.id,e&&e.currentTarget&&"id-dx-container"==e.currentTarget.id&&(dx.ctrl_click=!0,w3_el(e.target.id).click()),cancelEvent(e)}function canvas_mouseover(e){}function canvas_mouseout(e){waterfall_setup_done&&debug_canvas_drag&&event_dump(e,"canvas_mouseout",1)}function canvas_get_carfreq_offset(e,t){var a,_=e/waterfall_width;if(wf.audioFFT_active){var i=center_freq+demodulators[0].offset_frequency,n=ext_is_IQ_or_stereo_curmode();a=i+(_-=n?.5:.25)*audio_input_rate*(n?2:1)}else{a=bin_to_freq(x_bin+_*bins_at_cur_zoom())}var o=t?passband_offset():0;return Math.round(a-o)-bandwidth/2}function canvas_get_dspfreq(e){return canvas_get_carfreq_offset(e,!1)+center_freq}canvas_dragging=!1,canvas_drag_min_delta=1,canvas_mouse_down=!1,canvas_ignore_mouse_event=!1;var mouse={left:0,middle:1,right:2};function canvas_start_drag(e,t,a){if(debug_canvas_drag&&canvas_log("CSD"),e.button==mouse.right&&!e.ctrlKey)return canvas_ignore_mouse_event=!0,debug_canvas_drag&&console.log("CSD-Rclick IME=set-true"),debug_canvas_drag&&canvas_log("ordinary-RCM"),right_click_menu(t,a),owrx.right_click_menu_active=!0,canvas_ignore_mouse_event=!1,void(debug_canvas_drag&&console.log("CSD-Rclick IME=set-false"));if(e.shiftKey&&"id-dx-container"==e.target.id)canvas_ignore_mouse_event=!0,debug_canvas_drag&&console.log("CSD-DX IME=set-true"),dx_show_edit_panel(e,-1);else if(!e.shiftKey||e.ctrlKey||e.altKey)e.shiftKey&&(e.ctrlKey||e.altKey)?(canvas_ignore_mouse_event=!0,debug_canvas_drag&&console.log("CSD-lookup IME=set-true"),freq_database_lookup(canvas_get_dspfreq(t),e.altKey)):e.ctrlKey?(canvas_ignore_mouse_event=!0,debug_canvas_drag&&console.log("CSD-pageScroll1 IME=set-true"),page_scroll(-page_scroll_amount)):e.altKey&&(canvas_ignore_mouse_event=!0,debug_canvas_drag&&console.log("CSD-pageScroll2 IME=set-true"),page_scroll(page_scroll_amount));else{canvas_ignore_mouse_event=!0,debug_canvas_drag&&console.log("CSD-Wboundary IME=set-true");var _=1e3,i=canvas_get_dspfreq(t),n=find_band(i),o=cur_mode.substr(0,2),s="am"==o||"sa"==o||"qa"==o||"ls"==o||"us"==o||"iq"==o||"dr"==o,r=2==cfg.init.ITU_region+1&&n&&"75m"==n.name;null==n||"LW"!=n.name&&"MW"!=n.name?null==n||n.s!=svc.B||r||s&&(_=5e3):s&&(_=step_9_10?9e3:1e4);var l=i/_;freqmode_set_dsp_kHz(Math.round(l)*_/1e3,null)}owrx.drag_count=0,canvas_mouse_down=!0,canvas_dragging=!1,owrx.canvas_drag_last_x=owrx.canvas_drag_start_x=t,owrx.canvas_drag_last_y=owrx.canvas_drag_start_y=a}function canvas_mousedown(e){debug_canvas_drag&&canvas_log("$C-MD RCMA"+(owrx.right_click_menu_active?1:0)),canvas_start_drag(e,e.pageX,e.pageY),e.preventDefault()}function canvas_touchStart(e){var t=e.targetTouches.length,a=Math.round(e.targetTouches[0].pageX),_=Math.round(e.targetTouches[0].pageY);debug_canvas_drag&&canvas_log("$C-TS"+t+"-x"+a+"-y"+_),owrx.double_touch_start=!1,1==t?canvas_start_drag(e,a,_):2==t&&(canvas_start_drag(e,a,_),canvas_ignore_mouse_event=!0,debug_canvas_drag&&console.log("CTS-doubleTouch IME=set-true"),owrx.touches_first_startx=a,owrx.pinch_distance_first=Math.round(Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY)),owrx.pinch_distance_last=owrx.pinch_distance_first,owrx.double_touch_start=!0),e.preventDefault()}function canvas_drag(e,t,a,_,i){if(waterfall_setup_done){var n=t;if(spectrum_tooltip_update(e,_,i),owrx.drag_count++,debug_canvas_drag&&canvas_log("CD#"+owrx.drag_count+" x"+t+" y"+a+" CMD"+(canvas_mouse_down?1:0)+" IME"+(canvas_ignore_mouse_event?1:0)+" DG"+(canvas_dragging?1:0)),!canvas_mouse_down||canvas_ignore_mouse_event&&!owrx.double_touch_start)w3_innerHTML("id-mouse-unit",format_frequency("{x}",canvas_get_dspfreq(n)+1e3*cfg.freq_offset,1e3,2));else if(!canvas_dragging&&owrx.drag_count>10&&Math.abs(t-owrx.canvas_drag_start_x)>canvas_drag_min_delta&&(canvas_dragging=!0,canvas_container.style.cursor="move"),canvas_dragging){var o=owrx.canvas_drag_last_x-t;owrx.canvas_drag_last_y;if(owrx.double_touch_start){var s=Math.round(Math.hypot(owrx.canvas_drag_last_x-t,owrx.canvas_drag_last_y-a)),r=Math.abs(s-owrx.pinch_distance_last);if(debug_canvas_drag&&canvas_log(s.toFixed(0)+" "+r.toFixed(0)),r>25){debug_canvas_drag&&canvas_log("*");var l=s<=owrx.pinch_distance_last;zoom_step(l?ext_zoom.OUT:ext_zoom.IN),debug_canvas_drag&&canvas_log(l?"IN":"OUT"),owrx.pinch_distance_last=s}}else{waterfall_pan_canvases(norm_to_bins(o/waterfall_width))}owrx.canvas_drag_last_x=t,owrx.canvas_drag_last_y=a}}}function canvas_mousemove(e){canvas_drag(e,e.pageX,e.pageY,e.clientX,e.clientY)}function canvas_touchMove(e){e.touches.length>=1&&(owrx.touches_first_lastx=e.touches[0].pageX);for(var t=0;t<e.touches.length;t++){var a=Math.round(e.touches[t].pageX),_=Math.round(e.touches[t].pageY);canvas_drag(e,a,_,a,_)}e.preventDefault()}function canvas_end_drag2(){debug_canvas_drag&&canvas_log("C-ED2"),canvas_container.style.cursor="crosshair",canvas_mouse_down=!1,canvas_ignore_mouse_event=!1,debug_canvas_drag&&console.log("C-ED2 IME=set-false")}function canvas_container_mouseout(e){debug_canvas_drag&&event_dump(e,"canvas_container_mouseout",1),debug_canvas_drag&&canvas_log("C-MOUT"),canvas_end_drag2()}function canvas_end_drag(e,t){if(debug_canvas_drag&&canvas_log("C-ED IME"+(canvas_ignore_mouse_event?1:0)+" CD"+(canvas_dragging?1:0)),waterfall_setup_done){var a=t;if(canvas_ignore_mouse_event);else if(canvas_dragging)canvas_end_drag2();else if(debug_canvas_drag&&canvas_log("CMD"+(canvas_mouse_down?1:0)+" RCMA"+(owrx.right_click_menu_active?1:0)+" TL"+owrx.tuning_locked),canvas_mouse_down)if(owrx.right_click_menu_active)w3int_menu_onclick(null,"id-right-click-menu"),owrx.right_click_menu_active=!1;else if(owrx.tuning_locked){var _=w3_el("id-tuning-lock-container");_.style.opacity=.8,w3_show(_);var i=w3_el("id-tuning-lock");i.style.marginTop=px(w3_center_in_window(i,"TL")),setTimeout(function(){_.style.opacity=0,setTimeout(function(){w3_hide(_)},500)},300)}else debug_canvas_drag&&canvas_log("*click*"),demodulator_set_offset_frequency(0,canvas_get_carfreq_offset(a,!0));canvas_mouse_down=!1,canvas_ignore_mouse_event=!1,debug_canvas_drag&&console.log("C-ED IME=set-false")}}function canvas_mouseup(e){debug_canvas_drag&&console.log("C-MU"),canvas_end_drag(e,e.pageX)}function canvas_touchEnd(e){var t=owrx.canvas_drag_last_x,a=owrx.canvas_drag_last_y;debug_canvas_drag&&canvas_log("C-TE-x"+t+"-DTS"+(owrx.double_touch_start?1:0)+"-DRAG"+(canvas_dragging?1:0)),canvas_end_drag(e,t),spectrum_tooltip_update(e,t,a),owrx.double_touch_start&&(debug_canvas_drag&&canvas_log("dr"+canvas_dragging),canvas_dragging||(kiwi_isMobile()&&owrx.mobile&&owrx.mobile.small&&(t=10),debug_canvas_drag&&canvas_log("*"),right_click_menu(t,a),owrx.right_click_menu_active=!0),canvas_ignore_mouse_event=!1,debug_canvas_drag&&console.log("CTE-doubleTouch IME=set-false"),owrx.double_touch_start=!1),e.preventDefault()}var canvas_mousewheel_rlimit=kiwi_rateLimit(canvas_mousewheel_cb,170);function canvas_mousewheel(e){canvas_mousewheel_rlimit(e),e.preventDefault()}function canvas_mousewheel_cb(e){waterfall_setup_done&&zoom_step(e.deltaY<0?ext_zoom.IN:ext_zoom.OUT,e.pageX)}function right_click_menu_init(){w3_menu("id-right-click-menu","right_click_menu_cb");var e=w3_div("id-tuning-lock-container class-overlay-container w3-hide",w3_div("id-tuning-lock",w3_icon("","fa-lock",192)+"<br>Tuning locked"));w3_appendElement("id-main-container","div",e)}var right_click_menu_content=["database lookup","Utility database lookup","DX Cluster lookup","<hr>","üîí lock tuning","restore passband","save waterfall as JPG","edit last selected DX label","DX label filter","<hr>","<i>cal ADC clock (admin)</i>"];function right_click_menu(e,t){var a,_=freq_displayed_Hz/1e3,i=band_info();a=_>=i.NDB_lo&&_<i.NDB_hi?"NDB":_<i.LW_lo?"VLF/LF":_<i.MW_hi?"LW/MW":"SWBC",right_click_menu_content[0]=a+" database lookup",right_click_menu_content[7]=(owrx.dx_click_gid_last?"":"!")+"edit last selected DX label",w3_menu_items("id-right-click-menu",right_click_menu_content),w3_menu_popup("id-right-click-menu",e,t)}function right_click_menu_cb(e,t){switch(e){case 0:case 1:case 2:freq_database_lookup(canvas_get_dspfreq(t),e);break;case 3:owrx.tuning_locked^=1,right_click_menu_content[4]=(owrx.tuning_locked?"üîì unlock":"üîí lock")+" tuning";break;case 4:restore_passband(cur_mode),demodulator_analog_replace(cur_mode);break;case 5:export_waterfall(canvas_get_dspfreq(t));break;case 6:dx_show_edit_panel(null,owrx.dx_click_gid_last);break;case 7:dx_filter();break;case 8:admin_pwd_query(function(){var e=Math.round(freq_displayed_Hz/1e3),t=1e3*e,a=t-freq_displayed_Hz,_=Math.round(a*ext_adc_clock_Hz()/t);console.log("cal ADC clock: dsp="+freq_displayed_Hz+" car="+freq_car_Hz+" r1k_kHz="+e+" clk_diff="+a+" clk_adj="+_);var i=cfg.clk_adj+_,n=1e6*i/ext_adc_clock_Hz();console.log("cal ADC clock: prev_adj="+cfg.clk_adj+" new_adj="+i+" ppm="+n.toFixed(1)),cal_adc_dialog(i,a,e,n)})}owrx.right_click_menu_active=!1}function freq_database_lookup(e,t){var a,_=e/1e3,i=(Math.round(e/10),Math.round(e/1e3)),n="http://",o=band_info();if(1==t&&(n+="qrg.globaltuners.com/?q="+(a=Math.floor(e/100)/1e4).toFixed(4)),0==t)if(_>=o.NDB_lo&&_<o.NDB_hi)n+="rxx.classaxe.com/en/rww/signals?types=DGPS,NAVTEX,NDB&khz="+(a=i.toFixed(0))+"&limit=-1";else if(_<o.LW_lo)a=Math.round(e/100)/10,console.log("kHz="+_+" f="+a),n+="www.mwlist.org/vlf.php?kHz="+a.toFixed(1);else if(_<o.MW_hi){a=Math.round(i/o._9_10)*o._9_10,console.log("MW kHz="+_+" f="+a);n+="www.mwlist.org/mwlist_quick_and_easy.php?area="+[0,1,3,2][o.ITU_region]+"&kHz="+a.toFixed(0)}else n+="www.short-wave.info/index.php?freq="+(a=5*Math.round(i/5)).toFixed(0)+"&timbus=NOW&ip="+client_public_ip+"&porm=4";2==t&&(n+="ve3sun.com/KiwiSDR/DX.php?Search="+(a=Math.floor(e)/1e3).toFixed(1)),console.log("LOOKUP "+_+" -> "+a+" "+n);var s=window.open(n,"_blank");s&&s.focus()}function export_waterfall(e){f=get_visible_freq_range();var t=Math.floor(f.center/100)/10+cfg.freq_offset+"+-"+Math.floor((f.end-f.center)/100)/10+"KHz.jpg",a=document.createElement("canvas");a.width=wf_fft_size,a.height=(old_canvases.length+wf_canvases.length)*wf_canvas_default_height,a.ctx=a.getContext("2d"),a.ctx.fillStyle="black",a.ctx.fillRect(0,0,a.width,a.height),a.ctx.strokeStyle="red";var _,n=0;if(wf_canvases.forEach(function(e){a.ctx.drawImage(e,0,n),n+=e.height}),old_canvases.length>1)for(i=1;i<old_canvases.length;i++)a.ctx.drawImage(old_canvases[i],0,n),n+=old_canvases[i].height;e||(e=f.center),_=wf_fft_size*(e-f.start)/(f.end-f.start),a.ctx.moveTo(_,0),a.ctx.lineTo(_,50),a.ctx.stroke();var o=Math.floor(e/100)/10+cfg.freq_offset;o+=" KHz ",a.ctx.font="18px Arial",a.ctx.fillStyle="lime",o=(o+=window.location.href.substring(7)).substring(0,o.indexOf(":")),a.ctx.fillText(o,_+10,35);var s=(new Date).toUTCString();a.ctx.fillText(s,_-a.ctx.measureText(s).width-10,35);var r=a.toDataURL("image/jpeg",.85),l=document.createElement("a");l.download=t,l.href=r,l.dataset.downloadurl=["image/jpeg",l.download,l.href].join(":"),document.body.appendChild(l),l.click(),document.body.removeChild(l)}function zoom_finally(){w3_innerHTML("id-nav-optbar-wf","WF"+zoom_level.toFixed(0)),wf_gnd_value=wf_gnd_value_base-zoomCorrection(),extint_environment_changed({zoom:1}),freqset_select()}var ZOOM_NOMINAL=10,ZOOM_BAND=6,zoom_nom=0,zoom_old_nom=0,zoom_levels_max=0,zoom_level=0,zoom_level_f=0,zoom_freq=0,zoom_maxin_s=["id-maxin","id-maxin-nom","id-maxin-max"],x_bin=0;function zoom_step(e,t){if(wf.audioFFT_active)audioFFT_update();else{var a,_=e==ext_zoom.OUT,n=e==ext_zoom.IN,o=e!=ext_zoom.TO_BAND&&e!=ext_zoom.ABS,s=zoom_level,r=x_bin,l=!0;if(e==ext_zoom.WHEEL){if(null==t)return;if(l=!1,(u=Math.round(zoom_level_f))==s)return;e=u>s?ext_zoom.IN:ext_zoom.OUT}if(e==ext_zoom.MAX_OUT)_=!0,zoom_level=0,x_bin=0;else{if(o&&(_&&0==zoom_level||n&&zoom_level>=zoom_levels_max))return void zoom_finally();if(e==ext_zoom.TO_BAND){var d,c=center_freq+demodulators[0].offset_frequency,f=t;if(null!=f)zoom_level=f.zoom_level,d=f.cf,sb_trace&&console.log("ZTB-user f="+c+" cf="+d+" b="+f.name+" z="+f.zoom_level);else{var p=cfg.init.ITU_region+1;for(i=0;i<bands.length&&!((0==(f=bands[i]).itu||f.itu==p)&&c>=f.min&&c<=f.max);i++);i!=bands.length?(zoom_level=f.zoom_level,d=f.cf):(zoom_level=ZOOM_BAND,d=c)}_=zoom_level<s,x_bin=freq_to_bin(d),x_bin-=norm_to_bins(.5)}else if(e==ext_zoom.ABS){if(null==t)return void zoom_finally();var u;if((u=t)<0||u>zoom_levels_max||u==zoom_level)return void zoom_finally();_=u<zoom_level,zoom_level=u,x_bin=freq_to_bin(freq_passband_center()),x_bin-=norm_to_bins(.5)}else if(e==ext_zoom.NOM_IN||e==ext_zoom.MAX_IN)_=(zoom_level=e==ext_zoom.NOM_IN&&null!=t&&1==t&&zoom_level>=zoom_nom?zoom_level==zoom_levels_max?zoom_nom:zoom_levels_max:e==ext_zoom.NOM_IN?zoom_nom:zoom_levels_max)<s,x_bin=freq_to_bin(freq_passband_center()),x_bin-=norm_to_bins(.5);else{if(dbgUs&&(sb_trace&&console.log("ZOOM IN/OUT"),sb_trace=0),null!=t){a=t/waterfall_width}else{var w=passband_visible();a=w>=0?(w-x_bin)/bins_at_cur_zoom():.5}x_bin+=norm_to_bins(a),zoom_level+=e,x_bin-=norm_to_bins(a)}}l&&(zoom_level_f=zoom_level);var m=zoom_level==zoom_levels_max?2:zoom_level>=zoom_nom?1:0;m!=zoom_old_nom&&(w3_hide(zoom_maxin_s[zoom_old_nom]),w3_show(zoom_maxin_s[m],"w3-show-table-cell"),zoom_old_nom=m),0!=zoom_level&&0!=s||(w3_show_hide("id-maxout",0!=zoom_level,"w3-show-table-cell"),w3_show_hide("id-maxout-max",0==zoom_level,"w3-show-table-cell")),x_bin=clamp_xbin(x_bin);var h=_?r-x_bin:x_bin-r,g=bins_to_pixels(1,h,_?zoom_level:s);sb_trace&&console.log("Zs z"+s+">"+zoom_level+" b="+x_bin+"/"+r+"/"+h+" bz="+bins_at_zoom(s)+" r="+h/bins_at_zoom(s)+" px="+g);var v=zoom_level-s;sb_trace&&console.log("zoom_step oz="+s+" zl="+zoom_level+" dz="+v+" pdx="+g),waterfall_zoom_canvases(v,g),mkscale(),dx_schedule_update(),sb_trace&&console.log("SET Z"+zoom_level+" xb="+x_bin),wf_send("SET zoom="+zoom_level+" start="+x_bin),need_maxmindb_update=!0,writeCookie("last_zoom",zoom_level),freq_link_update(),zoom_finally()}}function passband_increment(e){var t,a=ext_get_passband(),_=Math.abs(a.high-a.low),i=(t=e?(1.25*_-_)/2:(_-.8*_)/2)>10?10:1;t=Math.round(t/i)*i,a.low+=e?-t:t,a.low=Math.round(a.low/i)*i,a.high+=e?t:-t,a.high=Math.round(a.high/i)*i,ext_set_passband(a.low,a.high,!0)}function zoom_click(e,t,a){if(any_alternate_click_event(e)){var _=e.currentTarget,i=w3_contains(_,"id-zoom-in"),n=w3_contains(_,"id-zoom-out");if(!i&&!n)return;passband_increment(i)}else t==ext_zoom.NOM_IN?zoom_step(t,1):zoom_step(t)}function zoom_over(e){if("IMG"==e.target.nodeName){var t=e.target,a=e.currentTarget,_=w3_contains(a,"id-zoom-in");any_alternate_click_event(e)?t.title=_?"passband widen":"passband narrow":t.removeAttribute("title")}}var page_scroll_amount=.8,window_width,waterfall_width,waterfall_scrollable_height,canvas_container,canvas_annotation,canvas_phantom,annotation_div;function page_scroll(e){wf.audioFFT_active||waterfall_pan_canvases(norm_to_bins(e));freqset_select()}function page_scroll_icon_click(e,t){any_alternate_click_event(e)?dx_label_step(t<0?-1:1):page_scroll(t)}var wf_canvases=[],old_canvases=[],wf_cur_canvas=null,wf_canvas_default_height=200,wf_canvas_actual_line,wf_canvas_id_seq=1;function create_canvas(e,t,a,_,i){var n=document.createElement("canvas");return n.id=e,n.width=t,n.height=a,_&&(n.style.width=px(_)),i&&(n.style.height=px(i)),n.ctx=n.getContext("2d"),n}function add_canvas(){var e=create_canvas("id-wf-canvas",wf_fft_size,wf_canvas_default_height,waterfall_width,wf_canvas_default_height);e.id_seq=wf_canvas_id_seq++,wf_canvas_actual_line=wf_canvas_default_height-1,e.style.left=0,e.openwebrx_height=wf_canvas_default_height,e.openwebrx_top=1-wf_canvas_default_height,e.style.top=px(e.openwebrx_top),e.oneline_image=e.ctx.createImageData(wf_fft_size,1),canvas_container.appendChild(e),add_canvas_listner(e),wf_canvases.unshift(e),wf_cur_canvas=e,kiwi_gc_wf&&(e=null)}function init_canvas_container(){window_width=window.innerWidth,canvas_container=html("id-waterfall-container"),waterfall_width=canvas_container.clientWidth,canvas_container.addEventListener("mouseout",canvas_container_mouseout,!1),(canvas_annotation=create_canvas("id-annotation-canvas",wf_fft_size,wf_canvas_default_height,waterfall_width,wf_canvas_default_height)).style.zIndex=1,canvas_container.appendChild(canvas_annotation),add_canvas_listner(canvas_annotation),add_canvas_listner(annotation_div=w3_el("id-annotation-div")),annotation_div.style.pointerEvents="none",add_canvas_listner(canvas_phantom=html("id-phantom-canvas")),canvas_phantom.style.width=px(canvas_container.clientWidth),add_canvas(),spec.canvas=create_canvas("id-spectrum-canvas",wf_fft_size,height_spectrum_canvas,waterfall_width,height_spectrum_canvas),html("id-spectrum-container").appendChild(spec.canvas),spec.ctx=spec.canvas.ctx,add_canvas_listner(spec.canvas),spec.ctx.font="10px sans-serif",spec.ctx.textBaseline="middle",spec.ctx.textAlign="left",spec.dB=html("id-spectrum-dB"),spec.dB.style.height=px(height_spectrum_canvas),spec.dB.style.width=px(waterfall_width),spec.dB.innerHTML='<span id="id-spectrum-dB-ttip" class="class-spectrum-dB-tooltip class-tooltip-text"></span>',add_canvas_listner(spec.dB),spec.dB_ttip=html("id-spectrum-dB-ttip")}function add_canvas_listner(e){e.addEventListener("mouseover",canvas_mouseover,!1),e.addEventListener("mouseout",canvas_mouseout,!1),e.addEventListener("mousedown",canvas_mousedown,!1),e.addEventListener("mousemove",canvas_mousemove,!1),e.addEventListener("mouseup",canvas_mouseup,!1),e.addEventListener("contextmenu",canvas_contextmenu,!1),e.addEventListener("wheel",canvas_mousewheel,!1),kiwi_isMobile()&&(e.addEventListener("touchstart",canvas_touchStart,!1),e.addEventListener("touchmove",canvas_touchMove,!1),e.addEventListener("touchend",canvas_touchEnd,!1))}function remove_canvas_listner(e){e.removeEventListener("mouseover",canvas_mouseover,!1),e.removeEventListener("mouseout",canvas_mouseout,!1),e.removeEventListener("mousedown",canvas_mousedown,!1),e.removeEventListener("mousemove",canvas_mousemove,!1),e.removeEventListener("mouseup",canvas_mouseup,!1),e.removeEventListener("contextmenu",canvas_contextmenu,!1),e.removeEventListener("wheel",canvas_mousewheel,!1),kiwi_isMobile()&&(e.removeEventListener("touchstart",canvas_touchStart,!1),e.removeEventListener("touchmove",canvas_touchMove,!1),e.removeEventListener("touchend",canvas_touchEnd,!1))}function wf_shift_canvases(){for(wf_canvases.forEach(function(e){e.style.top=px(e.openwebrx_top++)});wf_canvases.length;){var e=wf_canvases[wf_canvases.length-1];if(null==e||e.openwebrx_top<waterfall_scrollable_height){kiwi_gc_wf&&(e=null);break}var t=wf_canvases[wf_canvases.length-2];t&&old_canvases.unshift(t),old_canvases.length>15&&old_canvases.pop(),kiwi_gc_wf&&remove_canvas_listner(e),canvas_container.removeChild(e),kiwi_gc_wf&&(e=wf_canvases[wf_canvases.length-1]=null),wf_canvases.pop()}wf_canvas_maxshift++,wf_canvas_maxshift<canvas_container.clientHeight?(canvas_phantom.style.top=px(wf_canvas_maxshift),canvas_phantom.style.height=px(canvas_container.clientHeight-wf_canvas_maxshift),w3_show_block(canvas_phantom)):canvas_phantom.hidden||(w3_hide(canvas_phantom),canvas_phantom.hidden=!0)}function resize_canvases(e){window_width=canvas_container.innerWidth,waterfall_width=canvas_container.clientWidth,new_width=px(waterfall_width);wf_canvases.forEach(function(e){e.style.width=new_width,e.style.left=0}),canvas_annotation.width=waterfall_width,canvas_annotation.style.width=new_width,canvas_phantom.style.width=new_width,canvas_phantom.style.left=0,spec.canvas.style.width=new_width,wf.audioFFT_active&&w3_innerHTML("id-annotation-div",w3_div("w3-section w3-container",w3_text("w3-large|color:cyan","Audio FFT<br>"),w3_text("w3-small|color:cyan","Zoom waterfall not available<br>"+(wf.no_wf?'when "no_wf" URL option used.<br>':"on channels "+wf_chans_real+"-"+(rx_chans-1)+" of Kiwis<br>configured for "+rx_chans+" channels.<br>")),w3_text("w3-small|color:cyan","For details see the Kiwi forum.")))}function mobile_init(){var e=owrx.mobile=ext_mobile_info();e.small&&(toggle_or_set_hide_topbar(1),optbar_focus("optbar-off","init")),e.narrow&&(w3_hide("id-readme"),e.width<600&&toggle_or_set_hide_topbar(3)),owrx.last_mobile={},owrx.rescale_cnt=owrx.rescale_cnt2=0,setInterval(function(){e=owrx.mobile=ext_mobile_info(owrx.last_mobile),owrx.last_mobile=e;var t=w3_el("id-control");if(mobile_laptop_test&&(extint_news("whu="+e.width+","+e.height+","+t.uiWidth+" psn="+e.isPortrait+","+e.small+","+e.narrow+" #"+owrx.dseq),owrx.dseq++),!e.orient_unchanged)if(owrx.rescale_cnt++,e.narrow){var a=e.width/t.uiWidth*.95;t.style.transform="scale("+a.toFixed(2)+")",t.style.transformOrigin="bottom right",t.style.right="0px",owrx.rescale_cnt2++}else t.style.transform="none",t.style.right="10px"},500)}wf_canvas_maxshift=0;var spec={source_wf:0,source_audio:0,canvas:null,ctx:null,spectrum_image:null,colormap:null,colormap_transparent:null,dB:null,dB_ttip:null,update:0,last_update:0,need_update:0,need_clear_avg:0,clear_avg:0,avg:[],peak_show:0,peak_clear:0,peak:[],dB_bands:[],redraw_dB_scale:!1};function spectrum_init(){spec.colormap=spec.ctx.createImageData(1,spec.canvas.height),spec.colormap_transparent=spec.ctx.createImageData(1,spec.canvas.height),update_maxmindb_sliders(),spectrum_dB_bands();var e=(kiwi_isMobile(),10);if(setInterval(function(){spec.update++},1e3/e),spec.spectrum_image=spec.ctx.createImageData(spec.canvas.width,spec.canvas.height),!wf.audioFFT_active&&rx_chan>=wf_chans){var t=spec.canvas.width,a=spec.canvas.height;spec.ctx.fillStyle="black",spec.ctx.fillRect(0,0,t,a),spec.ctx.font="18px sans-serif",spec.ctx.fillStyle="white";var _=wf_chans?"Spectrum not available for rx"+rx_chan:"Spectrum not allowed on this Kiwi",i=spec.ctx.measureText(_).width;spec.ctx.fillText(_,t/2-i/2,a/2)}kiwi_load_js(["extensions/colormap/colormap.js"],function(){colormap_init()})}function spectrum_dB_bands(){spec.dB_bands=[];var e=0,t=maxdb,a=mindb;a>=t&&(t=-10,a=-110);var _=t-a,i=a+-12,n=t-i;n=n||1;for(var o=0,s=0,r=10*Math.floor(t/10);a-r<10;r-=10){var l=1-(r-a)/_,d=Math.round((r-i)/n*255),c=color_map[d],f=color_map_transparent[d],p="#"+(c>>>8).toString(16).leadingZeros(6);spec.dB_bands[e]={dB:r,norm:l,color:p};for(var u=function(e){return Math.round(e*spec.canvas.height)},w=u(o);w<u(l);w++){for(var m=0;m<4;m++)spec.colormap.data[4*w+m]=c>>>0>>8*(3-m)&255,spec.colormap_transparent.data[4*w+m]=f>>>0>>8*(3-m)&255;if(s++>8192)break}if(o=l,e++,s++>8192)break}spec.redraw_dB_scale=!0,w3_call("colormap_aper")}function spectrum_tooltip_update(e,t,a){if((e.target==spec.dB||e.currentTarget==spec.dB||e.target==spec.dB_ttip||e.currentTarget==spec.dB_ttip)&&a>=0&&a<height_spectrum_canvas){spec.dB_ttip.style.left=px(t),spec.dB_ttip.style.bottom=px(210-a);var _=(height_spectrum_canvas-a)/height_spectrum_canvas*full_scale+mindb;spec.dB_ttip.innerHTML=_.toFixed(0)+" dBm"}}function spectrum_update(e){var t,a,_,i,n,o;spec.last_update=spec.update;var s=spec.ctx;for(n=spec.canvas.width-25,o=spec.canvas.height,s.fillStyle="black",s.fillRect(0,0,n,o),s.fillStyle="lightGray",t=0;t<spec.dB_bands.length;t++){var r=spec.dB_bands[t];_=Math.round(r.norm*o),s.fillRect(0,_,n,1)}if(spec.clear_avg){for(a=0;a<n;a++)spec.avg[a]=color_index(e[a]);spec.clear_avg=!1,spec.peak_clear=!0}if(spec.peak_clear){for(a=0;a<n;a++)spec.peak[a]=0;spec.peak_clear=!1}if(spec.redraw_dB_scale){for(a=n;a<spec.canvas.width;a++)s.putImageData(spec.colormap_transparent,a,0,0,0,1,o);for(s.fillStyle="white",t=0;t<spec.dB_bands.length;t++){r=spec.dB_bands[t];_=Math.round(r.norm*o),s.fillText(r.dB,n+3,_-4)}spec.redraw_dB_scale=!1}for(s.fillStyle="hsl(180, 100%, 70%)",a=0;a<n;a++){switch(i=color_index(wf_gnd?wf_gnd_value:e[a]),spec_filter){case wf_sp_menu_e.IIR:var l=1-Math.exp(-sp_param*i/255);l<=.01&&(l=.01);var d=spec.avg[a];(d+=l*(i-d))>255&&(d=255),d<0&&(d=0),i=spec.avg[a]=d;break;case wf_sp_menu_e.MMA:i>255&&(i=255),i<0&&(i=0),spec.avg[a]=(spec.avg[a]*(sp_param-1)+i)/sp_param,i=spec.avg[a];break;case wf_sp_menu_e.EMA:i>255&&(i=255),i<0&&(i=0),spec.avg[a]+=(i-spec.avg[a])/sp_param,i=spec.avg[a];break;case wf_sp_menu_e.OFF:default:i>255&&(i=255),i<0&&(i=0)}i>spec.peak[a]&&(spec.peak[a]=i),_=Math.round((1-i/255)*o),spectrum_slow_dev?s.fillRect(a,_,1,o-_):s.putImageData(spec.colormap,a,0,0,_,1,o-_+1)}if(spec.peak_show){for(s.lineWidth=1,s.strokeStyle="yellow",s.beginPath(),_=Math.round((1-spec.peak[0]/255)*o)-1,s.moveTo(0,_),a=1;a<n;a++)_=Math.round((1-spec.peak[a]/255)*o)-1,s.lineTo(a,_);s.globalAlpha=.55,s.stroke(),s.globalAlpha=1}}var waterfall_setup_done=0,waterfall_timer,waterfall_ms;function waterfall_init(){okay_waterfall_init&&(init_canvas_container(),wf.audioFFT_active=rx_chan>=wf_chans,resize_waterfall_container(!1),resize_canvases(),bands_init(),panels_setup(),ident_init(),scale_setup(),mkcolormap(),mkscale(),spectrum_init(),dx_schedule_update(),users_init({user:1}),stats_init(),check_top_bar_congestion(),spectrum_show&&setTimeout(spec_show,2e3),audioFFT_setup(),waterfall_ms=900/wf_fps_max,waterfall_timer=window.setInterval(waterfall_dequeue,waterfall_ms),""!=shortcut.keys&&setTimeout(keyboard_shortcut_url_keys,3e3),(kiwi_isMobile()||mobile_laptop_test)&&mobile_init(),waterfall_setup_done=1)}var waterfall_dont_scale=0,need_maxmindb_update=!1,need_clear_wf_sp_avg=!1,need_clear_wfavg=!1,clear_wfavg=!0,wfavg=[],wf_swallow_samples=[2,4,8,18],x_bin_server_last,wf_swallow=0;function waterfall_add(e,t){var a,_;if(null!=e){var i=wf_cur_canvas;if(null!=i){var n,o,s,r=wf_fft_size;if(0==t){var l=new Uint32Array(e,4,3),d=l[0],c=l[1];kiwi_gc_wf&&(l=null);var f=65535&c,p=c>>16&65535,u=(n=new Uint8Array(e,16)).length;if(need_maxmindb_update&&zoom_level==f&&(update_maxmindb_sliders(),need_maxmindb_update=!1),x_bin==d&&zoom_level==f&&((need_clear_wf_sp_avg||spec.need_clear_avg)&&(spec.clear_avg=!0),(need_clear_wf_sp_avg||need_clear_wfavg)&&(clear_wfavg=!0),need_clear_wf_sp_avg=need_clear_wfavg=spec.need_clear_avg=!1),1&p){s=new Uint8Array(2*u);decode_ima_adpcm_e8_u8(n,s,u,{index:0,previousValue:0});o=s.subarray(10)}else o=n;if(wf_swallow)return void wf_swallow--;d!=x_bin_server_last&&(x_bin_server_last=d,zoom_level>=11&&(wf_swallow=wf_swallow_samples[zoom_level-11],wf_fps!=wf_fps_max&&(wf_swallow=Math.round(wf_swallow*wf_fps/wf_fps_max))))}else o=e,spec.source_wf&&spec.need_clear_avg&&(spec.clear_avg=!0,spec.need_clear_avg=!1);spec.source_wf&&spec.update!=spec.last_update&&spectrum_update(o);var w=i.oneline_image;for(a=0;a<r;a++){switch(_=color_index(wf_gnd?wf_gnd_value:o[a],wf.sqrt),wf_filter){case wf_sp_menu_e.IIR:clear_wfavg&&(wfavg[a]=_);var m=1-Math.exp(-wf_param*_/255);m<=.01&&(m=.01);var h=wfavg[a];(h+=m*(_-h))>255&&(h=255),h<0&&(h=0),wfavg[a]=h,_=Math.round(wfavg[a]);break;case wf_sp_menu_e.MMA:clear_wfavg&&(wfavg[a]=_),wfavg[a]=(wfavg[a]*(wf_param-1)+_)/wf_param,_=Math.round(wfavg[a]);break;case wf_sp_menu_e.EMA:clear_wfavg&&(wfavg[a]=_),wfavg[a]+=(_-wfavg[a])/wf_param,_=Math.round(wfavg[a]);break;case wf_sp_menu_e.OFF:}w.data[4*a]=color_map_r[_],w.data[4*a+1]=color_map_g[_],w.data[4*a+2]=color_map_b[_],w.data[4*a+3]=255}clear_wfavg&&(clear_wfavg=!1),i.ctx.putImageData(w,0,wf_canvas_actual_line),0==t&&"undefined"!=typeof IBP_scan_plot&&IBP_scan_plot(w);var g=!1;if(0==t){if(sb_trace&&console.log("WF fixup bin="+x_bin+"/"+d+" z="+zoom_level+"/"+f),zoom_level!=f){var v=zoom_level-f,b=v<0,x=b?d-x_bin:x_bin-d,k=bins_to_pixels(2,x,b?zoom_level:f);sb_trace&&console.log("WF Z fix z"+f+">"+zoom_level+" out="+b+" b="+x_bin+"/"+d+"/"+x+" px="+k),waterfall_zoom(i,v,wf_canvas_actual_line,k),d+=b?-x:x,sb_trace&&console.log("WF z fixed"),g=!0}x_bin!=d&&(k=bins_to_pixels(3,x_bin-d,zoom_level),sb_trace&&console.log("WF bin fix L="+wf_canvas_actual_line+" xb="+x_bin+" xbs="+d+" pdx="+k),waterfall_pan(i,wf_canvas_actual_line,k),sb_trace&&console.log("WF bin fixed"),g=!0),sb_trace&&x_bin==d&&zoom_level==f&&(console.log("--WF FIXUP ALL DONE--"),sb_trace=0)}if(wf.need_autoscale>1&&wf.need_autoscale--,1==wf.need_autoscale&&!g){for(var y=[],q=wf.audioFFT_active?o.slice(256,768):o,T=q.length,M=0;M<T;M++)y[M]=dB_wire_to_dBm(q[M]);y.sort(function(e,t){return e-t});var z=y[Math.floor(.5*T)],S=y[Math.floor(.98*T)];console_log_dbgUs("# autoscale min="+y[0]+" noise="+z+" signal="+S+" max="+y[T-1]);var F=y[Math.floor(.1*T)],E=y[Math.floor(.2*T)];console_log_dbgUs("# autoscale min="+y[0]+" 10%="+F+" 20%="+E+" 50%(noise)="+z+" 98%(signal)="+S+" max="+y[T-1]),(S+=30)<-80&&(S=-80),z-=10,wf.audioFFT_active&&(z=dbgUs&&devl.p4?Math.round(devl.p4):-110,console_log_dbgUs("audioFFT_active: force noise = "+z.toFixed(0)+" dBm")),setmaxdb(1,S),setmindb(1,z),update_maxmindb_sliders(),wf.need_autoscale=0}wf_canvas_actual_line--,wf_shift_canvases(),wf_canvas_actual_line<0&&add_canvas(),kiwi_gc_wf&&(i=e=n=s=o=null)}}}function waterfall_pan(e,t,a){var _,i,n,o=e.ctx,s=e.width;-1==t?(_=0,n=e.height):(_=t,n=1);var r=function(e,t,a){return e<t?t:e>a?a:e};try{sb_trace&&console.log("waterfall_pan h="+n+" dx="+a),a<0?(i=s-(a=-a),sb_trace&&console.log("PAN-L w="+i+" dx="+a),i>0&&o.drawImage(e,0,_,i,n,a,_,i,n),o.fillStyle="Black",sb_trace&&(o.fillStyle=-1==t?"Lime":"Red"),fx=r(a,0,s),o.fillRect(0,_,fx,n)):(i=s-a,sb_trace&&console.log("PAN-R w="+i+" dx="+a),i>0&&o.drawImage(e,a,_,i,n,0,_,i,n),o.fillStyle="Black",sb_trace&&(o.fillStyle=-1==t?"Lime":"Red"),fx=r(i,0,s),o.fillRect(fx,_,s,n))}catch(e){console.log("EX WFPAN "+e.toString()+" dx="+a+" y="+_+" w="+i+" h="+n)}}var last_pixels_frac=0;function waterfall_pan_canvases(e){if(e&&!wf.audioFFT_active){var t=x_bin,a=bins_to_pixels_frac(4,(x_bin=clamp_xbin(x_bin+=e))-t,zoom_level)+last_pixels_frac,_=Math.round(a);last_pixels_frac=a-_,sb_trace&&console.log("PAN-CAN z="+zoom_level+" xb="+x_bin+" db="+(x_bin-t)+" f_dx="+a+" i_dx="+_+" lpf="+last_pixels_frac),_&&(wf_canvases.forEach(function(e){waterfall_pan(e,-1,_)}),wf_send("SET zoom="+zoom_level+" start="+x_bin),mkscale(),need_clear_wf_sp_avg=!0,dx_schedule_update(),extint_environment_changed({waterfall_pan:1}),passband_visible()<0&&check_band(!0))}}function waterfall_zoom(e,t,a,_){var i,n,o,s=e.ctx,r=e.width,l=1<<Math.abs(t),d=r/l,c=function(e,t,a){return e<t?t:e>a?a:e};-1==a?(n=0,o=e.height):(n=a,o=1);try{if(sb_trace&&console.log("waterfall_zoom w="+r+" h="+o+" pw="+d+" zf="+l),t<0)sb_trace&&console.log("WFZ-out srcX=0/"+r+" dstX="+_+"/"+(_+d)+" (pw="+d+")"),s.drawImage(e,0,n,r,o,_,n,d,o),s.fillStyle="Black",sb_trace&&(console.log("chocolate 0:"+_),s.fillStyle="chocolate"),i=c(_,0,r),s.fillRect(0,n,i,n+o),sb_trace&&(console.log("brown "+(_+d)+":"+r),s.fillStyle="brown"),i=c(_+d,0,r),s.fillRect(i,n,r,n+o);else if(0!=r){sb_trace&&console.log("WFZ-in srcX="+_+"/"+(_+d)+"(pw="+d+") dstX=0/"+r);var f=!1,p=!1;_+d>r&&(i=Math.round((r-_)*l),sb_trace&&console.log("CLAMP HI fx="+i),f=!0),_<0&&(i=Math.round(-_*l),sb_trace&&console.log("CLAMP LO fx="+i),p=!0),s.drawImage(e,_,n,d,o,0,n,r,o),s.fillStyle="Black",sb_trace&&(s.fillStyle="deepPink"),f&&s.fillRect(i,n,r,n+o),p&&s.fillRect(0,n,i,n+o)}}catch(e){console.log("EX WFZ "+e.toString()+" dz="+t+" x="+_+" y="+n+" w="+r+" h="+o)}}function waterfall_zoom_canvases(e,t){sb_trace&&console.log("ZOOM-CAN z"+zoom_level+" xb="+x_bin+" x="+t),wf_canvases.forEach(function(a){waterfall_zoom(a,e,-1,t)}),need_clear_wf_sp_avg=!0}function waterfall_height(){var e=html("id-top-container").clientHeight,t=html("id-non-waterfall-container").clientHeight;return window.innerHeight-e-t}function resize_waterfall_container(e){if(!e||waterfall_setup_done){var t=waterfall_height();t>=0?(canvas_annotation.style.height=canvas_container.style.height=px(t),waterfall_scrollable_height=3*t):waterfall_scrollable_height=0}}var waterfall_delay=0,waterfall_queue=[],waterfall_last_add=0;function waterfall_add_queue(e,t,a){if("DAT"!=a){var _=new Uint32Array(e,4,3),i=_[2];kiwi_gc_wf&&(_=null);var n=Date.now(),o=waterfall_last_add?n-waterfall_last_add:0;waterfall_last_add=n,waterfall_queue.push({data:e,audioFFT:0,seq:i,spacing:o}),kiwi_gc_wf&&(e=null)}else{var s=new Uint8Array(e,4),r=s[0];if(0==r){for(var l=0;l<768;l++)downloaded_colormap[l]=s[l+1];mkcolormap(),console.log("W/F DAT downloaded_colormap")}else console.log("W/F DAT unknown cmd="+r)}}var init_zoom_set=!1,waterfall_last_out=0,wf_dq_onesec=0;function waterfall_dequeue(){if(!init_zoom_set&&demodulators[0]&&(init_zoom=parseInt(init_zoom),(init_zoom<0||init_zoom>zoom_levels_max)&&(init_zoom=0),zoom_step(ext_zoom.ABS,init_zoom),init_zoom_set=!0),waterfall_setup_done&&0!=waterfall_queue.length)for(;0!=waterfall_queue.length;){var e=waterfall_queue[0].seq;if(e>audio_ext_sequence+waterfall_delay)return;var t=Date.now();if(e==audio_ext_sequence&&t<waterfall_last_out+waterfall_queue[0].spacing)return;waterfall_last_out=t;var a=waterfall_queue[0].data;kiwi_gc_wf&&(waterfall_queue[0].data=null);var _=waterfall_queue[0].audioFFT;waterfall_queue.shift(),waterfall_add(a,_),kiwi_gc_wf&&(a=null)}}var downloaded_colormap=new Uint8Array(768);turbo_colormap_data=[.18995,.07176,.23217,.19483,.08339,.26149,.19956,.09498,.29024,.20415,.10652,.31844,.2086,.11802,.34607,.21291,.12947,.37314,.21708,.14087,.39964,.22111,.15223,.42558,.225,.16354,.45096,.22875,.17481,.47578,.23236,.18603,.50004,.23582,.1972,.52373,.23915,.20833,.54686,.24234,.21941,.56942,.24539,.23044,.59142,.2483,.24143,.61286,.25107,.25237,.63374,.25369,.26327,.65406,.25618,.27412,.67381,.25853,.28492,.693,.26074,.29568,.71162,.2628,.30639,.72968,.26473,.31706,.74718,.26652,.32768,.76412,.26816,.33825,.7805,.26967,.34878,.79631,.27103,.35926,.81156,.27226,.3697,.82624,.27334,.38008,.84037,.27429,.39043,.85393,.27509,.40072,.86692,.27576,.41097,.87936,.27628,.42118,.89123,.27667,.43134,.90254,.27691,.44145,.91328,.27701,.45152,.92347,.27698,.46153,.93309,.2768,.47151,.94214,.27648,.48144,.95064,.27603,.49132,.95857,.27543,.50115,.96594,.27469,.51094,.97275,.27381,.52069,.97899,.27273,.5304,.98461,.27106,.54015,.9893,.26878,.54995,.99303,.26592,.55979,.99583,.26252,.56967,.99773,.25862,.57958,.99876,.25425,.5895,.99896,.24946,.59943,.99835,.24427,.60937,.99697,.23874,.61931,.99485,.23288,.62923,.99202,.22676,.63913,.98851,.22039,.64901,.98436,.21382,.65886,.97959,.20708,.66866,.97423,.20021,.67842,.96833,.19326,.68812,.9619,.18625,.69775,.95498,.17923,.70732,.94761,.17223,.7168,.93981,.16529,.7262,.93161,.15844,.73551,.92305,.15173,.74472,.91416,.14519,.75381,.90496,.13886,.76279,.8955,.13278,.77165,.8858,.12698,.78037,.8759,.12151,.78896,.86581,.11639,.7974,.85559,.11167,.80569,.84525,.10738,.81381,.83484,.10357,.82177,.82437,.10026,.82955,.81389,.0975,.83714,.80342,.09532,.84455,.79299,.09377,.85175,.78264,.09287,.85875,.7724,.09267,.86554,.7623,.0932,.87211,.75237,.09451,.87844,.74265,.09662,.88454,.73316,.09958,.8904,.72393,.10342,.896,.715,.10815,.90142,.70599,.11374,.90673,.69651,.12014,.91193,.6866,.12733,.91701,.67627,.13526,.92197,.66556,.14391,.9268,.65448,.15323,.93151,.64308,.16319,.93609,.63137,.17377,.94053,.61938,.18491,.94484,.60713,.19659,.94901,.59466,.20877,.95304,.58199,.22142,.95692,.56914,.23449,.96065,.55614,.24797,.96423,.54303,.2618,.96765,.52981,.27597,.97092,.51653,.29042,.97403,.50321,.30513,.97697,.48987,.32006,.97974,.47654,.33517,.98234,.46325,.35043,.98477,.45002,.36581,.98702,.43688,.38127,.98909,.42386,.39678,.99098,.41098,.41229,.99268,.39826,.42778,.99419,.38575,.44321,.99551,.37345,.45854,.99663,.3614,.47375,.99755,.34963,.48879,.99828,.33816,.50362,.99879,.32701,.51822,.9991,.31622,.53255,.99919,.30581,.54658,.99907,.29581,.56026,.99873,.28623,.57357,.99817,.27712,.58646,.99739,.26849,.59891,.99638,.26038,.61088,.99514,.2528,.62233,.99366,.24579,.63323,.99195,.23937,.64362,.98999,.23356,.65394,.98775,.22835,.66428,.98524,.2237,.67462,.98246,.2196,.68494,.97941,.21602,.69525,.9761,.21294,.70553,.97255,.21032,.71577,.96875,.20815,.72596,.9647,.2064,.7361,.96043,.20504,.74617,.95593,.20406,.75617,.95121,.20343,.76608,.94627,.20311,.77591,.94113,.2031,.78563,.93579,.20336,.79524,.93025,.20386,.80473,.92452,.20459,.8141,.91861,.20552,.82333,.91253,.20663,.83241,.90627,.20788,.84133,.89986,.20926,.8501,.89328,.21074,.85868,.88655,.2123,.86709,.87968,.21391,.8753,.87267,.21555,.88331,.86553,.21719,.89112,.85826,.2188,.8987,.85087,.22038,.90605,.84337,.22188,.91317,.83576,.22328,.92004,.82806,.22456,.92666,.82025,.2257,.93301,.81236,.22667,.93909,.80439,.22744,.94489,.79634,.228,.95039,.78823,.22831,.9556,.78005,.22836,.96049,.77181,.22811,.96507,.76352,.22754,.96931,.75519,.22663,.97323,.74682,.22536,.97679,.73842,.22369,.98,.73,.22161,.98289,.7214,.21918,.98549,.7125,.2165,.98781,.7033,.21358,.98986,.69382,.21043,.99163,.68408,.20706,.99314,.67408,.20348,.99438,.66386,.19971,.99535,.65341,.19577,.99607,.64277,.19165,.99654,.63193,.18738,.99675,.62093,.18297,.99672,.60977,.17842,.99644,.59846,.17376,.99593,.58703,.16899,.99517,.57549,.16412,.99419,.56386,.15918,.99297,.55214,.15417,.99153,.54036,.1491,.98987,.52854,.14398,.98799,.51667,.13883,.9859,.50479,.13367,.9836,.49291,.12849,.98108,.48104,.12332,.97837,.4692,.11817,.97545,.4574,.11305,.97234,.44565,.10797,.96904,.43399,.10294,.96555,.42241,.09798,.96187,.41093,.0931,.95801,.39958,.08831,.95398,.38836,.08362,.94977,.37729,.07905,.94538,.36638,.07461,.94084,.35566,.07031,.93612,.34513,.06616,.93125,.33482,.06218,.92623,.32473,.05837,.92105,.31489,.05475,.91572,.3053,.05134,.91024,.29599,.04814,.90463,.28696,.04516,.89888,.27824,.04243,.89298,.26981,.03993,.88691,.26152,.03753,.88066,.25334,.03521,.87422,.24526,.03297,.8676,.2373,.03082,.86079,.22945,.02875,.8538,.2217,.02677,.84662,.21407,.02487,.83926,.20654,.02305,.83172,.19912,.02131,.82399,.19182,.01966,.81608,.18462,.01809,.80799,.17753,.0166,.79971,.17055,.0152,.79125,.16368,.01387,.7826,.15693,.01264,.77377,.15028,.01148,.76476,.14374,.01041,.75556,.13731,.00942,.74617,.13098,.00851,.73661,.12477,.00769,.72686,.11867,.00695,.71692,.11268,.00629,.7068,.1068,.00571,.6965,.10102,.00522,.68602,.09536,.00481,.67535,.0898,.00449,.66449,.08436,.00424,.65345,.07902,.00408,.64223,.0738,.00401,.63082,.06868,.00401,.61923,.06367,.0041,.60746,.05878,.00427,.5955,.05399,.00453,.58336,.04931,.00486,.57103,.04474,.00529,.55852,.04028,.00579,.54583,.03593,.00638,.53295,.03169,.00705,.51989,.02756,.0078,.50664,.02354,.00863,.49321,.01963,.00955,.4796,.01583,.01055];var spectrum_scale_color_map_transparency=200,color_map=new Uint32Array(256),color_map_transparent=new Uint32Array(256),color_map_r=new Uint8Array(256),color_map_g=new Uint8Array(256),color_map_b=new Uint8Array(256);function mkcolormap(){var e;wf.cmap>=kiwi.cmap_e.custom_1&&(e=wf.custom_colormaps[wf.cmap-kiwi.cmap_e.custom_1]);for(var t=0;t<256;t++){var a,_,i,n,o,s,r,l;switch(wf.cmap){case kiwi.cmap_e.kiwi:t<32?(s=0,r=0,l=255*t/31):t<72?(s=0,r=255*(t-32)/39,l=255):t<96?(s=0,r=255,l=255-255*(t-72)/23):t<116?(s=255*(t-96)/19,r=255,l=0):t<184?(s=255,r=255-255*(t-116)/67,l=0):(s=255,r=0,l=128*(t-184)/70);break;case kiwi.cmap_e.CuteSDR:t<43?(s=0,r=0,l=255*t/43):t<87?(s=0,r=255*(t-43)/43,l=255):t<120?(s=0,r=255,l=255-255*(t-87)/32):t<154?(s=255*(t-120)/33,r=255,l=0):t<217?(s=255,r=255-255*(t-154)/62,l=0):(s=255,r=0,l=128*(t-217)/38);break;case kiwi.cmap_e.greyscale:black_level=0,white_level=48,s=r=l=black_level+(255-black_level+white_level)*t/255;break;case kiwi.cmap_e.linear:var d={r:255,g:0,b:255},c={r:0,g:255,b:0};s=d.r*(t/255)+c.r*((255-t)/255),s*=1+t/255*0,r=d.g*(t/255)+c.g*((255-t)/255),r*=1+t/255*0,l=d.b*(t/255)+c.b*((255-t)/255),l*=1+t/255*0;break;case kiwi.cmap_e.turbo:s=255*turbo_colormap_data[3*t+0],r=255*turbo_colormap_data[3*t+1],l=255*turbo_colormap_data[3*t+2];break;case kiwi.cmap_e.SdrDx:t<=20?(a=0,_=0,i=0,s=0,r=0,l=.5,n=0,o=20):t<=60?(a=0,_=0,i=.5,s=0,r=0,l=1,n=21,o=60):t<=150?(a=0,_=0,i=1,s=1,r=1,l=0,n=61,o=150):t<=180?(a=1,_=1,i=0,s=1,r=0,l=0,n=151,o=180):t<=210?(a=1,_=0,i=0,s=1,r=1,l=1,n=181,o=210):(a=1,_=1,i=1,s=1,r=1,l=1,n=211,o=255);var f=(t-n)/(o-n);s=255*(a+(s-a)*f),r=255*(_+(r-_)*f),l=255*(i+(l-i)*f);break;default:s=e[3*t+0],r=e[3*t+1],l=e[3*t+2]}s=Math.round(s),s=w3_clamp(s,0,255),r=Math.round(r),r=w3_clamp(r,0,255),l=Math.round(l),l=w3_clamp(l,0,255),color_map[t]=s<<24|r<<16|l<<8|255,color_map_transparent[t]=s<<24|r<<16|l<<8|spectrum_scale_color_map_transparency,color_map_r[t]=s,color_map_g[t]=r,color_map_b[t]=l}}function dB_wire_to_dBm(e){return e<0&&(e=0),e>255&&(e=255),-(255-e)+cfg.waterfall_cal}function color_index(e,t){var a=dB_wire_to_dBm(e);a<mindb&&(a=mindb),a>maxdb&&(a=maxdb);var _=(a-mindb)/full_scale,i=_;if(isDefined(t))try{switch(+t){case 0:default:break;case 1:i=Math.sqrt(_);break;case 2:_>.21&&_<.5&&(i=.2+.09*(4+Math.log10(_-.2)));break;case 3:_>.31&&_<.6&&(i=.3+.07*(5+Math.log10(_-.3)));break;case 4:_>.41&&_<.7&&(i=.4+.055*(6+Math.log10(_-.4)))}}catch(e){i=_}var n=255*i;return(n=Math.round(n))<0&&(n=0),n>255&&(n=255),n}function waterfall_color_index_max_min(e,t,a){(e=-(255-e))<a&&(e=a),e>t&&(e=t);var _=t-a,i=255*((e-a)/(_=_||1));return(i=Math.round(i))<0&&(i=0),i>255&&(i=255),i}function color_index_max_min(e,t,a){e<a&&(e=a),e>t&&(e=t);var _=t-a,i=255*((e-a)/(_=_||1));return(i=Math.round(i))<0&&(i=0),i>255&&(i=255),i}var afft={init:!1,comp_1x:!1,prev_lsb:!1,audioFFT_dynload:{},offt:0,i_re:0,i_im:0,o_re:0,o_im:0,window_512:[],window_1k:[],window_2k:[],pwr_dB:[],dBi:[],CUTESDR_MAX_VAL:32767},freq_displayed_Hz,freq_displayed_kHz_str,freq_car_Hz,freqset_tout,freq_dsp_set_last;function audioFFT_setup(){if(wf.audioFFT_active){if(zoom_level=0,wf.aper!=kiwi.aper_e.auto){var e=readCookie("last_AF_max_dB",maxdb),t=readCookie("last_AF_min_dB",mindb_un);setmaxdb(1,e),setmindb(1,t),update_maxmindb_sliders()}var a=function(e,t){return.5-.5*Math.cos(2*Math.PI*e/(t-1))};for(i=0;i<512;i++)afft.window_512[i]=a(i,512);for(i=0;i<1024;i++)afft.window_1k[i]=a(i,1024);for(i=0;i<2048;i++)afft.window_2k[i]=a(i,2048)}}function audioFFT_update(){mkscale(),dx_schedule_update(),freq_link_update(),w3_innerHTML("id-nav-optbar-wf","WF"),freqset_select(),wf.audioFFT_clear_wf&&(wf_canvases.forEach(function(e){e.ctx.fillStyle="Black",e.ctx.fillRect(0,0,e.width,e.height)}),spec.need_clear_avg=!0,wf.audioFFT_clear_wf=!1,wf.aper==kiwi.aper_e.auto&&wf.audioFFT_active&&(wf.need_autoscale=16))}function wf_audio_FFT(e,t){if(wf.audioFFT_active&&isDefined(cur_mode)&&kiwi_load_js_polled(afft.audioFFT_dynload,["pkgs/js/Ooura_FFT32.js"])){var a,_,i,n,o=ext_is_IQ_or_stereo_curmode(),s="ls"==cur_mode.substr(0,2)||"sal"==cur_mode,r=!afft.init||o!=afft.iq||audio_compression!=afft.comp;if(r)console.log("audio_FFT: SWITCHING iq="+o+" comp="+audio_compression),o?("complex",afft.size=1024,afft.offt=ooura32.FFT(afft.size,{type:"complex",radix:4}),afft.i_re=ooura32.vectorArrayFactory(afft.offt),afft.i_im=ooura32.vectorArrayFactory(afft.offt)):("real",afft.size=audio_compression?afft.comp_1x?2048:1024:512,afft.offt=ooura32.FFT(afft.size,{type:"real",radix:4}),afft.i_re=ooura32.scalarArrayFactory(afft.offt)),afft.o_re=ooura32.vectorArrayFactory(afft.offt),afft.o_im=ooura32.vectorArrayFactory(afft.offt),afft.scale=20/(afft.size*afft.size*afft.size*afft.CUTESDR_MAX_VAL*afft.CUTESDR_MAX_VAL),afft.init||wf.aper==kiwi.aper_e.auto||(wf.need_autoscale=16),afft.iq=o,afft.comp=audio_compression,afft.init=!0;if(r||s!=afft.prev_lsb){for(a=0;a<1024;a++)afft.pwr_dB[a]=0;afft.prev_lsb=s}if(afft.iq){for(a=0,_=0;a<1024;a+=2,_++)afft.i_re[_]=e[a]*afft.window_512[_],afft.i_im[_]=e[a+1]*afft.window_512[_];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.i_im.buffer,afft.o_re.buffer,afft.o_im.buffer),_=0,i=512;_<256;_++,i++){var l=(c=afft.o_re[_])*c+(f=afft.o_im[_])*f,d=10*Math.log10(l*afft.scale+1e-30);d=Math.round(255+d),afft.pwr_dB[i]=d}for(_=256,i=256;_<512;_++,i++){l=(c=afft.o_re[_])*c+(f=afft.o_im[_])*f,d=10*Math.log10(l*afft.scale+1e-30);d=Math.round(255+d),afft.pwr_dB[i]=d}waterfall_queue.push({data:afft.pwr_dB,audioFFT:1,seq:0,spacing:0})}else if(audio_compression){if(afft.comp_1x){for(a=0;a<2048;a++)afft.i_re[a]=e[a]*afft.window_2k[a];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.o_re.buffer,afft.o_im.buffer),s?(i=512,n=-1):(i=256,n=1),_=0;_<1024;_++){l=(c=afft.o_re[_])*c+(f=afft.o_im[_])*f;afft.dBi[1&_]=Math.round(255+10*Math.log10(l*afft.scale+1e-30)),1&_&&(afft.pwr_dB[i]=Math.max(afft.dBi[0],afft.dBi[1]),i+=n)}}else{for(a=0;a<1024;a++)afft.i_re[a]=e[a]*afft.window_1k[a];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.o_re.buffer,afft.o_im.buffer),s?(i=512,n=-1):(i=256,n=1),_=0;_<512;_++,i+=n){l=(c=afft.o_re[_])*c+(f=afft.o_im[_])*f;afft.pwr_dB[i]=Math.round(255+10*Math.log10(l*afft.scale+1e-30))}for(waterfall_queue.push({data:afft.pwr_dB,audioFFT:1,seq:0,spacing:0}),a=1024;a<2048;a++)afft.i_re[a]=e[a]*afft.window_2k[a-1024];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.o_re.buffer,afft.o_im.buffer),s?(i=512,n=-1):(i=256,n=1),_=0;_<512;_++,i+=n){l=(c=afft.o_re[_])*c+(f=afft.o_im[_])*f;afft.pwr_dB[i]=Math.round(255+10*Math.log10(l*afft.scale+1e-30))}}waterfall_queue.push({data:afft.pwr_dB,audioFFT:1,seq:0,spacing:0})}else{for(a=0;a<512;a++)afft.i_re[a]=e[a]*afft.window_512[a];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.o_re.buffer,afft.o_im.buffer),s?(i=512,n=-2):(i=256,n=2),_=0;_<256;_++,i+=n){var c,f;l=(c=afft.o_re[_])*c+(f=afft.o_im[_])*f;afft.pwr_dB[i]=afft.pwr_dB[i+1]=Math.round(255+10*Math.log10(l*afft.scale+1e-30))}waterfall_queue.push({data:afft.pwr_dB,audioFFT:1,seq:0,spacing:0})}}}function freq_dsp_to_car(e){var t=demodulators[0];if(isUndefined(t))return console.log("freq_dsp_to_car no demod?"),e;var a=t.low_cut+(t.high_cut-t.low_cut)/2;return fcar=t.isCW?e-a:e,fcar<0&&(fcar=0),fcar>bandwidth&&(fcar=bandwidth),fcar}function freq_car_to_dsp(e){var t=demodulators[0];if(isUndefined(t))return e;var a=t.low_cut+(t.high_cut-t.low_cut)/2;return fdsp=t.isCW?e+a:e,fdsp}function passband_offset(){var e=0,t=demodulators[0];return isDefined(t)&&(e=t.usePBCenter?t.low_cut+(t.high_cut-t.low_cut)/2:0),e}function freq_passband_center(){var e=0,t=demodulators[0];return isDefined(t)&&(e=center_freq+t.offset_frequency,e+=t.low_cut+(t.high_cut-t.low_cut)/2),e}function passband_offset_dxlabel(e){var t=passbands[e],a=e.substr(0,2);return"us"==a||"ls"==a?t.lo+(t.hi-t.lo)/2:0}function freqmode_set_dsp_kHz(e,t,a){var _=w3_opt(a,"dont_clear_wf",!1),i=w3_opt(a,"open_ext",!1);e*=1e3,0==_&&(wf.audioFFT_clear_wf=!0),!isArg(t)||t==cur_mode&&1!=i?demodulator_set_offset_frequency(0,(freq_car_Hz=freq_dsp_to_car(e))-center_freq):ext_set_mode(t,e,a)}function freqset_car_Hz(e){freq_car_Hz=e}function freqset_update_ui(){if(freq_displayed_Hz=freq_car_to_dsp(freq_car_Hz),freq_displayed_kHz_str=(freq_displayed_Hz/1e3).toFixed(2),waterfall_setup_done){var e=w3_el("id-freq-input");if(!isUndefined(e)&&null!=e){var t=freq_displayed_Hz+1e3*cfg.freq_offset;freq_displayed_kHz_str_with_freq_offset=(t/1e3).toFixed(t>1e8?1:2),e.value=freq_displayed_kHz_str_with_freq_offset,freqset_select();var a=-passband_visible()-1;if(a>=0)waterfall_pan_canvases(a-(x_bin+bins_at_cur_zoom()/2));check_band(),writeCookie("last_freq",freq_displayed_kHz_str_with_freq_offset),freq_dsp_set_last=freq_displayed_kHz_str_with_freq_offset,freq_step_update_ui(),freq_link_update(),freq_displayed_kHz_str_with_freq_offset!=freq_memory[freq_memory_pointer]&&freq_memory.push(freq_displayed_kHz_str_with_freq_offset),freq_memory.length>25&&freq_memory.shift(),freq_memory_pointer=freq_memory.length-1,writeCookie("freq_memory",JSON.stringify(freq_memory))}}}function freqset_keydown(e){"38"==e.keyCode?freq_memory_up_down(1):"40"==e.keyCode&&freq_memory_up_down(0)}var freq_up_down_timeout=-1;function freq_memory_up_down(e){kiwi_clearTimeout(freq_up_down_timeout);var t=w3_el("id-freq-input");if(e)freq_memory_pointer>0&&--freq_memory_pointer,freq_memory[freq_memory_pointer]&&(t.value=freq_memory[freq_memory_pointer]);else{if(!(freq_memory_pointer<freq_memory.length-1))return;freq_memory[++freq_memory_pointer]&&(t.value=freq_memory[freq_memory_pointer])}freq_up_down_timeout=setTimeout(function(){kiwi_isMobile()||(freq_memory_pointer=freq_memory.length-1,w3_el("id-freq-input").value=freq_dsp_set_last),freqset_complete("u/d t/o")},kiwi_isMobile()?2e3:3e3)}function freqset_select(e){var t=document.activeElement;t&&w3_contains(t,"w3-retain-input-focus")||w3_field_select("id-freq-input",{mobile:1})}function modeset_update_ui(e){null!=owrx.last_mode_el&&(owrx.last_mode_el.style.color="white");var t=e.substr(0,2);"qa"==t&&(t="sa");var a=w3_el("id-mode-"+t);a.innerHTML=e.toUpperCase(),a&&a.style&&(a.style.color="lime"),owrx.last_mode_el=a,squelch_setup(toggle_e.FROM_COOKIE),writeCookie("last_mode",e),freq_link_update();var _=ext_is_IQ_or_stereo_mode(e);w3_els("id-button-compression",function(e){w3_set_props(e,"w3-disabled",_)})}function try_freqset_update_ui(){waterfall_setup_done?(freqset_update_ui(),wf.audioFFT_active?(cur_mode!=wf.audioFFT_prev_mode&&(wf.audioFFT_clear_wf=!0),audioFFT_update(),wf.audioFFT_prev_mode=cur_mode):mkenvelopes(get_visible_freq_range())):setTimeout(try_freqset_update_ui,1e3)}function try_modeset_update_ui(e){waterfall_setup_done?modeset_update_ui(e):setTimeout(function(){try_modeset_update_ui(e)},1e3)}function freq_link_update(){var e=kiwi_url_origin()+"/?f="+freq_displayed_kHz_str+cur_mode+"z"+zoom_level;w3_innerHTML("id-freq-link",w3_icon("w3-text-css-lime||title="+dq("copy to clipboard:\n"+e),"fa-external-link-square",15,"","freq_link_update_cb",e))}function freq_link_update_cb(e,t,a){a||w3_copy_to_clipboard(t)}function freqset_complete(e){var t=w3_el("id-freq-input");if(kiwi_clearTimeout(freqset_tout),kiwi_clearTimeout(freq_up_down_timeout),!isUndefined(t)&&null!=t){var a=t.value.split(/[\/:]/),_=t.value.includes("/"),i=a[0].replace(",",".").parseFloatWithUnits("M",.001),n=!0;if("/"==t.value)return restore_passband(cur_mode),demodulator_analog_replace(cur_mode),void freqset_update_ui();if(i>0&&!isNaN(i)&&(i-=cfg.freq_offset)>0&&!isNaN(i)&&(freqmode_set_dsp_kHz(i,null),w3_field_select(t,{mobile:1}),n=!1),n&&freqset_update_ui(),a[1]){p2=a[1].split(",");var o=p2[0].parseFloatWithUnits("k"),s=NaN;p2.length>1&&(s=p2[1].parseFloatWithUnits("k"));var r=ext_get_passband(),l=(r.high-r.low)/2,d=r.low+l;if(_){if(1==p2.length)o=d-(c=o/2),s=d+c}else{var c,f=o;if(1==p2.length)o=f-l,s=f+l;else o=f-(c=Math.abs(s/2)),s=f+c}ext_set_passband(o,s,!0)}}}var ignore_next_keyup_event=!1;function freqset_keyup(e,t){if(kiwi_clearTimeout(freqset_tout),null!=t&&null!=t.key){var a=t.key.length;if(any_alternate_click_event_except_shift(t)||1!=a&&"Backspace"!=t.key)return"Escape"==t.key&&freqset_update_ui(),void(ignore_next_keyup_event=!1)}ignore_next_keyup_event?ignore_next_keyup_event=!1:freqset_tout=setTimeout(function(){freqset_complete("t/o")},3e3)}var num_step_buttons=6,up_down={am:[0,-1,-.1,.1,1,0],amn:[0,-1,-.1,.1,1,0],sam:[0,-1,-.1,.1,1,0],sal:[0,-1,-.1,.1,1,0],sau:[0,-1,-.1,.1,1,0],sas:[0,-1,-.1,.1,1,0],qam:[0,-1,-.1,.1,1,0],drm:[0,-1,-.1,.1,1,0],usb:[0,-1,-.1,.1,1,0],usn:[0,-1,-.1,.1,1,0],lsb:[0,-1,-.1,.1,1,0],lsn:[0,-1,-.1,.1,1,0],cw:[0,-.1,-.01,.01,.1,0],cwn:[0,-.1,-.01,.01,.1,0],nbfm:[-5,-1,-.1,.1,1,5],iq:[0,-1,-.1,.1,1,0]},up_down_default={am:[5,0,0,0,0,5],amn:[5,0,0,0,0,5],sam:[5,0,0,0,0,5],sal:[5,0,0,0,0,5],sau:[5,0,0,0,0,5],sas:[5,0,0,0,0,5],qam:[5,0,0,0,0,5],drm:[5,0,0,0,0,5],usb:[5,0,0,0,0,5],usn:[5,0,0,0,0,5],lsb:[5,0,0,0,0,5],lsn:[5,0,0,0,0,5],cw:[1,0,0,0,0,1],cwn:[1,0,0,0,0,1],iq:[5,0,0,0,0,5]},NDB_400_1000_mode=1,freq_step_last_mode,freq_step_last_band;function special_step(e,t,a){var _,i=cur_mode.substr(0,2);if(null!=e&&"NDB"==e.name)_="cw"==i?NDB_400_1000_mode:-1," NDB";else if(null==e||"LW"!=e.name&&"MW"!=e.name)null!=e&&0!=e.chan?(_=e.chan," band="+e.name+" "):(_=-1," no band chan found, use default");else{_="am"==i||"sa"==i||"qa"==i||"ls"==i||"us"==i||"iq"==i||"dr"==i?step_9_10?9e3:1e4:-1," LW/MW"}return-1==_&&(_=1e3*up_down_default[cur_mode][t]),t<num_step_buttons/2&&(_=-_)," "+_,_}function freqstep(e){var t=1e3*up_down[cur_mode][e];0==t&&(t=special_step(find_band(freq_displayed_Hz),e,"freqstep"));var a=freq_displayed_Hz,_=Math.abs(t),i=t>=0?1:0,n=a/_;if(n=(i?Math.ceil(n):Math.floor(n))*_,_==NDB_400_1000_mode){var o=a%1e3;o=i?o<400?400:o<600?600:1e3:0==o?-400:o<=400?0:o<=600?400:600,a=(n=1e3*Math.floor(a/1e3))+o,"400/1000"}else freq_displayed_Hz!=n?(a=n,"TRUNC"):(a+=t,"INC");freqmode_set_dsp_kHz(a/1e3,null,{dont_clear_wf:!0})}function freq_step_update_ui(e){if(!isUndefined(cur_mode)&&null!=passbands[cur_mode]){var t=find_band(freq_displayed_Hz);if(e||freq_step_last_mode!=cur_mode||freq_step_last_band!=t){var a=cur_mode.substr(0,2),_="am"==a||"sa"==a||"qa"==a||"ls"==a||"us"==a||"iq"==a||"dr"==a,i=!(null==t||"LW"!=t.name&&"MW"!=t.name||!_);w3_visible("id-9-10-cell",i);for(var n=0;n<num_step_buttons;n++){var o,s=1e3*up_down[cur_mode][n];0==s&&(s=special_step(t,n,"freq_step_update_ui"));var r=Math.abs(s),l=s>=0?1:0;o=r>=1e3?(l?"+":"")+(s/1e3).toString()+"k":r!=NDB_400_1000_mode?(l?"+":"")+s.toString():(l?"+":"-")+"400/"+(l?"+":"-")+"1000",html("id-step-"+n).title=o}freq_step_last_mode=cur_mode,freq_step_last_band=t}}}function band_info(){var e,t,a,_=+cfg.init.AM_BCB_chan?10:9,i=cfg.init.ITU_region+1;return 1==i?(e=283.5,t=526.5,a=1606.5):2==i?(e=190.5,t=540-_/2,a=1700+_/2):(e=190.5,t=540-_/2,a=1602+_/2),{ITU_region:i,_9_10:_,LW_lo:148.5,NDB_lo:e,NDB_hi:t,MW_hi:a}}function bands_init(){var e,t,a,_;for(owrx.nbands=[],e=t=0;e<bands.length;e++){if("LW"==(s=bands[e]).name&&"E"==s.region&&(s.region="1"),"LW"==s.name&&">"==s.region&&(s.region="23"),"MW"==s.name&&"3"==s.region&&(s.region="13"),"NDB"==s.name&&"E"==s.region&&(s.region="1"),"NDB"==s.name&&"U"==s.region&&(s.region="2"),"NDB"==s.name&&">"==s.region&&(s.region="3"),"MF"==s.name&&">23"==s.region&&(s.region="*"),s.name.startsWith("Time ")&&"*"==s.region&&(s.region="m"),s.region){var i=s.region.length;if(1==i){owrx.nbands[t]=kiwi_shallow_copy(s);var n=owrx.nbands[t];t++;var o=n.region.charAt(0);n.itu=o>="1"&&o<="3"?o.charCodeAt(0)-"1".charCodeAt(0)+1:"m"==o?-1:"-"==o||"*"==o||">"==o?0:-1}else for(a=0;a<i;a++){if(">"!=(o=s.region.charAt(a))){owrx.nbands[t]=kiwi_shallow_copy(s);n=owrx.nbands[t];t++,n.itu=o>="1"&&o<="3"?o.charCodeAt(0)-"1".charCodeAt(0)+1:-1}}}else{owrx.nbands[t]=kiwi_shallow_copy(s),(n=owrx.nbands[t]).itu=0,t++}}for(bands=owrx.nbands,e=0;e<bands.length;e++)var s=bands[e];var r=band_info();for(e=t=0;e<bands.length;e++){s=bands[e];bands[e].chan=isUndefined(s.chan)?0:s.chan,s.min-=s.chan/2,s.max+=s.chan/2,"LW"==s.name&&(s.min=r.LW_lo,s.max=r.NDB_lo,s.chan=9),"NDB"==s.name&&(s.min=r.NDB_lo,s.max=r.NDB_hi,s.chan=0),"MW"==s.name&&(s.min=r.NDB_hi,s.max=r.MW_hi,s.chan=r._9_10),s.min*=1e3,s.max*=1e3,s.chan*=1e3;var l=s.max-s.min;for(_=zoom_nom;_>=0;_--){if(l<=.8*(bandwidth/(1<<_)))break}bands[e].zoom_level=_,bands[e].cf=s.min+(s.max-s.min)/2,bands[e].longName=s.name+" "+s.s.name,s.s!=svc.L&&s.s!=svc.X||"m"!=s.region||s.sel.includes("cwn")||(s.sel=s.sel.replace("cw","cwn"))}}function find_band(e){for(var t,a=cfg.init.ITU_region+1,_=0;_<bands.length;_++)if((0==(t=bands[_]).itu||t.itu==a)&&e>=t.min&&e<=t.max)return t;return null}function mk_bands_scale(){var e,t,a,_=g_range,i=band_ctx.canvas.width,n=band_scale_top,o=band_scale_h,s=n+band_scale_text_top,r=1e3*cfg.freq_offset;band_ctx.globalAlpha=1,band_ctx.fillStyle="White",band_ctx.fillRect(0,band_canvas_top,i,band_canvas_h);var l=cfg.init.ITU_region+1;for(e=0;e<bands.length;e++){var d=bands[e];if(0==d.itu||d.itu==l){if(d.min<r)break;var c,f=0,p=d.min>=_.start&&d.min<=_.end?1:0,u=d.max>=_.start&&d.max<=_.end?1:0;if(p&&u?(f=d.min,c=d.max):!p&&u?(f=_.start,c=d.max):p&&!u?(f=d.min,c=_.end):d.min<_.start&&d.max>_.end&&(f=_.start,c=_.end),0!=f)if(t=scale_px_from_freq(f,g_range),!((a=scale_px_from_freq(c,g_range)-t)<3)){band_ctx.fillStyle=d.s.color,band_ctx.globalAlpha=.2,band_ctx.fillRect(t,n,a,o),band_ctx.globalAlpha=1,band_ctx.font="bold 12px sans-serif",band_ctx.textBaseline="top";var w=t+a/2,m=d.longName,h=band_ctx.measureText(m);a>=h.width+4||(m=d.name,a>=(h=band_ctx.measureText(m)).width+4||(m=null)),m&&band_ctx.fillText(m,w-h.width/2,s)}}}}function mk_spurs(){scale_ctx.fillStyle="red";for(var e=scale_canvas_h-12,t=0;t<=zoom_level&&t<spurs.length;t++)for(var a=0;a<spurs[t].length;a++){var _=scale_px_from_freq(1e3*spurs[t][a],g_range);if(_>window.innerWidth)break;_<0||scale_ctx.fillRect(_-1,e,2,12)}}function parse_freq_mode(e){new RegExp("([0-9.]*)([^&#]*)").exec(e)}band_canvas_h=30,band_canvas_top=0,band_scale_h=20,band_scale_top=5,band_scale_text_top=5,dx_container_h=80,dx_container_top=band_canvas_h,dx_label_top=5,dx_line_h=dx_container_h-dx_label_top,scale_canvas_h=47,scale_canvas_top=band_canvas_h+dx_container_h,scale_container_h=band_canvas_h+dx_container_h+scale_canvas_h;var last_selected_band=0,maxdb,mindb_un,mindb,full_scale;function band_scroll(e){var t,a=last_selected_band;do{(a+=e)<0&&(a=band_menu.length-1),a>=band_menu.length&&(a=0),t=band_menu[a]}while(null==t);select_band(a),w3_set_value("id-select-band",a)}function select_band(e,t){var a=+e;if(isNaN(a)){var _;for(_=0;_<band_menu.length-1&&(!band_menu[_]||band_menu[_].name!=e);_++);_<band_menu.length-1&&select_band(_,t)}else{var i;if(b=band_menu[a],null!=b)isDefined(b.sel)?(i=parseFloat(b.sel),isUndefined(t)&&isString(b.sel)&&(t=-1==(t=b.sel.search(/[a-z]/i))?null:b.sel.slice(t))):i=b.cf/1e3,last_selected_band=a,dbgUs&&(sb_trace=0),freqmode_set_dsp_kHz(i,t),zoom_step(ext_zoom.TO_BAND,b);else check_band(!0)}}function check_band(e){if(last_selected_band){band=band_menu[last_selected_band];var t=freq_car_Hz,a=freq_passband_center();(null!=e&&-1==e||(t<band.min||t>band.max)&&(a<band.min||a>band.max))&&(w3_select_value("id-select-band",0),last_selected_band=0)}}function tune(e,t,a,_){ext_tune(e,t,ext_zoom.ABS,a,_)}function init_scale_dB(){maxdb=init_max_dB,mindb_un=init_min_dB,mindb=mindb_un-zoomCorrection(),full_scale=(full_scale=maxdb-mindb)||1,wf.save_maxdb=maxdb,wf.save_mindb_un=mindb_un,wf.auto_ceil.val=+initCookie("last_ceil_dB",wf.auto_ceil.def),wf.auto_floor.val=+initCookie("last_floor_dB",wf.auto_floor.def)}var confirmation={displayed:!1,close_cb:null},cal_adc_new_adj;function confirmation_panel_init(){w3_el("id-panels-container").innerHTML+=w3_div('id-confirmation class-panel|border: 1px solid white|data-panel-name="confirmation" data-panel-pos="center" data-panel-order="0" data-panel-size="600,100"'),w3_innerHTML("id-confirmation",w3_divs("id-confirmation-container/class-panel-inner")+w3_div("id-confirmation-vis class-vis"))}function confirmation_panel_set_close_func(e){w3_el("id-confirmation-close").onclick=e,confirmation.close_cb=e}function confirmation_panel_init2(){confirmation_panel_set_close_func(confirmation_panel_close),w3_el("id-kiwi-body").addEventListener("keyup",function(e){"Escape"==e.key&&(confirmation.close_cb(),toggle_or_set_hide_panels(0))},!0)}function confirmation_show_content(e,t,a,_,i){confirmation.displayed&&w3_color("id-confirmation",null,""),w3_innerHTML("id-confirmation-container",e),w3_color("id-confirmation",null,i),_&&confirmation_panel_set_close_func(_),confirmation_panel_show(t,a),toggle_or_set_hide_panels(0)}function confirmation_panel_show(e,t){el=w3_el("id-confirmation"),el.style.zIndex=1020,null==e&&(e=525),null==t&&(t=80),confirmation_panel_resize(e,t),confirmation.displayed=!confirmation.displayed,toggle_panel("id-confirmation")}function confirmation_panel_resize(e,t){var a=w3_el("id-confirmation");panel_set_width_height("id-confirmation",e,t),a.style.left=px(window.innerWidth/2-a.activeWidth/2),a.style.bottom=px(window.innerHeight/2-a.uiHeight/2)}function confirmation_panel_close(){confirmation.displayed&&(w3_color("id-confirmation",null,""),toggle_panel("id-confirmation"),confirmation_panel_set_close_func(confirmation_panel_close),confirmation.displayed=!1)}function cal_adc_dialog(e,t,a,_){var i;if(cfg.ADC_clk_corr&&ext_adc_gps_clock_corr()>3?1:0)i=w3_col_percent("/w3-valign",w3_div("w3-show-inline-block","GPS is automatically correcting ADC clock. <br> No manual calibration available.")+w3_button("w3-red w3-margin-left","Close","confirmation_panel_close"),80);else{cal_adc_new_adj=e;var n=100*ext_adc_clock_nom_Hz()/1e6;e<-n||e>n?(console.log("cal ADC clock: ADJ TOO LARGE"),i=w3_col_percent("/w3-valign",w3_div("w3-show-inline-block","ADC clock adjustment too large: "+t+" Hz<br>(ADC clock "+_.toFixed(1)+" ppm, limit is +/- 100 ppm)")+w3_button("w3-red w3-margin-left","Close","confirmation_panel_close"),80)):i=w3_col_percent("/w3-valign",w3_div("w3-show-inline-block","ADC clock will be adjusted by<br>"+t+" Hz to "+a+" kHz<br>(ADC clock "+_.toFixed(1)+" ppm)")+w3_button("w3-green w3-margin-left","Confirm","cal_adc_confirm")+w3_button("w3-red w3-margin-left","Cancel","confirmation_panel_close"),80)}confirmation_show_content(i,525,70)}function cal_adc_confirm(){ext_send("SET clk_adj="+cal_adc_new_adj),ext_set_cfg_param("cfg.clk_adj",cal_adc_new_adj,!0),confirmation_panel_close()}function admin_pwd_query(e){ext_hasCredential("admin",admin_pwd_cb,e,ws_wf)}function admin_pwd_cb(e,t){(console.log("admin_pwd_cb badp="+e),e)?(confirmation_show_content(w3_col_percent("/w3-text-aqua",w3_input("kiwi-pw","Admin password","admin.pwd","","admin_pwd_cb2"),80),525,80),w3_field_select("id-admin.pwd",{mobile:1})):t()}function admin_pwd_cb2(e,t){w3_string_cb(e,t),confirmation_panel_close(),ext_valpwd("admin",t,ws_wf)}var dx={filter_ident:"",filter_notes:"",filter_case:0,filter_wild:0,filter_grep:0,ctrl_click:!1,displayed:[]},dx_update_delay=350,dx_update_timeout,dx_seq=0;function dx_schedule_update(){kiwi_clearTimeout(dx_update_timeout),dx_div.innerHTML="",dx_update_timeout=setTimeout(dx_update,dx_update_delay)}function dx_update(){dx_seq++,wf_send("SET MARKER min="+(g_range.start/1e3).toFixed(3)+" max="+(g_range.end/1e3).toFixed(3)+" zoom="+zoom_level+" width="+waterfall_width)}var dx_ibp_list,dx_ibp_interval,dx_ibp_server_time_ms,dx_ibp_local_time_epoch_ms=0,dx_ibp_freqs={14:0,18:1,21:2,24:3,28:4},dx_ibp_lastsec=0,dx_ibp=["4U1UN","New York","VE8AT","Nunavut","W6WX","California","KH6RS","Hawaii","ZL6B","New Zealand","VK6RBP","Australia","JA2IGY","Japan","RR9O","Siberia","VR2B","Hong Kong","4S7B","Sri Lanka","ZS6DN","South Africa","5Z4B","Kenya","4X6TU","Israel","OH2B","Finland","CS3B","Madeira","LU4AA","Argentina","OA4B","Peru","YV5B","Venezuela"],dx_list=[];function dx_label_cb(e){var t,a=e[0];if(2!=a.t){kiwi_clearInterval(dx_ibp_interval),dx_ibp_list=[],dx_ibp_server_time_ms=1e3*a.s+ +a.m,dx_ibp_local_time_epoch_ms=Date.now(),dx_filter_field_err(+a.f);var _,i=120;dx_div.innerHTML="";var n="";for(dx.displayed=[],t=1;t<e.length;t++){_=t-1;var o=(a=e[t]).g,s=a.f,r=a.o,l=a.b,d=a.i,c=isDefined(a.n)?a.n:"",f=isDefined(a.p)?a.p:"",p=1e3*s,u=scale_px_from_freq(p+passband_offset_dxlabel(kiwi.modes_l[l&DX_MODE]),g_range)-1,w=0,m=p-r;r&&(w=scale_px_from_freq(m,g_range));var h=dx_label_top+30*(1&_),g=dx_container_h-h,v=type_colors[l&DX_TYPE];"IBP"!=d&&"IARU%2fNCDXF"!=d||(v=type_colors[32]),m/=1e3,dx_list[o]={gid:o,carrier:m,lo:a.lo,hi:a.hi,freq:s,moff:r,flags:l,ident:d,notes:c,params:f},dx.displayed[_]=dx_list[o],n+='<div id="'+_+'-id-dx-label" class="class-dx-label '+o+"-id-dx-gid"+(""!=f?" id-has-ext":"")+'" style="left:'+(u-10)+"px; top:"+h+"px; z-index:"+i+"; background-color:"+v+';" onmouseenter="dx_enter(this,'+w+', event)" onmouseleave="dx_leave(this,'+w+')" onmousedown="ignore(event)" onmousemove="ignore(event)" onmouseup="ignore(event)" ontouchmove="ignore(event)" ontouchend="ignore(event)" onclick="dx_click(event,'+o+')" ontouchstart="dx_click(event,'+o+')" name="'+(""==f?0:1)+'"></div><div class="class-dx-line" id="'+_+'-id-dx-line" style="left:'+u+"px; top:"+h+"px; height:"+g+'px; z-index:110"></div>',i++}for(dx_div.innerHTML=n,t=1;t<e.length;t++){_=t-1;d=(a=e[t]).i,c=isDefined(a.n)?a.n:"";var b=w3_el(_+"-id-dx-label");try{b.innerHTML=decodeURIComponent(d)}catch(e){b.innerHTML="bad URI decode"}try{b.title=decodeURIComponent(c)}catch(e){b.title="bad URI decode"}if("IBP"==d||"IARU%2fNCDXF"==d){var x=dx_ibp_freqs[Math.trunc(s/1e3)];dx_ibp_list.push({idx:_,off:x}),kiwi_clearInterval(dx_ibp_interval),dx_ibp_interval=setInterval(function(){var e=new Date(dx_ibp_server_time_ms+(Date.now()-dx_ibp_local_time_epoch_ms)),t=e.getMinutes(),a=e.getSeconds(),_=a%10;if(0==_&&9==dx_ibp_lastsec)for(var i=t%3*6+Math.trunc(a/10),n=0;n<dx_ibp_list.length;n++){var o=i-dx_ibp_list[n].off;o<0&&(o=18+o);var s=w3_el(dx_ibp_list[n].idx+"-id-dx-label");s&&(s.innerHTML="IBP: "+dx_ibp[2*o]+" "+dx_ibp[2*o+1])}dx_ibp_lastsec=_},500)}}}else{var k=e[1];if(k){var y=kiwi.modes_l[k.b&DX_MODE];if(freqmode_set_dsp_kHz(k.f,y),0!=k.lo&&0!=k.hi)ext_set_passband(k.lo,k.hi);else{var q=passbands[y];ext_set_passband(q.lo,q.hi)}}}}function dx_filter(){confirmation_show_content(w3_div("w3-medium w3-text-aqua w3-bold","DX label filter")+w3_divs("w3-text-aqua",w3_col_percent("",w3_divs("/w3-margin-T-8",w3_input("w3-label-inline/id-dx-filter-ident w3-retain-input-focus w3-input-any-change w3-padding-small","Ident","dx.filter_ident",dx.filter_ident,"dx_filter_cb"),w3_input("w3-label-inline/id-dx-filter-notes w3-retain-input-focus w3-input-any-change w3-padding-small","Notes","dx.filter_notes",dx.filter_notes,"dx_filter_cb")),90),w3_inline("w3-halign-space-around w3-margin-T-8 w3-text-white/",w3_checkbox("w3-retain-input-focus w3-label-inline w3-label-not-bold","case sensitive","dx.filter_case",dx.filter_case,"dx_filter_opt_cb"),w3_inline("",w3_text("","pattern match:"),w3_checkbox("w3-margin-left w3-retain-input-focus w3-label-inline w3-label-not-bold","grep","dx.filter_grep",dx.filter_grep,"dx_filter_opt_cb")))),450,140,dx_filter_panel_close),w3_field_select("id-dx-filter-ident",{mobile:1})}function dx_filter_panel_close(){var e=document.activeElement;e&&e.id&&(e.id.startsWith("id-dx-filter")||e.id.startsWith("id-dx.filter"))&&e.blur(),confirmation_panel_close()}function dx_filter_cb(e,t,a,_){if(!a){w3_string_cb(e,t);var i=""!=dx.filter_ident||""!=dx.filter_notes;wf_send("SET DX_FILTER i="+encodeURIComponent(dx.filter_ident+"x")+" n="+encodeURIComponent(dx.filter_notes+"x")+" c="+dx.filter_case+" w="+dx.filter_wild+" g="+dx.filter_grep),w3_remove_then_add("id-dx-container","whiteSmoke cl-dx-filtered",i?"cl-dx-filtered":"whiteSmoke"),i||_||dx_filter_panel_close()}}function dx_filter_opt_cb(e,t,a){a||(t=+t,w3_bool_cb(e,t),dx_filter_cb("dx.filter_ident",dx.filter_ident,!1,!0),w3_checkbox_set(e,t),t&&"dx.filter_case"!=e&&dx_filter_opt_cb("dx.filter_wild"==e?"dx.filter_grep":"dx.filter_wild",0),w3_field_select("id-dx-filter-ident",{mobile:1}))}function dx_filter_field_err(e){w3_set_props("id-dx-filter-ident","w3-pink",1&e),w3_set_props("id-dx-filter-notes","w3-pink",2&e)}function dx_label_step(e){var t,a;if(1==e){for(t=0;t<dx.displayed.length;t++){if(a=dx.displayed[t],Math.round(1e3*a.freq)>freq_displayed_Hz)break}if(t==dx.displayed.length)return void wf_send("SET MARKER dir=1 freq="+(freq_displayed_Hz/1e3).toFixed(3))}else{for(t=dx.displayed.length-1;t>=0;t--){if(a=dx.displayed[t],Math.round(1e3*a.freq)<freq_displayed_Hz)break}if(t<0)return void wf_send("SET MARKER dir=-1 freq="+(freq_displayed_Hz/1e3).toFixed(3))}var _=kiwi.modes_l[a.flags&DX_MODE];if(freqmode_set_dsp_kHz(a.freq,_),0!=a.lo&&0!=a.hi)ext_set_passband(a.lo,a.hi);else{var i=passbands[_];ext_set_passband(i.lo,i.hi)}}var dx_panel_customize=!1,dx_keys,dx_z_save,dx_bg_color_save,smeter_width;function dx_show_edit_panel(e,t){dx_keys=e?{shift:e.shiftKey,alt:e.altKey,ctrl:e.ctrlKey,meta:e.metaKey}:{shift:0,alt:0,ctrl:0,meta:0},dxo.gid=t,dx_panel_customize||(html("id-ext-controls").className="class-panel class-dx-panel",dx_panel_customize=!0),admin_pwd_query(function(){dx_show_edit_panel2()})}function dx_show_edit_panel2(){var e=dxo.gid;if(-1==e)dxo.f=freq_displayed_kHz_str,dxo.lo=dxo.hi=dxo.o=0,dxo.m=kiwi.modes_s[cur_mode],dxo.y=types_s.active,dxo.i=dxo.n=dxo.p="";else{dxo.f=dx_list[e].carrier.toFixed(2),dxo.lo=dx_list[e].lo,dxo.hi=dx_list[e].hi,dxo.o=dx_list[e].moff,dxo.m=dx_list[e].flags&DX_MODE,dxo.y=(dx_list[e].flags&DX_TYPE)>>DX_TYPE_SFT;try{dxo.i=decodeURIComponent(dx_list[e].ident)}catch(e){dxo.i="bad URI decode"}try{dxo.n=decodeURIComponent(dx_list[e].notes)}catch(e){dxo.n="bad URI decode"}try{dxo.p=decodeURIComponent(dx_list[e].params)}catch(e){dxo.p="bad URI decode"}}if(-1!=e&&dx_keys.shift&&dx_keys.alt){var t=dxo.y;t=t==types_s.active?types_s.watch_list:types_s.active,dxo.y=t;var a=dxo.m;return a|=t<<DX_TYPE_SFT,void wf_send("SET DX_UPD g="+dxo.gid+" f="+dxo.f+" lo="+dxo.lo.toFixed(0)+" hi="+dxo.hi.toFixed(0)+" o="+dxo.o.toFixed(0)+" m="+a+" i="+encodeURIComponent(dxo.i+"x")+" n="+encodeURIComponent(dxo.n+"x")+" p="+encodeURIComponent(dxo.p+"x"))}extint_panel_hide(),dxo.f=(parseFloat(dxo.f)+cfg.freq_offset).toFixed(2),dxo.pb="",(dxo.lo||dxo.hi)&&(dxo.lo==-dxo.hi?dxo.pb=(2*Math.abs(dxo.hi)).toFixed(0):dxo.pb=dxo.lo.toFixed(0)+", "+dxo.hi.toFixed(0));var _=w3_div("w3-medium w3-text-aqua w3-bold","DX label edit")+w3_divs("w3-text-aqua/w3-margin-T-8",w3_inline("w3-halign-space-between/",w3_input("w3-padding-small||size=8","Freq","dxo.f",dxo.f,"dx_num_cb"),w3_select("|color:red","Mode","","dxo.m",dxo.m,kiwi.modes_u,"dx_sel_cb"),w3_input("w3-padding-small||size=10","Passband","dxo.pb",dxo.pb,"dx_passband_cb"),w3_select("|color:red","Type","","dxo.y",dxo.y,types,"dx_sel_cb"),w3_input("w3-padding-small||size=8","Offset","dxo.o",dxo.o,"dx_num_cb")),w3_input("w3-label-inline/w3-padding-small w3-retain-input-focus","Ident","dxo.i","","dx_string_cb"),w3_input("w3-label-inline/w3-padding-small","Notes","dxo.n","","dx_string_cb"),w3_input("w3-label-inline/w3-padding-small","Extension","dxo.p","","dx_string_cb"),w3_inline("w3-hspace-16",w3_button("w3-yellow","Modify","dx_modify_cb"),w3_button("w3-green","Add","dx_add_cb"),w3_button("w3-red","Delete","dx_delete_cb"),w3_text("","Create new label with Add button")));ext_panel_show(_,null,function(){var e=w3_el("dxo.i");e.value=dxo.i,w3_el("dxo.n").value=dxo.n,w3_el("dxo.p").value=dxo.p,w3_field_select(e,{mobile:1})}),ext_set_controls_width_height(550,260)}function dx_close_edit_panel(e){w3_radio_unhighlight(e),extint_panel_hide()}function dx_modify_cb(e,t){if(-1!=dxo.gid){var a=dxo.m;a|=dxo.y<<DX_TYPE_SFT,dxo.f-=cfg.freq_offset,dxo.f<0&&(dxo.f=0),wf_send("SET DX_UPD g="+dxo.gid+" f="+dxo.f+" lo="+dxo.lo.toFixed(0)+" hi="+dxo.hi.toFixed(0)+" o="+dxo.o.toFixed(0)+" m="+a+" i="+encodeURIComponent(dxo.i+"x")+" n="+encodeURIComponent(dxo.n+"x")+" p="+encodeURIComponent(dxo.p+"x")),setTimeout(function(){dx_close_edit_panel(e)},250)}}function dx_add_cb(e,t){var a=dxo.m;a|=dxo.y<<DX_TYPE_SFT,dxo.f-=cfg.freq_offset,dxo.f<0&&(dxo.f=0),wf_send("SET DX_UPD g=-1 f="+dxo.f+" lo="+dxo.lo.toFixed(0)+" hi="+dxo.hi.toFixed(0)+" o="+dxo.o.toFixed(0)+" m="+a+" i="+encodeURIComponent(dxo.i+"x")+" n="+encodeURIComponent(dxo.n+"x")+" p="+encodeURIComponent(dxo.p+"x")),setTimeout(function(){dx_close_edit_panel(e)},250),owrx.dx_click_gid_last=void 0}function dx_delete_cb(e,t){-1!=dxo.gid&&(wf_send("SET DX_UPD g="+dxo.gid+" f=-1"),setTimeout(function(){dx_close_edit_panel(e)},250),owrx.dx_click_gid_last=void 0)}function dx_click(e,t){if(e.shiftKey)dx_show_edit_panel(e,t);else{owrx.dx_click_gid_last=t;var a=dx_list[t].freq,_=kiwi.modes_l[dx_list[t].flags&DX_MODE],i=dx_list[t].lo,n=dx_list[t].hi,o=dx_list[t].params;if(console.log("### dx_click f="+dx_list[t].freq+" mode="+_+" cur_mode="+cur_mode+" lo="+i+" hi="+n+" params="+o),extint.extname=extint.param=null,isArg(o)){var s=""==o?[]:decodeURIComponent(o).split(",");"drm"==_?(extint.extname="drm",s.push("lo:"+i),s.push("hi:"+n),extint.param=s.join(",")):(extint.extname=s[0],extint.param=s.slice(1).join(","))}console.log("### dx_click extname="+extint.extname+" param=<"+extint.param+">"),freqmode_set_dsp_kHz(a,_,{open_ext:!0}),(i||n)&&ext_set_passband(i,n,!1,a),"drm"==_||any_alternate_click_event(e)||dx.ctrl_click||!dx_list[t].params||(console.log("### dx_click ext="+extint.extname+" <"+extint.param+">"),extint_open(extint.extname,250)),dx.ctrl_click=!1}return cancelEvent(e)}function dx_enter(e,t,a){dx_z_save=e.style.zIndex,e.style.zIndex=999,dx_bg_color_save=e.style.backgroundColor,e.style.backgroundColor=w3_contains(e,"id-has-ext")&&!any_alternate_click_event(a)?"magenta":"yellow";var _=w3_el(parseInt(e.id)+"-id-dx-line");_.zIndex=998,_.style.width="3px",t&&(dx_canvas.style.left=t-dx_car_w/2+"px",dx_canvas.style.zIndex=100)}function dx_leave(e,t){e.style.zIndex=dx_z_save,e.style.backgroundColor=dx_bg_color_save;var a=w3_el(parseInt(e.id)+"-id-dx-line");a.zIndex=110,a.style.width="1px",t&&(dx_canvas.style.zIndex=99)}var SMETER_RHS=38,SMETER_SCALE_HEIGHT=29,SMETER_BIAS=127,SMETER_INPUT_MAX=3.4,SMETER_INPUT_RANGE=SMETER_BIAS+SMETER_INPUT_MAX,SMETER_DISPLAY_MAX=-6,SMETER_DISPLAY_RANGE=SMETER_BIAS+SMETER_DISPLAY_MAX,sMeter_ctx,smeter_ovfl,bars={dBm:[-121,-109,-97,-85,-73,-63,-53,-33,-13],text:["S1","S3","S5","S7","S9","+10","+20","+40","+60"]};function smeter_dBm_biased_to_x(e){return e>SMETER_DISPLAY_RANGE&&(e=SMETER_DISPLAY_RANGE),Math.round(e/SMETER_DISPLAY_RANGE*smeter_width)}function smeter_init(){w3_innerHTML("id-control-smeter",'<canvas id="id-smeter-scale" class="class-smeter-scale" width="0" height="0"></canvas>',w3_div("id-smeter-ovfl w3-hide","OV"),w3_div("id-smeter-dbm-value"),w3_div("id-smeter-dbm-units","dBm"));var e=w3_el("id-smeter-scale");smeter_ovfl=w3_el("smeter-ovfl");var t=smeter_width=divControl.activeWidth-SMETER_RHS-html_LR_border_pad(e),a=SMETER_SCALE_HEIGHT,_=a-8,i=t+SMETER_RHS;(sMeter_ctx=e.getContext("2d")).canvas.width=i,sMeter_ctx.canvas.height=a,sMeter_ctx.fillStyle="gray",sMeter_ctx.globalAlpha=1,sMeter_ctx.fillRect(0,0,i,a),sMeter_ctx.font="11px Verdana",sMeter_ctx.textBaseline="middle",sMeter_ctx.textAlign="center",sMeter_ctx.fillStyle="white";for(var n=0;n<bars.text.length;n++){var o=smeter_dBm_biased_to_x(bars.dBm[n]+SMETER_BIAS);line_stroke(sMeter_ctx,1,3,"white",o,_-8,o,_+8),sMeter_ctx.fillText(bars.text[n],o,_-15)}line_stroke(sMeter_ctx,0,5,"black",0,_,t,_),setInterval(update_smeter,100)}var sm_px=0,sm_timeout=0,sm_interval=10,sm_ovfl_showing=!1,ident_tout;function update_smeter(){var e=smeter_dBm_biased_to_x(owrx.sMeter_dBm_biased),t=SMETER_SCALE_HEIGHT-8,a=smeter_width;if(sMeter_ctx.globalAlpha=1,line_stroke(sMeter_ctx,0,5,"lime",0,t,e,t),cfg.agc_thresh_smeter){var _=smeter_dBm_biased_to_x(-thresh);line_stroke(sMeter_ctx,0,2,"white",0,t-3,a-_,t-3),line_stroke(sMeter_ctx,0,2,"black",a-_,t-3,a,t-3)}0==sm_timeout--?(sm_timeout=sm_interval,e<sm_px&&line_stroke(sMeter_ctx,0,5,"black",e,t,sm_px,t),sm_px=e):e<sm_px?line_stroke(sMeter_ctx,0,5,"red",e,t,sm_px,t):(sm_px=e,sm_timeout=sm_interval),audio_ext_adc_ovfl&&!sm_ovfl_showing?(w3_hide("id-smeter-dbm-units"),w3_show("id-smeter-ovfl"),sm_ovfl_showing=!0):!audio_ext_adc_ovfl&&sm_ovfl_showing&&(w3_hide("id-smeter-ovfl"),w3_show("id-smeter-dbm-units"),sm_ovfl_showing=!1),w3_innerHTML("id-smeter-dbm-value",owrx.sMeter_dBm.toFixed(0))}var ident_user="",need_ident=!1;function ident_init(){user_url&&writeCookie("ident",kiwi_strip_tags(decodeURIComponent(user_url),""));var e=initCookie("ident","");e=kiwi_strip_tags(e,""),w3_el("id-ident-input").value=e,ident_user=e,need_ident=!0}function ident_complete(e){var t=w3_el("id-ident-input"),a=t.value;a=kiwi_strip_tags(a,""),t.value=a,kiwi_clearTimeout(ident_tout),w3_schedule_highlight(t),freqset_select(),writeCookie("ident",a),ident_user=a,need_ident=!0}function ident_keyup(e,t){if(kiwi_clearTimeout(ident_tout),null!=t&&null!=t.key){var a=t.key.length;if(any_alternate_click_event_except_shift(t)||1!=a&&"Backspace"!=t.key&&"Shift"!=t.key)return void("Enter"==t.key&&ident_complete("Enter"))}ident_tout=setTimeout(function(){ident_complete("t/o")},5e3)}var shortcut={nav_off:0,keys:"",SHIFT:1,CTL_OR_ALT:2,SHIFT_PLUS_CTL_OR_ALT:3};function keyboard_shortcut_init(){kiwi_isMobile()||kiwi_isFirefox()<47||kiwi_isChrome()<=49||kiwi_isOpera()<=36||(shortcut.help=w3_div("",w3_inline_percent("w3-padding-tiny w3-bold w3-text-aqua","Keys",25,"Function"),w3_inline_percent("w3-padding-tiny","g =",25,"select frequency entry field"),w3_inline_percent("w3-padding-tiny","j i LR-arrow-keys",25,"frequency step down/up, add shift or alt/ctrl for faster<br>shift plus alt/ctrl to step to next/prev DX label"),w3_inline_percent("w3-padding-tiny","t T UD-arrow-keys",25,"scroll frequency memory list"),w3_inline_percent("w3-padding-tiny","b B",25,"scroll band menu"),w3_inline_percent("w3-padding-tiny","e E",25,"scroll extension menu"),w3_inline_percent("w3-padding-tiny","a A d l u c f q",25,"toggle modes: AM SAM DRM LSB USB CW NBFM IQ<br>add alt/ctrl to toggle backwards (e.g. SAM modes)"),w3_inline_percent("w3-padding-tiny","p P",25,"passband narrow/widen"),w3_inline_percent("w3-padding-tiny","r",25,"toggle audio recording"),w3_inline_percent("w3-padding-tiny","z Z",25,"zoom in/out, add alt/ctrl for max in/out"),w3_inline_percent("w3-padding-tiny","< >",25,"waterfall page down/up"),w3_inline_percent("w3-padding-tiny","w W",25,"waterfall min dB slider -/+ 1 dB, add alt/ctrl for -/+ 10 dB"),w3_inline_percent("w3-padding-tiny","S",25,"waterfall auto-scale"),w3_inline_percent("w3-padding-tiny","s D",25,"spectrum on/off toggle, slow device mode"),w3_inline_percent("w3-padding-tiny","v V m space",25,"volume less/more, mute"),w3_inline_percent("w3-padding-tiny","o",25,'toggle between option bar "off" and "stats" mode,<br>others selected by related shortcut key'),w3_inline_percent("w3-padding-tiny","!",25,"toggle aperture manual/auto menu"),w3_inline_percent("w3-padding-tiny","@",25,"DX label filter"),w3_inline_percent("w3-padding-tiny","x y",25,"toggle visibility of control panels, top bar"),w3_inline_percent("w3-padding-tiny","esc",25,"close/cancel action"),w3_inline_percent("w3-padding-tiny","? h",25,"toggle this help list"),w3_inline_percent("w3-padding-tiny w3-bold w3-text-aqua","",25,"Windows, Linux: use alt, not ctrl"),w3_inline_percent("w3-padding-tiny w3-bold w3-text-aqua","",25,"Mac: use ctrl or alt")),w3_el("id-kiwi-body").addEventListener("keydown",keyboard_shortcut_event,!0))}function keyboard_shortcut_help(){confirmation_show_content(shortcut.help,550,545)}function keyboard_shortcut_nav(e){w3_el("id-nav-optbar-"+e).click(),shortcut.nav_click=!0}function keyboard_shortcut_key_proc(){shortcut.key_i>=shortcut.keys.length||(keyboard_shortcut(shortcut.keys[shortcut.key_i],0,0),shortcut.key_i++,setTimeout(keyboard_shortcut_key_proc,100))}function keyboard_shortcut_url_keys(){shortcut.keys=shortcut.keys.split(""),shortcut.key_i=0,keyboard_shortcut_key_proc()}function keyboard_shortcut(e,t,a){var _=a?-1:1;switch(shortcut.nav_click=!1,e){case"a":mode_button(null,w3_el("id-button-am"),_);break;case"A":mode_button(null,w3_el("id-button-sam"),_);break;case"d":ext_set_mode("drm",null,{open_ext:!0});break;case"l":mode_button(null,w3_el("id-button-lsb"),_);break;case"u":mode_button(null,w3_el("id-button-usb"),_);break;case"c":mode_button(null,w3_el("id-button-cw"),_);break;case"f":ext_set_mode("nbfm");break;case"q":ext_set_mode("iq");break;case"j":case"J":case"ArrowLeft":t!=shortcut.SHIFT_PLUS_CTL_OR_ALT?freqstep(2-t):dx_label_step(-1);break;case"i":case"I":case"ArrowRight":t!=shortcut.SHIFT_PLUS_CTL_OR_ALT?freqstep(3+t):dx_label_step(1);break;case"p":passband_increment(!1);break;case"P":passband_increment(!0);break;case"v":setvolume(1,kiwi.volume-10),toggle_or_set_mute(0),keyboard_shortcut_nav("audio");break;case"V":setvolume(1,kiwi.volume+10),toggle_or_set_mute(0),keyboard_shortcut_nav("audio");break;case"m":case" ":toggle_or_set_mute(),shortcut.nav_click=!0;break;case"g":case"=":freqset_select();break;case"t":freq_up_down_cb(null,1);break;case"T":freq_up_down_cb(null,0);break;case"b":band_scroll(1);break;case"B":band_scroll(-1);break;case"<":page_scroll(-page_scroll_amount);break;case">":page_scroll(+page_scroll_amount);break;case"z":zoom_step(a?ext_zoom.NOM_IN:ext_zoom.IN);break;case"Z":zoom_step(a?ext_zoom.MAX_OUT:ext_zoom.OUT);break;case"w":incr_mindb(1,a?-10:-1),keyboard_shortcut_nav("wf");break;case"W":incr_mindb(1,a?10:1),keyboard_shortcut_nav("wf");break;case"s":toggle_or_set_spec(),keyboard_shortcut_nav("wf");break;case"S":wf_autoscale_cb(),keyboard_shortcut_nav("wf");break;case"D":toggle_or_set_slow_dev(),keyboard_shortcut_nav("wf");break;case"!":keyboard_shortcut_nav("wf"),wf_aper_cb("wf.aper",1^wf.aper,!1);break;case"o":keyboard_shortcut_nav(shortcut.nav_off?"status":"off"),shortcut.nav_off^=1;break;case"r":toggle_or_set_rec();break;case"x":toggle_or_set_hide_panels();break;case"y":toggle_or_set_hide_topbar();break;case"@":dx_filter(),shortcut.nav_click=!0;break;case"e":extension_scroll(1);break;case"E":extension_scroll(-1);break;case"?":case"h":keyboard_shortcut_help();break;default:1==e.length&&console.log("no shortcut key <"+e+">"),!1}ignore_next_keyup_event=!0}function keyboard_shortcut_event(e){if(e.target){var t=e.key;if("Escape"==t||t.match(/F[1-9][12]?/))return;var a=e.target.id;""==a&&w3_iterate_classList(e.target,function(e,t){e.startsWith("id-")&&(a=e," (class)")});var _=e.shiftKey,i=e.ctrlKey,n=e.altKey,o=e.metaKey,s=i||n,r=_&&!s?shortcut.SHIFT:!_&s?shortcut.CTL_OR_ALT:_&&s?shortcut.SHIFT_PLUS_CTL_OR_ALT:0,l=t>="0"&&t<="9"&&!i||"."==t||","==t||"/"==t||":"==t||"-"==t||"k"==t||"M"==t||"Enter"==t||"ArrowUp"==t||"ArrowDown"==t||"Backspace"==t||"Delete"==t;if("INPUT"!=e.target.nodeName||"id-freq-input"==a&&!l){if(kiwi_isOSX()){if(o)return}else if(i)return;return n&&!t.startsWith("Arrow")&&(t=String.fromCharCode(e.keyCode).toLowerCase(),_&&(t=t.toUpperCase())),keyboard_shortcut(t,r,s),void cancelEvent(e)}}}function extension_scroll(e){console.log("extension_scroll dir="+e),console.log(extint_names);var t=w3_el("id-select-ext");console.log(t);var a,_=t.childNodes;console.log(_);var i=+t.value+1;console.log("extension_scroll initial i="+i);do{(i+=e)<1&&(i=_.length-1),i>=_.length&&(i=1),a=_[i]}while(a.disabled);var n=+a.value,o=+a.getAttribute("kiwi_idx");console.log("extension_scroll i="+i+" val="+n+" idx="+o+" "+a.innerHTML),w3_select_value("id-select-ext",n),owrx.sel_ext_to&&kiwi_clearTimeout(owrx.sel_ext_to),owrx.sel_ext_to=setTimeout(function(){extint_select(n)},2e3)}var panel_margin=10,ac_play_button;function check_suspended_audio_state(){try{if(window.AudioContext=window.AudioContext||window.webkitAudioContext,ac_play_button=new AudioContext,kiwi_isSafari()){var e=ac_play_button.createBufferSource();e.connect(ac_play_button.destination);try{e.start(0)}catch(t){e.noteOn(0)}}setTimeout(test_audio_suspended,500)}catch(e){console.log("#### no AudioContext?")}}function test_audio_suspended(){if("running"!=ac_play_button.state){var e=w3_div('id-play-button-container class-overlay-container||onclick="play_button()"',w3_div("id-play-button",'<img src="gfx/openwebrx-play-button.png" width="150" height="150" /><br><br>'+(kiwi_isMobile()?"Tap to":"Click to")+" start OpenWebRX"));w3_appendElement("id-kiwi-body","div",e),el=w3_el("id-play-button"),el.style.marginTop=px(w3_center_in_window(el))}}function play_button(){try{if(kiwi_is_iOS()){var e=audio_context,t=e.createBufferSource();t.connect(e.destination);try{t.start(0)}catch(e){t.noteOn(0)}}else try{audio_context&&audio_context.resume()}catch(e){console.log("#### audio_context.resume() FAILED")}}catch(e){add_problem("audio start")}w3_el("id-play-button-container").style.opacity=0,setTimeout(function(){w3_hide("id-play-button-container")},1100),audio_reset(),freqset_select()}function panels_setup(){var e;if(w3_el("id-ident").innerHTML=w3_input('w3-label-not-bold/w3-custom-events|padding:1px|size=20 onkeyup="ident_keyup(this, event)"',"Your name or callsign:","ident-input"),w3_el("id-control-freq1").innerHTML=w3_inline("",w3_div("id-freq-cell",'<form id="id-freq-form" name="form_freq" action="#" onsubmit="freqset_complete(0); return false;">'+w3_input('w3-custom-events|padding:0 4px;max-width:74px|size=8 onkeydown="freqset_keydown(event)" onkeyup="freqset_keyup(this, event)"',"","freq-input")+"</form>"),w3_div("|padding:0 0 0 3px",w3_icon('w3-show-block w3-text-orange||title="prev"',"fa-arrow-circle-up",15,"","freq_up_down_cb",1)+w3_icon('w3-show-block w3-text-aqua||title="next"',"fa-arrow-circle-down",15,"","freq_up_down_cb",0)),w3_div("id-select-band-cell|padding:0 4px",'<select id="id-select-band" class="w3-pointer" onchange="select_band(this.value)"><option value="0" selected disabled>select band</option>'+setup_band_menu()+"</select>"),w3_div("id-select-ext-cell|padding:0",'<select id="id-select-ext" class="w3-pointer" onchange="freqset_select(); extint_select(this.value)"><option value="-1" selected disabled>extension</option>'+extint_select_build_menu()+"</select>")),check_suspended_audio_state(),w3_el("id-control-freq2").innerHTML=w3_inline("w3-halign-space-between w3-margin-T-4/",w3_div("id-mouse-freq",w3_div("id-mouse-unit","-----.--")),w3_div("id-link-cell",w3_div("id-freq-link|padding-left:0px")),w3_div("id-9-10-cell",w3_div('id-button-9-10 class-button-small||title="LW/MW 9/10 kHz tuning step" onclick="button_9_10()"',"10")),w3_div("id-step-freq",'<img id="id-step-0" src="icons/stepdn.20.png" onclick="freqstep(0)" />','<img id="id-step-1" src="icons/stepdn.18.png" onclick="freqstep(1)" style="padding-bottom:1px" />','<img id="id-step-2" src="icons/stepdn.16.png" onclick="freqstep(2)" style="padding-bottom:2px" />','<img id="id-step-3" src="icons/stepup.16.png" onclick="freqstep(3)" style="padding-bottom:2px" />','<img id="id-step-4" src="icons/stepup.18.png" onclick="freqstep(4)" style="padding-bottom:1px" />','<img id="id-step-5" src="icons/stepup.20.png" onclick="freqstep(5)" />'),w3_div("",w3_button('id-button-spectrum class-button||title="toggle spectrum display"',"Spec","toggle_or_set_spec")),w3_div("",w3_div('fa-stack||title="record"',w3_icon("id-rec1","fa-repeat fa-stack-1x w3-text-pink",22,"","toggle_or_set_rec"))),w3_div('|width:8%|title="mute"',w3_div("id-mute-no fa-stack|width:100%; color:lime",w3_icon("","fa-volume-up fa-stack-2x",24,"inherit","toggle_or_set_mute")),w3_div("id-mute-yes fa-stack w3-hide|width:100%;color:magenta;",w3_icon("","fa-volume-off fa-stack-2x fa-nudge-left",24,"","toggle_or_set_mute"),w3_icon("","fa-times fa-right",12,"","toggle_or_set_mute")),w3_div("id-mute-exclaim fa-stack w3-hide|width:100%; color:yellow",w3_icon("","fa-exclamation-triangle fa-stack-1x",20,"inherit")))),isNaN(override_9_10)){var t=ext_get_cfg_param("init.AM_BCB_chan");step_9_10=null==t||null==t?0:t?0:1}else step_9_10=override_9_10;button_9_10(step_9_10),e="",mode_buttons.forEach(function(t,a){var _=t.s[0],i=_.toLowerCase(),n=t.dis||"drm"==i&&!kiwi.DRM_enable,o=n?"":' onclick="mode_button(event, this)"';o+=' onmouseover="mode_over(event, this)"',e+=w3_div("id-button-"+i+" id-mode-"+i.substr(0,2)+" class-button"+(n?" class-button-disbled":"")+' ||id="'+a+'-id-mode-col"'+o+' onmousedown="cancelEvent(event)"',_)}),w3_el("id-control-mode").innerHTML=w3_inline("w3-halign-space-between/",e);var a=wf.audioFFT_active?" w3-disabled":"",_=wf.audioFFT_active?' w3-disabled||onclick="audioFFT_update()"':"";w3_el("id-control-zoom").innerHTML=w3_inline("w3-halign-space-between/",w3_div("id-zoom-in class-icon"+a+'||onclick="zoom_click(event,1)" onmouseover="zoom_over(event)" title="zoom in"','<img src="icons/zoomin.png" width="32" height="32" />'),w3_div("id-zoom-out class-icon"+a+'||onclick="zoom_click(event,-1)" onmouseover="zoom_over(event)" title="zoom out"','<img src="icons/zoomout.png" width="32" height="32" />'),w3_div("id-maxin"+_,w3_div('class-icon||onclick="zoom_click(event,8)" title="max in"','<img src="icons/maxin.png" width="32" height="32" />')),w3_div("id-maxin-nom w3-hide"+_,w3_div('class-icon||onclick="zoom_click(event,8)" title="max in"','<img src="icons/maxin.nom.png" width="32" height="32" />')),w3_div("id-maxin-max w3-hide"+_,w3_div('class-icon||onclick="zoom_click(event,8)" title="max in"','<img src="icons/maxin.max.png" width="32" height="32" />')),w3_div("id-maxout"+_,w3_div('class-icon||onclick="zoom_click(event,-9)" title="max out"','<img src="icons/maxout.png" width="32" height="32" />')),w3_div("id-maxout-max w3-hide"+_,w3_div('class-icon||onclick="zoom_click(event,-9)" title="max out"','<img src="icons/maxout.max.png" width="32" height="32" />')),w3_div("class-icon"+a+'||onclick="zoom_click(event,0)" title="zoom to band"','<img src="icons/zoomband.png" width="32" height="16" style="padding-top:13px; padding-bottom:13px;"/>'),w3_div("class-icon"+a+'||onclick="page_scroll_icon_click(event,'+-page_scroll_amount+')" title="page down\nalt: label step"','<img src="icons/pageleft.png" width="32" height="32" />'),w3_div("class-icon"+a+'||onclick="page_scroll_icon_click(event,'+page_scroll_amount+')" title="page up\nalt: label step"','<img src="icons/pageright.png" width="32" height="32" />'));var i=["w3-pink","w3-blue","w3-purple","w3-aqua","w3-yellow","w3-black","w3-red","w3-khaki","w3-green","w3-orange","w3-lime","w3-indigo","w3-brown","w3-teal"],n=0,o=" w3-center|width:15.2%",s=o+";margin-right:6px";if(w3_el("id-optbar").innerHTML=w3_navbar("cl-optbar",w3_navdef(i[n++]+s,"WF","optbar-wf","optbar"),w3_nav(i[n++]+s,"Audio","optbar-audio","optbar"),w3_nav(i[n++]+s,"AGC","optbar-agc","optbar"),w3_nav(i[n++]+s,"Users","optbar-users","optbar"),w3_nav(i[n++]+s,"Stats","optbar-status","optbar"),w3_nav(i[n++]+o,"Off","optbar-off","optbar")),wf_filter=readCookie("last_wf_filter",wf_sp_menu_e.OFF),spec_filter=readCookie("last_spec_filter",wf_sp_menu_e.IIR),isString(spectrum_show)){var r=spectrum_show.toLowerCase();wf_sp_menu_s.forEach(function(e,t){r==e.toLowerCase()&&(spec_filter=t)})}wf.max_min_sliders=w3_col_percent("w3-valign/class-slider",w3_text(optbar_prefix_color,"WF max"),19,'<input id="id-input-maxdb" type="range" min="-100" max="20" value="'+maxdb+'" step="1" onchange="setmaxdb(1,this.value)" oninput="setmaxdb(0,this.value)">',60,w3_div("id-field-maxdb class-slider"),19)+w3_col_percent("w3-valign/class-slider",w3_text(optbar_prefix_color,"WF min"),19,'<input id="id-input-mindb" type="range" min="-190" max="-30" value="'+mindb+'" step="1" onchange="setmindb(1,this.value)" oninput="setmindb(0,this.value)">',60,w3_div("id-field-mindb class-slider"),19),wf.floor_ceil_sliders=w3_col_percent("w3-valign/class-slider",w3_text(optbar_prefix_color,"WF ceil"),19,'<input id="id-input-ceildb" type="range" min="-30" max="30" value="'+wf.auto_ceil.val+'" step="5" onchange="setceildb(1,this.value)" oninput="setceildb(0,this.value)">',60,w3_div("id-field-ceildb class-slider"),19)+w3_col_percent("w3-valign/class-slider",w3_text(optbar_prefix_color,"WF floor"),19,'<input id="id-input-floordb" type="range" min="-30" max="30" value="'+wf.auto_floor.val+'" step="5" onchange="setfloordb(1,this.value)" oninput="setfloordb(0,this.value)">',60,w3_div("id-field-floordb class-slider"),19),w3_el("id-optbar-wf").innerHTML=w3_div("id-aper-data w3-hide w3-margin-B-5|left:0px; width:256px; height:16px; background-color:#575757; overflow:hidden; position:relative;",'<canvas id="id-aper-canvas" width="256" height="16" style="position:absolute"></canvas>')+w3_col_percent("",w3_div("",w3_div("id-wf-sliders",wf.max_min_sliders),w3_col_percent("w3-valign/class-slider",w3_text(optbar_prefix_color,"WF rate"),19,'<input id="slider-rate" class="'+a+'" type="range" min="0" max="4" value="'+wf_speed+'" step="1" onchange="setwfspeed(1,this.value)" oninput="setwfspeed(0,this.value)">',60,w3_div("slider-rate-field class-slider"),19),w3_col_percent("w3-valign/class-slider",w3_button("id-wf-sp-button class-button w3-font-12px","Spec &Delta;","toggle_or_set_wf_sp_button"),19,w3_slider("id-wf-sp-slider","","wf_sp_param",wf_sp_param,0,10,1,"wf_sp_slider_cb"),60,w3_div("id-wf-sp-slider-field class-slider"),19)),85,w3_divs("/w3-tspace-4 w3-hcenter w3-font-11_25px",w3_button('id-button-wf-autoscale class-button||title="waterfall auto scale"',"Auto<br>Scale","wf_autoscale_cb"),w3_button('id-button-slow-dev class-button||title="slow device mode"',"Slow<br>Dev","toggle_or_set_slow_dev"),w3_inline("",w3_button('id-button-spec-peak class-button||title="toggle peak hold"',"Pk","toggle_or_set_spec_peak"),w3_icon("id-wf-gnd w3-margin-L-4 w3-momentary","fa-caret-down",22,"white","wf_gnd_cb",1))),15)+w3_inline("w3-halign-space-between w3-margin-T-2/",w3_select('|color:red|title="colormap selection"',"","colormap","wf.cmap",wf.cmap,kiwi.cmap_s,"wf_cmap_cb"),w3_select('|color:red|title="aperture selection"',"","aperture","wf.aper",wf.aper,kiwi.aper_s,"wf_aper_cb"),w3_select('|color:red|title="waterfall filter selection"',"","wf","wf_filter",wf_filter,wf_sp_menu_s,"wf_sp_menu_cb",1),w3_select('|color:red|title="spectrum filter selection"',"","spec","spec_filter",spec_filter,wf_sp_menu_s,"wf_sp_menu_cb",0)),setwfspeed(1,wf_speed),toggle_or_set_slow_dev(toggle_e.FROM_COOKIE|toggle_e.SET,0),toggle_or_set_spec_peak(toggle_e.FROM_COOKIE|toggle_e.SET_URL,peak_initially),toggle_or_set_wf_sp_button(toggle_e.FROM_COOKIE|toggle_e.SET,0);de_emphasis=readCookie("last_de_emphasis",0),de_emphasis=w3_clamp(de_emphasis,0,1),pan=readCookie("last_pan",0),w3_el("id-optbar-audio").innerHTML=w3_col_percent("w3-valign/",w3_div("w3-show-inline-block",w3_text(optbar_prefix_color+" cl-closer-spaced-label-text","Noise")),17,w3_select_conditional('|color:red|title="noise blanker selection"',"","blanker","nb_algo",0,[["off",1],["std",1],["Wild",1]],"nb_algo_cb"),24,w3_div("w3-hcenter",w3_div('class-button||onclick="extint_open(\'noise_blank\'); freqset_select();" title="noise blanker parameters"',"More")),21,w3_select_conditional('|color:red|title="noise filter selection"',"","filter","nr_algo",0,[["off",1],["wdsp",1],["LMS",1],["spec",1]],"nr_algo_cb"),23,w3_div("w3-hcenter",w3_div('class-button||onclick="extint_open(\'noise_filter\'); freqset_select();" title="noise filter parameters"',"More")),15)+w3_col_percent("id-vol w3-valign w3-margin-T-4 w3-hide/class-slider",w3_text(optbar_prefix_color,"Volume"),17,'<input id="id-input-volume" type="range" min="0" max="200" value="'+kiwi.volume+'" step="1" onchange="setvolume(1, this.value)" oninput="setvolume(0, this.value)">',50,"&nbsp;",8,w3_select('|color:red|title="de-emphasis selection"',"","de-emp","de_emphasis",de_emphasis,de_emphasis_s,"de_emp_cb"))+w3_col_percent("id-vol-comp w3-valign w3-margin-T-4/class-slider",w3_text(optbar_prefix_color,"Volume"),17,'<input id="id-input-volume" type="range" min="0" max="200" value="'+kiwi.volume+'" step="1" onchange="setvolume(1, this.value)" oninput="setvolume(0, this.value)">',40,w3_select("|color:red","","de-emp","de_emphasis",de_emphasis,de_emphasis_s,"de_emp_cb"),28,w3_button('id-button-compression class-button w3-hcenter||title="compression"',"Comp","toggle_or_set_compression"))+w3_col_percent("id-pan w3-valign w3-hide/class-slider",w3_text(optbar_prefix_color,"Pan"),17,'<input id="id-pan-value" type="range" min="-1" max="1" value="'+pan+'" step="0.01" onchange="setpan(1,this.value)" oninput="setpan(0,this.value)">',50,"&nbsp;",3,w3_div("id-pan-field"),8,"&nbsp;",7,w3_button('id-button-compression class-button w3-hcenter||title="compression"',"Comp","toggle_or_set_compression"))+w3_col_percent("id-squelch w3-valign/class-slider",w3_text("id-squelch-label","Squelch"),17,w3_slider("","","squelch-value",squelch,0,99,1,"set_squelch_cb"),50,"&nbsp;",3,w3_div("id-squelch-field class-slider"),14,w3_select('w3-hide|color:red|title="squelch tail length"',"","tail","squelch_tail",squelch_tail,squelch_tail_s,"squelch_tail_cb"))+w3_col_percent("id-sam-carrier-container w3-valign w3-hide/class-slider",w3_text(optbar_prefix_color,"SAM"),17,w3_text("id-sam-carrier"),42,"&nbsp;",8,w3_select("id-chan-null w3-hide|color:red","","channel null","owrx.chan_null",owrx.chan_null,owrx.chan_null_s,"chan_null_cb")),kiwi_load_js_dir("extensions/",["noise_blank/noise_blank.js","noise_filter/noise_filter.js"],function(){noise_blank_init(),noise_filter_init()}),toggle_or_set_compression(toggle_e.FROM_COOKIE|toggle_e.SET,1),squelch_setup(toggle_e.FROM_COOKIE),audio_panner_ui_init(),w3_el("id-optbar-agc").innerHTML=w3_col_percent("w3-valign w3-margin-B-4/class-slider",'<div id="id-button-agc" class="class-button" onclick="toggle_agc(event)" onmousedown="cancelEvent(event)" onmouseover="agc_over(event)">AGC</div>',13,'<div id="id-button-hang" class="class-button" onclick="toggle_or_set_hang();">Hang</div>',17,w3_divs("w3-show-inline-block/id-label-man-gain cl-closer-spaced-label-text","Manual<br>gain"),15,'<input id="input-man-gain" type="range" min="0" max="120" value="'+manGain+'" step="1" onchange="setManGain(1,this.value)" oninput="setManGain(0,this.value)">',40,w3_div("field-man-gain w3-show-inline-block",manGain.toString())+" dB",15)+w3_div("",w3_col_percent("w3-valign/class-slider",w3_div("label-threshold w3-show-inline-block","Threshold"),20,'<input id="input-threshold" type="range" min="-130" max="0" value="'+thresh+'" step="1" onchange="setThresh(1,this.value)" oninput="setThresh(0,this.value)">',52,w3_div("field-threshold w3-show-inline-block",thresh.toString())+" dBm"),w3_col_percent("w3-valign/class-slider",w3_div("label-threshCW w3-show-inline-block","Thresh CW"),20,'<input id="input-threshCW" type="range" min="-130" max="0" value="'+threshCW+'" step="1" onchange="setThreshCW(1,this.value)" oninput="setThreshCW(0,this.value)">',52,w3_div("field-threshCW w3-show-inline-block",threshCW.toString())+" dBm"),w3_col_percent("w3-valign/class-slider",w3_div("label-slope w3-show-inline-block","Slope"),20,'<input id="input-slope" type="range" min="0" max="10" value="'+slope+'" step="1" onchange="setSlope(1,this.value)" oninput="setSlope(0,this.value)">',52,w3_div("field-slope w3-show-inline-block",slope.toString())+" dB"),w3_col_percent("w3-valign/class-slider",w3_div("label-decay w3-show-inline-block","Decay"),20,'<input id="input-decay" type="range" min="20" max="5000" value="'+decay+'" step="1" onchange="setDecay(1,this.value)" oninput="setDecay(0,this.value)">',52,w3_div("field-decay w3-show-inline-block",decay.toString())+" msec")),setup_agc(toggle_e.FROM_COOKIE|toggle_e.SET),w3_click_nav(kiwi_toggle(toggle_e.FROM_COOKIE|toggle_e.SET,"optbar-wf","optbar-wf","last_optbar"),"optbar","init"),w3_el("id-news").style.backgroundColor=news_color,w3_el("id-news-inner").innerHTML='<span style="font-size: 14pt; font-weight: bold;">KiwiSDR now available on <a href="https://www.kickstarter.com/projects/1575992013/kiwisdr-beaglebone-software-defined-radio-sdr-with" target="_blank"><img class="class-KS" src="icons/kickstarter-logo-light.150x18.png" /></a></span>',w3_el("id-readme").style.backgroundColor=readme_color,w3_el("id-readme-inner").innerHTML='<span style="font-size: 15pt; font-weight: bold;">Welcome!</span>&nbsp;&nbsp;&nbsp;Project website: <a href="http://kiwisdr.com" target="_blank">kiwisdr.com</a>&nbsp;&nbsp;&nbsp;&nbsp;Here are some tips:<ul style="padding-left: 12px;"><li> Windows: Firefox, Chrome & Edge work; IE does not work. </li><li> Mac & Linux: Safari, Firefox, Chrome & Opera should work fine. </li><li> Open and close the panels by using the circled arrows at the top right corner. </li><li> You can click and/or drag almost anywhere on the page to change settings. </li><li> Enter a numeric frequency in the box marked "kHz" at right. </li><li> Or use the "select band" menu to jump to a pre-defined band. </li><li> Use the zoom icons to control the waterfall span. </li><li> Tune by clicking on the waterfall, spectrum or the cyan/red-colored station labels. </li><li> Ctrl-shift or alt-shift click in the waterfall to lookup frequency in online databases. </li><li> Control or option/alt click to page spectrum down and up in frequency. </li><li> Adjust the "WF min" slider for best waterfall colors or use the "Auto Scale" button. </li><li> Type \'h\' or \'?\' to see the list of keyboard shortcuts. </li><li> See the <a href="http://www.kiwisdr.com/quickstart/" target="_blank">Operating information</a> pageand <a href="https://www.dropbox.com/s/i1bjyp1acghnc16/KiwiSDR.design.review.pdf?dl=1" target="_blank">Design review document</a>. </li></ul>';var l=ext_get_cfg_param("contact_admin");isUndefined(l)&&(l=!0);var d=ext_get_cfg_param("admin_email");null!=(d="undefined"!=l&&null!=l&&1==l&&"undefined"!=d&&null!=d?d:null)&&(d=encodeURIComponent(encodeURIComponent(enc(d)))),w3_el("id-optbar-status").innerHTML=w3_div("id-status-msg")+w3_div("",w3_text(optbar_prefix_color,"Links"),w3_text("",(d?"<a href=\"javascript:sendmail('"+d+"');\">Owner/Admin</a> | ":"")+'<a href="http://kiwisdr.com" target="_blank">KiwiSDR</a> | <a href="http://forum.kiwisdr.com/discussions" target="_blank">Forum</a> | <a href="https://kiwiirc.com/client/chat.freenode.net/#kiwisdr" target="_blank">Chat</a> '))+w3_div("id-status-adc")+w3_div("id-status-config")+w3_div("id-status-gps")+w3_inline("w3-valign",w3_div("id-status-audio")," ",w3_div("id-status-problems"))+w3_div("id-status-stats-cpu")+w3_div("id-status-stats-xfer"),setTimeout(function(){setInterval(status_periodic,5e3)},1e3)}var prev_optbar=null;function optbar_focus(e,t){writeCookie("last_optbar",e),"optbar-off"==e?("init"!=t&&"optbar-off"==prev_optbar&&toggle_or_set_hide_topbar(),w3_hide("id-optbar-content"),w3_el("id-control-top").style.paddingBottom="8px"):(w3_show_block("id-optbar-content"),w3_el("id-control-top").style.paddingBottom=""),w3_el("id-control").style.height="",prev_optbar=e,freqset_select()}function optbar_blur(e){}function zoomCorrection(){return 3*zoom_level}var WF_SPEED_OFF=0,WF_SPEED_1HZ=1,WF_SPEED_SLOW=2,WF_SPEED_MED=3,WF_SPEED_FAST=4,wf_speed=WF_SPEED_FAST,wf_speeds=["off","1 Hz","slow","med","fast"],wf={no_wf:!1,cmap:0,cmap_override:-1,custom_colormaps:[new Uint8Array(768),new Uint8Array(768),new Uint8Array(768),new Uint8Array(768)],aper:0,aper_algo:3,aper_param:0,sqrt:0,contr:0,last_zoom:-1,need_autoscale:0,auto_ceil:{min:0,val:5,max:30,def:5},auto_floor:{min:-30,val:-10,max:0,def:-10},auto_maxdb:0,auto_mindb:0,audioFFT_active:!1,audioFFT_prev_mode:"",audioFFT_clear_wf:!1},wf_contr_s={0:"normal",1:"scheme 1",2:"scheme 2",3:"scheme 3",4:"scheme 4"};function wf_contr_cb(e,t,a){}var wf_gnd=0,wf_gnd_value_base=150,wf_gnd_value=wf_gnd_value_base;function wf_gnd_cb(e,t,a){t=+t,w3_color(e,t?"white":"lime"),wf_gnd=!t,0==t&&freqset_select()}var wf_sp_param=0,wf_param=0,sp_param=0,wf_sp_which=0,wf_filter=0,spec_filter=0,wf_sp_menu_s=["IIR","MMA","EMA","off"],wf_sp_menu_e={IIR:0,MMA:1,EMA:2,OFF:3},wf_sp_slider_s=["gain","avgs","avgs",""],wf_sp_filter_p=[{IIR_min:0,IIR_max:1,IIR_step:.1,IIR_def:.2,IIR_val:void 0,MMA_min:1,MMA_max:32,MMA_step:1,MMA_def:8,MMA_val:void 0,EMA_min:1,EMA_max:32,EMA_step:1,EMA_def:8,EMA_val:void 0,off_min:0,off_max:0,off_step:0,off_def:0,off_val:void 0},{IIR_min:0,IIR_max:2,IIR_step:.1,IIR_def:.8,IIR_val:void 0,MMA_min:1,MMA_max:16,MMA_step:1,MMA_def:2,MMA_val:void 0,EMA_min:1,EMA_max:16,EMA_step:1,EMA_def:2,EMA_val:void 0,off_min:0,off_max:0,off_step:0,off_def:0,off_val:void 0}];function spec_show(){toggle_or_set_spec(toggle_e.SET,1);var e=-1;spectrum_param=parseFloat(spectrum_param),isNaN(spectrum_param)||-1==spectrum_param||(e=spectrum_param),wf_sp_which=0;var t=wf_sp_menu_s[spec_filter],a=wf_sp_filter_p[0];e>=a[t+"_min"]&&e<=a[t+"_max"]&&(wf_sp_slider_cb("id-wf-sp-slider",e,!0,!1),toggle_or_set_wf_sp_button(toggle_e.SET,0))}function wf_sp_menu_cb(e,t,a,_){t=+t,(wf_sp_which=+_)?wf_filter=t:spec_filter=t;var i=wf_sp_which?wf_filter:spec_filter,n=wf_sp_menu_s[i];wf_sp_slider_cb("id-wf-sp-slider",wf_sp_filter_p[wf_sp_which][n+"_val"],!0,!1),toggle_or_set_wf_sp_button(toggle_e.SET,wf_sp_which),writeCookie(wf_sp_which?"last_wf_filter":"last_spec_filter",i.toString()),wf_sp_which?need_clear_wfavg=!0:spec.need_clear_avg=!0,freqset_select()}function spectrum_filter(e){wf_sp_menu_cb("",e,!1,0)}function toggle_or_set_wf_sp_button(e,t){isNumber(e)?wf_sp_which=+kiwi_toggle(e,+t,+t,"last_wf_sp_filter"):wf_sp_which^=1,w3_innerHTML("id-wf-sp-button",wf_sp_which?"WF &Delta;":"Spec &Delta;");var a=wf_sp_menu_s[wf_sp_which?wf_filter:spec_filter];wf_sp_slider_cb("id-wf-sp-slider",wf_sp_filter_p[wf_sp_which][a+"_val"],!0,!1),freqset_select()}function wf_sp_slider_cb(e,t,a,_){if(!_){t=+t;var i=wf_sp_which?wf_filter:spec_filter,n=wf_sp_menu_s[i],o=wf_sp_filter_p[wf_sp_which];if(null==t||isNaN(t)){t=o[n+"_def"];var s=parseFloat(readCookie(wf_sp_which?"last_wf_filter":"last_spec_filter")),r=parseFloat(readCookie(wf_sp_which?"last_wf_filter_param":"last_spec_filter_param"));s!=i||isNaN(r)||(t=r)}wf_sp_which?wf_param=t:sp_param=t,o[n+"_val"]=t,w3_slider_setup("id-wf-sp-slider",o[n+"_min"],o[n+"_max"],o[n+"_step"],t),w3_el("id-wf-sp-slider-field").innerHTML=i==wf_sp_menu_e.OFF?"":t+" "+wf_sp_slider_s[i],a&&(writeCookie(wf_sp_which?"last_wf_filter_param":"last_spec_filter_param",t.toFixed(2)),freqset_select())}}function wf_cmap_cb(e,t,a){a||(t=+t,wf.cmap=w3_clamp(t,0,kiwi.cmap_s.length-1,0),w3_select_value(e,t,{all:1}),writeCookie("last_cmap",t),mkcolormap(),spectrum_dB_bands(),update_maxmindb_sliders(),wf_send("SET cmap="+wf.cmap),w3_call("colormap_select"),freqset_select())}function wf_aper_cb(e,t,a){if(!a){t=+t,wf.aper=w3_clamp(t,0,kiwi.aper_s.length-1,0),w3_select_value(e,t),writeCookie("last_aper",t);var _=wf.aper==kiwi.aper_e.auto;w3_set_innerHTML("id-wf-sliders",_?wf.floor_ceil_sliders:wf.max_min_sliders),w3_color("id-button-wf-autoscale",null,_?w3_selection_green:""),_?(wf.save_maxdb=maxdb,wf.save_mindb_un=mindb_un,wf.audioFFT_active&&(wf.need_autoscale=16)):(setmaxdb(1,wf.save_maxdb),setmindb(1,wf.save_mindb_un-zoomCorrection())),spectrum_dB_bands(),update_maxmindb_sliders(),w3_show_hide_inline("id-cmap-maxmin",_),w3_show_hide_inline("id-cmap-maxmin-empty",!_),colormap_update(),freqset_select()}}function setwfspeed(e,t){wf.audioFFT_active?freqset_select():(wf_speed=+t,w3_set_value("slider-rate",wf_speed),w3_el("slider-rate-field").innerHTML=wf_speeds[wf_speed],w3_el("slider-rate-field").style.color=wf_speed?"white":"orange",wf_send("SET wf_speed="+wf_speed.toFixed(0)),e&&freqset_select())}function setmaxdb(e,t,a){var _=parseFloat(t),i=!1;if(wf.aper==kiwi.aper_e.auto)maxdb=_+wf.auto_ceil.val;else{var n=w3_el("id-input-maxdb"),o=w3_el("id-field-maxdb"),s=w3_el("id-field-mindb");if(!n||!o||!s)return;i=!0,_<=mindb?(maxdb=mindb+1,html(n).value=maxdb,html(o).innerHTML=maxdb.toFixed(0)+" dB",html(o).style.color="red"):(maxdb=_,html(o).innerHTML=_.toFixed(0)+" dB",html(o).style.color="white",html(s).style.color="white")}setmaxmindb(e,i,a)}function incr_mindb(e,t){if(wf.aper==kiwi.aper_e.man){var a=+mindb+t;setmindb(e,Math.max(-190,Math.min(-30,a)).toFixed(0))}}function setmindb(e,t,a){var _=parseFloat(t),i=!1;if(wf.aper==kiwi.aper_e.auto)mindb=_+wf.auto_floor.val;else{var n=w3_el("id-input-mindb"),o=w3_el("id-field-maxdb"),s=w3_el("id-field-mindb");if(!n||!o||!s)return;i=!0,maxdb<=_?(mindb=maxdb-1,html(n).value=mindb,html(s).innerHTML=mindb.toFixed(0)+" dB",html(s).style.color="red"):(mindb=_,html(n).value=mindb,html(s).innerHTML=_.toFixed(0)+" dB",html(s).style.color="white",html(o).style.color="white")}mindb_un=mindb+zoomCorrection(),setmaxmindb(e,i,a)}function setmaxmindb(e,t,a){full_scale=(full_scale=maxdb-mindb)||1,spectrum_dB_bands(),wf_send("SET maxdb="+maxdb.toFixed(0)+" mindb="+mindb.toFixed(0)),need_clear_wf_sp_avg=!0,e&&(1!=a&&freqset_select(),t&&(writeCookie(wf.audioFFT_active?"last_AF_max_dB":"last_max_dB",maxdb.toFixed(0)),writeCookie(wf.audioFFT_active?"last_AF_min_dB":"last_min_dB",mindb_un.toFixed(0))))}function update_maxmindb_sliders(){var e,t,a,_,i,n,o=wf.aper==kiwi.aper_e.auto;o||(mindb=mindb_un-zoomCorrection()),full_scale=(full_scale=maxdb-mindb)||1,spectrum_dB_bands(),o?(e=wf.auto_ceil.val,t=wf.auto_floor.val,a=e.toFixed(0).positiveWithSign(),_=t.toFixed(0).positiveWithSign(),w3_el("id-input-ceildb").value=e,w3_el("id-input-floordb").value=t,i=w3_el("id-field-ceildb"),n=w3_el("id-field-floordb")):(t=mindb,a=(e=maxdb).toFixed(0),_=t.toFixed(0),w3_el("id-input-maxdb").value=e,w3_el("id-input-mindb").value=t,i=w3_el("id-field-maxdb"),n=w3_el("id-field-mindb")),i.innerHTML=a+" dB",n.innerHTML=_+" dB"}function setceildb(e,t){var a=w3_el("id-input-ceildb"),_=w3_el("id-field-ceildb");if(a&&_){var i=parseFloat(t);w3_set_innerHTML(_,i.toFixed(0).positiveWithSign()+" dB"),wf.auto_ceil.val=i,set_ceilfloordb(e)}}function setfloordb(e,t){var a=w3_el("id-input-floordb"),_=w3_el("id-field-floordb");if(a&&_){var i=parseFloat(t);w3_set_innerHTML(_,i.toFixed(0).positiveWithSign()+" dB"),wf.auto_floor.val=i,set_ceilfloordb(e)}}function set_ceilfloordb(e){maxdb=wf.auto_maxdb+wf.auto_ceil.val,mindb=wf.auto_mindb+wf.auto_floor.val,mindb_un=mindb+zoomCorrection(),setmaxmindb(e,!1),w3_call("colormap_maxmin_cb"),e&&(freqset_select(),writeCookie("last_ceil_dB",wf.auto_ceil.val.toFixed(0)),writeCookie("last_floor_dB",wf.auto_floor.val.toFixed(0)))}function wf_autoscale_cb(){wf.need_autoscale=1,colormap_update(),freqset_select()}var spectrum_slow_dev=0;function toggle_or_set_slow_dev(e,t){isNumber(e)?spectrum_slow_dev=kiwi_toggle(e,t,spectrum_slow_dev,"last_slow_dev"):spectrum_slow_dev^=1,w3_color("id-button-slow-dev",spectrum_slow_dev?"lime":"white"),freqset_select(),writeCookie("last_slow_dev",spectrum_slow_dev.toString()),spectrum_slow_dev&&wf_speed==WF_SPEED_FAST&&setwfspeed(1,WF_SPEED_MED)}function toggle_or_set_spec_peak(e,t){isNumber(e)?spec.peak_show=kiwi_toggle(e,t,spec.peak_show,"last_spec_peak"):spec.peak_show^=1,spec.peak_show&&(spec.peak_clear=!0),w3_color("id-button-spec-peak",spec.peak_show?"lime":"white"),freqset_select(),writeCookie("last_spec_peak",spec.peak_show.toString())}var muted_until_freq_set=!0,recording=!1;function setvolume(e,t){kiwi.volume=+t,kiwi.volume=Math.max(0,Math.min(200,kiwi.volume)),kiwi.volume_f=kiwi.muted?0:kiwi.volume/100,e&&(w3_set_value("id-input-volume",kiwi.volume),freqset_select())}function toggle_or_set_mute(e){isNumber(e)?kiwi.muted=e:kiwi.muted^=1,owrx.squelched_overload||(w3_show_hide("id-mute-no",!kiwi.muted),w3_show_hide("id-mute-yes",kiwi.muted)),kiwi.volume_f=kiwi.muted?0:kiwi.volume/100,freqset_select()}var de_emphasis=0,de_emphasis_s=["off","on"];function de_emp_cb(e,t,a){snd_send("SET de_emp="+(de_emphasis=+t)),writeCookie("last_de_emphasis",de_emphasis.toString())}var pan=0;function setpan(e,t){var a=+t;a>-.1&&a<.1&&(a=0),w3_set_value("id-pan-value",a),w3_color("id-pan-value",null,a<0?"rgba(255,0,0,0.3)":a?"rgba(0,255,0,0.2)":""),w3_set_innerHTML("id-pan-field",a?(100*Math.abs(a)).toFixed(0)+" "+(a<0?"L":"R"):"L=R"),audio_set_pan(a),e&&(writeCookie("last_pan",a.toString()),freqset_select())}function audio_panner_ui_init(){audio_panner&&(w3_hide("id-vol-comp"),w3_show_block("id-vol"),w3_show_block("id-pan"),setpan(1,pan))}var hide_topbar=0;function toggle_or_set_hide_topbar(e){isNumber(e)?hide_topbar=e:1&(hide_topbar=hide_topbar+1&3)&&(extint.using_data_container||spec.source_wf||spec.source_audio)&&(hide_topbar=hide_topbar+1&3),w3_set_props("id-top-container","w3-panel-override-hide",1&hide_topbar),w3_set_props("id-band-container","w3-panel-override-hide",2&hide_topbar),openwebrx_resize()}var hide_panels=0,test_button;function toggle_or_set_hide_panels(e){isNumber(e)?hide_panels=e:hide_panels^=1,w3_iterate_children("id-panels-container",function(e){w3_contains(e,"class-panel")&&w3_set_props(e,"w3-panel-override-hide",hide_panels)})}function toggle_or_set_test(e){isNumber(e)?test_button=e:test_button^=1,console.log("toggle_or_set_test set="+e+" test_button="+test_button),w3_color("id-button-test",test_button?"lime":"white"),snd_send("SET test="+(test_button?1:0)),freqset_select()}function toggle_or_set_rec(e){if(recording=!recording,w3_remove_then_add("id-rec1","fa-spin",recording?"fa-spin":""),w3_remove_then_add("id-rec1","w3-text-white","w3-text-pink"),recording)window.recording_meta={buffers:[],data:null,offset:0,total_size:0,filename:window.location.hostname+"_"+(new Date).toISOString().replace(/:/g,"_").replace(/\.[0-9]+Z$/,"Z")+"_"+w3_el("id-freq-input").value+"_"+cur_mode+".wav"},window.recording_meta.buffers.push(new ArrayBuffer(65536)),window.recording_meta.data=new DataView(window.recording_meta.buffers[0]);else{var t=new ArrayBuffer(44),a=new DataView(t);a.setUint32(0,1380533830),a.setUint32(4,window.recording_meta.total_size+36,!0),a.setUint32(8,1463899717),a.setUint32(12,1718449184),a.setUint32(16,16,!0),a.setUint16(20,1,!0);var _=ext_is_IQ_or_stereo_curmode()?2:1;a.setUint16(22,_,!0);var i=Math.round(audio_input_rate||12e3);a.setUint32(24,i,!0);a.setUint32(28,i*_*2,!0),a.setUint16(32,2*_,!0),a.setUint16(34,16,!0),a.setUint32(36,1684108385),a.setUint32(40,window.recording_meta.total_size,!0),window.recording_meta.buffers.unshift(t);var n=new Blob(window.recording_meta.buffers,{type:"octet/stream"}),o=document.createElement("a");o.style="display: none",o.href=window.URL.createObjectURL(n),o.download=window.recording_meta.filename,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(o.href),document.body.removeChild(o),delete window.recording_meta}}var squelched=0,squelch=0,squelch_tail=0,squelch_tail_s=["0",".2s",".5s","1s","2s"],squelch_tail_v=[0,.2,.5,1,2];function squelch_action(e){var t=(squelched=e)?"white":kiwi.unmuted_color,a=t;if(owrx.squelched_overload=owrx.sMeter_dBm>=cfg.overload_mute,owrx.prev_squelched_overload!=owrx.squelched_overload&&(w3_show_hide("id-mute-exclaim",owrx.squelched_overload),w3_show_hide("id-mute-no",!owrx.squelched_overload&&!kiwi.muted),w3_show_hide("id-mute-yes",!owrx.squelched_overload&&kiwi.muted),owrx.prev_squelched_overload=owrx.squelched_overload),w3_color("id-squelch-label",a),w3_color("id-mute-no",t),recording){var _=squelched||owrx.squelched_overload;w3_remove_then_add("id-rec1","fa-spin",_?"":"fa-spin"),w3_remove_then_add("id-rec1","w3-text-white w3-text-pink",_?"w3-text-white":"w3-text-pink")}}function squelch_setup(e){var t="nbfm"==cur_mode;if(e&toggle_e.FROM_COOKIE){var a=readCookie("last_squelch"+(t?"":"_efm"));squelch=a?+a:0,w3_el("id-squelch-value").max=t?99:40,w3_set_value("id-squelch-value",squelch)}set_squelch_cb("",squelch,!0,!1,!0),t?squelch_action(squelched):w3_color("id-mute-no",kiwi.unmuted_color),w3_show_hide("id-squelch_tail",!t),w3_show_hide("id-squelch","drm"!=cur_mode)}function send_squelch(){var e="nbfm"==cur_mode;snd_send("SET squelch="+squelch.toFixed(0)+" param="+(e?squelch_threshold:squelch_tail_v[squelch_tail]).toFixed(2))}function set_squelch_cb(e,t,a,_,i){var n="nbfm"==cur_mode;_||(squelch=parseFloat(t),w3_el("id-squelch-field").innerHTML=squelch?t+(n?"":" dB"):"off",w3_color("id-squelch-value",null,squelch?"":"rgba(255,0,0,0.3)"),a&&(send_squelch(),1!=i&&writeCookie("last_squelch"+(n?"":"_efm"),t),freqset_select()))}function squelch_tail_cb(e,t,a){a||(squelch_tail=+t,send_squelch())}function chan_null_cb(e,t,a){a?w3_show_hide("id-chan-null","sam"==cur_mode):(owrx.chan_null=+t,ext_set_mode(cur_mode))}var btn_less_buffering=0;function toggle_or_set_audio(e,t){isNumber(e)?btn_less_buffering=kiwi_toggle(e,t,btn_less_buffering,"last_audio"):btn_less_buffering^=1;var a=w3_el("id-button-buffering");a&&(a.style.color=btn_less_buffering?"lime":"white",a.style.visibility="visible",freqset_select()),writeCookie("last_audio",btn_less_buffering.toString()),isNumber(e)||window.location.reload(!0)}var btn_compression=0;function toggle_or_set_compression(e,t){recording||(isNumber(e)?btn_compression=kiwi_toggle(e,t,btn_compression,"last_compression"):btn_compression^=1,w3_els("id-button-compression",function(e){e.style.color=btn_compression?"lime":"white",e.style.visibility="visible",freqset_select()}),writeCookie("last_compression",btn_compression.toString()),snd_send("SET compression="+btn_compression.toFixed(0)))}function set_agc(){var e=cur_mode&&"cw"==cur_mode.substr(0,2);w3_color("label-threshold",!e&&agc?"orange":"white"),w3_color("label-threshCW",e&&agc?"orange":"white"),snd_send("SET agc="+agc+" hang="+hang+" thresh="+(e?threshCW:thresh)+" slope="+slope+" decay="+decay+" manGain="+manGain)}var agc=0;function toggle_agc(e){return any_alternate_click_event(e)?setup_agc(toggle_e.SET):toggle_or_set_agc(),cancelEvent(e)}function agc_over(e){w3_el("id-button-agc").title=any_alternate_click_event(e)?"restore AGC params":""}var default_agc=1,default_hang=0,default_manGain=50,default_thresh=-100,default_threshCW=-130,default_slope=6,default_decay=1e3;function setup_agc(e){toggle_or_set_agc(agc=kiwi_toggle(e,default_agc,agc,"last_agc")),toggle_or_set_hang(hang=kiwi_toggle(e,default_hang,hang,"last_hang")),setManGain(!0,manGain=kiwi_toggle(e,default_manGain,manGain,"last_manGain")),setThresh(!0,thresh=kiwi_toggle(e,default_thresh,thresh,"last_thresh")),setThreshCW(!0,threshCW=kiwi_toggle(e,default_threshCW,threshCW,"last_threshCW")),setSlope(!0,slope=kiwi_toggle(e,default_slope,slope,"last_slope")),setDecay(!0,decay=kiwi_toggle(e,default_decay,decay,"last_decay"))}function toggle_or_set_agc(e){null!=e?agc=e:agc^=1,html("id-button-agc").style.color=agc?"lime":"white",agc?(html("id-label-man-gain").style.color="white",html("id-button-hang").style.borderColor=html("label-slope").style.color=html("label-decay").style.color="orange"):(html("id-label-man-gain").style.color="orange",html("id-button-hang").style.borderColor=html("label-slope").style.color=html("label-decay").style.color="white"),set_agc(),writeCookie("last_agc",agc.toString()),freqset_select()}var hang=0;function toggle_or_set_hang(e){null!=e?hang=e:hang^=1,html("id-button-hang").style.color=hang?"lime":"white",set_agc(),writeCookie("last_hang",hang.toString()),freqset_select()}var manGain=0;function setManGain(e,t){manGain=parseFloat(t),html("input-man-gain").value=manGain,html("field-man-gain").innerHTML=t,set_agc(),writeCookie("last_manGain",manGain.toString()),e&&freqset_select()}var thresh=0;function setThresh(e,t){thresh=parseFloat(t),html("input-threshold").value=thresh,html("field-threshold").innerHTML=t,set_agc(),writeCookie("last_thresh",thresh.toString()),e&&freqset_select()}var threshCW=0;function setThreshCW(e,t){threshCW=parseFloat(t),html("input-threshCW").value=threshCW,html("field-threshCW").innerHTML=t,set_agc(),writeCookie("last_threshCW",threshCW.toString()),e&&freqset_select()}var slope=0;function setSlope(e,t){slope=parseFloat(t),html("input-slope").value=slope,html("field-slope").innerHTML=t,set_agc(),writeCookie("last_slope",slope.toString()),e&&freqset_select()}var decay=0;function setDecay(e,t){decay=parseFloat(t),html("input-decay").value=decay,html("field-decay").innerHTML=t,set_agc(),writeCookie("last_decay",decay.toString()),e&&freqset_select()}function users_setup(){for(var e="",t=0;t<rx_chans;t++)e+=w3_div("",w3_div("w3-show-inline-block w3-left w3-margin-R-5 "+(t==rx_chan?"w3-text-css-lime":optbar_prefix_color),"RX"+t),w3_div("id-optbar-user-"+t+" w3-show-inline-block"));w3_set_innerHTML("id-optbar-users",w3_div("w3-nowrap",e))}function freq_up_down_cb(e,t){freq_memory_up_down(+t),w3_field_select("id-freq-input",{focus_only:1})}function toggle_or_set_spec(e,t){isNumber(e)&&e&toggle_e.SET?spec.source_wf=t:spec.source_wf^=1,extint.using_data_container&&spec.source_wf&&extint_panel_hide(),html("id-button-spectrum").style.color=spec.source_wf?"lime":"white",w3_show_hide("id-spectrum-container",spec.source_wf),w3_show_hide("id-top-container",!spec.source_wf),freqset_select()}var band_menu=[];function setup_band_menu(){var e,t=0,a=null,_="";band_menu[t++]=null;var i=cfg.init.ITU_region+1;for(e=0;e<bands.length;e++){var n=bands[e];"-"!=n.region&&("m"!=n.region&&0!=n.itu&&n.itu!=i||(n.s!=svc.L&&n.s!=svc.X||"m"!=n.region||n.name.includes("IBP")||(n.name="IBP "+n.name),a!=n.s.name&&(a=n.s.name,_+='<option value="'+t+'" disabled>'+n.s.name.toUpperCase()+"</option>",band_menu[t++]=null),_+='<option value="'+t+'">'+n.name+"</option>",band_menu[t++]=n))}return _}function mode_over(e,t){var a;switch(t.innerHTML.toLowerCase()){case"sam":a="synchronous AM";break;case"sal":a="synchronous AM LSB";break;case"sau":a="synchronous AM USB";break;case"sas":a="synchronous AM stereo";break;case"qam":a="C-QUAM AM stereo";break;default:a=""}t.title=e.shiftKey?"restore passband":a}function any_alternate_click_event(e){return e&&(e.shiftKey||e.ctrlKey||e.altKey||e.button==mouse.middle||e.button==mouse.right)}function any_alternate_click_event_except_shift(e){return e&&(e.ctrlKey||e.altKey||e.button==mouse.middle||e.button==mouse.right)}function restore_passband(e){passbands[e].last_lo=passbands[e].lo,passbands[e].last_hi=passbands[e].hi}var mode_buttons=[{s:["AM","AMN"],dis:0},{s:["SAM","SAL","SAU","SAS","QAM"],dis:0},{s:["DRM"],dis:0},{s:["LSB","LSN"],dis:0},{s:["USB","USN"],dis:0},{s:["CW","CWN"],dis:0},{s:["NBFM"],dis:0},{s:["IQ"],dis:0}],step_9_10,divControl;function mode_button(e,t,a){var _=t.innerHTML.toLowerCase();isUndefined(a)&&(a=1);var i=ext_is_IQ_or_stereo_curmode()?1:0;ext_is_IQ_or_stereo_mode(wf.audioFFT_prev_mode);if(!(recording&&i^m_iq_drm_sas)){if(any_alternate_click_event(e)){if(e.shiftKey||e.button==mouse.middle)return restore_passband(_),void ext_set_mode(_,null,{open_ext:!0});a=-1}var n=parseInt(t.id);if(isUndefined(owrx.last_mode_col)&&(owrx.last_mode_col=parseInt(owrx.last_mode_el.id)),owrx.last_mode_col!=n)owrx.last_mode_col=n;else{var o=mode_buttons[n].s;_=_.toUpperCase();var s=o.indexOf(_)+a;s<=-1&&(s=o.length-1),s>=o.length&&(s=0),_=o[s],t.innerHTML=_,_=_.toLowerCase()}ext_set_mode(_,null,{open_ext:!0})}}function button_9_10(e){null!=e?step_9_10=e:step_9_10^=1,writeCookie("last_9_10",step_9_10),freq_step_update_ui(!0),w3_el("id-button-9-10").innerHTML=step_9_10?"9":"10",freqset_select()}function pop_bottommost_panel(e){min_order=parseInt(e[0].getAttribute("data-panel-order")),min_index=0;for(var t=0;t<e.length;t++)actual_order=parseInt(e[t].getAttribute("data-panel-order")),actual_order<min_order&&(min_index=t,min_order=actual_order);return to_return=e[min_index],e.splice(min_index,1),to_return}function place_panels(){for(var e=[],t=[],a=html("id-panels-container").children,_=0;_<a.length;_++){var i=a[_];if(i.classList.contains("class-panel")){var n=i.getAttribute("data-panel-pos");if(!n)continue;var o=i.getAttribute("data-panel-size").split(",");"left"==n?e.push(i):"right"==n&&t.push(i),i.idName=i.id.replace("id-",""),i.style.width=o[0]+"px",i.style.height=o[1]+"px",i.style.margin=px(panel_margin),i.uiWidth=parseInt(o[0]),i.uiHeight=parseInt(o[1]),i.defaultWidth=parseInt(o[0]),i.defaultHeight=parseInt(o[1]);var s=html_LR_border_pad(i);i.activeWidth=i.uiWidth-s,"center"==n&&(i.style.left=px(window.innerWidth/2-i.activeWidth/2),i.style.bottom=px(window.innerHeight/2-i.uiHeight/2),i.style.visibility="hidden"),"bottom-left"==n&&(i.style.left=0,i.style.bottom=0,i.style.visibility="hidden")}}for(y=0;e.length>0;)p=pop_bottommost_panel(e),p.style.left=0,p.style.bottom=px(y),p.style.visibility="visible",y+=p.uiHeight+3*panel_margin,w3_call("panel_setup_"+p.idName,p);for(y=0;t.length>0;)p=pop_bottommost_panel(t),p.style.right=px(kiwi_scrollbar_width()),p.style.bottom=px(y),p.style.visibility="visible",y+=p.uiHeight+3*panel_margin,w3_call("panel_setup_"+p.idName,p)}var OPTBAR_CONTENT_HEIGHT=150;function panel_setup_control(e){divControl=e,e.style.marginBottom="0",w3_el("id-control-inner").innerHTML=w3_div("id-control-top",w3_div("id-control-freq1"),w3_div("id-control-freq2"),w3_div("id-control-mode w3-margin-T-6"),w3_div("id-control-zoom w3-margin-T-6"),w3_div("id-optbar w3-margin-T-4"))+w3_div("id-optbar-content w3-margin-T-6 w3-scroll-y|height:"+px(OPTBAR_CONTENT_HEIGHT),w3_div("id-optbar-wf w3-hide"),w3_div("id-optbar-audio w3-hide"),w3_div("id-optbar-agc w3-hide"),w3_div("id-optbar-users w3-hide w3-scroll-x"),w3_div("id-optbar-status w3-hide"))+w3_div("id-control-smeter"),w3_el("id-control-freq1").style.width=px(e.activeWidth-visIcon-6),w3_show_hide("id-mute-no",!kiwi.muted),w3_show_hide("id-mute-yes",kiwi.muted)}function panel_set_vis_button(e){var t=w3_el(e),a=w3_el(e+"-vis"),_=t.activeWidth-visIcon;a.style.left=px(_+visBorder)}function panel_set_width_height(e,t,a){var _=w3_el(e);null==t&&(t=_.defaultWidth),_.style.width=px(t),_.uiWidth=t,null==a&&(a=_.defaultHeight),_.style.height=px(a),_.uiHeight=a;var i=html_LR_border_pad(_);_.activeWidth=_.uiWidth-i,panel_set_vis_button(e)}function event_dump(e,t,a){if(a){var _=isDefined(e.relatedTarget)&&e.relatedTarget?" Trel="+e.relatedTarget.id:"";console.log("event_dump "+t+" "+e.type+" T="+e.target.id+" Tcur="+e.currentTarget.id+_)}else console.log("================================"),console.log("EVENT_DUMP: "+t+" type="+e.type),console.log((e.shiftKey?"SFT ":"")+(e.ctrlKey?"CTL ":"")+(e.altKey?"ALT ":"")+(e.metaKey?"META ":"")+"key="+e.key),console.log("this.id="+this.id+" tgt.name="+e.target.nodeName+" tgt.id="+e.target.id+" ctgt.id="+e.currentTarget.id),console.log("button="+e.button+" buttons="+e.buttons+" detail="+e.detail+" which="+e.which),console.log("offX="+e.offsetX+" pageX="+e.pageX+" clientX="+e.clientX+" layerX="+e.layerX),console.log("offY="+e.offsetY+" pageY="+e.pageY+" clientY="+e.clientY+" layerY="+e.layerY),console.log("evt, evt.target, evt.currentTarget, evt.relatedTarget:"),console.log(e),console.log(e.target),console.log(e.currentTarget),console.log(e.relatedTarget),console.log("----")}function arrayBufferToString(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function arrayBufferToStringLen(e,t){var a=new Uint8Array(e),_=String();t=Math.min(t,a.length);for(var i=0;i<t;i++)_+=String.fromCharCode(a[i]);return _}function add_problem(e,t,a,_){if(el=w3_el(_||"id-status-problems"),el){if(isDefined(el.children)){for(var i=0;i<el.children.length;i++)if(el.children[i].innerHTML==e)return;if(0==t)for(;el.firstChild;)el.removeChild(el.firstChild)}var n=w3_appendElement(el,"span",e);1!=a&&window.setTimeout(function(e,t){try{e.removeChild(t)}catch(e){}},1e3,el,n)}}function set_gen(e,t){snd_send("SET genattn="+t.toFixed(0)),snd_send("SET gen="+e+" mix=-1")}var bin_server=0,zoom_server=0;function owrx_msg_cb(e,t){switch(e[0]){case"wf_setup":waterfall_init();break;case"extint_list_json":extint_list_json(e[1]),override_ext&&extint_open(override_ext,3e3);break;case"bandwidth":bandwidth=parseInt(e[1]);break;case"center_freq":center_freq=parseInt(e[1]);break;case"wf_fft_size":wf_fft_size=parseInt(e[1]);break;case"wf_fps_max":wf_fps_max=parseInt(e[1]);break;case"wf_fps":wf_fps=parseInt(e[1]);break;case"start":bin_server=parseInt(e[1]);break;case"zoom":zoom_server=parseInt(e[1]);break;case"zoom_max":zoom_levels_max=parseInt(e[1]),zoom_nom=Math.min(ZOOM_NOMINAL,zoom_levels_max);break;case"audio_init":toggle_or_set_audio(toggle_e.FROM_COOKIE|toggle_e.SET,1),audio_init(+e[1],btn_less_buffering,kiwi_toggle(toggle_e.FROM_COOKIE|toggle_e.SET,1,1,"last_compression"));break;case"audio_camp":var a=e[1].split(",");audio_camp(+a[0],+a[1],btn_less_buffering,kiwi_toggle(toggle_e.FROM_COOKIE|toggle_e.SET,1,1,"last_compression"));break;case"audio_rate":audio_rate(parseFloat(e[1]));break;case"audio_adpcm_state":a=e[1].split(",");audio_adpcm_state(+a[0],+a[1]);break;case"audio_passband":a=e[1].split(",");audio_recompute_LPF(1,+a[0],+a[1]);break;case"kiwi_up":kiwi_up(parseInt(e[1]));break;case"gps":toggle_or_set_spec(toggle_e.SET,1);break;case"fft_mode":kiwi_fft_mode();break;case"maxdb":wf.auto_maxdb=+e[1],setmaxdb(1,wf.auto_maxdb,!0);break;case"mindb":wf.auto_mindb=+e[1],setmindb(1,wf.auto_mindb,!0),w3_call("colormap_maxmin_cb"),update_maxmindb_sliders(!0);break;case"max_thr":cfg.overload_mute=Math.round(+e[1]);break;default:return!1}return!0}function owrx_ws_open_snd(e,t){return ws_snd=open_websocket("SND",e,t,owrx_msg_cb,audio_recv,on_ws_error)}function owrx_ws_open_wf(e,t){return ws_wf=open_websocket("W/F",e,t,owrx_msg_cb,waterfall_add_queue,on_ws_error)}function on_ws_error(){console.log("WebSocket error")}function snd_send(e){try{return ws_snd.send(e),0}catch(t){return console.log("CATCH snd_send('"+e+"') ex="+t),kiwi_trace(),-1}}function wf_send(e){try{return ws_wf.send(e),0}catch(t){return console.log("CATCH wf_send('"+e+"') ex="+t),kiwi_trace(),-1}}function ws_any(){return ws_snd||(ws_wf||null)}var need_geo=!0,need_status=!0;function send_keepalive(){for(var e=0;e<1&&(ws_snd.up&&!(snd_send("SET keepalive")<0));e++){if(need_geo&&""!=kiwi_geo()){if(msg_send("SET geoloc="+kiwi_geo())<0)break;if(msg_send("SET geojson="+kiwi_geojson())<0)break;need_geo=!1}if(need_ident){if(ident_user||(ident_user=""),snd_send("SET ident_user="+encodeURIComponent(ident_user))<0)break;need_ident=!1}if(need_status){if(snd_send("SET need_status=1")<0)break;need_status=!1}}ws_wf.up&&wf_send("SET keepalive")}




/* web/openwebrx/audio.min.js */
var audio_stat_output_bufs,audio_stat_last_time,audio_running,audio_started,audio_last_output_offset,audio_mode_iq,audio_compression,audio_stat_input_epoch,audio_prepared_buffers,audio_prepared_buffers2,audio_prepared_seq,audio_prepared_flags,audio_prepared_smeter,audio_buffering,audio_convolver_running,audio_meas_dly,audio_meas_dly_start,resample_new,resample_old,resample_init1,resample_init2,resample_input_buffer,resample_input_available,resample_input_processed,resample_last_taps_delay,resample_output_buffer,resample_output_buffer2,resample_output_size,resample_taps,resample_taps_length,resample_last,resample_last2,audio_ext_adc_ovfl,audio_need_stats_reset,audio_change_LPF_latch,audio_change_freq_latch,audio_change_sq_UI_latch,audio_last_sq,audio_gain,comp_lpf_freq,comp_lpf_taps,comp_lpf_taps_length,audio_buffer_size,audio_buffer_min_length_sec,audio_buffer_max_length_sec,audio_data,audio_last_output_buffer,audio_last_output_buffer2,audio_silence_buffer,audio_stats_interval,audio_periodic_interval,audio_context,audio_output_rate,audio_last_is_local,audio_last_compression,audio_input_rate,audio_interpolation,audio_decimation,audio_resample_ratio,audio_transition_bw,audio_min_nbuf,audio_max_nbuf,audio_stat_output_epoch,audio_channels,audio_source,audio_watchdog,audio_change_LPF_delayed,audio_disconnected,audio_convolver,audio={d:!1,last_flags:0,trim_bufs:!1,lo_cut:0,hi_cut:0},audio_periodic_interval_ms=1e3,audio_flags={SND_FLAG_LPF:1,SND_FLAG_ADC_OVFL:2,SND_FLAG_NEW_FREQ:4,SND_FLAG_MODE_IQ:8,SND_FLAG_COMPRESSED:16,SND_FLAG_RESTART:32,SND_FLAG_SQUELCH_UI:64,SND_FLAG_LITTLE_ENDIAN:128},audio_ext_sequence=0,audio_meas_dly_ena=0,audio_initial_connect=!1,audio_watchdog_restart=!1,audio_stat_input_size=0,audio_stat_total_input_size=0,audio_reconnect=0,audio_silence_count=0,audio_restart_count=0,audio_underrun_errors=0,audio_overrun_errors=0,audio_last_underruns=0,audio_last_reconnect=0,audio_last_restart_count=0,resample_new_default=!1,audio_adpcm={index:0,previousValue:0},audio_panner=null,audio_instance=0,audio_camping=0,audio_init_disconnect=0,audio_firefox_watchdog=0;function audio_camp(a,e,_,o){audio_camping=a?0:1,audio_init_disconnect=a,audio_init(e,_,o),audio_ext_sequence=0,audio_meas_dly_ena=0,audio_initial_connect=!1,audio_watchdog_restart=!1}function audio_reset(){audio.trim_bufs=!0}function audio_init(a,e,_){if(audio_running=!1,kiwi_clearInterval(audio_periodic_interval),console.log("--------------------------"),audio.d&&console.log("AUDIO audio_init CALLED audio_init_disconnect="+audio_init_disconnect+" is_local="+a+" less_buffering="+e+" compression="+_),e=!1,audio.d&&console.log("AUDIO audio_init LAST audio_last_is_local="+audio_last_is_local+" audio_last_compression="+audio_last_compression),null==a&&(a=audio_last_is_local),audio_last_is_local=a,null==_&&(_=audio_last_compression),audio_last_compression=_,console.log("AUDIO audio_init FINAL is_local="+a+" less_buffering="+e+" compression="+_),(audio_init_disconnect||null!=audio_source)&&(audio.d&&console.log("AUDIO audio_init audio_disconnect"),audio_disconnect()),audio_started=!1,audio_last_output_offset=0,audio_mode_iq=!1,audio_compression=!!_,audio_stat_input_epoch=-1,audio_prepared_buffers=Array(),audio_prepared_buffers2=Array(),audio_prepared_seq=Array(),audio_prepared_flags=Array(),audio_prepared_smeter=Array(),audio_buffering=!1,audio_convolver_running=!1,audio_meas_dly=0,audio_meas_dly_start=0,resample_new=!kiwi_isMobile()&&resample_new_default,resample_old=!resample_new,resample_init1=!1,resample_init2=!1,resample_input_buffer=[],resample_input_available=0,resample_input_processed=0,resample_last_taps_delay=0,resample_output_buffer=[],resample_output_buffer2=[],resample_taps=[],resample_last=0,resample_last2=0,comp_lpf_freq=0,comp_lpf_taps=[],comp_lpf_taps_length=255,audio_adpcm.index=0,audio_adpcm.previousValue=0,audio_ext_adc_ovfl=!1,audio_need_stats_reset=!0,audio_change_LPF_latch=!1,audio_change_freq_latch=!1,audio_change_sq_UI_latch=!1,audio_last_sq=void 0,audio_firefox_watchdog=0,kiwi_clearInterval(audio_stats_interval),audio_init_disconnect)return audio.d&&console.log("AUDIO audio_init DISCONNECT"),audio_init_disconnect=0,!1;var o,i=0,u=kiwi_url_param("abuf",null,null),t=0;if(null!=u){var d=u.split(",");if(t=parseFloat(d[0]),!isNaN(t)&&t>=.25&&t<=5){console.log("AUDIO override abuf="+u);var r=3*t;if(d.length>=2){var s=parseFloat(d[1]);!isNaN(s)&&s>=.25&&s<=5&&s>t&&(r=s)}else r=3*t;audio_buffer_min_length_sec=t,audio_buffer_max_length_sec=r,audio_buffer_size=8192,i=9,o="abuf="}else t=0}0==t&&(2==(i=e?a?2:1:0)?(audio_buffer_size=8192,audio_buffer_min_length_sec=.37,audio_buffer_max_length_sec=2,o="less buf, local"):1==i?(audio_buffer_size=8192,audio_buffer_min_length_sec=.74,audio_buffer_max_length_sec=3,o="less buf, remote"):0==i&&(audio_buffer_size=8192,audio_buffer_min_length_sec=.85,audio_buffer_max_length_sec=3.4,o="more buf")),audio_data=new Int16Array(audio_buffer_size),audio_last_output_buffer=new Float32Array(audio_buffer_size),audio_last_output_buffer2=new Float32Array(audio_buffer_size),audio_silence_buffer=new Float32Array(audio_buffer_size),console.log("AUDIO buffer_size="+audio_buffer_size+" buffering_scheme: "+o),audio_stats_interval=setInterval(audio_stats,1e3);try{window.AudioContext=window.AudioContext||window.webkitAudioContext,(audio_context=new AudioContext).sampleRate=44100,audio_output_rate=audio_context.sampleRate;try{audio_panner=audio_context.createStereoPanner(),audio_panner_ui_init()}catch(a){audio_panner=null}kiwi_isSmartTV()&&(audio_gain=audio_context.createGain())}catch(a){return kiwi_serious_error("Your browser does not support Web Audio API, which is required for OpenWebRX to run. Please use an HTML5 compatible browser."),audio_context=null,audio_output_rate=0,!0}return setTimeout(function(a){snd_send("SET little-endian")},1e4,++audio_instance),audio_running=!0,!1}function audio_rate(a){if(0==(audio_input_rate=a))snd_send("SET x-DEBUG user's browser gave zero audio_input_rate?"),kiwi_serious_error("Audio initialization problem.");else if(0==audio_output_rate)snd_send("SET x-DEBUG user's browser doesn't support WebAudio"),snd_send("SET x-DEBUG "+navigator.userAgent),kiwi_serious_error("Browser doesn't support WebAudio:<br>"+navigator.userAgent+"<br><br>Please update to the latest version of your browser.");else if(resample_old)audio_interpolation=audio_output_rate/audio_input_rate,audio_decimation=1;else if(0==(audio_interpolation=0)){var e,_;for(e=2;e<=1024;e++){var o=a*e/audio_output_rate;if(_=Math.floor(o),Math.abs(o-_)<1e-5)break}e>1024?(snd_send("SET UAR in="+a+" out="+audio_output_rate),kiwi_serious_error("Your system uses an audio output rate of "+audio_output_rate+" sps which we do not support.")):(audio_interpolation=e,audio_decimation=_)}0!=audio_interpolation?(audio_transition_bw=.001,audio_resample_ratio=audio_output_rate/audio_input_rate,snd_send("SET AR OK in="+a+" out="+audio_output_rate)):audio_resample_ratio=1,audio_min_nbuf=Math.ceil(audio_buffer_min_length_sec*audio_output_rate/audio_buffer_size),audio_max_nbuf=Math.ceil(audio_buffer_max_length_sec*audio_output_rate/audio_buffer_size),console.log("AUDIO audio_input_rate="+audio_input_rate+" audio_output_rate="+audio_output_rate),console.log("AUDIO min_length_sec="+audio_buffer_min_length_sec+"("+audio_min_nbuf+" bufs) max_length_sec="+audio_buffer_max_length_sec+"("+audio_max_nbuf+" bufs)")}function audio_start(){if(audio.d&&console.log("AUDIO audio_start"),null!=audio_context){audio_started=!0,audio_connect(0),audio_periodic_interval=setInterval(audio_periodic,audio_periodic_interval_ms);try{demodulator_analog_replace(init_mode)}catch(a){snd_send("SET x-DEBUG audio_start.demodulator_analog_replace: catch: "+a.toString())}}}function audio_disconnect(){audio.d&&console.log("AUDIO audio_disconnect"),audio_source&&(audio_disconnected=!0,audio_source.disconnect(),audio_source.onaudioprocess=null,audio_source=null),audio_convolver_running&&(audio_convolver.disconnect(),audio_convolver_running=!1),audio_watchdog&&(audio_watchdog.disconnect(),audio_watchdog.onaudioprocess=null,audio_watchdog=null),audio_panner&&(audio_panner.disconnect(),audio_panner=null)}function audio_connect_destination(a){kiwi_isSmartTV()&&(audio_gain.gain.value=.3,a.connect(audio_gain),a=audio_gain),audio_panner?(a.connect(audio_panner),audio_panner.connect(audio_context.destination)):a.connect(audio_context.destination)}function audio_set_pan(a){if(audio_panner)try{audio_panner.pan.value=a}catch(a){}}function audio_connect(a){null!=audio_context&&(!audio_initial_connect&&a||(a||(audio_initial_connect=!0),a&&(audio_disconnect(),resample_init1=resample_init2=!1,audio_reconnect++,kiwi_log("AUDIO reconnect BUFFERING true"),audio_buffering=!0),audio_stat_output_epoch=-1,audio_change_LPF_delayed=!1,(audio_source=audio_context.createScriptProcessor(audio_buffer_size,0,audio_channels)).onaudioprocess=audio_onprocess,audio_disconnected=!1,audio_convolver_running?(audio_source.connect(audio_convolver),audio_connect_destination(audio_convolver)):audio_connect_destination(audio_source),kiwi_isFirefox()&&((audio_watchdog=audio_context.createScriptProcessor(audio_buffer_size,audio_channels,0)).onaudioprocess=audio_watchdog_process,audio_convolver_running?audio_convolver.connect(audio_watchdog):audio_source.connect(audio_watchdog))))}function audio_watchdog_process(a){if(kiwi.muted||audio_buffering)audio_silence_count=0;else{var e=a.inputBuffer.getChannelData(0),_=0==e[0];kiwi_gc_snd&&(e=null),(audio_silence_count=_?audio_silence_count+1:0)>16&&(audio_connect(1),audio_silence_count=0,audio_restart_count++,add_problem("FF silence"),kiwi_log("AUDIO FF SILENCE"))}}function audio_onprocess(a){if(audio_firefox_watchdog++,!audio_disconnected){if(-1==audio_stat_output_epoch&&(audio_stat_output_epoch=(new Date).getTime(),audio_stat_output_bufs=0),audio_stat_output_bufs++,audio_started&&0==audio_prepared_buffers.length&&(audio_underrun_errors++,audio_buffering=!0),!audio_started||audio_buffering)return audio_need_stats_reset=!0,a.outputBuffer.copyToChannel(audio_silence_buffer,0),void(2==audio_channels&&a.outputBuffer.copyToChannel(audio_silence_buffer,1));a.outputBuffer.copyToChannel(audio_prepared_buffers.shift(),0),2==audio_channels&&a.outputBuffer.copyToChannel(audio_prepared_buffers2.shift(),1),audio_ext_sequence=audio_prepared_seq.shift(),audio_change_LPF_delayed&&(audio_recompute_LPF(0),audio_change_LPF_delayed=!1),owrx.sMeter_dBm_biased=audio_prepared_smeter.shift()/10,owrx.sMeter_dBm=owrx.sMeter_dBm_biased-SMETER_BIAS;var e=audio_prepared_flags.shift();audio_ext_adc_ovfl=!!(e&audio_flags.SND_FLAG_ADC_OVFL),e&audio_flags.SND_FLAG_LPF&&(audio_change_LPF_delayed=!0);var _=!!(e&audio_flags.SND_FLAG_SQUELCH_UI);_!=audio_last_sq&&isDefined(squelch_action)&&(setTimeout(function(a){squelch_action(a)},1,_),audio_last_sq=_),audio_meas_dly_ena&&audio_meas_dly_start&&e&audio_flags.SND_FLAG_NEW_FREQ&&(audio_meas_dly=(new Date).getTime()-audio_meas_dly_start,kiwi_log("AUDIO dly="+audio_meas_dly),audio_meas_dly_start=0)}}var audio_watchdog_restart_cnt=0;function audio_periodic(){audio_started&&audio_prepared_buffers.length&&0==audio_firefox_watchdog&&kiwi_isFirefox()&&!cfg.disable_recent_changes&&(add_problem("FF watchdog"),console.log("AUDIO FF WATCHDOG Q"+audio_prepared_buffers.length+" WD="+audio_firefox_watchdog+" ============================================"),audio_init(0,null,!1,null),audio_initial_connect=!0,audio_watchdog_restart=!0,snd_send("SET reinit"));for(var a=!1;audio_prepared_buffers.length>audio_max_nbuf;)a=!0,audio_prepared_buffers.shift(),2==audio_channels&&audio_prepared_buffers2.shift(),audio_prepared_seq.shift(),audio_prepared_flags.shift(),audio_prepared_smeter.shift();a&&(add_problem("audio overrun"),audio_overrun_errors++),audio_last_underruns!=audio_underrun_errors&&(add_problem("audio underrun"),snd_send("SET underrun="+audio_underrun_errors),audio_last_underruns=audio_underrun_errors)}function audio_adpcm_state(a,e){audio_adpcm.index=a,audio_adpcm.previousValue=e,audio_camping=2}function audio_recv(a){if(audio_running){var e=new Uint8Array(a,0,8),_=e[3],o=e[7]<<24|e[6]<<16|e[5]<<8|e[4];if(!(1==audio_camping&&_&audio_flags.SND_FLAG_COMPRESSED)){var i,u=new Uint8Array(a,8,2),t=u[0]<<8|u[1],d=_&audio_flags.SND_FLAG_MODE_IQ,r=new DataView(a,d?20:10),s=r.byteLength;if(audio_watchdog_restart){if(!(_&audio_flags.SND_FLAG_RESTART))return;audio_watchdog_restart=!1,audio_prepared_buffers=[],audio_prepared_buffers2=[],audio_prepared_seq=[],audio_prepared_flags=[],audio_prepared_smeter=[],audio_mode_iq?resample_old=!(resample_new=!1):(audio_adpcm.index=audio_adpcm.previousValue=0,resample_new=!kiwi_isMobile()&&resample_new_default,resample_old=!resample_new),audio_connect(1)}else if(d)audio_mode_iq||(audio_prepared_buffers=[],audio_prepared_buffers2=[],audio_prepared_seq=[],audio_prepared_flags=[],audio_prepared_smeter=[],resample_old=!(resample_new=!1),audio_mode_iq=!0,audio_channels=2,audio.d&&console.log("AUDIO !IQ -> IQ transition"),audio_connect(1)),audio_last_compression=audio_compression=!1,audio_mode_iq=!0;else{var n=!!(_&audio_flags.SND_FLAG_COMPRESSED);(audio_mode_iq||audio_compression!=n)&&(audio_prepared_buffers=[],audio_prepared_buffers2=[],audio_prepared_seq=[],audio_prepared_flags=[],audio_prepared_smeter=[],audio_adpcm.index=audio_adpcm.previousValue=0,resample_new=!kiwi_isMobile()&&resample_new_default,resample_old=!resample_new,audio.d&&(audio_mode_iq?console.log("AUDIO IQ -> !IQ transition, compressed="+n):console.log("AUDIO !IQ, compression change="+(audio_compression!=n)+" compressed="+n)),audio_mode_iq=!1,audio_channels=1,audio_last_compression=audio_compression=n,audio_connect(1)),audio_last_compression=audio_compression=n,audio_mode_iq=!1}if(audio_channels=audio_mode_iq?2:1,audio_compression)audio.d&&console.log("AC Q"+audio_prepared_buffers.length+" #"+audio_channels),decode_ima_adpcm_e8_i16(r,audio_data,s,audio_adpcm),i=2*s;else for(audio.d&&(d?console.log("ANC IQ Q"+audio_prepared_buffers.length+"/"+audio_prepared_buffers2.length+" #"+audio_channels):console.log("ANC Q"+audio_prepared_buffers.length+" #"+audio_channels)),i=s/2,p=0;p<i;p++)audio_data[p]=r.getInt16(2*p,!!(_&audio_flags.SND_FLAG_LITTLE_ENDIAN));if(audio_prepare(audio_data,i,o,_,t),!audio_started)audio_prepared_buffers.length>audio_min_nbuf&&audio_start();if(audio_need_stats_reset&&audio_stats_reset(),audio_stat_input_size+=i,audio_stat_total_input_size+=i,extint_audio_data(audio_data,i),wf.audioFFT_active&&wf_audio_FFT(audio_data,i),window.recording&&0==audio_last_sq){for(var l=audio_mode_iq?1024:n?2048:512,p=0;p<l;++p)window.recording_meta.data.setInt16(window.recording_meta.offset,audio_data[p],!0),window.recording_meta.offset+=2;window.recording_meta.total_size+=2*l,65536==window.recording_meta.offset&&(window.recording_meta.buffers.push(new ArrayBuffer(65536)),window.recording_meta.data=new DataView(window.recording_meta.buffers[window.recording_meta.buffers.length-1]),window.recording_meta.offset=0)}}}}var audio_push_ct=0;function audio_prepare(a,e,_,o,i){var u,t,d,r=resample_new&&audio_compression&&comp_lpf_taps_length,s=function(){audio_prepared_buffers.push(audio_last_output_buffer),2==audio_channels&&audio_prepared_buffers2.push(audio_last_output_buffer2),audio_prepared_seq.push(_),audio_change_LPF_latch&&(audio_change_LPF_latch=!1,o|=audio_flags.SND_FLAG_LPF),audio_change_freq_latch&&(audio_change_freq_latch=!1,o|=audio_flags.SND_FLAG_NEW_FREQ),audio_change_sq_UI_latch&&(audio_change_sq_UI_latch=!1,o|=audio_flags.SND_FLAG_SQUELCH_UI),audio_prepared_flags.push(o),audio_prepared_smeter.push(i),audio_last_output_offset=0,audio_last_output_buffer=new Float32Array(audio_buffer_size),2==audio_channels&&(audio_last_output_buffer2=new Float32Array(audio_buffer_size))},n=function(a,e,_,o,i){var u;for(u=0;u<i;u++)a[e+u]=_[o+u]};if(0!=e){if(1!=audio_resample_ratio){var l,p;if(resample_init1||((resample_taps_length=Math.round(4/audio_transition_bw))%2==0&&resample_taps_length++,rational_resampler_get_lowpass_f(resample_taps,resample_taps_length,audio_interpolation,audio_decimation),resample_init1=!0),!resample_init2&&resample_init1&&(r||resample_old)&&null!=audio_source)audio_recompute_LPF(1),l=comp_lpf_taps,p=comp_lpf_taps_length,(audio_convolver=audio_context.createConvolver()).normalize=!1,audio_reload_convolver_buffer(l,p),audio.d&&console.log("AUDIO splice in convolver"),audio_source.disconnect(),audio_source.connect(audio_convolver),audio_connect_destination(audio_convolver),kiwi_isFirefox()&&audio_convolver.connect(audio_watchdog),audio_convolver_running=!0,resample_init2=!0;if(resample_old)if(2==audio_channels){resample_output_size=Math.round(e/2*audio_resample_ratio);var f,c=1/audio_resample_ratio,m=0,g=0;for(A=0;A<resample_output_size;A++)h=a[2*m],b=resample_last,resample_output_buffer[A]=(h-b)*g+b,f=a[2*m+1],b=resample_last2,resample_output_buffer2[A]=(f-b)*g+b,(g+=c)>=1&&(g-=1,resample_last=h,resample_last2=f,m++);resample_last=h,resample_last2=f}else{resample_output_size=Math.round(e*audio_resample_ratio);var h,b;c=1/audio_resample_ratio,m=0,g=0;for(A=0;A<resample_output_size;A++)h=a[m],b=resample_last,resample_output_buffer[A]=(h-b)*g+b,(g+=c)>=1&&(g-=1,resample_last=h,m++);resample_last=h}else{if(0!=resample_input_processed){var w=resample_input_available-resample_input_processed;n(resample_input_buffer,0,resample_input_buffer,resample_input_processed,w),resample_input_available=w,resample_input_processed=0}n(resample_input_buffer,resample_input_available,a,0,e),resample_input_available+=e,2==audio_channels?rational_resampler_cc(resample_input_buffer,resample_output_buffer,resample_output_buffer2,resample_input_available,audio_interpolation,audio_decimation,resample_taps,resample_taps_length,resample_last_taps_delay):rational_resampler_ff(resample_input_buffer,resample_output_buffer,resample_input_available,audio_interpolation,audio_decimation,resample_taps,resample_taps_length,resample_last_taps_delay)}u=resample_output_buffer,t=resample_output_buffer2,d=resample_output_size}else u=a,d=e;if(o&audio_flags.SND_FLAG_LPF&&(audio_change_LPF_latch=!0),o&audio_flags.SND_FLAG_NEW_FREQ||audio.trim_bufs){audio_change_freq_latch=!0,audio.trim_bufs=!1;audio_prepared_buffers.length;for(var v=audio_min_nbuf;audio_prepared_buffers.length>v;)audio_prepared_buffers.pop(),2==audio_channels&&audio_prepared_buffers2.pop(),audio_prepared_seq.pop(),audio_prepared_flags.pop(),audio_prepared_smeter.pop()}if(o&audio_flags.SND_FLAG_SQUELCH_UI&&(audio_change_sq_UI_latch=!0),audio_last_output_offset+d<=audio_buffer_size){if(2==audio_channels)for(var A=0;A<d;A++)audio_last_output_buffer[A+audio_last_output_offset]=u[A]/32768*kiwi.volume_f,audio_last_output_buffer2[A+audio_last_output_offset]=t[A]/32768*kiwi.volume_f;else for(A=0;A<d;A++)audio_last_output_buffer[A+audio_last_output_offset]=u[A]/32768*kiwi.volume_f;(audio_last_output_offset+=d)==audio_buffer_size&&s()}else{var F=audio_buffer_size-audio_last_output_offset,D=d-F;if(2==audio_channels)for(A=0;A<audio_buffer_size-audio_last_output_offset;A++)audio_last_output_buffer[A+audio_last_output_offset]=u[A]/32768*kiwi.volume_f,audio_last_output_buffer2[A+audio_last_output_offset]=t[A]/32768*kiwi.volume_f;else for(A=0;A<audio_buffer_size-audio_last_output_offset;A++)audio_last_output_buffer[A+audio_last_output_offset]=u[A]/32768*kiwi.volume_f;s();do{for(A=0;A<D;A++){if(A==audio_buffer_size){s();break}audio_last_output_buffer[A]=u[A+F]/32768*kiwi.volume_f,2==audio_channels&&(audio_last_output_buffer2[A]=t[A+F]/32768*kiwi.volume_f)}D-=A,F+=A}while(D);audio_last_output_offset+=A}if(audio_buffering)audio_prepared_buffers.length>audio_min_nbuf&&(audio_buffering=!1)}}try{AudioBuffer.prototype.copyToChannel||(AudioBuffer.prototype.copyToChannel=function(a,e){for(var _=this.getChannelData(e),o=0;o<a.length;o++)_[o]=a[o]})}catch(a){console.log("CATCH: AudioBuffer.prototype.copyToChannel")}function audio_stats_reset(){audio_stat_input_epoch=(new Date).getTime(),audio_stat_last_time=audio_stat_input_epoch,audio_stat_input_size=audio_stat_total_input_size=0,audio_need_stats_reset=!1}function audio_stats(){if(-1!=audio_stat_input_epoch&&-1!=audio_stat_output_epoch){var a=(new Date).getTime(),e=(a-audio_stat_last_time)/1e3;audio_stat_last_time=a;var _=audio_stat_total_input_size/((a-audio_stat_input_epoch)/1e3),o=audio_stat_output_bufs*audio_buffer_size/((a-audio_stat_output_epoch)/1e3),i="Audio: network "+(audio_stat_input_size/e).toFixed(0)+" sps ("+_.toFixed(0)+" avg), output "+o.toFixed(0)+" sps";i+=", Qlen "+audio_prepared_buffers.length,audio_underrun_errors&&(i+=", underruns "+audio_underrun_errors.toString()),audio_restart_count&&(i+=", restart "+audio_restart_count.toString()),w3_innerHTML("id-msg-audio",i),audio.d&&console.log(i),isNaN(o)&&(o=0),w3_innerHTML("id-status-audio",w3_text(optbar_prefix_color,"WF"),w3_text("",kiwi.wf_fps.toFixed(0)+" fps"),w3_text(optbar_prefix_color,"Audio"),w3_text("",(o/1e3).toFixed(1)+"k, Qlen "+audio_prepared_buffers.length)),audio_stat_input_size=0}}function audio_recompute_LPF(a,e,_){isDefined(e)&&isDefined(_)&&(audio.lo_cut=Math.abs(e),audio.hi_cut=Math.abs(_)),audio_camping?(e=audio.lo_cut,_=audio.hi_cut):isDefined(demodulators[0])?(_=Math.abs(demodulators[0].high_cut),isNaN(_)&&console.log(demodulators[0]),e=Math.abs(demodulators[0].low_cut)):(e=0,_=4e3);var o=Math.max(_,e);(a||o!=comp_lpf_freq)&&(firdes_lowpass_f(comp_lpf_taps,comp_lpf_taps_length,o/audio_output_rate),comp_lpf_freq=o,audio_convolver_running&&audio_reload_convolver_buffer(comp_lpf_taps,comp_lpf_taps_length))}function audio_reload_convolver_buffer(a,e){var _=audio_context.createBuffer(2,e,audio_output_rate),o=_.getChannelData(0);o.set(a),(o=_.getChannelData(1)).set(a),audio_convolver.buffer=_}function rational_resampler_ff(a,e,_,o,i,u,t,d){var r,s,n,l,p=Math.round(_*o/i);for(s=0;s<p&&(n=Math.floor((s*i+o-1-d)/o),l=Math.floor((d+n*o-s*i)%o),!(n+t/o+1>_));s++){var f=Math.floor((t-l)/o),c=0;for(r=0;r<f;r++)c+=a[n+r]*u[l+r*o];e[s]=c*o}resample_input_processed=n,resample_output_size=s,resample_last_taps_delay=l}function rational_resampler_cc(a,e,_,o,i,u,t,d,r){console.log("WARNING rational_resampler_cc() not working yet!")}function rational_resampler_get_lowpass_f(a,e,_,o){var i=1/_,u=1/o;firdes_lowpass_f(a,e,(i<u?i:u)/2)}function firdes_lowpass_f(a,e,_){var o,i=Math.floor(e/2);for(a[i]=2*Math.PI*_*firdes_wkernel_hamming(0),o=1;o<=i;o++)a[i-o]=a[i+o]=Math.sin(2*Math.PI*_*o)/o*firdes_wkernel_hamming(o/i);var u=0;for(o=0;o<e;o++)u+=a[o];for(o=0;o<e;o++)a[o]/=u}function firdes_wkernel_hamming(a){return a=.5+a/2,.54-.46*Math.cos(2*Math.PI*a)}




/* web/openwebrx/ima_adpcm.min.js */
var indexAdjustTable=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],stepSizeTable=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767];function ImaAdpcmDecode(e,a){var p=stepSizeTable[a.index],d=p>>3;return 1&e&&(d+=p>>2),2&e&&(d+=p>>1),4&e&&(d+=p),8&e&&(d=-d),a.previousValue+=d,a.previousValue>a.pos_clamp?a.previousValue=a.pos_clamp:a.previousValue<a.neg_clamp&&(a.previousValue=a.neg_clamp),a.index+=indexAdjustTable[e],a.index<0?a.index=0:a.index>88&&(a.index=88),a.previousValue}function decode_ima_adpcm_e8_i16(e,a,p,d){d.pos_clamp=32767,d.neg_clamp=-32768;var c,i=0;for(c=0;c<p;c++){var m=e.getUint8(c);a[i++]=ImaAdpcmDecode(15&m,d),a[i++]=ImaAdpcmDecode(m>>4&15,d)}}function decode_ima_adpcm_e8_u8(e,a,p,d){d.pos_clamp=255,d.neg_clamp=0;var c,i=0;for(c=0;c<p;c++)a[i++]=ImaAdpcmDecode(15&e[c],d),a[i++]=ImaAdpcmDecode(e[c]>>4&15,d)}

/* web/pkgs/xdLocalStorage/xdLocalStorage.min.js */
"use strict";window.xdLocalStorage=window.xdLocalStorage||function(){var e,n="cross-domain-local-message",o={iframeId:"cross-domain-iframe",iframeUrl:void 0,initCallback:function(){}},t=-1,i={},a=!1,l=!1;function r(e){var t;try{t=JSON.parse(e.data)}catch(e){}t&&t.namespace===n&&("iframe-ready"===t.id?(l=!0,t.ip&&console.log("xdLocalStorage ip="+t.ip),o.initCallback()):function(e){i[e.id]&&(i[e.id](e),delete i[e.id])}(t))}function s(o,a,l,r){i[++t]=r;var s={namespace:n,etag:0,server:0,id:t,action:o,key:a,value:l};e.contentWindow.postMessage(JSON.stringify(s),"*")}function c(n){o=XdUtils.extend(n,o);var t=document.createElement("div");window.addEventListener?window.addEventListener("message",r,!1):window.attachEvent("onmessage",r),t.innerHTML='<iframe id="'+o.iframeId+'" src='+o.iframeUrl+' style="display: none;"></iframe>',document.body.appendChild(t),e=document.getElementById(o.iframeId)}function d(){return a?!!l||(console.log("You must wait for iframe ready message before using the api."),!1):(console.log("You must call xdLocalStorage.init() before using it."),!1)}return{init:function(e){if(!e.iframeUrl)throw"You must specify iframeUrl";a?console.log("xdLocalStorage was already initialized!"):(a=!0,"complete"===document.readyState?c(e):window.onload=function(){c(e)})},setItem:function(e,n,o){d()&&s("set",e,n,o)},getItem:function(e,n){d()&&s("get",e,null,n)},removeItem:function(e,n){d()&&s("remove",e,null,n)},key:function(e,n){d()&&s("key",e,null,n)},getSize:function(e){d()&&s("size",null,null,e)},getLength:function(e){d()&&s("length",null,null,e)},clear:function(e){d()&&s("clear",null,null,e)},wasInit:function(){return a}}}(),window.xdLocalStorageHA=window.xdLocalStorageHA||function(){var e="cross-domain-local-message",n={iframeId:"cross-domain-iframe",iframeUrls:void 0,initCallback:function(){}},o=-1,t=[],i=[],a=0,l={},r=[],s=!1,c=!1;function d(n){var o;try{o=JSON.parse(n.data)}catch(e){}o&&o.namespace===e&&("iframe-ready"===o.id?o.ip&&console.log("xdLocalStorage ip="+o.ip):"ping"===o.action?(i[o.server]=!0,a++,console.log("XDLS ping reply server="+o.server+" seen_ct="+a)):r[o.server]=o)}function u(n,a,s,c){l[++o]=c;for(var d={namespace:e,etag:Date.now(),id:o,action:n,key:a,value:s},u=0;u<t.length;u++)("ping"==n||i[u])&&(console.log("XDLS request id="+o+" server="+u+" action="+n+" etag="+d.etag),d.server=u,r[u]=null,t[u].contentWindow.postMessage(JSON.stringify(d),"*"));"ping"!=n&&setTimeout(function(){for(var e=-1,n=-1,o=0;o<t.length;o++){var i=r[o];if(null!=i){var a=i.etag?i.etag:0;console.log("XDLS response id="+i.id+" server="+i.server+" etag="+a),a>e&&(e=a,n=o)}}-1!=n?function(e){console.log("XDLS result id="+e.id+" server="+e.server),console.log(e),l[e.id]&&(l[e.id](e),delete l[e.id])}(r[n]):console.log("XDLS wait longer for response?")},250)}function f(e){n=XdUtils.extend(e,n),window.addEventListener?window.addEventListener("message",d,!1):window.attachEvent("onmessage",d);var o=0;n.iframeUrls.forEach(function(e){var i="id-"+n.iframeId+"-"+o,a=document.createElement("div");w3_add(a,"id-"+n.iframeId),a.innerHTML='<iframe id="'+i+'" src='+e+' style="display: none;"></iframe>',document.body.appendChild(a),t[o]=document.getElementById(i),o++})}function m(){return s?!!c||(console.log("You must wait for iframe ready message before using the api."),!1):(console.log("You must call xdLocalStorage.init() before using it."),!1)}return setTimeout(function(){u("ping",null,null,null),setTimeout(function(){console.log("XDLS seen servers="+a),c=!0,n.initCallback()},1e3)},5e3),{init:function(e){if(!e.iframeUrls)throw"You must specify iframeUrls";s?console.log("xdLocalStorage was already initialized!"):(s=!0,"complete"===document.readyState?f(e):window.onload=function(){f(e)})},setItem:function(e,n,o){m()&&u("set",e,n,o)},getItem:function(e,n){m()&&u("get",e,null,n)},removeItem:function(e,n){m()&&u("remove",e,null,n)},key:function(e,n){m()&&u("key",e,null,n)},getSize:function(e){m()&&u("size",null,null,e)},getLength:function(e){m()&&u("length",null,null,e)},clear:function(e){m()&&u("clear",null,null,e)},wasInit:function(){return s}}}();

/* web/pkgs/xdLocalStorage/xd-utils.min.js */
"use strict";window.XdUtils=window.XdUtils||function(){return{extend:function(n,t){var r,i=t||{};for(r in n)n.hasOwnProperty(r)&&(i[r]=n[r]);return i}}}();