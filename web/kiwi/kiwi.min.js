

/* web/kiwi/kiwi.min.js (web/kiwi/kiwi.js = Fri Apr  7 12:24:00 2023) */
var kiwi={d:{},isOffset:!1,is_local:[],loaded_files:{},WSPR_rgrid:"",GPS_fixes:0,wf_fps:0,is_multi_core:0,log2_seq:0,inactivity_panel:!1,no_admin_conns_pend:0,foff_error_pend:0,notify_seq:0,ident_min:16,volume:50,volume_f:1e-6,muted:1,unmuted_color:"lime",pan:0,queued:0,modes_lc:["am","amn","usb","lsb","cw","cwn","nbfm","iq","drm","usn","lsn","sam","sau","sal","sas","qam","nnfm"],modes_uc:[],modes_idx:{},mode_menu:["AM","AMN","USB","USN","LSB","LSN","CW","CWN","NBFM","NNFM","IQ","DRM","SAM","SAU","SAL","SAS","QAM"],cfg_fields:["min","max","chan"],ITU_s:["any","R1: Europe, Africa","R2: North & South America","R3: Asia / Pacific","show on band scale only","show on band menu only"],ITU_ANY:0,BAND_SCALE_ONLY:4,BAND_MENU_ONLY:5,RX4_WF4:0,RX8_WF2:1,RX3_WF3:2,RX14_WF0:3,cmap_s:["Kiwi","CSDR","grey","linear","turbo","SdrDx","cust1","cust2","cust3","cust4"],cmap_e:{kiwi:0,CuteSDR:1,greyscale:2,linear:3,turbo:4,SdrDx:5,custom_1:6,custom_2:7,custom_3:8,custom_4:9},aper_s:["man","auto"],aper_e:{man:0,auto:1},esc_lt:"",esc_gt:"",xdLocalStorage_ready:!1,prefs_import_ch:-1,ADC_CLK_CORR_DISABLED:0,ADC_CLK_CORR_CONTINUOUS:1,pre_samps:0,pre_size:0,pre_last:0,pre_buf:null,pre_data:null,pre_off:0,pre_captured:!1,pre_wrapped:!1,pre_ping_pong:0,_ver_:1.578,_last_:null};kiwi.modes_lc.forEach(function(e,i){kiwi.modes_uc.push(e.toUpperCase()),kiwi.modes_idx[e]=i});var rx_chans,wf_chans,wf_chans_real,max_camp,conn_type,timestamp,gmap,WATERFALL_CALIBRATION_DEFAULT=-13,SMETER_CALIBRATION_DEFAULT=-13,rx_chan=null,try_again="",seriousError=!1,optbar_prefix_color="w3-text-css-orange",dbgUs=!1,dbgUsFirst=!0;function kiwi_bodyonload(e){""!=e?kiwi_serious_error(e):"LG"==kiwi_isSmartTV()&&kiwi_isChrome()<87?kiwi_serious_error("Browser: "+navigator.userAgent+"<br>Sorry, KiwiSDR requires SmartTV Chrome version >= 87"):(initCookie("ident","").startsWith("ZL/KF6VO")&&(dbgUs=!0),"undefined"==(conn_type=w3_el("id-kiwi-container").getAttribute("data-type"))&&(conn_type="kiwi"),console.log("conn_type="+conn_type),w3int_init(),e=new Date,timestamp=e.getTime(),extint.ws="kiwi"==conn_type?owrx_ws_open_snd(kiwi_open_ws_cb,{conn_type:conn_type}):kiwi_ws_open(conn_type,kiwi_open_ws_cb,{conn_type:conn_type}))}function kiwi_open_ws_cb(e){"kiwi"!=e.conn_type&&setTimeout(function(){setInterval(function(){ext_send("SET keepalive")},5e3)},5e3),seriousError||ext_hasCredential(e.conn_type,kiwi_valpwd1_cb,e)}function kiwi_load_js_polled(e,i){return e.started||(kiwi_load_js(i,function(){e.finished=!0}),e.started=!0,e.finished=!1),e.finished}function kiwi_load_js_dir(e,i,r,n){for(var o=0;o<i.length;o++)i[o]=e+i[o];kiwi_load_js(i,r,n)}function kiwi_load_js(o,t,e){console.log("DYNLOAD START"),o.push("kiwi/kiwi_js_load.js"),console.log(o);var s=!1;o.forEach(function(e,i){if(kiwi.loaded_files[e])console.log("DYNLOAD already loaded: "+e);else{if(e.includes("kiwi_js_load.js")){if(!s)return}else kiwi.loaded_files[e]=1,s=!0;var r,n=!1;e.endsWith(".js")||e.includes("/js?key=")?((r=document.createElement("script")).src=e,r.type="text/javascript","kiwi/kiwi_js_load.js"==e&&(r.kiwi_js=o[i-1],r.kiwi_cb=t)):e.endsWith(".css")?((r=document.createElement("link")).rel="stylesheet",r.href=e,r.type="text/css"):n=!0,n?console.log("DYNLOAD UNKNOWN FILETYPE "+e):(r.async=!1,document.head.appendChild(r),console.log("DYNLOAD loading "+e))}}),console.log("DYNLOAD FINISH"),s?e&&(console.log("DYNLOAD call pre subsequent"),w3_call(e,!0)):(e&&(console.log("DYNLOAD call pre"),w3_call(e,!1)),t&&(console.log("DYNLOAD call post"),w3_call(t)))}function kiwi_ask_pwd_cb(e,i,r){ext_valpwd(conn_type,i)}function kiwi_queue_or_camp_cb(e,i,r){var n=window.location.href;console.log(n),n+=kiwi_add_search_param(window.location,"camp"),console.log("--\x3e "+n),window.location.href=n}function kiwi_ask_pwd(e){console.log("kiwi_ask_pwd chan_no_pwd_true="+chan_no_pwd_true+" client_public_ip="+client_public_ip);var i="",r="";e&&chan_no_pwd_true&&(i="All channels busy that don't require a password ("+chan_no_pwd_true+"/"+rx_chans+")<br>",r="<br> <b>OR</b> <br><br> click to queue for an available channel, <br>or camp on an existing channel: <br>"+w3_button("w3-medium w3-padding-smaller w3-aqua w3-margin-T-8","Queue or Camp","kiwi_queue_or_camp_cb")),kiwi_show_msg("KiwiSDR: software-defined receiver <br>"+(i=kiwi_url_param(["p","prot","protected"],!0,!1)&&e?"You have requested a password protected channel<br>":i)+try_again+w3_input("w3-retain-input-focus w3-margin-TB-8/w3-label-inline w3-label-not-bold/kiwi-pw|padding:1px|size=40","Password:","id-pwd","","kiwi_ask_pwd_cb")+r),w3_field_select("id-pwd",{mobile:1})}var override_freq,override_mode,override_zoom,override_max_dB,override_min_dB,override_9_10,body_loaded=!1;function kiwi_valpwd1_cb(e,i){seriousError||(1==e?(kiwi_ask_pwd("kiwi"==i.conn_type),try_again="Try again. "):2==e?kiwi_show_msg("Still determining local interface address.<br>Please try reloading page in a few moments."):3==e?kiwi_show_msg("Admin connections not allowed from this ip address."):4==e?kiwi_show_msg("No admin password set. Can only connect from same local network as Kiwi.<br>Client ip = "+client_public_ip):5==e?kiwi_show_msg("Multiple connections from the same ip address not allowed.<br>Client ip = "+client_public_ip):6==e?kiwi_show_msg("Database update in progress.<br>Please try reloading page after one minute."):0==e&&("kiwi"==i.conn_type?extint.ws=owrx_ws_open_wf(kiwi_open_ws_cb2,i):kiwi_valpwd2_cb(0,i)))}function kiwi_open_ws_cb2(e){ext_hasCredential(e.conn_type,kiwi_valpwd2_cb,e)}function kiwi_valpwd2_cb(e,i){if(!seriousError)if(kiwi_show_msg(""),body_loaded)console.log("kiwi_valpwd2_cb: body_loaded previously!");else{body_loaded=!0,"kiwi"!=i.conn_type&&(w3_hide("id-kiwi-msg-container"),w3_show_block("id-kiwi-container"),w3_el("id-kiwi-body").style.overflow="hidden");try{kiwi_init(),w3_call(i.conn_type+"_main")}catch(e){console.log("EX: "+e),console.log("kiwi_valpwd2_cb: no interface routine for "+i.conn_type+"?")}}}function kiwi_init(){}function kiwi_xdLocalStorage_init(){for(var e=[],i=0;i<2;i++)e[i]="http://pub"+i+".kiwisdr.com/pkgs/xdLocalStorage/xdLocalStorage.php/?key=4e92a0c3194c62b2a067c494e2473e8dfe261138";xdLocalStorageHA.init({iframeUrls:e,initCallback:function(){kiwi.xdLocalStorage_ready=!0,console.log("xdLocalStorageHA READY")}})}function kiwi_get_init_settings(){var e=null==init_frequency?7020:init_frequency,e=ext_get_cfg_param("init.freq",e,EXT_NO_SAVE);init_frequency=override_freq||e;var i=ext_get_cfg_param("init.mode",init_mode||"lsb",EXT_NO_SAVE);console.log("INIT init_mode="+init_mode+" init.mode="+i+" override_mode="+override_mode),init_mode=override_mode||i,"drm"===init_mode&&(init_mode="am");e=null==init_zoom?0:init_zoom,e=ext_get_cfg_param("init.zoom",e,EXT_NO_SAVE);init_zoom=isNumber(override_zoom)?override_zoom:e;i=null==init_max_dB?-10:init_max_dB,i=ext_get_cfg_param("init.max_dB",i,EXT_NO_SAVE);init_max_dB=override_max_dB||i;e=null==init_min_dB?-110:init_min_dB,e=ext_get_cfg_param("init.min_dB",e,EXT_NO_SAVE);init_min_dB=override_min_dB||e,console.log("INIT f="+init_frequency+" m="+init_mode+" z="+init_zoom+" min="+init_min_dB+" max="+init_max_dB),w3_call("init_scale_dB");i=ext_get_cfg_param("rx_antenna"),e=w3_el("rx-antenna");null!=e&&i&&(e.innerHTML="Antenna: "+kiwi_decodeURIComponent("rx_antenna",i)),kiwi.WSPR_rgrid=ext_get_cfg_param_string("WSPR.grid","",EXT_NO_SAVE)}var cfg={},adm={};function cfg_save_json(e,i){var r;if(i.startsWith("adm."))r=encodeURIComponent(JSON.stringify(adm,null,3)),console.log("save_adm len="+r.length),extint.ws.send("SET save_adm="+r);else{r=encodeURIComponent(JSON.stringify(cfg,null,3)),console.log("save_cfg len="+r.length);for(var n=65e3;r.length>n;)extint.ws.send("SET save_cfg_part="+r.slice(0,n)),r=r.slice(n);extint.ws.send("SET save_cfg="+r)}console.log("cfg_save_json: from="+e+" path="+i+" DONE")}var server_time_utc,server_time_local,server_time_tzid,server_time_tzname,server_tz,geo={geo:"",json:"",retry:0};function kiwi_geolocate(i){var r,e=kiwi_isFirefox();if(!(e&&e<=28)){switch(null==i&&(i=(new Date).getSeconds()),i%=3){case 0:r="https://ipapi.co/json";break;case 1:r="https://get.geojs.io/v1/ip/geo.json";break;case 2:r="http://ip-api.com/json?fields=49177"}kiwi_ajax(r,function(e){isUndefined(e.AJAX_error)?(console.log("GEOLOC "+r),console.log(e),geoloc_json(e)):geo.retry++<=3&&kiwi_geolocate(i+1)},null,5e3)}}function geoloc_json(e){var i,r;isDefined(e.AJAX_error)||(window.JSON&&window.JSON.stringify?geo.json=JSON.stringify(e):geo.json=e.toString(),i=e.country_name||e.country,r=e.regionName||e.region,"United States"==i&&r&&(i=r+", USA"),geo.geo="",e.city&&(geo.geo+=e.city),i&&(geo.geo+=(e.city?", ":"")+i),console.log("GEOLOC "+geo.geo))}function kiwi_geo(){return encodeURIComponent(geo.geo)}function kiwi_geojson(){return encodeURIComponent(geo.json)}var time_display_current=!0;function time_display_cb(e){isUndefined(e.tu)||(server_time_utc=e.tu,server_time_local=e.tl,server_time_tzid=decodeURIComponent(e.ti),server_time_tzname=decodeURIComponent(e.tn).replace(/\\/g,"").replace(/_/g," "),server_tz=server_time_tzname,server_time_tzid&&(server_tz+=" ("+server_time_tzid+")"),time_display_started?time_display(time_display_current):(time_display_periodic(),time_display_started=!0))}function time_display(e){var i;w3_el("id-time-display-text-inner")&&(i=""==server_time_local||"null"==server_time_tzname,w3_innerHTML("id-time-display-UTC",server_time_utc||"?"),w3_innerHTML("id-time-display-local",i?"?":server_time_local),w3_innerHTML("id-time-display-tzname",i?"Lat/lon needed for local time":server_tz),w3_el("id-time-display-logo-inner").style.opacity=e?0:1,w3_el("id-time-display-inner").style.opacity=e?1:0)}function time_display_periodic(){time_display(time_display_current),time_display_current^=1,setTimeout(function(){time_display_periodic()},time_display_current?5e4:1e4)}var time_display_prev,time_display_started=!1;function time_display_setup(e){var i;0==e.startsWith("id-")&&(e+="-time-display"),time_display_prev&&(i=w3_el(time_display_prev))&&(i.innerHTML=""),time_display_prev=e,(i=w3_el(e)).innerHTML=w3_div("id-time-display-inner",w3_div("id-time-display-text-inner",w3_inline("",w3_div("id-time-display-UTC"),w3_div("cl-time-display-text-suffix","UTC")),w3_inline("",w3_div("id-time-display-local"),w3_div("cl-time-display-text-suffix","Local")),w3_div("id-time-display-tzname")))+w3_div("id-time-display-logo-inner",w3_div("id-time-display-logo-text","Powered by"),'<a href="https://github.com/ha7ilm/openwebrx" target="_blank"><img id="id-time-display-logo" src="gfx/openwebrx-top-logo.png" /></a>'),time_display(time_display_current)}function time_display_height(){return 80}function time_display_width(){return 200}function time_display_html(e,i){return i=i||"50px",w3_div(e+"-time-display|top:"+i+"; background-color:black; position:relative;")}var ansi={colors:[[0,0,0],[252,57,31],[49,231,34],[234,236,35],[88,51,255],[249,53,248],[20,240,240],[233,235,235],[0,0,0],[252,57,31],[49,231,34],[234,236,35],[88,51,255],[249,53,248],[20,240,240],[233,235,235]],BRIGHT:8,RED:"[97m[101m",YELLOW:"[103m",GREEN:"[102m",CYAN:"[106m",BLUE:"[97m[104m",MAGENTA:"[97m[105m",GREY:"[47m",NORM:"[m",rolling:["RED","YELLOW","GREEN","CYAN","BLUE","MAGENTA","GREY"],rolling_n:7};function kiwi_output_sgr(e){var i="SGR",r="",n=0,o=0,t=e.esc.s.substr(1).split(";"),s=t.length;e.isAltBuf&&(i+="("+e.r+","+e.c+")");for(var _,a,c,l,d,w,u,f=0;f<s&&!isNumber(i);f++)0==(u=""==t[f]||"m"==t[f]?0:parseInt(t[f]))?(e.sgr.fg=e.sgr.bg=null,i+=", reset",n=1):isNaN(u)?i=2:1==u?(e.sgr.bright=ansi.BRIGHT,i+=", bright"):2==u?(e.sgr.bright=0,i+=", faint"):22==u?(e.sgr.bright=0,i+=", normal"):7==u?(w=e.sgr.fg,e.sgr.fg=e.sgr.bg,e.sgr.bg=w,null==e.sgr.fg&&(e.sgr.fg=[255,255,255]),null==e.sgr.bg&&(e.sgr.bg=[0,0,0]),i+=", reverse video",o=1):27==u?(e.sgr.fg=e.sgr.bg=null,i+=", reverse video off",n=1):30<=u&&u<=37?(e.sgr.fg=ansi.colors[u-30+e.sgr.bright],i+=", fg color",o=1):90<=u&&u<=97?(e.sgr.fg=ansi.colors[u-90+ansi.BRIGHT],i+=", fg color bright",o=1):39==u?(e.sgr.fg=null,i+=", fg normal",o=1):40<=u&&u<=47?(e.sgr.bg=ansi.colors[u-40+e.sgr.bright],i+=", bg color",o=1):100<=u&&u<=107?(e.sgr.bg=ansi.colors[u-100+ansi.BRIGHT],i+=", bg color bright",o=1):49==u?(e.sgr.bg=null,i+=", bg normal",o=1):38==u||48==u?3!=s||5!=parseInt(t[1])||isNaN(_=parseInt(t[2]))?5!=s||2!=parseInt(t[1])||isNaN(a=parseInt(t[2]))||isNaN(c=parseInt(t[3]))||isNaN(l=parseInt(t[4]))?i=2:(d=[a=w3_clamp(a,0,255),c=w3_clamp(c,0,255),l=w3_clamp(l,0,255)],38==u?e.sgr.fg=d:e.sgr.bg=d,i+=", 24-bit color",o=1):(f+=2,_<=15?(d=ansi.colors[_],38==u?e.sgr.fg=d:e.sgr.bg=d,i+=", 38/48 mode color",o=1):_<=231?(_-=16,_-=36*(a=Math.floor(_/36)),l=_-=6*(c=Math.floor(_/6)),d=[a=Math.floor(255*a/5),c=Math.floor(255*c/5),l=Math.floor(255*l/5)],38==u?e.sgr.fg=d:e.sgr.bg=d,i+=", color cube",o=1):_<=255?(d=[w=8+10*(_-232),w,w],38==u?e.sgr.fg=d:e.sgr.bg=d,i+=", grayscale ramp",o=1):i=2):i=2;return n?e.sgr.span&&(r+="</span>",e.sgr.span=0):o&&(e.sgr.span&&(r+="</span>"),r+='<span style="'+(e.sgr.fg?"color:"+kiwi_rgb(e.sgr.fg)+";":"")+(e.sgr.bg?"background-color:"+kiwi_rgb(e.sgr.bg)+";":"")+'">',e.sgr.span=1),{msg:i,str:r}}function kiwi_output_msg(e,i,c){var r=w3_el(e);if(r){function n(e){var i=w3_create_appendElement(e,"pre","");for(c.nlines++;c.nlines>c.max_lines;)e.removeChild(e.firstChild),c.nlines--;return i}function o(e){for(;e.firstChild;)e.removeChild(e.firstChild);c.nlines=0}function _(e){return'<span class="cl-admin-console-cursor">'+(e=e||"&nbsp;")+"</span>"}function t(){c.r_cursor!=c.r&&0!=c.r_cursor&&(c.dirty[c.r_cursor]=!0),function(){for(var e=null,i=null,r=!1,n=1;n<=c.rows;n++)if(c.dirty[n]){c.dirty[n]=!1;for(var o="",t=1;t<=c.cols;t++){var s=c.color[n][t];s.fg==e&&s.bg==i||(r&&(o+="</span>"),s.fg||s.bg?o+='<span style="'+(s.fg?"color:"+kiwi_rgb(s.fg)+";":"")+(s.bg?"background:"+kiwi_rgb(s.bg)+";":"")+'">':r=!1,e=s.fg,i=s.bg,r=!0);s=c.screen[n][t];"<"==s?s="&lt;":">"==s?s="&gt;":"&"==s?s="&amp;":"'"==s?s="&apos;":"/"==s&&(s="&#47;"),c.show_cursor&&n==c.r&&t==c.c?(o+=_(s),c.r_cursor=n,c.c_cursor=t):o+=s}""==o?o="&nbsp;":r&&(o+="</span>");try{c.els[n].innerHTML=o}catch(e){0}}}()}function s(){kiwi_clearTimeout(c.rend_timeout),c.rend_timeout=setTimeout(function(){t()},250)}function a(){c.dirty[c.r]=!0}function l(e,i){var r=c.r,n=c.c;if(i!=c.NOSHIFT_MODE&&c.insertMode)for(K=r.cols-1;n<=K;K--)c.screen[r][K+1]=c.screen[r][K],c.color[r][K+1]=c.color[r][K];try{c.screen[r][n]=e}catch(e){0}c.color[r][n]={fg:c.sgr.fg,bg:c.sgr.bg},a(),c.c++,c.c>c.cols&&(c.eol_wrap&&i!=c.NOSHIFT_MODE?(c.c=1,c.r++,c.r>c.rows&&(c.r=1,a())):c.c=c.cols),s()}function d(e,i,r,n){for(var o=e,t=0<n,s=i;t&&s<=r||!t&&r<=s;s+=n){c.r=o,o+=n;for(var _=c.c=1;_<=c.cols;_++)l(c.screen[s][_])}}function w(e,i,r,n){for(var o=e;e&&o<=i;o++){for(var t=r;t<=(o==c.r?n:c.cols);t++)c.screen[o][t]=" ",c.color[o][t]={fg:null,bg:null};c.dirty[o]=!0}s()}function u(e){""==b&&(c.snew_r=c.r,c.snew_c=c.c),b+=e}function f(e){""!=b&&(b="")}function m(e){isString(c.line_html[c.ccol])?c.line_html[c.ccol]+=e:c.line_html[c.ccol]=e}function p(e,i){i=i||c.cols;for(var r="",n=[],o=e,t=0;o<i;o++,t++){var s=isString(c.line_sgr[o])?c.line_sgr[o]:"",_=isString(c.line_html[o])?c.line_html[o]:"",a=isString(c.line[o])?c.line[o]:"";r+=s+_+a,n[t]={sgr:s,html:_,ch:a,s:r}}return{s:r,a:n}}var g;if(isArg(c.no_decode)&&1==c.no_decode)g=c.s;else try{g=kiwi_decodeURIComponent("kiwi_output_msg",c.s)}catch(e){console.log("decodeURIComponent FAIL:"),console.log(c.s),g=c.s}if(1!=c.init){o(r),c.el=n(r),c.cols=c.cols||80,c.NONE=0,c.ESC=1,c.CSI=2,c.NON_CSI=3,c.NOSHIFT_MODE=!0,c.esc={s:"",state:c.NONE},c.sgr={span:0,bright:0,fg:null,bg:null},c.return_pending=!1,c.must_scroll_down=!1,c.traceEvery=!1,c.ccol=1,c.line=[],c.line_sgr=[],c.line_html=[],c.inc=1,c.r=c.c=1,c.margin_set=!1,c.margin_top=1,c.margin_bottom=c.rows,c.show_cursor=c.show_cursor||!1,c.r_cursor=c.c_cursor=0,c.insertMode=!0,c.eol_wrap=!1,c.screen=[],c.color=[],c.dirty=[],c.els=[];for(var k=0;k<=c.rows;k++)c.screen[k]=[],c.color[k]=[];c.isAltBuf=!1,c.altbuf_via_cursor_visible=!1,c.altbuf_via_cup=!1,c.alt_save="",c.rend_timeout=null,c.init=!0}var b="",h=w3_el(i),v=null;!c.process_return_alone||"\r"!=g.charAt(0)||1!=g.length&&"\n"==g.charAt(1)||c.isAltBuf||(g=g.substring(1),c.line=[],c.line_sgr=[],c.line_html=[],c.ccol=1),c.remove_returns&&(g=g.replace(/\r/g,"")),c.inline_returns&&!c.isAltBuf&&(g=(g=g.replace(/\r\n/g,"\n")).replace(/\r\n/g,"\n"));for(var y,x,S=0,A=0;A<g.length;A++){var T,N=null,E=g.charAt(A);if(c.inline_returns&&c.return_pending&&"\r"!=E&&(c.isAltBuf||(c.ccol=1,c.line_sgr[c.ccol]=null,c.line_html[c.ccol]=null,c.return_pending=!1)),"\f"==E)c.isAltBuf||(o(r),c.el=n(r),c.line=[],c.line_sgr=[],c.line_html=[],c.ccol=1);else if("\r"==E)c.isAltBuf&&(c.c=1,a()),c.inline_returns&&(c.return_pending=!0),f(),N="\\r col = 1 ("+c.r+",1)";else if("\n"==E&&c.isAltBuf)N=c.margin_set?(d(c.margin_top,c.margin_top+1,c.margin_bottom,1),"\\n (scroll text up)"):(c.c=1,c.r<c.rows&&c.r++,a(),"\\n row++ ("+c.r+","+c.c+")");else if("\b"==E)N="backspace (arrow left)",c.isAltBuf?1<c.c&&(a(),c.c--):1<c.ccol&&c.ccol--;else if("\t"==E){if(N="tab",!c.isAltBuf)for(u("&nbsp;"),c.line[c.ccol]="&nbsp;",c.ccol++;0!=(7&c.ccol);)u("&nbsp;"),c.line[c.ccol]="&nbsp;",c.ccol++}else if(""==E)c.esc.s="",c.esc.state=c.ESC,c.traceEvery=!1;else if(c.esc.state>=c.ESC){var L=!1;if(c.esc.state==c.ESC)if("["==E)c.esc.state=c.CSI;else switch(c.esc.state=c.NON_CSI,E){case"(":case"O":S=2;break;case">":case"=":S=1;break;default:0,S=1}if(c.esc.state==c.CSI?(c.esc.s+=E,1<c.esc.s.length&&"@"<=E&&E<="~"&&(L=!0)):c.esc.state==c.NON_CSI&&S&&(c.esc.s+=E,0==--S&&(L=!0)),L){var R,C,B,I,M,O=c.esc.s.charAt(0),U=c.esc.s.charAt(1),D="h"==E||"l"==E,H="h"==E,F=N=0,z=1,q=1,L=c.esc.s.slice(1);if(1<L.length&&isNumber(+L[0])&&(z=(z=+(P=(P=L.slice(0,L.length-1)).split(";"))[0])||1,q=(q=1<P.length?+P[1]:q)||1),"["==O)if("m"==E){var P=kiwi_output_sgr(c),N=P.msg;c.isAltBuf||(u(P.str),c.line_sgr[c.ccol]=P.str),c.traceEvery=!0}else if("K"==E){if(c.isAltBuf){switch(N="erase in line: ",U){case"0":case"K":B=c.c,I=c.cols,N+="cur to EOL";break;case"1":B=1,I=c.c,N+="BOL to cur";break;case"2":B=1,I=c.cols,N+="full line";break;default:B=0}!function(e,i){for(var r=e;e&&r<=i;r++)c.screen[c.r][r]=" ",c.color[c.r][r]={fg:null,bg:null};a(),s()}(B,I)}else if("K"==U){0;for(var j=c.line.length,K=c.ccol;K<=j;K++)c.line[K]=null,c.line_sgr[K]=null,c.line_html[K]=null;0,N="erase in line: cur to EOL"}}else if("J"==E)c.isAltBuf?(N="0"==U||"J"==U?(R=c.r,C=c.rows,B=c.c,I=c.cols,"erase cur to EOS"):"2"==U||"3"==U?(R=1,C=c.rows,B=1,I=c.cols,"erase full screen"):"1"==U?(R=1,C=c.r,B=1,I=c.c,"erase BOS to cur"):(R=0,2),w(R,C,B,I)):"2"!=U&&"3"!=U||(o(r),c.el=n(r),c.line=[],c.line_sgr=[],c.line_html=[],c.ccol=1,N="erase full screen");else if("H"==E)N="move "+z+","+q,c.isAltBuf?(a(),c.r=z,c.c=q,a()):F=1;else if("d"==E)N="move row "+z,c.isAltBuf?(a(),c.r=z,a()):F=1;else if("G"==E)N="move col "+z,c.isAltBuf?(c.c=z,a()):F=1;else if("?"==U&&D){N=(H?"SET":"RESET")+" ";var G=!1,W=!1;switch(z=parseInt(c.esc.s.substr(2))){case 1:N+="cursor keys mode";break;case 7:N+="vertical autowrap";break;case 12:N+="cursor bold";break;case 25:N+="cursor visible",(c.show_cursor=H)||c.isAltBuf?H&&c.isAltBuf&&c.altbuf_via_cursor_visible&&(W=!0):(G=!0,c.altbuf_via_cursor_visible=!0);break;case 1049:N+="alt screen buf",H&&!c.isAltBuf?(G=!0,c.altbuf_via_cup=!0):!H&&c.isAltBuf&&c.altbuf_via_cup&&(W=!0);break;default:N+="$UNKNOWN ="+z}if(G){0,c.alt_save=r.innerHTML.replace(/<pre><span class="cl-admin-console-cursor">.*<\/span><\/pre>$/,""),o(r);for(k=1;k<=c.rows;k++){c.dirty[k]=!1;try{for(E=1;E<=c.cols;E++)c.screen[k][E]=" ",c.color[k][E]={fg:null,bg:null}}catch(e){0}c.els[k]=n(r),c.els[k].innerHTML="&nbsp;"}console_is_char_oriented(!0),c.margin_set=!1,c.isAltBuf=!0}else W&&(c.altbuf_via_cursor_visible=!1,c.altbuf_via_cup=!1,r.innerHTML=c.alt_save,c.el=n(r),c.must_scroll_down=!0,console_is_char_oriented(),c.isAltBuf=!1)}else if("4"==U&&c.isAltBuf&&D)N=(c.insertMode=H)?"INSERT mode":"REPLACE mode";else if("X"==E&&c.isAltBuf){0==z&&(z=1);for(var Y=0,J=c.c;Y<z&&J<=c.cols;Y++,J++)c.screen[c.r][J]=" ",c.color[c.r][J]={fg:null,bg:null};a(),s(),N="erase "+z+" chars"}else if("P"==E){if(0==z&&(z=1),c.isAltBuf){var X=c.c;for(Z=c.c+z,Q=c.c;Z<=c.cols;Z++,Q++)c.screen[c.r][Q]=c.screen[c.r][Z],c.color[c.r][Q]=c.color[c.r][Z];for(;Q<c.cols;Q++)c.screen[c.r][Q]=" ",c.color[c.r][Q]={fg:null,bg:null};c.c=X,a(),s()}else{for(0,K=0;K<z;K++){for(var j=c.line.length,V=c.ccol;V<j;V++)c.line[V]=c.line[V+1];c.line[V]=null}0}N="del #"+z+" chars"}else if("@"==E){if(0==z&&(z=1),c.isAltBuf){var Z,Q,X=c.c;for(Z=c.cols-z,Q=c.cols;X<=Z;Z--,Q--)c.screen[c.r][Q]=c.screen[c.r][Z],c.color[c.r][Q]=c.color[c.r][Z];for(;X<=Q;Q--)c.screen[c.r][Q]=" ",c.color[c.r][Q]={fg:null,bg:null};c.c=X,a(),s()}else{for(0,K=0;K<z;K++)for(V=j=c.line.length;V>c.ccol;V--)c.line[V]=c.line[V-1];0}N="ins #"+z+" chars"}else"r"==E&&c.isAltBuf?(c.margin_top=z,c.margin_bottom=q,c.margin_set=!0,N="set margins, top="+z+", bottom="+q):"S"==E&&c.isAltBuf?(d(c.margin_top,c.margin_top+z,c.margin_bottom,1),w(c.r,c.margin_bottom,1,c.cols),c.insertMode=M,N="pan down "+z):"T"==E&&c.isAltBuf?(M=c.insertMode,c.insertMode=!1,d(c.margin_bottom,c.margin_top+z-1,c.margin_top,-1),w(c.margin_top,c.margin_top+z-1,1,c.cols),c.insertMode=M,N="pan up "+z):"M"==E&&c.isAltBuf?(M=c.insertMode,c.insertMode=!1,d(c.r,c.r+1,c.r+z,1),w(c.r+z,c.r+z,1,c.cols),c.insertMode=M,N="delete line(s) "+z):"t"==E?N="set lines per page "+z+" (ignored)":"A"==E?c.isAltBuf&&(1<c.r&&(a(),c.r--,a()),N="arrow up"):"B"==E?c.isAltBuf&&(c.r<c.rows&&(a(),c.r++,a()),N="arrow down"):"C"==E?(c.isAltBuf?c.c<c.cols&&(a(),c.c++):c.ccol<c.line.length&&c.ccol++,N="arrow right"):"D"==E?c.isAltBuf&&(1<c.c&&(a(),c.c--),N="arrow left"):N=2;else if("("==O)N="define char set";else switch(E){case"H":N="set horiz tab (nop)";break;case"M":c.isAltBuf&&(M=c.insertMode,c.insertMode=!1,d(c.margin_bottom,c.margin_bottom-1,c.margin_top,-1),w(c.margin_top,c.margin_top,1,c.cols),c.insertMode=M,N="scroll text down");break;case">":N="set numeric keypad";break;case"=":N="keypad application mode";break;case"7":N="save cursor";break;case"8":N="restore cursor";break;case"c":N="reset initial state (nop)";break;default:N=2}f(),F&&(N+=" UNEXPECTED ===================================================================================="),F=0,1===N||(2===N?console.log("> ESC "+kiwi_JSON(c.esc.s)+" $UNKNOWN ======================================================================================"):isString(N)),N=null,c.esc.state=c.NONE}}else" "<=E||"\n"==E||"\t"==E?c.isAltBuf||"<"!=E?c.isAltBuf||">"!=E?("\n"!=E&&(u(E),c.isAltBuf?l(E):(c.inc?(c.line[c.ccol]=E,c.ccol++):m(E),0)),F=c.ccol==c.cols,("\n"==E||F&&(!c.isAltBuf||c.isAltBuf&&c.eol_wrap))&&(v=w3_isScrolledDown(h),c.isAltBuf?(c.c=1,a(),c.r++,a(),c.r>c.rows&&(c.r=1)):(T=p(1).s,c.el.innerHTML=""==T?"&nbsp;":T,c.line=[],c.line_sgr=[],c.line_html=[],c.el=n(r),c.ccol=1),w3_contains(h,"w3-scroll-down")&&(!c.scroll_only_at_bottom||c.scroll_only_at_bottom&&v)&&w3_scrollDown(h))):(c.inc&&(u(">"),c.line[c.ccol]="&gt;",c.ccol+=c.inc),0):(c.inc&&(u("<"),c.line[c.ccol]="&lt;",c.ccol+=c.inc),0):c.isAltBuf||E!=kiwi.esc_lt?c.isAltBuf||E!=kiwi.esc_gt?c.isAltBuf:(u(">"),m(">"),c.inc=1):(u("<"),m("<"),c.inc=0)}v=w3_isScrolledDown(h),c.isAltBuf||(c.show_cursor?(y=p(1,c.ccol).s,x=p(c.ccol,c.ccol+1).a,i=p(c.ccol+1).s,x.length?(T=y,T+=x[0].sgr+x[0].html+_(x[0].ch),T+=i):T=y+_()):T=p(1).s,c.el.innerHTML=T),w3_contains(h,"w3-scroll-down")&&(!c.scroll_only_at_bottom||c.scroll_only_at_bottom&&v||c.must_scroll_down)&&(w3_scrollDown(h),c.must_scroll_down=!1),c.isAltBuf&&s(),f()}else console.log("kiwi_output_msg NOT_FOUND id="+e)}function gps_stats_cb(e,i,r,n,o,t){n=(e?"yes":"pause")+", track "+i+", good "+r+", fixes "+n.toUnits();w3_innerHTML("id-msg-gps","GPS: acquire "+n),w3_innerHTML("id-status-gps",w3_text(optbar_prefix_color,"GPS"),w3_text("","acq "+n)),extint_adc_clock_Hz=1e6*o,(extint_adc_gps_clock_corr=t)&&(n=o.toFixed(6)+" ("+t.toUnits()+" avgs)",(t=w3_el("id-msg-gps"))&&(t.innerHTML+=", ADC clock "+n),w3_innerHTML("id-status-adc",w3_text(optbar_prefix_color,"ADC clock "),w3_text("",n)))}function admin_stats_cb(e,i,r,n,o,t,s,_){if(null!=e){var a=w3_el("id-msg-errors");if(a&&(a.innerHTML="Stats: "+e.toUnits()+" dropped, "+i.toUnits()+" underruns, "+r.toUnits()+" sequence, "+n.toUnits()+" realtime"),a=w3_el("id-status-dp-hist")){for(var c="Datapump: ",l=0;l<o;l++)c+=(l?", ":"")+t[l].toUnits();a.innerHTML=c}if(a=w3_el("id-status-in-hist")){for(c="SoundInQ: ",l=0;l<s;l++)c+=(l?", ":"")+_[l].toUnits();a.innerHTML=c}}}function kiwi_too_busy(e){kiwi_show_msg("Sorry, the KiwiSDR server is too busy right now ("+e+' users max). <br>There is also a limit on the total number of channel queuers and campers. <br>Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.')}function kiwi_exclusive_use(){kiwi_show_msg('Sorry, this Kiwi has been locked for special use. <br>This happens when using an extension (e.g. DRM decoder) that requires all available resources. <br>Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide. <br><br>Áî≥„ÅóË®≥„ÅÇ„Çä„Åæ„Åõ„Çì„Åå„ÄÅ„Åì„ÅÆ„Ç≠„Éº„Ç¶„Ç£„ÅØÁâπÂà•„Å™‰ΩøÁî®„ÅÆ„Åü„ÇÅ„Å´„É≠„ÉÉ„ÇØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ <br>„Åì„Çå„ÅØ„ÄÅÂà©Áî®ÂèØËÉΩ„Å™„Åô„Åπ„Å¶„ÅÆ„É™„ÇΩ„Éº„Çπ„ÇíÂøÖË¶Å„Å®„Åô„ÇãÊã°ÂºµÊ©üËÉΩÔºàDRM „Éá„Ç≥„Éº„ÉÄ„Éº„Å™„Å©Ôºâ„Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„Å´Áô∫Áîü„Åó„Åæ„Åô„ÄÇ <br>‰∏ñÁïå‰∏≠„ÅßÂà©Áî®„Åß„Åç„Çã KiwiSDR „É¨„Ç∑„Éº„Éê„Éº„Å´„Å§„ÅÑ„Å¶„ÅØ„ÄÅ<a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> „ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ')}function kiwi_ip_limit_pwd_cb(e){console.log("kiwi_ip_limit_pwd_cb pwd="+e),writeCookie("iplimit",encodeURIComponent(e)),window.location.reload(!0)}function kiwi_show_error_ask_exemption_cb(e,i,r){kiwi_ip_limit_pwd_cb(i)}function kiwi_show_error_ask_exemption(e){kiwi_show_msg(e+="<br><br>If you have an exemption password from the KiwiSDR owner/admin <br> please enter it here: "+w3_input("w3-retain-input-focus w3-margin-TB-8/w3-label-inline w3-label-not-bold/kiwi-pw|padding:1px|size=40","Password:","id-epwd","","kiwi_show_error_ask_exemption_cb")),w3_field_select("id-epwd",{mobile:1})}function kiwi_inactivity_timeout(e){kiwi_show_msg("Sorry, this KiwiSDR has an inactivity timeout after "+e+" minutes.<br>Reload the page to continue.")}function kiwi_24hr_ip_limit(e,i){kiwi_show_error_ask_exemption("Sorry, this KiwiSDR can only be used for "+e+' minutes every 24 hours by each IP address.<br>Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.')}function kiwi_password_entry_timeout(){kiwi_show_msg("Timeout. Please reload page to continue.")}function kiwi_up(e){seriousError||(w3_hide("id-kiwi-msg-container"),w3_show_block("id-kiwi-container"),w3_el("id-kiwi-body").style.overflow="hidden")}function kiwi_down(e,i){kiwi_show_msg(1==(e=+e)?'Sorry, software update in progress. Please check back in a few minutes.<br>Or check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.':2==e?"Backup in progress.":i=null==i||""==i?'Sorry, this KiwiSDR server is being used for development right now. <br>Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.':i)}var stats_interval=1e4,need_config=!0;function stats_init(){need_config&&(msg_send("SET GET_CONFIG"),need_config=!1),stats_update()}function stats_update(){msg_send("SET STATS_UPD ch="+rx_chan);var e=new Date,e=Math.ceil(e/stats_interval)*stats_interval-e;e<stats_interval/2&&(e+=stats_interval),setTimeout(stats_update,e)}function status_periodic(){w3_innerHTML("id-status-stats-cpu",kiwi_cpu_stats_str),w3_innerHTML("id-status-stats-xfer",kiwi_xfer_stats_str),w3_innerHTML("id-msg-stats-cpu",kiwi_cpu_stats_str_long),w3_innerHTML("id-msg-stats-xfer",kiwi_xfer_stats_str_long)}var kiwi_xfer_stats_str="",kiwi_xfer_stats_str_long="";function xfer_stats_cb(e,i,r,n,o){kiwi_xfer_stats_str=w3_text(optbar_prefix_color,"Net")+w3_text("","aud "+e.toFixed(0)+", wf "+i.toFixed(0)+", http "+n.toFixed(0)+", total "+o.toFixed(0)+" kB/s"),kiwi_xfer_stats_str_long="Network (all channels): audio "+e.toFixed(0)+" kB/s, waterfall "+i.toFixed(0)+" kB/s ("+r.toFixed(0)+" fps), http "+n.toFixed(0)+" kB/s, total "+o.toFixed(0)+" kB/s ("+(8*o).toFixed(0)+" kb/s)"}var kiwi_cpu_stats_str="",kiwi_cpu_stats_str_long="",kiwi_config_str="",kiwi_config_str_long="";function cpu_stats_cb(e,i,r,n){l%=100;var o=e.cc||0,t=9*o/5+32,s=e.cc?60<=e.cc?"w3-text-css-red w3-bold":50<=e.cc?"w3-text-css-yellow":"w3-text-css-lime":"",_=o?o.toFixed(0)+"&deg;C "+t.toFixed(0)+"&deg;F ":"",t=1e3<=e.cf?(e.cf/1e3).toFixed(1)+" GHz":e.cf.toFixed(0)+" MHz";kiwi_cpu_stats_str=w3_text(optbar_prefix_color,"BB ")+w3_text("",e.cu[0]+","+e.cs[0]+","+e.ci[0]+" usi% ")+(o?w3_text(s,_):"")+w3_text("",t+" ")+w3_text(optbar_prefix_color,"FPGA")+w3_text("",r.toFixed(0)+"%"),kiwi.wf_fps=n;for(var a="",c="",l="",d=!0,w=0;w<e.cu.length;w++)a+=(d?"":" ")+e.cu[w]+"%",c+=(d?"":" ")+e.cs[w]+"%",l+=(d?"":" ")+e.ci[w]+"%",d=!1;var u="cpu";if(1<e.cu.length){u+="0";for(w=1;w<e.cu.length;w++)u+=" cpu"+w}kiwi_cpu_stats_str_long=w3_inline("",w3_text("w3-text-black","Beagle: "+u+" "+a+" usr | "+c+" sys | "+l+" idle,"+(o?"":" "))+(o?"&nbsp;"+w3_text(s+" w3-text-outline w3-large",_)+"&nbsp;":"")+w3_text("w3-text-black",t+", ")+w3_text("w3-text-black","FPGA eCPU: "+r.toFixed(0)+"%"));s=i,_=Math.trunc(s%60),s=Math.trunc(s/60),t=Math.trunc(s%60);s=Math.trunc(s/60);r=Math.trunc(s%24),i=s=Math.trunc(s/24),s=" ";i&&(s+=i+"d:"),s+=r+":"+t.leadingZeros(2)+":"+_.leadingZeros(2),w3_innerHTML("id-status-config",w3_text(optbar_prefix_color,"Up"),w3_text("",s+", "+kiwi_config_str)),s=" | Uptime: ",i&&(s+=i+" "+(1<i?"days":"day")+" "),s+=r+":"+t.leadingZeros(2)+":"+_.leadingZeros(2);_=""==server_time_local||"null"==server_time_tzname;server_time_utc&&(s+=" | UTC: "+server_time_utc),isDefined(server_time_tzname)&&(s+=" | Local: ",_||(s+=server_time_local+" "),s+=_?"Lat/lon needed for local time":server_tz),w3_innerHTML("id-msg-config",kiwi_config_str_long+s)}function config_str_update(e,i,r,n){kiwi_config_str="v"+r+"."+n+", "+e+" SDR ch, "+i+" GPS ch",w3_innerHTML("id-status-config",kiwi_config_str),kiwi_config_str_long="Config: v"+r+"."+n+", "+e+" SDR channels, "+i+" GPS channels",w3_innerHTML("id-msg-config",kiwi_config_str)}var config_net={};function config_cb(e,i,r,n,o,t,s,_,a,c,l){config_str_update(e,i,c,l);l=w3_el("id-net-config");l&&(l.innerHTML=w3_div("",w3_col_percent("",w3_div("","Public IP address (outside your firewall/router): "+n+" [port "+o+"]"),50,w3_div("","Ethernet MAC address: "+a.toUpperCase()),30,w3_div("","KiwiSDR serial number: "+r),20),w3_col_percent("",w3_div("","Private IP address (inside your firewall/router): "+t+" [port "+s+"]"),50,w3_div("","Private netmask: /"+_),50)),config_net.pub_ip=n,config_net.pub_port=o,config_net.pvt_ip=n,config_net.pvt_port=s,config_net.mac=a,config_net.serno=r)}function update_cb(e,i,r,n,o,t,s,_,a,c,l){config_str_update(n,o,t,s);o=w3_el("id-msg-update");if(o){var d,l="Installed version: v"+t+"."+s+", built "+c+" "+l;if(e){switch(e){case 1:d="Filesystem is FULL!";break;case 2:d="No Internet connection? (can't ping 1.1.1.1 or 8.8.8.8)";break;case 3:d="No connection to github.com?";break;case 4:d="Git clone damaged!";break;case 5:d="Makefile update failed -- check /root/build.log file";break;case 6:d="Build failed, check /root/build.log file";break;default:d="Unknown reason, code="+e}l+="<br>"+d,w3_hide("id-build-restart"),w3_hide("id-build-reboot")}else l+=r?"<br>Update to version v"+ +_+"."+a+" in progress":i?"<br>Update check pending":-1==_?"<br>Error determining the latest version -- check log":t==_&&s==a?"<br>Running most current version":"<br>Available version: v"+_+"."+a;o.innerHTML=l}}var users_interval=2500,user_init=!1;function users_init(e){if(kiwi.called_from_admin=e.admin,kiwi.called_from_user=e.user,kiwi.called_from_monitor=e.monitor,kiwi.called_from_admin||kiwi.called_from_monitor)for(var i,r=kiwi.called_from_admin?"id-admin-user-":"id-monitor-user-",n=kiwi.called_from_monitor?" w3-padding-LR-2":"",o="",t=0;t<rx_chans;t++)kiwi.called_from_admin&&(o=w3_button("id-user-kick-"+t+" w3-hide w3-small w3-white w3-border w3-border-red w3-round-large w3-padding-0 w3-padding-LR-8","Kick","status_user_kick_cb",t)),i=w3_div("id-campers-"+t+" w3-css-orange w3-padding-LR-8"),w3_el("id-users-list").innerHTML+=w3_inline("/w3-hspace-8",w3_div("id-user-"+t+n,"RX"+t),w3_div(r+t),o,i);users_update(),w3_call("users_setup"),user_init=!0}function users_update(){msg_send("SET GET_USERS"),setTimeout(users_update,users_interval)}function user_cb(e){var k=kiwi.called_from_admin?"id-admin-user-":"id-monitor-user-",b=kiwi_url_origin();e.forEach(function(e){var i="",r="",n=e.i,o=e.n,t=e.f,s=e.g,_=isDefined(e.a)&&""!=e.a?e.a+", ":"",a=e.m,c=e.z,l=e.t,d="";e.rt&&(p=1==e.rt?" act":" 24h",d=" "+w3_text("w3-text-css-orange|vertical-align:bottom",e.rs+p));var w,u=e.e;if(isDefined(o)){var f,m=!1;do{try{f=decodeURIComponent(o),m=!0}catch(e){o=o.slice(0,-1)}}while(!m);var p=kiwi_strip_tags(f,"");""!=(p=!kiwi.called_from_admin&&""==p?"(no identity)":p)&&(p='"'+p+'"');var g,s="(null)"==s||""==s?kiwi.called_from_admin?"unknown location":"":decodeURIComponent(s),s=""!=(_=_.replace(/::ffff:/,""))||""!=s?"("+_+s+")":"",_=t+kiwi.freq_offset_Hz,_=(_=(_/1e3).toFixed(1e8<_?1:2))+" kHz ",t=(t/1e3).toFixed(2);kiwi.called_from_admin?g=b+"/?f="+t+a+"z"+c:g="javascript:"+(kiwi.called_from_user?"tune("+t+","+sq(a)+","+c+")":"camp("+n+")");""!=u&&(u=decodeURIComponent(u)+" "),i=w3_sb(p,s)+" ",r=w3_link("w3-link-darker-color",g,_+(e.wf?"WF":a)+" z"+c)+" "+u+l+d}user_init&&(kiwi.called_from_user?w3_innerHTML("id-optbar-user-"+n,""!=i?i+"<br>"+r:""):(w3_innerHTML(k+n,i+r+""),w3_hide2("id-user-kick-"+n,""==i),w3_hide2("id-user-bl32-"+n,""==i),w3_hide2("id-user-bl24-"+n,""==i))),n!=rx_chan||!isDefined(e.c)||(i=w3_el("id-sam-carrier"))&&w3_innerHTML(i,"carrier "+e.c.toFixed(1)+" Hz"),w3_innerHTML("id-campers-"+n,e.ca?e.ca+plural(e.ca," camper"):""),n==rx_chan&&e.rn&&e.rn<=55&&!kiwi.inactivity_panel&&(w=1==e.rt?"Inactivity timeout in one minute.<br>Close this panel to avoid disconnection.":"Per 24-hour connection timeout in one minute.",confirmation_show_content(w,360,55,function(){msg_send("SET inactivity_ack"),confirmation_panel_close(),kiwi.inactivity_panel=!1},"red"),kiwi.inactivity_panel=!0),n==rx_chan&&55<e.rn&&kiwi.inactivity_panel&&(confirmation_panel_close(),kiwi.inactivity_panel=!1),n==rx_chan&&isNumber(e.fo)&&e.fo!=kiwi.freq_offset_kHz&&!confirmation.displayed&&(w=w3_div("","Frequency scale offset changed. Page must be reloaded.",w3_inline("w3-halign-space-around/",w3_button("w3-margin-T-16 w3-aqua","OK","freq_offset_page_reload"))),confirmation_show_content(w,425,100)),n==rx_chan&&isNumber(e.nc)&&e.nc!=rx_chan&&isNumber(e.ns)&&e.ns!=kiwi.notify_seq&&(console.log("$ NOTIFY sn="+e.ns),msg_send("SET notify_msg"),kiwi.notify_seq=e.ns)})}function freq_offset_page_reload(){window.location.reload(!0)}var toggle_e={SET:1,SET_URL:2,FROM_COOKIE:4,WRITE_COOKIE:8,NO_CLOSE_EXT:16};function kiwi_toggle(e,i,r,n){var o=null;return e&toggle_e.SET_URL&&(null!=i||null!=i)?o=i:e&toggle_e.FROM_COOKIE&&null!=(o=readCookie(n))&&(n=parseFloat(o),isNaN(n)||(o=n)),o=null==(o=null==o&&e&toggle_e.SET?i:o)?r:o}function kiwi_fft_mode(){setmaxdb(-30)}function kiwi_mapPinSymbol(e,i){return{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z",fillColor:e=e||"red",fillOpacity:1,strokeColor:i=i||"white",strokeWeight:1,scale:1}}function isAdmin(){return 0!=Object.keys(adm).length}function kiwi_force_admin_close_cb(e,i,r){r||(i=+i,ext_send("SET close_admin_force"),confirmation_panel_close(),kiwi.no_admin_conns_pend=0,i?setTimeout(function(){dx_send_update_retry()},1e3):setTimeout(function(){cfg_save_json("kiwi_force_admin_close_cb","adm")},1e3))}function kiwi_set_freq_offset(e){kiwi.isOffset=0!=e,kiwi.freq_offset_kHz=e,kiwi.freq_offset_Hz=1e3*e,kiwi.offset_frac=e%1e3*1e3}var chan_no_pwd,chan_no_pwd_true,client_public_ip,reason_disabled="",version_maj=-1,version_min=-1,debian_ver=-1,tflags={INACTIVITY:1,WF_SM_CAL:2,WF_SM_CAL2:4},kiwi_output_msg_p={scroll_only_at_bottom:!0,process_return_alone:!1};function kiwi_msg(e,i){var r,n=!0;switch(e[0]){case"version_maj":version_maj=parseInt(e[1]);break;case"version_min":version_min=parseInt(e[1]);break;case"debian_ver":debian_ver=parseInt(e[1]);break;case"client_public_ip":client_public_ip=e[1].replace(/::ffff:/,""),console.log("client public IP: "+client_public_ip);break;case"badp":extint_valpwd_cb(parseInt(e[1]));break;case"chan_no_pwd":chan_no_pwd=parseInt(e[1]);break;case"chan_no_pwd_true":chan_no_pwd_true=parseInt(e[1]);break;case"rx_chans":rx_chans=parseInt(e[1]);break;case"wf_chans":wf_chans=parseInt(e[1]);break;case"wf_chans_real":wf_chans_real=parseInt(e[1]);break;case"rx_chan":rx_chan=parseInt(e[1]);break;case"max_camp":max_camp=parseInt(e[1]);break;case"load_cfg":var o=decodeURIComponent(e[1]);console.log("### load_cfg "+i.stream+" "+o.length),kiwi_set_freq_offset((cfg=kiwi_JSON_parse("load_cfg",o)).freq_offset),owrx_cfg();break;case"load_adm":var t=decodeURIComponent(e[1]);console.log("### load_adm "+i.stream+" "+t.length),adm=kiwi_JSON_parse("load_adm",t);break;case"no_admin_conns":t=parseInt(e[1]);kiwi.no_admin_conns_pend++,1==kiwi.no_admin_conns_pend&&(confirmation_panel_close(),confirmation_show_content("Must close all admin connections before attempting this operation."+w3_button("w3-small w3-padding-smaller w3-yellow w3-margin-T-8","Close all admin connections and complete original operation","kiwi_force_admin_close_cb",t),500,75,function(){confirmation_panel_close(),kiwi.no_admin_conns_pend=0},"red"));break;case"foff_error":kiwi.foff_error_pend++,1==kiwi.foff_error_pend&&setTimeout(function(){confirmation_panel_close(),confirmation_show_content(0==+e[1]?'"foff=" URL parameter available from local connections only.':'Must close all admin connections before using "foff=" URL parameter.',500,55,function(){confirmation_panel_close(),kiwi.foff_error_pend=0},"red")},5e3);break;case"request_dx_update":isAdmin()?dx.ignore_dx_update?dx.ignore_dx_update=!1:dx_update_admin():dx_update_request();break;case"mkr":var s=e[1];(s=kiwi_JSON_parse("mkr",s))&&dx_label_cb(s);break;case"user_cb":(s=kiwi_JSON_parse("user_cb",e[1]))&&user_cb(s);break;case"config_cb":(r=kiwi_JSON_parse("config_cb",e[1]))&&config_cb(r.r,r.g,r.s,r.pu,r.pe,r.pv,r.pi,r.n,r.m,r.v1,r.v2,r.ai);break;case"update_cb":(r=kiwi_JSON_parse("update_cb",e[1]))&&update_cb(r.f,r.p,r.i,r.r,r.g,r.v1,r.v2,r.p1,r.p2,decodeURIComponent(r.d),decodeURIComponent(r.t));break;case"stats_cb":(r=kiwi_JSON_parse("stats_cb",e[1]))&&(null!=r.ce&&cpu_stats_cb(r,r.ct,r.ce,r.fc),xfer_stats_cb(r.ac,r.wc,r.fc,r.ah,r.as),extint.srate=r.sr,extint.nom_srate=r.nsr,gps_stats_cb(r.ga,r.gt,r.gg,r.gf,r.gc,r.go),r.gr&&(kiwi.WSPR_rgrid=decodeURIComponent(r.gr),kiwi.GPS_fixes=r.gf),-1==r.sh?(w3_innerHTML("id-rx-snr",", SNR ",r.sa," dB"),w3_innerHTML("id-msg-snr","SNR: All ",r.sa," dB")):(w3_innerHTML("id-rx-snr",", SNR ",r.sa,":",r.sh," dB"),w3_innerHTML("id-msg-snr","SNR: All ",r.sa," dB, HF ",r.sh," dB")),admin_stats_cb(r.ad,r.au,r.ae,r.ar,r.an,r.ap,r.an2,r.ai),w3_call("config_status_cb",r),time_display_cb(r));break;case"status_msg_text":kiwi_output_msg_p.s=e[1],kiwi_output_msg("id-output-msg","id-output-msg",kiwi_output_msg_p);break;case"status_msg_html":var _=kiwi_decodeURIComponent("status_msg_html",e[1]);w3_innerHTML("id-status-msg",_),w3_innerHTML("id-msg-status",_);break;case"is_admin":extint.isAdmin_cb(e[1]);break;case"is_local":var a=e[1].split(",");console.log("kiwi_msg rx_chan="+a[0]+" is_local="+a[1]),kiwi.is_local[+a[0]]=+a[1];break;case"no_admin_reopen_retry":admin.no_admin_reopen_retry=!0;break;case"is_multi_core":kiwi.is_multi_core=1;break;case"authkey_cb":extint_authkey_cb(e[1]);break;case"down":kiwi_down(e[1],reason_disabled);break;case"too_busy":kiwi_too_busy(parseInt(e[1]));break;case"monitor":kiwi_monitor();break;case"exclusive_use":kiwi_exclusive_use();break;case"inactivity_timeout":kiwi_inactivity_timeout(e[1]);break;case"ip_limit":a=decodeURIComponent(e[1]).split(",");kiwi_24hr_ip_limit(parseInt(a[0]),a[1]);break;case"password_timeout":kiwi_password_entry_timeout();break;case"reason_disabled":reason_disabled="User connections disabled."+(""!=e[1]?" Reason: "+kiwi_decodeURIComponent("reason_disabled",e[1]):"");break;case"sample_rate":extint.srate=parseFloat(e[1]);break;case"pref_import_ch":kiwi.prefs_import_ch=+e[1];break;case"pref_import":prefs_import_cb(e[1],kiwi.prefs_import_ch);break;case"adc_clk_nom":extint_adc_clock_nom_Hz=+e[1];break;case"notify_msg":_=kiwi_decodeURIComponent("notify_msg",e[1]);if(console.log("notify_msg: "+_),confirmation.displayed)break;_=w3_div("",_),confirmation_show_content(_,425,50),setTimeout(confirmation_panel_close,3e3);break;case"kiwi_kick":_=e[1]+(""!=cfg.reason_kicked?"<br>Reason: "+cfg.reason_kicked:"");if(_=kiwi_decodeURIComponent("kiwi_kick",_),confirmation.displayed)break;_=w3_div("",_),confirmation_show_content(_,425,75,null,"red");break;default:n=!1}return n}function kiwi_debug(e){console.log(e),msg_send("SET dbug_msg="+encodeURIComponent(e))}function kiwi_show_msg(e){""==(html("id-kiwi-msg").innerHTML=e)?(w3_hide("id-kiwi-msg-container"),w3_el("id-kiwi-body").style.overflow="hidden"):(w3_hide("id-kiwi-container"),w3_show_block("id-kiwi-msg-container"),w3_el("id-kiwi-body").style.overflow="scroll")}function kiwi_server_error(e){kiwi_show_msg('Hmm, there seems to be a problem. <br>The server reported the error: <span style="color:red">'+e+"</span>"),seriousError=!0}function kiwi_serious_error(e){kiwi_show_msg(e),seriousError=!0,console.log(e)}function kiwi_trace(e){e&&console.log("kiwi_trace: "+e);try{console.trace()}catch(e){}}function kiwi_trace_mobile(e){alert(e+" "+Error().stack)}



