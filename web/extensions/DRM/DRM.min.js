

/* web/extensions/DRM/DRM.min.js */
var drm={ext_name:"DRM",first_time:!0,active:!1,url:"http://DRM.kiwisdr.com/drm/",special_passband:null,dseq:0,locked:0,wrong_srate:!1,hacked:!1,n_menu:5,menu0:W3_SELECT_SHOW_TITLE,menu1:W3_SELECT_SHOW_TITLE,menu2:W3_SELECT_SHOW_TITLE,menu3:W3_SELECT_SHOW_TITLE,menu4:W3_SELECT_SHOW_TITLE,run:0,is_stopped:0,is_monitor:0,freq_s:"",freq:0,w_graph_nom:675,w_graph_min:400,panel_0:["info","info","info","info","info","info"],panel_1:["by-svc","graph","IQ","IQ","IQ","IQ"],SCHED0:0,GRAPH0:1,IQ_ALL:2,FAC:3,SDC:4,MSC:5,IQ_END:5,display_idx:1,display_idx_s:["schedule","graph","iq"],display_idx_si:[1,3,5],display_s:{Schedule:[{m:"by service"}],Display:[{m:"IF/SNR",c:"graph"}],IQ:[{m:"all",c:"IQ"},{m:"FAC",c:"IQ"},{m:"SDC",c:"IQ"},{m:"MSC",c:"IQ"}]},stations:null,using_default:!1,double_fault:!1,loading_msg:"&nbsp;loading data from kiwisdr.com ...",SINGLE:0,MULTI:1,REGION:2,SERVICE:3,monitor:0,monitor_s:["DRM","source"],last_occ:-1,last_ilv:-1,last_sdc:-1,last_msc:-1,DRM_DAT_IQ:0,EAudCod:["AAC","OPUS","RESERVED","xHE_AAC",""],AAC:0,xHE_AAC:3,europe:{"BBC\\Worldservice":[3955,15620],"Radio\\France Intl":[3965,6175],"Voice of\\Russia":[5925,6025,6110,6125,7435,9590,9625,9800,11620,11860,15325],"Radio\\Romania Intl":[5940,5955,6025,6030,6040,6175,7220,7235,7350,9490,9820,13730],"Funklust\\(bitXpress)":[15785]},middle_east_africa:{"All India\\Radio":[6100,7550,9950],"Radio Kuwait":[11970,13650,15110,15540],"Voice of\\Nigeria":[15120]},asia_pac:{"China National\\Radio":[6030,7360,9420,9655,9870,11695,13825,15180,17770,17800,17830],"Radio\\New Zealand":[5975,7285,7330,9780,11690],"Transworld\\KTWR":[7500,11995,13800]},americas:{"WINB USA":[7315,9265,13690]},menu_India_MW:4,india_MW:{Ahmedabad:[855],Ajmer:[612],Bengaluru:[621],Barmer:[1467],Bikaner:[1404],"Chennai A":[729],"Chennai B":[783],Chinsurah:[603],"Delhi A":[828],"Delhi B":[1368],Dharwad:[774],Dibrugarh:[576],"Guwahati B":[1044],Hyderabad:[747],Itanagar:[684],Jabalpur:[810],Jalandhar:[882],Jammu:[999],"Kolkata A":[666],"Kolkata B":[1017],Luknow:[756],"Mumbai A":[1053],"Mumbai B":[567],Panaji:[1296],Passighat:[1071],Patna:[630],Pune:[801],"Rajkot A":[819],"Rajkot B":[1080],"Rajkot C":[1071],Ranchi:[558],Siliguri:[720],Suratgarh:[927],Tawang:[1530],Trichirapalli:[945],Varanasi:[1251],Vijayawada:[846]},last_last:0};function DRM_main(){ext_switch_to_client(drm.ext_name,drm.first_time,drm_recv),drm.first_time||drm_lock_setup(),drm.first_time=!1}function drm_recv(e){var r,d;if("DAT"!=arrayBufferToStringLen(e,3)){var t=arrayBufferToString(e).substring(4).split(" ");for(r=0;r<t.length;r++){var s=t[r].split("=");switch(s[0]){case"ready":kiwi_load_js(["pkgs/js/graph.js","pkgs/js/sprintf/sprintf.js"],"drm_lock_setup");break;case"inuse":drm.inuse=+s[1];break;case"heavy":drm.heavy=+s[1];break;case"locked":var n=+s[1];-1==n?(drm.wrong_srate=!0,drm.locked=0):-2==n?(drm.hacked=!0,drm.locked=0):drm.locked=1==n?1:0,drm_controls_setup();break;case"drm_status_cb":if(!drm.run||!drm.desktop)break;var a,i;try{a=decodeURIComponent(s[1])}catch(e){console.log("DRM decodeURIComponent(param) FAIL:"),console.log(e),console.log(s[1]);break}try{i=JSON.parse(a)}catch(e){console.log("DRM JSON.parse(deco) FAIL:"),console.log(e),console.log(a);break}drm_all_status(i.io,i.time,i.frame,i.FAC,i.SDC,i.MSC),w3_innerHTML("id-drm-if_level","IF Level: "+i.if.toFixed(1)+" dB"),i.if<0&&i.if>-100&&(isUndefined(drm.last_if)&&(drm.last_if=i.if),drm.last_if=graph_plot(drm.gr_if,i.if,{line:drm.last_if,color:"green"})),w3_innerHTML("id-drm-snr",i.snr?"SNR: "+i.snr.toFixed(1)+" dB":""),i.snr>0&&(isUndefined(drm.last_snr)&&(drm.last_snr=i.snr),drm.last_snr=graph_plot(drm.gr_snr,i.snr,{line:drm.last_snr})),isDefined(i.mod)?((r=i.mod)>=0&&r<=3&&w3_color("id-drm-mod-"+["A","B","C","D"][r],"black","lime"),(r=i.occ)>=0&&r<=5&&(drm.last_occ!=r&&w3_color("id-drm-occ-"+["4.5","5","9","10","18","20"][drm.last_occ],"",""),w3_color("id-drm-occ-"+["4.5","5","9","10","18","20"][r],"black","lime"),drm.last_occ=r),(r=i.ilv)>=0&&r<=1&&(drm.last_ilv!=r&&w3_color("id-drm-ilv-"+["L","S"][drm.last_ilv],"",""),w3_color("id-drm-ilv-"+["L","S"][r],"black","lime"),drm.last_ilv=r),(r=i.sdc)>=0&&r<=1&&(drm.last_sdc!=r&&w3_color("id-drm-sdc-"+["4","16"][drm.last_sdc],"",""),w3_color("id-drm-sdc-"+["4","16"][r],"black","lime"),drm.last_sdc=r),(r=i.msc)>2&&(r=2),r>=1&&r<=2&&(drm.last_msc!=r&&w3_color("id-drm-msc-"+["16","64"][drm.last_msc-1],"",""),w3_color("id-drm-msc-"+["16","64"][r-1],"black","lime"),drm.last_msc=r),w3_innerHTML("id-drm-prot",sprintf("Protect: A=%d B=%d",i.pla,i.plb)),w3_innerHTML("id-drm-nsvc",sprintf("Services: A=%d D=%d",i.nas,i.nds)),i.mod>=0&&i.mod<=3&&w3_innerHTML("id-drm-desc",["Local/regional use","Medium range use, multipath resistant","Long distance use, multipath/doppler resistant","Resistance to large delay/doppler spread"][i.mod])):drm_reset_status(),w3_show_hide("id-drm-mode",isDefined(i.mod));var o=drm.AAC;i.svc.forEach(function(e,r){if(d=++r,e.id){var t=kiwi_clean_html(kiwi_clean_newline(decodeURIComponent(e.lbl)));d+=" "+drm.EAudCod[e.ac]+" ("+e.id+") "+t+(e.ep?" UEP ("+e.ep.toFixed(1)+"%) ":" EEP ")+(e.ad?"Audio ":"Data ")+e.br.toFixed(2)+" kbps"}var s=w3_el("id-drm-svc-"+r);s.innerHTML=d,w3_color(s,null,e.cur?"mediumSlateBlue":""),e.cur&&e.ac<4&&(o=e.ac)}),w3_show("id-drm-svcs"),o!=drm.AAC&&o!=drm.xHE_AAC&&console.log("codec="+o),w3_innerHTML("id-drm-error",o!=drm.AAC&&o!=drm.xHE_AAC?"WARNING: codec not supported -- audio will be bad":"<br>"),w3_color("id-drm-error","white","red",o!=drm.AAC&&o!=drm.xHE_AAC),w3_innerHTML("id-drm-msgs",i.msg?kiwi_clean_html(kiwi_clean_newline(decodeURIComponent(i.msg))):"");break;case"drm_bar_pct":if(!drm.run)break;var _=w3_clamp(parseInt(s[1]),0,100),m=w3_el("id-drm-bar");m&&(m.style.width=_+"%");break;case"annotate":switch(+s[1]){case 0:drm_annotate("lime");break;case 1:drm_annotate("gold");break;case 2:drm_annotate("red");break;case 3:drm_annotate("blue")}break;default:console.log("drm_recv: UNKNOWN CMD "+s[0])}}}else{var l=new Uint8Array(e,4)[0],c=new Uint8Array(e,5),p=c.length-1;if(isUndefined(drm.canvas_IQ))return;var w=drm.canvas_IQ.ctx,h=drm.w_IQ,u=drm.h_IQ;switch(l){case drm.DRM_DAT_IQ:if(w.fillStyle="white",w.fillRect(0,0,h,u),w.fillStyle="grey",w.fillRect(0,u/2,h,1),w.fillRect(h/2,0,1,u),drm.display==drm.IQ_ALL||drm.display==drm.FAC)for(w.fillStyle="green",r=0;r<64;r++){var b=c[2*r]/255*h,f=c[2*r+1]/255*u;w.fillRect(b,f,2,2)}if(r=64,drm.display==drm.IQ_ALL||drm.display==drm.SDC)for(w.fillStyle="red";r<320;r++){b=c[2*r]/255*h,f=c[2*r+1]/255*u;w.fillRect(b,f,2,2)}if(r=320,drm.display==drm.IQ_ALL||drm.display==drm.MSC)for(w.fillStyle="blue";r<2368;r++){b=c[2*r]/255*h,f=c[2*r+1]/255*u;w.fillRect(b,f,2,2)}return}console.log("drm_recv: DATA UNKNOWN cmd="+l+" len="+p)}}function drm_annotate(e){graph_annotate(drm.gr_if,e),graph_annotate(drm.gr_snr,e)}function drm_reset_status(){drm_all_status(4,4,4,4,4,4),w3_innerHTML("id-drm-if_level",""),w3_innerHTML("id-drm-snr",""),w3_hide("id-drm-mode");for(var e=0;e<=3;e++)w3_color("id-drm-mod-"+["A","B","C","D"][e],"","");w3_innerHTML("id-drm-error",""),w3_hide("id-drm-svcs"),w3_innerHTML("id-drm-msgs","")}function drm_status(e,r){var d;switch(r){case 0:d="lime";break;case 1:d="yellow";break;case 2:d="red";break;case 3:default:d="red";break;case 4:d="grey"}w3_color("id-drm-status-"+e,d)}function drm_all_status(e,r,d,t,s,n){drm_status("io",e),drm_status("time",r),drm_status("frame",d),drm_status("fac",t),drm_status("sdc",s),drm_status("msc",n)}function drm_lock_setup(){ext_send("SET lock_set")}function drm_saved_mode(){drm.saved_mode=ext_get_mode(),console.log("drm_save_mode FIRST saved_mode="+drm.saved_mode),"drm"==drm.saved_mode&&(drm.saved_mode=ext_get_prev_mode()),console.log("drm_save_mode FINAL saved_mode="+drm.saved_mode)}function drm_tscale(e){var r=drm.mobile?.3:.35,d=drm.mobile?.026:.025;return(r*drm.w_sched+e*d*drm.w_sched).toFixed(0)}function drm_schedule_static(){for(var e="",r=0;r<=24;r++)e+=w3_div(sprintf("id-drm-sched-tscale|left:%spx;",drm_tscale(r)));return e+=w3_div(sprintf("id-drm-sched-now|left:%spx;",drm_tscale(kiwi_UTC_minutes()/60))),drm.interval=setInterval(function(){w3_el("id-drm-sched-now").style.left=px(drm_tscale(kiwi_UTC_minutes()/60))},6e4),e}function drm_set_freq_menu(e,r){var d=isArg(r);r=d?r.toLowerCase():null;for(var t=!1,s=0;s<drm.n_menu;s++){var n,a="drm.menu"+s;if(w3_select_enum(a,function(s){s.disabled&&(n=s.innerHTML.toLowerCase());var i=parseFloat(s.innerHTML);isNaN(i)||t||parseFloat(s.innerHTML)!=e||r&&!r.includes(n)||(drm_pre_select_cb(a,s.value,!1,d),t=!0)}),t)break}t||drm_set_freq(e)}function drm_click(e){var r=drm.stations[e];if(console.log("drm_click "+r.f+" "+dq(r.s.toLowerCase())+" "+(r.u?r.u:"")),drm.special_passband=null,r.u){var d=new RegExp("^.*?f=/([-0-9.k]*)?,?([-0-9.k]*)?.*$").exec(r.u);console.log(d),d&&3==d.length&&(drm.special_passband={low:d[1].parseFloatWithUnits("k"),high:d[2].parseFloatWithUnits("k")})}console.log("special_passband:"),console.log(drm.special_passband),drm_set_freq_menu(r.f,r.s)}function drm_schedule(){if(drm.stations){var e,r=drm.using_default?w3_div("w3-yellow w3-padding w3-show-inline-block","can't contact kiwisdr.com<br>using default data"):"",d=drm.narrow_listing;for(e=0;e<drm.stations.length;e++){var t=drm.stations[e];if(t.t!=drm.REGION){for(var s=t.s,n=t.f,a=t.u,i="";e<drm.stations.length&&t.s==s&&t.f==n;){var o=drm_tscale(t.b),_=drm_tscale(t.e);i+=w3_div(sprintf('id-drm-sched-time %s|left:%spx; width:%spx;|title="%s"; onclick="drm_click(%d);"',t.v?"w3-light-green":"",o,(_-o+2).toFixed(0),n.toFixed(0),e)),e++,t=drm.stations[e]}e--,s=s.replace("_",d?"<br>":" "),d&&(s=s.replace(",","<br>")),a&&(s=w3_link("w3-link-darker-color",a,s)),r+=w3_inline("cl-drm-sched-station cl-drm-sched-striped/",w3_div("",s+"&nbsp;&nbsp;&nbsp;"+(d?"<br>":"")+n),i),t&&t.t==drm.SERVICE&&(r+=w3_div("cl-drm-sched-hr-div cl-drm-sched-striped",'<hr class="cl-drm-sched-hr">'),e++)}}return r}}function drm_get_stations_cb(e){var r,d,t,s,n,a,i,o=!1;if(e?e.AJAX_error&&"timeout"==e.AJAX_error?(console.log("drm_get_stations_cb: TIMEOUT"),drm.using_default=!0,o=!0):isArray(e)||(console.log("drm_get_stations_cb: not array"),o=!0):(console.log("drm_get_stations_cb: stations="+e),o=!0),o){if(drm.double_fault)return void console.log("drm_get_stations_cb: default station list fetch FAILED");console.log(e);var _=kiwi_url_origin()+"/extensions/DRM/stations.cjson";return console.log("drm_get_stations_cb: using default station list "+_),drm.using_default=!0,drm.double_fault=!0,void kiwi_ajax(_,"drm_get_stations_cb",0,1e4)}drm.stations=[];var m=!1;e.forEach(function(e,o){a="",w3_obj_enum(e,function(o,l){var c=e[o];if(0==l)return"India MW"==(r=o)&&(a="India, ",m=!0),void drm.stations.push({t:drm.REGION,f:0,s:"",r:r});if(isArray(c)){for(d=a+o,_=null,l=0;l<c.length;l++){var p=c[l];if(0==l&&isString(p))_=p;else if(t=p,p=c[++l],isArray(p))for(var w=0;w<p.length;w++)s=p[w++],n=p[w],i=s<0||n<0,s=Math.abs(s),n=Math.abs(n),drm.stations.push({t:drm.MULTI,f:t,s:d,r:r,b:s,e:n,v:i,u:_});else s=c[l++],n=c[l],i=s<0||n<0,s=Math.abs(s),n=Math.abs(n),drm.stations.push({t:drm.SINGLE,f:t,s:d,r:r,b:s,e:n,v:i,u:_})}m||drm.stations.push({t:drm.SERVICE,f:0,s:d,r:r})}})}),console.log(drm.stations),w3_innerHTML("id-drm-panel-by-svc",drm_schedule())}function drm_panel_show(e,r){var d=w3_div("id-drm-controls w3-text-white",w3_divs("w3-container/",w3_col_percent("",w3_div("w3-medium w3-text-aqua","<b>Digital Radio Mondiale (DRM30) decoder</b>"),60,w3_div("",'Based on <b><a href="https://sourceforge.net/projects/drm/" target="_blank">Dream 2.2.1</a></b>'),40),w3_col_percent("w3-margin-T-4/",w3_div("id-drm-station w3-text-css-yellow","&nbsp;"),60,w3_div("",'Schedules: <a href="http://ab27.bplaced.net/drm.pdf" target="_blank">ab27(pdf)</a> <a href="https://www.drm.org/what-can-i-hear/broadcast-schedule-2" target="_blank">drm.org</a> <a href="http://www.hfcc.org/drm" target="_blank">hfcc.org</a>'),40),e));ext_panel_show(d,r,null),ext_set_controls_width_height(700,150)}function drm_mobile_controls_setup(e){drm.mobile=1,console.log("$ mobile drm mobile_laptop_test="+mobile_laptop_test),drm.w_nom=drm.w_sched=300,drm.h_sched=mobile_laptop_test?100:230,drm.cpanel_margin=20;var r=w3_div(sprintf("id-drm-controls w3-absolute|width:%dpx; height:%dpx;",drm.w_sched,drm.h_sched),w3_div(sprintf("id-drm-panel-container cl-drm-sched|width:100%%; height:100%%;"),w3_div("id-drm-panel-by-svc-static",drm_schedule_static()),w3_div("id-drm-panel-by-svc w3-iphone-scroll w3-absolute|width:100%; height:100%;",drm.loading_msg)));ext_panel_show(r,null,null),ext_set_controls_width_height(drm.w_sched+drm.cpanel_margin,drm.h_sched+drm.cpanel_margin);var d=w3_el("id-ext-controls-close");console.log("DRM mobile setup panelShown="+w3_el("id-ext-controls").panelShown),d.onclick=function(){toggle_panel("ext-controls",0),console.log("DRM mobile ext-controls-close panelShown="+w3_el("id-ext-controls").panelShown)},w3_attribute("id-ext-controls-close-img","src","icons/close.black.24.png"),drm.last_mobile={},drm.rescale_cnt=drm.rescale_cnt2=0,drm.fit="",drm.interval2=setInterval(function(){if(e=ext_mobile_info(drm.last_mobile),drm.last_mobile=e,!e.orient_unchanged){drm.rescale_cnt++;var r=w3_el("id-control").uiWidth;drm.w_nom+r<=e.width?(drm.w_sched=e.width-r-60,w3_el("id-ext-controls").style.zIndex=125,drm.fit="sbs"+drm.w_sched):(drm.w_sched=e.width-2*drm.cpanel_margin,w3_el("id-ext-controls").style.zIndex=150,drm.fit="fw"+drm.w_sched),ext_set_controls_width_height(drm.w_sched+drm.cpanel_margin,drm.h_sched+drm.cpanel_margin),w3_el("id-drm-controls").style.width=px(drm.w_sched),w3_innerHTML("id-drm-panel-by-svc-static",drm_schedule_static()),w3_innerHTML("id-drm-panel-by-svc",drm_schedule())}},500)}function drm_desktop_controls_setup(e){var r,d,t=null,s=250;if(drm.wrong_srate)d=w3_text("w3-medium w3-text-css-yellow","Currently, DRM does not support Kiwis configured for 20 kHz wide channels.");else if(drm.hacked)d=w3_text("w3-medium w3-text-css-yellow","Yeah, nah..");else if(0==drm.locked){if(kiwi.is_multi_core)r="DRM not supported on this channel.";else{var n=cfg.DRM.nreg_chans;console_log("drm_nreg_chans",n),r=0==n?"Requires exclusive use of the Kiwi. There can be no other connections.":1==n?"Can only run DRM with one other Kiwi connection.<br>And the other connection is not using any extensions.":"Can only run DRM with "+n+" or fewer other Kiwi connections.<br>And the other connections are not using any extensions.",r+="<br>Please try again when these conditions are met."}d=w3_text("w3-medium w3-text-css-yellow",r)}else{for(var a="Services:<br>",i=1;i<=4;i++)a+=w3_inline("",w3_checkbox("w3-margin-R-8","","drm.svc"+i,1==i,"drm_svcs_cbox_cb"),w3_div("id-drm-svc-"+i+"|width:100%"));var o=function(e){return e+" "+w3_icon("id-drm-status-"+e.toLowerCase(),"fa-square",16,"grey")+" &nbsp;&nbsp;"},_=function(e,r){return w3_span("id-drm-"+e+" cl-drm-blk",r)},m=function(e){return _("mod-"+e,e)},l=function(e){return _("occ-"+e,e)},c=function(e){return _("ilv-"+e,e)},p=function(e){return _("sdc-"+e,e)},w=function(e){return _("msc-"+e,e)},h=500+e;drm.w_sched=e;var u=25+h;t=time_display_html("drm")+w3_div(sprintf("id-drm-panel-0-info w3-relative w3-no-scroll|width:%dpx; height:%dpx; background-color:black;",u,s),w3_div(sprintf("id-drm-console-msg w3-margin-T-8 w3-small w3-text-white w3-absolute|left:%dpx; width:%dpx; height:%dpx; overflow-x:hidden;",25,500,s),w3_div("id-drm-status",o("IO")+o("Time")+o("Frame")+o("FAC")+o("SDC")+o("MSC")),w3_inline("w3-halign-space-between|width:250px/",w3_div("id-drm-if_level"),w3_div("id-drm-snr")),w3_divs("id-drm-mode w3-hide/w3-margin-T-6",w3_inline("/w3-show-inline","DRM mode ",m("A"),m("B"),m("C"),m("D"),"&nbsp;&nbsp;&nbsp; Chan ",l("4.5"),l("5"),l("9"),l("10"),l("18"),l("20")," kHz","&nbsp;&nbsp;&nbsp; ILV ",c("L"),c("S")),w3_inline("/w3-show-inline","SDC ",p("4"),p("16")," QAM","&nbsp;&nbsp;&nbsp; MSC ",w("16"),w("64")," QAM",w3_div("id-drm-prot w3-margin-left"),w3_div("id-drm-nsvc w3-margin-left")),w3_div("id-drm-desc")),w3_div("id-drm-error|width:"+px(450)),w3_div("id-drm-svcs w3-hide|width:"+px(450),a),"<br><br>",w3_div(sprintf("id-drm-msgs|width:%dpx",500))),w3_div(sprintf("id-drm-panel-graph w3-absolute|width:%dpx; height:%dpx; left:%dpx;",e,s,525),w3_div(sprintf("id-drm-panel-1-by-svc cl-drm-sched|width:%dpx; height:100%%;",e),w3_div("",drm_schedule_static()),w3_div("id-drm-panel-by-svc w3-scroll-y w3-absolute|width:100%; height:100%;",drm.loading_msg)),w3_div("id-drm-panel-1-graph w3-show-block",w3_canvas("id-drm-graph-if",e,105,{top:10}),w3_canvas("id-drm-graph-snr",e,105,{top:135})),w3_canvas("id-drm-panel-1-IQ",e,s,{pad:10})))+w3_div("id-drm-options w3-display-right w3-text-white|top:230px; right:0px; width:200px; height:200px",w3_select_hier("w3-text-red","","","drm.display_idx",drm.display_idx,drm.display_s,"drm_display_cb"),w3_div("w3-margin-T-8",w3_divs("id-drm-options-by-svc/w3-tspace-4",w3_div("cl-drm-sched-options-time w3-light-green","verified"),w3_div("cl-drm-sched-options-time","not verified"),w3_link("w3-link-color","http://valentfx.com/vanilla/discussion/1865/drm-heard#latest","Please report<br>schedule changes")))),d=w3_inline("w3-halign-space-between w3-margin-T-8/",w3_select_hier("w3-text-red","Europe","select","drm.menu0",drm.menu0,drm.europe,"drm_pre_select_cb"),w3_select_hier("w3-text-red","Middle East, Africa","select","drm.menu1",drm.menu1,drm.middle_east_africa,"drm_pre_select_cb"),w3_select_hier("w3-text-red","Asia/Pacific","select","drm.menu2",drm.menu2,drm.asia_pac,"drm_pre_select_cb"),w3_select_hier("w3-text-red","Americas","select","drm.menu3",drm.menu3,drm.americas,"drm_pre_select_cb"),w3_select_hier("w3-text-red","India MW","select","drm.menu4",drm.menu4,drm.india_MW,"drm_pre_select_cb"))+w3_inline("w3-margin-T-8/w3-margin-between-16",w3_button("w3-padding-smaller","Next","drm_next_prev_cb",1),w3_button("w3-padding-smaller","Prev","drm_next_prev_cb",-1),w3_button("id-drm-stop-button w3-padding-smaller w3-pink","Stop","drm_stop_start_cb"),w3_button("w3-padding-smaller w3-pink","Monitor IQ","drm_monitor_IQ_cb"),w3_button("w3-padding-smaller w3-aqua","Test 1","drm_test_cb",1),w3_button("w3-padding-smaller w3-aqua","Test 2","drm_test_cb",2),w3_div("id-drm-bar-container w3-progress-container w3-round-large w3-white w3-hide|width:220px; height:16px",w3_div("id-drm-bar w3-progressbar w3-round-large w3-light-green|width:50%","&nbsp;")))}drm_panel_show(d,t),ext_set_data_height(s),0!=drm.locked&&(time_display_setup("drm"),drm.canvas_if=w3_el("id-drm-graph-if"),drm.canvas_if.ctx=drm.canvas_if.getContext("2d"),drm.gr_if=graph_init(drm.canvas_if,{dBm:0,speed:1,averaging:!1}),graph_mode(drm.gr_if,"auto"),graph_clear(drm.gr_if),drm.canvas_snr=w3_el("id-drm-graph-snr"),drm.canvas_snr.ctx=drm.canvas_snr.getContext("2d"),drm.gr_snr=graph_init(drm.canvas_snr,{dBm:0,speed:1,averaging:!1}),graph_mode(drm.gr_snr,"auto"),graph_clear(drm.gr_snr),drm.canvas_IQ=w3_el("id-drm-panel-1-IQ"),drm.canvas_IQ.ctx=drm.canvas_IQ.getContext("2d"),drm.w_IQ=e-20,drm.h_IQ=230,drm.desktop=1)}function drm_controls_setup(){drm_saved_mode(),console.log("drm_controls_setup saved_mode="+drm.saved_mode),drm.saved_passband=ext_get_passband(),drm.is_stopped=0,console.log("drm_controls_setup is_stopped="+drm.is_stopped),drm.is_monitor=0,console.log("drm_controls_setup is_monitor="+drm.is_monitor),(t=drm.url_params=ext_param())&&(t=t.split(",")).forEach(function(e,r){console.log("DRM param1 <"+e+">");var d,t=e.split(":");if(t=t[t.length-1].toLowerCase(),w3_ext_param_array_match_str(drm.display_idx_s,e,function(e){drm.display_idx=drm.display_idx_si[e]}),(d=w3_ext_param("lo",e)).match)drm.pb_lo=d.num;else if((d=w3_ext_param("hi",e)).match)drm.pb_hi=d.num;else if((d=w3_ext_param("mobile",e)).match)drm.mobile=1;else if((d=w3_ext_param("debug",e)).match){var s=d.has_value?d.num:0;ext_send("SET debug="+s)}});var e=ext_mobile_info(),r=drm.w_graph_nom-Math.max(0,1440-e.width);if(drm.narrow_listing=r<drm.w_graph_nom,drm.mobile||r<=drm.w_graph_min?drm_mobile_controls_setup(e):drm_desktop_controls_setup(r),0!=drm.locked){if(drm.active=!0,drm.url_params){var d=parseFloat(drm.url_params);d&&drm_set_freq_menu(d)}var t;(t=drm.url_params)&&(t=t.split(",")).forEach(function(e,r){var d,t=e.split(":");if(t=t[t.length-1].toLowerCase(),w3_ext_param("help",e).match)extint_help_click();else if((d=w3_ext_param("test",e)).match){var s=d.has_value?d.num:1;drm_station("Test Recording "+(s=w3_clamp(s,1,2,1))),w3_show("id-drm-bar-container"),drm_test(s)}}),drm.using_default=drm.double_fault=!1,kiwi_ajax(drm.url+"stations2.cjson","drm_get_stations_cb",0,1e4),drm_run(1),drm_set_freq(ext_get_freq_kHz())}}function drm_run(e){e!=drm.run&&(e&&(drm_saved_mode(),console.log("drm_run saved_mode="+drm.saved_mode),drm.saved_passband=ext_get_passband()),drm.run=e,ext_send("SET run="+drm.run))}function drm_test(e){ext_send("SET test="+e)}function drm_stop(e){drm_test(0),drm_run(0),drm_reset_status(),drm_station(""),w3_hide("id-drm-bar-container"),e?drm_set_mode("iq"):(isDefined(drm.saved_passband)&&(console_log_fqn("drm_stop RESTORE","drm.saved_passband.low","drm.saved_passband.high"),ext_set_passband(drm.saved_passband.low,drm.saved_passband.high)),isDefined(drm.saved_mode)&&(console_log_fqn("drm_stop RESTORE","drm.saved_mode"),drm_set_mode(drm.saved_mode)))}function drm_start(){drm_test(0),drm_run(1),drm_set_mode("drm"),drm.is_stopped=0,w3_button_text("id-drm-stop-button","Stop","w3-pink","w3-green")}function drm_stop_start_cb(e,r){console.log("drm_stop_start_cb ENTRY is_stopped="+drm.is_stopped),drm.is_stopped^=1,drm.is_stopped?(console.log("$drm_stop_start_cb: do stop, show start"),drm_stop(1),w3_button_text(e,"Start","w3-green","w3-pink")):(console.log("$drm_stop_start_cb: do start, show stop"),drm_start())}function drm_monitor_IQ_cb(e,r){console.log("drm_monitor_IQ_cb ENTRY is_monitor="+drm.is_monitor+" cb_param="+r),drm.is_monitor^=1,drm.is_monitor?(console.log("$drm_monitor_IQ_cb: do monitor start"),w3_remove_then_add(e,"w3-pink","w3-green"),ext_send("SET monitor=1")):(console.log("$drm_monitor_IQ_cb: do monitor stop"),w3_remove_then_add(e,"w3-green","w3-pink"),ext_send("SET monitor=0"))}function drm_set_passband(){drm.pb_lo||drm.pb_hi||extint.override_pb?console.log("drm_set_passband PB FROM PARAMS "+drm.pb_lo+","+drm.pb_hi):drm.special_passband?(console_log_fqn("drm_set_passband SPECIAL PB","drm.special_passband.low","drm.special_passband.high"),ext_set_passband(drm.special_passband.low,drm.special_passband.high)):(console.log("drm_set_passband DEFAULT PB"),ext_set_passband(-5e3,5e3))}function drm_set_mode(e){console_log("drm_set_mode",e),ext_set_mode(e,null,{no_drm_proc:!0}),"drm"==e&&drm_set_passband()}function drm_set_freq(e){drm.freq=e;var r=ext_get_zoom();r<5?r=5:r>9&&(r=9);var d=drm.pb_lo||drm.pb_hi||extint.override_pb,t=d?ext_get_passband():null;ext_tune(drm.freq,"drm",ext_zoom.ABS,r),d&&ext_set_passband(t.low,t.high),drm_set_passband()}function drm_reset_cb(e,r,d){console.log("drm_reset_cb"),ext_send("SET reset")}function drm_test_cb(e,r,d){console.log("drm_test_cb "+r),drm_station("Test Recording "+r),drm_reset_menus(),drm_run(0),drm_start(),drm_test(r),drm_set_mode("drm"),w3_show("id-drm-bar-container"),drm_annotate("magenta")}function drm_svcs_cbox_cb(e,r,d){var t=e.substr(-1,1);if(!d){for(var s=1;s<=4;s++)w3_checkbox_set("drm.svc"+s,!1);w3_checkbox_set(e,!0),ext_send("SET svc="+t)}}function drm_monitor_cb(e,r,d){if(!d){var t=drm.monitor_s[r];console.log("drm_monitor_cb idx="+r+" monitor="+t),ext_send("SET monitor="+r)}}function drm_display_cb(e,r,d){r=+r,w3_select_value(e,r);var t=0,s=-1,n=!1;w3_select_enum(e,function(e){e.disabled||(n||e.value!=r||(s=t,n=!0),t++)});var a=drm.display=s;w3_color("id-drm-panel-graph",null,"graph"!=drm.panel_1[a]?"black":"mediumBlue"),console.log("$ drm_display_cb idx="+r+" show="+a+" "+drm.panel_0[a]+"/"+drm.panel_1[a]),drm.panel_0.forEach(function(e){w3_hide("id-drm-panel-0-"+e)}),drm.panel_1.forEach(function(e){w3_hide("id-drm-panel-1-"+e)}),drm.panel_1.forEach(function(e){w3_hide("id-drm-options-"+e)}),w3_show("id-drm-panel-0-"+drm.panel_0[a]),w3_show("id-drm-panel-1-"+drm.panel_1[a]),w3_show("id-drm-options-"+drm.panel_1[a]),ext_send("SET send_iq="+(a>=drm.IQ_ALL&&a<=drm.IQ_END?1:0))}function drm_reset_menus(){for(var e=0;e<drm.n_menu;e++)w3_select_value("drm.menu"+e,-1)}function drm_pre_select_cb(e,r,d,t){if(d)return!1;1!=t&&(console.log("drm_pre_select_cb  RESET special_passband ########"),drm.special_passband=null);var s=!1;r=+r;var n=parseInt(e.split("drm.menu")[1]);return drm.last_disabled=!1,drm_reset_menus(),drm_station(""),w3_select_enum(e,function(d){d.disabled&&(0==drm.last_disabled&&(drm.station_id=[]),-1!=d.value&&drm.station_id.push(d.innerHTML)),drm.last_disabled=d.disabled,d.value==r&&(drm.freq_s=d.innerHTML,drm_set_freq(parseFloat(drm.freq_s)),w3_select_value(e,d.value),drm_station((n==drm.menu_India_MW?"India, ":"")+drm.station_id.join(" ")),drm_start(),s=!0)}),s}function drm_station(e){drm.desktop&&(drm.last_station=e,""==e&&(e="&nbsp;"),w3_el("id-drm-station").innerHTML="<b>"+e+"</b>",drm_annotate("magenta"))}function DRM_environment_changed(e){var r=ext_get_freq()/1e3,d=ext_get_mode();drm.freq==r&&"drm"==d||(drm_reset_menus(),drm.menu_sel="",drm_station(""))}function drm_next_prev_cb(e,r,d){r=+r;for(var t,s=0,n=0,a=0,i=0,o=0;o<drm.n_menu;o++){t="drm.menu"+o;var _=w3_el(t).value;if(-1!=_){w3_select_enum(t,function(e){e.disabled||(n&&(a=e.value,n=0),e.value===_&&(i=s,n=1),s=e.value)});break}}_=0,1==r&&a&&(_=a),-1==r&&i&&(_=i),_&&drm_pre_select_cb(t,_,!1)}function DRM_blur(){console.log("DRM_blur saved_mode="+drm.saved_mode),kiwi_clearInterval(drm.interval),kiwi_clearInterval(drm.interval2),drm.active=!1,drm_stop(0),(isUndefined(drm.saved_mode)||"drm"==drm.saved_mode)&&(console.log("DRM_blur FORCE iq"),drm_set_mode("iq")),drm.locked=0,ext_send("SET lock_clear"),ext_set_data_height()}function DRM_help(e){if(e){var r=w3_text("w3-medium w3-bold w3-text-aqua","Digital Radio Mondiale (DRM30) decoder help")+"<br><br>"+w3_div("w3-scroll-y|height:85%",'Schedule: Click on colored bars to tune a station. <br>Gray vertical lines are spaced 1 hour apart beginning at 00:00 UTC on the left. <br>Red line shows current UTC time and updates while the extension is running. <br><br>With DRM selective fading can prevent even the strongest signals from being received properly. To see if signal fading is occurring adjust the waterfall "WF max/min" controls carefully so the waterfall colors are not saturated. The image below shows fading (dark areas) that might cause problems. See the <a href="http://valentfx.com/vanilla/discussion/1842/v1-360-drm-extension-now-available-for-beta-testing/p1" target="_blank">Kiwi forum</a> for more information. <br><br><img src="gfx/DRM.sel.fade.png" /><br><br>Custom passbands set before invoking the DRM extension will be respected. <br>For example the passband field of a DX label that has mode DRM, or a passband specification in the URL e.g. "my_kiwi.com:8073/?pb=0,5k&ext=drm" <hr>DRM code from <b>Dream 2.2.1</b> <br>Technische Universitaet Darmstadt, Institut fuer Nachrichtentechnik <br>Copyright (c) 2001-2020 &nbsp;&nbsp;&nbsp;&nbsp;<a href="https://sourceforge.net/projects/drm" target="_blank">sourceforge.net/projects/drm</a> <br>License: GNU General Public License version 2.0 (GPLv2) <br><hr><b>Fraunhofer FDK AAC Codec Library for Android</b> <br>© Copyright  1995 - 2018 Fraunhofer-Gesellschaft zur Förderung der angewandten <br>Forschung e.V. All rights reserved. <br>For more information visit <a href="http://www.iis.fraunhofer.de/amm" target="_blank">www.iis.fraunhofer.de/amm</a> <br><hr><b>OpenCORE-AMR modifications to Fraunhofer FDK AAC Codec</b> <br>Copyright (C) 2009-2011 Martin Storsjo &nbsp;&nbsp;&nbsp;&nbsp;<a href="https://sourceforge.net/projects/opencore-amr" target="_blank">sourceforge.net/projects/opencore-amr</a> <br>License: Apache License V2.0 <br><hr>Features <b>NewsService Journaline(R)</b> decoder technology by <br>Fraunhofer IIS, Erlangen, Germany. <br>Copyright (c) 2003, 2004 <br>For more information visit <a href="http://www.iis.fhg.de/dab" target="_blank">www.iis.fhg.de/dab</a> <br>License: GNU General Public License version 2.0 (GPLv2) <br><hr>');confirmation_show_content(r,610,350),w3_el("id-confirmation-container").style.height="100%"}else if(drm.mobile)return"off";return!0}function DRM_config_html(){var e=ext_get_cfg_param("DRM.nreg_chans",3);-1==e&&(e=3),drm.nreg_chans=Math.min(e,rx_chans-1);var r=Math.max(4,rx_chans);drm.nreg_chans_u={0:"none"};for(var d=1;d<r;d++)drm.nreg_chans_u[d]=d.toFixed(0);var t=w3_inline_percent("w3-container",w3_div("w3-center",w3_select("","Number of non-DRM connections allowed<br>when DRM in use","","DRM.nreg_chans",drm.nreg_chans,drm.nreg_chans_u,"admin_select_cb")),40);ext_config_html(drm,"DRM","DRM","DRM configuration",t)}
