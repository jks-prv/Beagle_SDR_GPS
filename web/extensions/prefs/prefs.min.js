

/* web/extensions/prefs/prefs.min.js */
var prefs={ext_name:"prefs",first_time:!0,CMD1:0,id:"_no_user_",pobj:null,default:{p:"default-p"},status_anim:!1,status_timeout:-1};function prefs_main(){ext_switch_to_client(prefs.ext_name,prefs.first_time,prefs_recv),prefs.first_time||prefs_controls_setup(),prefs.first_time=!1}function prefs_recv(e){if("DAT"!=arrayBufferToStringLen(e,3))for(var s=arrayBufferToString(e).substring(4).split(" "),r=0;r<s.length;r++){var o=s[r].split("=");switch("keepalive"!=o[0]&&(isDefined(o[1])?console.log("prefs_recv: "+o[0]+"="+o[1]):console.log("prefs_recv: "+o[0])),o[0]){case"ready":prefs_controls_setup();break;default:console.log("prefs_recv: UNKNOWN CMD "+o[0])}}else{var t=new Uint8Array(e,4),n=t[0];n==prefs.CMD1||console.log("prefs_recv: DATA UNKNOWN cmd="+n+" len="+(t.length-1))}}function prefs_controls_setup(){window.onstorage=function(e){console.log("Key Changed: "+e.key),console.log("New Value: "+e.newValue)};var e=w3_divs("w3-text-css-yellow/w3-tspace-16",w3_div("w3-medium w3-text-aqua","<b>User preferences</b>"),w3_div("id-prefs-container"),w3_div("w3-show-inline-block w3-hspace-16",w3_div("id-prefs-buttons w3-hide",w3_button("w3-margin-R-16","Export","prefs_export_btn_cb"),w3_button("w3-margin-R-16","Import","prefs_import_btn_cb")),"<b>Status:</b> "+w3_div("id-prefs-status w3-show-inline-block w3-snap-back")));ext_panel_show(e),ext_set_controls_width_height(768,250),prefs_status("yellow","waiting for local storage.."),prefs_load(function(){w3_innerHTML("id-prefs-container",w3_col_percent("",w3_input("","Prefs","prefs.pobj.p",prefs.pobj.p,"prefs_p_cb","something"),30)),w3_show("id-prefs-buttons")})}function prefs_p_cb(e,s){w3_string_cb(e,s),prefs_save()}function prefs_refresh_ui(){w3_set_value("prefs.pobj.p",prefs.pobj.p)}function prefs_status(e,s){var r=w3_el("id-prefs-status");if(prefs.status_anim)return kiwi_clearTimeout(prefs.status_timeout),w3_remove_then_add(r,"w3-fade-out","w3-snap-back"),void setTimeout(function(){prefs.status_anim=!1,prefs_status(e,s)},1e3);r.style.color=e,r.innerHTML=s,w3_remove_then_add(r,"w3-snap-back","w3-fade-out"),prefs.status_anim=!0,prefs.status_timeout=setTimeout(function(){r.innerHTML="",w3_remove_then_add(r,"w3-fade-out","w3-snap-back"),prefs.status_anim=!1},1500)}function prefs_export_btn_cb(e,s){console.log("prefs_export_btn_cb"),prefs_save(function(){console.log("msg_send pref_export"),msg_send("SET pref_export id="+encodeURIComponent(prefs.id)+" pref="+encodeURIComponent(JSON.stringify(prefs.pobj)))}),prefs_status("lime","preferences exported")}function prefs_import_btn_cb(e,s){console.log("prefs_import_btn_cb");var r=ident_user||"_no_user_";msg_send("SET pref_import id="+encodeURIComponent(r))}function prefs_import_cb(e,s){var r=decodeURIComponent(e);if(console.log("prefs_import_cb "+r),"null"!=r){var o=kiwi_JSON_parse("prefs_import_cb",r);o&&(prefs.pobj=o,console.log(o),prefs_save(),prefs_refresh_ui(),prefs_status("lime","preferences successfully imported from RX"+s))}else prefs_status("yellow","no preferences previously exported")}function prefs_check(){var e=ident_user||"_no_user_";xdLocalStorageHA.getItem("prefs."+e,function(e){if(e.value){var s=kiwi_JSON_parse("prefs_check",e.value);s&&prefs.pobj.p!=s.p&&(console.log("--\x3e prefs_check "+e.value),msg_send("SET dbug_msg=prefs_check "+e.value))}}),setTimeout(prefs_check,1e3)}function prefs_load(e){if(kiwi.xdLocalStorage_ready){var s=ident_user||"_no_user_";xdLocalStorageHA.getItem("prefs."+s,function(r){if(console.log("prefs_load key=prefs."+s),msg_send("SET dbug_msg=prefs_load "+JSON.stringify(r)),console.log(r),null==r.value)prefs.pobj=prefs.default;else{var o=kiwi_JSON_parse("prefs_load",r.value);o&&(prefs.pobj=o,msg_send("SET dbug_msg=prefs_load "+r.value))}console.log(prefs.pobj),e&&e()}),setTimeout(prefs_check,1e3)}else setTimeout(prefs_load,250,e)}function prefs_save(e){var s=ident_user||"_no_user_";prefs.id=s;var r=JSON.stringify(prefs.pobj);xdLocalStorageHA.setItem("prefs."+s,r,function(){console.log("prefs_save key=prefs."+s),console.log(r),e&&e()})}function prefs_focus(){console.log("prefs_focus")}function prefs_blur(){console.log("prefs_blur")}function prefs_help(e){if(e){var s=w3_text("w3-medium w3-bold w3-text-aqua","User preferences help")+w3_div("w3-margin-T-8 w3-scroll-y|height:90%",w3_div("w3-margin-R-8","..."));confirmation_show_content(s,610,350),w3_el("id-confirmation-container").style.height="100%"}return!0}function prefs_config_html(){ext_config_html(prefs,"prefs","Prefs","User preferences configuration")}


