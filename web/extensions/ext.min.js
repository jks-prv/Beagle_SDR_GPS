

/* web/extensions/ext.min.js (web/extensions/ext.js = Sat Nov  2 09:57:09 2024) */
var extint={ws:null,extname:null,first_ext_load:true,ext_is_tuning:false,authkey_cb:null,adc_clock_Hz:0,adc_gps_clock_corr:0,adc_clock_nom_Hz:0,audio_data_cb:null,extint_pwd_cb:null,extint_pwd_cb_param:null,extint_conn_type:null,ext_names:null,hasIframeMenu:false,isAdmin_cb:null,srate:0,wb_srate:0,nom_srate:0,param:null,override_pb:false,displayed:false,help_displayed:false,current_ext_name:null,using_data_container:false,hide_func:null,default_w:525,default_h:300,prev_mode:null,mode_prior_to_dx_click:null,seq:0,scanning:0,web_socket_fragmentation:8192,send_hiwat:0,send_hiwat_msg:null,optbars:{'optbar-wf':0,'optbar-audio':1,'optbar-agc':2,'optbar-users':3,'optbar-status':4,'optbar-off':5},no_lockout:['noise_blank','noise_filter','ant_switch','iframe','colormap','devl','prefs'],former_exts:['ant_switch','waterfall','noise_blank','noise_filter'],excl_devl:['devl','digi_modes','s4285','prefs'],OPT_NOLOCAL:1,};var devl={p0:0,p1:0,p2:0,p3:0,p4:0,p5:0,p6:0,p7:0};function ext_switch_to_client(ext_name,first_time,recv_func){recv_websocket(extint.ws,recv_func);ext_send('SET ext_switch_to_client='+ext_name+' first_time='+(first_time?1:0)+' rx_chan='+rx_chan);w3_call(ext_name+'_focus');}
function ext_send(msg,ws){if(isNoArg(ws))ws=extint.ws;var len=msg.length;if(len>extint.send_hiwat){extint.send_hiwat_msg=msg;extint.send_hiwat=len;}
try{ws.send(msg);return 0;}catch(ex){console.log("CATCH ext_send('"+msg+"') ex="+ex);kiwi_trace();}}
function ext_send_new(msg,ws){ext_send(kiwi_stringify(msg),ws);}
function ext_send_cfg(cfg,s){var ws=extint.ws;var len=s.length;var tr='='+len;var _send=function(seq,suffix,s){return('SET '+cfg.cmd+suffix+seq+' '+s);};var transaction_seq=cfg.seq;cfg.seq++;w3_do_when_cond(function(seq){var ba=ws.bufferedAmount?('['+ws.bufferedAmount+']'):'0';tr=w3_sb(tr,ba);if(ws.bufferedAmount!=0)return false;if(len>extint.web_socket_fragmentation){cfg.lock=1;ws.send(_send(seq,'_frag=',s.slice(0,extint.web_socket_fragmentation)));s=s.slice(extint.web_socket_fragmentation);len=s.length;tr=w3_sb(tr,'W'+extint.web_socket_fragmentation);return false;}else{ws.send(_send(seq,'=',s.slice(0,extint.web_socket_fragmentation)));cfg.lock=0;if(kiwi.log_cfg_save_seq)
kiwi_debug(w3_sb('save_config:',seq+'-'+cfg.name+tr,'w'+len,'DONE'),true);len=0;return true;}},null,transaction_seq,kiwi.test_cfg_save_seq?1000:50);}
function ext_send_after_cfg_save(msg,cfg_s){cfg_s=cfg_s||'cfg';var kiwi_cfg=kiwi[cfg_s];w3_do_when_cond(function(){if(kiwi.log_cfg_save_seq)
kiwi_debug('ext_send_after_cfg_save lock='+kiwi_cfg.lock+' msg=<'+msg+'>');return(kiwi_cfg.lock==0);},function(msg){ext_send(msg);},msg,100);}
function ext_panel_show(controls_html,data_html,show_func,hide_func){extint_panel_show(controls_html,data_html,show_func,hide_func);}
function ext_set_data_height(height){var el=w3_el('id-ext-data-container');if(!height){if(el)el.style.height='';}else{if(el)el.style.height=px(height);}}
function ext_set_controls_width_height(width,height){panel_set_width_height('ext-controls',width,height);}
var EXT_SAVE=true;var EXT_NO_SAVE=false;var EXT_SAVE_DEFER=false;function ext_get_cfg_param(path,init_val,save,update_path_var){var cur_val;var cfg_path=w3_add_toplevel(path);try{cur_val=getVarFromString(cfg_path);}catch(ex){cur_val=null;}
if(isNoArg(cur_val)&&init_val!=undefined){cur_val=init_val;setVarFromString(cfg_path,cur_val);if((save==undefined&&isAdmin())||save==EXT_SAVE)
cfg_save_json('ext_get_cfg_param',cfg_path,cur_val);}
if(update_path_var){if(path.startsWith('cfg.')||path.startsWith('adm.')){console.log('ext_get_cfg_param: update_path_var CAUTION: NOT SETTING path='+path+' cur_val='+cur_val);}else{setVarFromString(path,cur_val);}}
return cur_val;}
function ext_get_cfg_param_string(path,init_val,save){var s=ext_get_cfg_param(path,init_val,save);if(isNoArg(s))s='';return kiwi_decodeURIComponent('ext_get_cfg_param_string'+':'+path,s);}
function ext_set_cfg_param(path,val,save){if(path.startsWith('id-')){console.log('$WARNING: ext_set_cfg_param path='+path);kiwi_trace();return;}
path=w3_add_toplevel(path);setVarFromString(path,val);save=(isArg(save)&&save==EXT_SAVE)?true:false;if(save){cfg_save_json('ext_set_cfg_param',path,val);}}
function ext_get_freq_range(){var offset=kiwi.freq_offset_kHz;return{lo_kHz:offset,hi_kHz:offset+32000,offset_kHz:offset};}
function ext_set_freq_offset(foff_kHz){kiwi_set_freq_offset(foff_kHz);ext_send('SET antsw_freq_offset='+foff_kHz);}
var ext_zoom={TO_BAND:0,IN:1,OUT:-1,ABS:2,WHEEL:3,CUR:4,NOM_IN:8,MAX_IN:9,MAX_OUT:-9,TO_PASSBAND:null};function ext_tune(freq_dial_kHz,mode,zoom,zlevel,low_cut,high_cut,opt){var pb_specified=(isArg(low_cut)&&isArg(high_cut));extint.ext_is_tuning=true;freq_dial_kHz=freq_dial_kHz||(freq_displayed_Hz / 1000);freqmode_set_dsp_kHz(freq_dial_kHz,mode,opt);if(pb_specified)ext_set_passband(low_cut,high_cut);if(isArg(zoom)){zoom_step(zoom,zlevel);}else{zoom_step(ext_zoom.TO_BAND);}
extint.ext_is_tuning=false;}
function ext_get_freq_Hz(){return{displayed:freq_displayed_Hz,carrier:freq_car_Hz,passband_center:freq_passband_center()};}
function ext_get_freq(){return freq_displayed_Hz;}
function ext_get_freq_kHz(){return(freq_displayed_Hz/1e3).toFixed(2);}
function ext_get_carrier_freq(){return freq_car_Hz;}
function ext_get_passband_center_freq(){return freq_passband_center();}
function ext_save_setup(){var mode=isArg(extint.mode_prior_to_dx_click)?extint.mode_prior_to_dx_click:cur_mode;console.log('ext_save_setup mode='+mode+' mode_prior_to_dx_click='+extint.mode_prior_to_dx_click+' cur_mode='+cur_mode);extint.mode_prior_to_dx_click=null;return{mode:mode,zoom:zoom_level};}
function ext_restore_setup(s){console.log('ext_restore_setup mode='+s.mode+' zoom='+s.zoom);ext_set_mode(s.mode);ext_set_zoom(ext_zoom.ABS,s.zoom);}
function ext_get_mode(){return cur_mode;}
function ext_mode(mode){var fail=false;var str;if(isArg(mode)){mode=mode.toLowerCase();str=mode.substr(0,2);if(str=='qa')str='sa';if(str=='nn')str='nb';}else{str='';fail=true;}
var o={fail:fail,str:str};o.AM=fail?false:(str=='am');o.LSB=fail?false:(str=='ls');o.USB=fail?false:(str=='us');o.CW=fail?false:(str=='cw');o.IQ=fail?false:(str=='iq');o.NBFM=fail?false:(str=='nb');o.SAx=fail?false:(str=='sa');o.DRM=fail?false:(str=='dr');o.AM=fail?false:(str=='am');o.LSB_SAL=fail?false:(o.LSB||mode=='sal');o.SSB=fail?false:(o.USB||o.LSB);o.SSB_CW=fail?false:(o.SSB||o.CW);o.STEREO=fail?false:(o.IQ||o.DRM||mode=='sas'||mode=='qam');o.AM_SAx_IQ_DRM=fail?false:(o.AM||o.SAx||o.SSB||o.DRM);return o;}
function ext_is_IQ_or_stereo_mode(mode){return ext_mode(mode).STEREO;}
function ext_is_IQ_or_stereo_curmode(){return ext_is_IQ_or_stereo_mode(cur_mode);}
function ext_get_prev_mode(){return extint.prev_mode;}
function ext_set_mode(mode,freq_Hz,opt){if(isUndefined(mode))return;var new_drm=(mode=='drm');if(new_drm)
extint.prev_mode=cur_mode;demodulator_analog_replace(mode,freq_Hz);var open_ext=w3_opt(opt,'open_ext',false);var no_drm_proc=w3_opt(opt,'no_drm_proc',false);var drm_active=(typeof(drm)!='undefined'&&drm.active);if(!no_drm_proc){if(new_drm&&open_ext){if(drm_active){toggle_panel("ext-controls",1);}else{extint_open('drm');}}else
if(!new_drm&&drm_active){extint_panel_hide();demodulator_analog_replace(mode,freq_Hz);}}}
function ext_get_passband(){var demod=demodulators[0];return{low:demod.low_cut,high:demod.high_cut};}
function ext_set_passband(low_cut,high_cut,set_mode_pb,freq_dial_Hz){var demod=demodulators[0];var filter=demod.filter;if(low_cut==undefined)low_cut=demod.low_cut;if(high_cut==undefined)high_cut=demod.high_cut;var bw=Math.abs(high_cut-low_cut);low_cut=(low_cut<filter.low_cut_limit)?filter.low_cut_limit:low_cut;high_cut=(high_cut>filter.high_cut_limit)?filter.high_cut_limit:high_cut;bw=Math.abs(high_cut-low_cut);var okay=false;if(bw>=filter.min_passband&&low_cut<high_cut){demod.low_cut=low_cut;demod.high_cut=high_cut;okay=true;}
if(isArg(set_mode_pb)&&set_mode_pb&&okay){owrx.last_lo[cur_mode]=low_cut;owrx.last_hi[cur_mode]=high_cut;}
if(isArg(freq_dial_Hz)){freq_dial_Hz*=1000;freq_car_Hz=freq_dsp_to_car(freq_dial_Hz);extint.ext_is_tuning=true;demodulator_set_frequency(owrx.FSET_EXT_SET_PB,freq_car_Hz);extint.ext_is_tuning=false;}else{demodulators[0].set();if(!wf.audioFFT_active)
mkenvelopes(get_visible_freq_range());}}
function ext_get_tuning(){return{low:demod.low_cut,high:demod.high_cut,mode:cur_mode,freq_dial_kHz:freq_displayed_Hz/1000};}
function ext_get_zoom(){return zoom_level;}
function ext_set_zoom(zoom_mode,zoom_level){zoom_step(zoom_mode,zoom_level);}
function ext_get_audio_comp(){return btn_compression?true:false;}
function ext_set_audio_comp(comp,no_write_cookie){no_write_cookie=(no_write_cookie===true)?toggle_e.NO_WRITE_COOKIE:0;toggle_or_set_compression(toggle_e.SET|no_write_cookie,comp?1:0);}
function ext_set_scanning(scanning){extint.scanning=scanning?1:0;}
function ext_agc_delay(set_val){var prev_val=w3_el('input-decay').value;if(isDefined(set_val))setDecay_cb('',set_val,1);return prev_val;}
function ext_get_optbar(){var optbar=kiwi_storeRead('last_optbar');return optbar;}
function ext_set_optbar(optbar,cb_param){if(extint.optbars[optbar]){kiwi_storeWrite('last_optbar',optbar);w3_click_nav('id-navbar-optbar',optbar,'optbar',cb_param);}}
function ext_hasCredential(conn_type,cb,cb_param,ws){if(conn_type=='mfg')conn_type='admin';var pwd;if(conn_type=='admin'){if(kiwi.admin_save_pwd){pwd=kiwi_storeInit('admin','');}else{pwd='';kiwi_storeDelete('admin');}
kiwi_storeDelete('admin');kiwi_storeDelete('admin-pwd');}else{pwd=kiwi_storeRead(conn_type);}
pwd=pwd?decodeURIComponent(pwd):'';extint.pwd_cb=cb;extint.pwd_cb_param=cb_param;ext_valpwd(conn_type,pwd,ws);}
function ext_valpwd(conn_type,pwd,ws){if(conn_type=='mfg')conn_type='admin';pwd=encodeURIComponent(pwd);if(conn_type=='admin'){if(kiwi.admin_save_pwd){kiwi_storeWrite('admin',pwd);}}else{kiwi_storeWrite(conn_type,pwd);}
extint.conn_type=conn_type;pwd=(pwd!='')?pwd:'#';var ipl=null;var iplimit_cookie=kiwi_storeRead('iplimit');var iplimit_pwd=kiwi_url_param(['pwd','password'],'','');if(iplimit_pwd!=''){ipl=iplimit_pwd;kiwi_storeWrite('iplimit',encodeURIComponent(ipl));}else
if(iplimit_cookie&&iplimit_cookie!=''){ipl=iplimit_cookie;}
ipl=ipl?(' ipl='+ipl):'';if(kiwi_url_param(['p','prot','protected'],'true',null)!=null&&conn_type!='admin')
conn_type='prot';var options=0;if(kiwi_url_param('nolocal'))options|=extint.OPT_NOLOCAL;if(options!=0)ext_send('SET options='+options);ext_send('SET auth t='+conn_type+' p='+pwd+ipl,ws);}
function ext_isAdmin(cb){extint.isAdmin_cb=cb;ext_send('SET is_admin');}
function ext_get_authkey(func){ext_send('SET get_authkey');extint.authkey_cb=func;}
function ext_adc_clock_Hz(){return extint.adc_clock_Hz;}
function ext_adc_gps_clock_corr(){return extint.adc_gps_clock_corr;}
function ext_adc_clock_nom_Hz(){return extint.adc_clock_nom_Hz;}
function ext_sample_rate(){return extint.srate;}
function ext_nom_sample_rate(){return extint.nom_srate;}
function ext_register_audio_data_cb(func){extint.audio_data_cb=func;}
function ext_unregister_audio_data_cb(){extint.audio_data_cb=null;}
function ext_param(){var p=extint.param;extint.param=null;return p;}
function ext_panel_set_name(name){extint.current_ext_name=name;}
function ext_get_name(){return extint.current_ext_name;}
function ext_mobile_info(last){var w=window.innerWidth;var h=window.innerHeight;if(mobile_laptop_test){w=375;h=812;}
var rv={width:w,height:h};var isPortrait;if(owrx.popup_keyboard_active){isPortrait=last?last.isPortrait:1;}else{isPortrait=(w<h||mobile_laptop_test)?1:0;}
rv.orient_unchanged=(last&&last.isPortrait==isPortrait)?1:0;rv.isPortrait=isPortrait?1:0;rv.small=(isPortrait&&w<768)?1:0;rv.narrow=(isPortrait&&w<=600)?1:0;rv.iPad=(isPortrait&&w<=768)?1:0;rv.tablet=(isPortrait&&w<=600)?1:0;rv.phone=(isPortrait&&w<=430)?1:0;return rv;}
function ext_get_menus_cb(ctx,freqs,retry_cb,done_cb,done_cb_param){var fault=false;if(!freqs){console.log('ext_get_menus_cb: freqs='+freqs);fault=true;}else
if(freqs.AJAX_error&&freqs.AJAX_error=='timeout'){console.log('ext_get_menus_cb: TIMEOUT');ctx.using_default=true;fault=true;}else
if(freqs.AJAX_error&&freqs.AJAX_error=='status'){console.log('ext_get_menus_cb: status='+freqs.status);ctx.using_default=true;fault=true;}else
if(!isObject(freqs)){console.log('ext_get_menus_cb: not array');fault=true;}else
if(isDefined(freqs.AJAX_error)){console.log('ext_get_menus_cb: AJAX_error');fault=true;}
var url;if(fault){if(ctx.double_fault){console.log('ext_get_menus_cb: default freq list fetch FAILED');console.log(freqs);return;}
console.log(freqs);url=ctx.int_url;console.log('ext_get_menus_cb: using default freq list '+url);ctx.using_default=true;ctx.double_fault=true;kiwi_ajax(url,retry_cb,0,10000);return;}else{url=ctx.ext_url;}
console.log('ext_get_menus_cb: from '+url);if(dbgUs)console.log(freqs);w3_call(done_cb,done_cb_param);}
function ext_render_menus(ctx,ext_name,ctx_name){var new_menu=function(i,o,menu_s){ctx.n_menu++;ctx.menus[i]=o;ctx.menu_s[i]=menu_s;var s=w3_div('id-'+menu_s+' w3-margin-between-24',w3_select_hier(ctx.sfmt,menu_s,'select',ctx_name+'.menu'+i,-1,o,ext_name+'_pre_select_cb'));return s;};if(isUndefined(ctx_name))ctx_name=ext_name;var s='';ctx.n_menu=0;w3_obj_enum(ctx.freqs,function(menu_s,i,o2){s+=new_menu(i,o2,menu_s);});w3_innerHTML('id-'+ext_name+'-menus',s);console.log('ext_render_menus n_menu='+ctx.n_menu);}
function ext_help_click(delay){if(w3_contains('id-ext-controls-help-btn','w3-disabled'))return;console.log(extint.current_ext_name+'_help_click CLICKED');if(delay)
setTimeout(function(){extint_help_click_now();},2000);else
extint_help_click_now();}
function ext_panel_init(){w3_el('id-panels-container').innerHTML+='<div id="id-ext-controls" class="class-panel" data-panel-name="ext-controls" data-panel-pos="bottom-left" data-panel-order="0" '+'data-panel-size="'+extint.default_w+','+extint.default_h+'"></div>';var el=w3_el('id-ext-data-container');el=w3_el('id-ext-controls');el.innerHTML=w3_div('id-ext-controls-container w3-relative|width:100%;height:100%;')+
w3_div('id-ext-controls-vis class-vis')+
w3_div('id-ext-controls-help cl-ext-help',w3_button('id-ext-controls-help-btn w3-green w3-small w3-padding-small w3-disabled||onclick="ext_help_click()"','help'));w3_el('id-kiwi-body').addEventListener('keyup',function(evt){if(evt.key=='Escape'&&extint.displayed&&!confirmation.displayed){if(w3_call(extint.current_ext_name+'_escape_key_cb')!=true){console.log('EXT ESC: no _escape_key_cb() routine, so doing id-ext-controls-close.click()');w3_el('id-ext-controls-close').click();}}},true);}
function ext_show_spectrum(which){toggle_or_set_spec(toggle_e.SET|toggle_e.NO_CLOSE_EXT,which);}
function ext_hide_spectrum(){toggle_or_set_spec(toggle_e.SET|toggle_e.NO_CLOSE_EXT,spec.NONE);}
function extint_panel_show(controls_html,data_html,show_func,hide_func,show_help_button){var el;extint.using_data_container=(data_html?true:false);if(extint.using_data_container){toggle_or_set_spec(toggle_e.SET,spec.NONE);w3_hide('id-top-container');w3_show_block(w3_innerHTML('id-ext-data-container',data_html));}else{w3_hide('id-ext-data-container');if(spec.source==spec.NONE)
w3_show_block('id-top-container');}
if(extint.help_displayed==true){confirmation_panel_close();extint.help_displayed=false;}
var ext_name=extint.current_ext_name;el=w3_el('id-ext-controls-close');el.onclick=function(){toggle_panel("ext-controls");extint_panel_hide();};ext_set_data_height();w3_el('id-ext-controls').style.zIndex=150;w3_create_attribute('id-ext-controls-close-img','src','icons/close.24.png');el=w3_el('id-ext-controls-container');el.innerHTML=controls_html;if(show_func)show_func();extint.hide_func=hide_func;el=w3_el('id-ext-controls');el.style.zIndex=150;w3_visible(el,true);el.panelShown=1;toggle_or_set_hide_panels(0);w3_el('id-confirmation-container').style.height='';show_help_button=isDefined(show_help_button)?show_help_button:w3_call(extint.current_ext_name+'_help',false);w3_set_props('id-ext-controls-help-btn','w3-disabled',isUndefined(show_help_button)||show_help_button==false);w3_show_hide('id-ext-controls-help-btn',show_help_button!='off');extint.displayed=true;}
function ext_panel_displayed(ext_name){return(extint.displayed&&(ext_name?(ext_name==extint.current_ext_name):true));}
function ext_panel_redisplay(s){w3_innerHTML('id-ext-controls-container',s);}
function extint_panel_hide(skip_calling_hide_spec){console.log('extint_panel_hide using_data_container='+extint.using_data_container+' skip_calling_hide_spec='+skip_calling_hide_spec);if(extint.using_data_container){w3_hide('id-ext-data-container');if(skip_calling_hide_spec!=true)
ext_hide_spectrum();w3_show_block('id-top-container');extint.using_data_container=false;if(extint.help_displayed==true){confirmation_panel_close();extint.help_displayed=false;}}
w3_visible('id-ext-controls',false);extint_blur_prev(1);w3_call(extint.hide_func);w3_select_value('id-select-ext',-1);resize_waterfall_container(true);extint.displayed=false;freqset_select();}
function extint_help_click_now(){extint.help_displayed=w3_call(extint.current_ext_name+'_help',true);}
function extint_environment_changed(changed){setTimeout(function(){if(extint.current_ext_name){w3_call(extint.current_ext_name+'_environment_changed',changed);}
if(changed.freq||changed.mode||changed.zoom||changed.waterfall_pan||changed.resize)
mouse_freq_remove();noise_blank_environment_changed(changed);noise_filter_environment_changed(changed);w3_call('injection_environment_changed',changed);},100);}
function extint_valpwd_cb(badp){if(extint.pwd_cb)extint.pwd_cb(badp,extint.pwd_cb_param);}
function extint_open_ws_cb(){ext_hasCredential('kiwi',null,null);setTimeout(function(){setInterval(function(){ext_send("SET keepalive");},5000);},5000);}
function extint_connect_server(){extint.ws=open_websocket('EXT',extint_open_ws_cb,null,extint_msg_cb);}
function extint_msg_cb(param,ws){switch(param[0]){case"keepalive":break;case"ext_client_init":console.log('ext_client_init is_locked='+(+param[1]));extint_focus(+param[1]);break;default:return false;}
return true;}
function extint_blur_prev(restore){if(extint.current_ext_name!=null){w3_call(extint.current_ext_name+'_blur');recv_websocket(extint.ws,null);if(restore)ext_set_controls_width_height();extint.current_ext_name=null;time_display_setup('id-topbar-R-container');}
if(extint.ws)
ext_send('SET ext_blur='+rx_chan);}
function extint_focus(is_locked){var ext_name=extint.current_ext_name;console.log('extint_focus: loading '+ext_name+'.js');if(is_locked&&!extint.no_lockout.includes(ext_name)){var s=w3_text('w3-medium w3-text-css-yellow','Cannot use extensions while <br> another channel is in DRM mode.');extint_panel_show(s,null,null,null,'off');ext_set_controls_width_height(300,75);return;}
kiwi_load_js_dir('extensions/'+ext_name+'/'+ext_name,['.js','.css'],function(){console.log('extint_focus: calling '+ext_name+'_main()');ext_set_controls_width_height();w3_call(ext_name+'_main');if(isNonEmptyArray(shortcut.keys))
setTimeout(keyboard_shortcut_url_keys,3000);},function(loaded){console.log('extint_focus: '+ext_name+' loaded='+loaded);if(loaded){extint_panel_show('loading extension...',null,null,null,'off');ext_set_controls_width_height(325,45);if(kiwi.is_locked)
console.log('==== IS_LOCKED =================================================');}});}
function extint_select(value){freqset_select();value=+value;var el=w3_el('id-select-ext');if(!el){setTimeout(extint_select,1000,value);return;}
w3_select_value(el,value);var menu=el.childNodes;var name=menu[value+1].innerHTML.toLowerCase();var idx;extint_enum_names(function(i,value,id,id_en){if(name.startsWith(id.toLowerCase())){idx=i;}});if(name=='ant_switch'){ant_switch_focus();ant_switch_view();}else{ant_switch_blur();if(extint.former_exts.includes(name)){w3_call(name+'_view');}else{extint_blur_prev(0);w3_call(extint.hide_func);var ext_name=extint.ext_names[idx];if(extint.hasIframeMenu&&ext_name==cfg.iframe.menu)ext_name='iframe';extint.current_ext_name=ext_name;if(extint.first_ext_load){extint_connect_server();extint.first_ext_load=false;}else{ext_send('SET ext_is_locked_status');}}}}
function extint_list_json(param){extint.ext_names=kiwi_JSON_parse('extint_list_json',decodeURIComponent(param));extint.former_exts.forEach(function(e,i){extint.ext_names.push(e);});console.log(extint.ext_names);console.log(extint.ext_names.includes(cfg.iframe.menu));if(isNonEmptyString(cfg.iframe.menu)&&!extint.ext_names.includes(cfg.iframe.menu)){extint.ext_names.push(cfg.iframe.menu);extint.hasIframeMenu=true;}
kiwi_dedup_array(extint.ext_names);extint.ext_names.sort(kiwi_sort_ignore_case);}
function extint_enum_names(func){var i,value;for(i=value=0;i<extint.ext_names.length;i++){var id=extint.ext_names[i];if(!dbgUs&&extint.excl_devl.includes(id))continue;if(id=='sig_gen'&&rx_chan!=0)continue;if(id=='wspr')id='WSPR';var id_en=id.toLowerCase();if(id_en=='cw_decoder')id_en='cw';if(id_en=='drm')id_en='DRM';if(id_en=='s_meter')id_en='S_meter';if(id_en=='wspr')id_en='WSPR';func(i,value,id,id_en);value++;}}
function extint_exts_call(func_s){extint_enum_names(function(i,value,id,id_en){id_en=id_en.toLowerCase();w3_call(id_en+func_s);});}
function ext_auth(){if(kiwi.is_local[rx_chan])return kiwi.AUTH_LOCAL;if(kiwi.tlimit_exempt_by_pwd[rx_chan])return kiwi.AUTH_PASSWORD;return kiwi.AUTH_USER;}
function extint_select_build_menu(){var s='';if(extint.ext_names&&isArray(extint.ext_names)){extint_enum_names(function(i,value,id,id_en){var enable=ext_get_cfg_param(id_en+'.enable');if(enable==null||ext_auth()==kiwi.AUTH_LOCAL)enable=true;if(id=='DRM')kiwi.DRM_enable=enable;if(id=='NAVTEX')id='NAVTEX/DSC';else
if(id=='FT8')id='FT8/FT4';else
if(id=='wspr')id='WSPR';s+='<option value='+dq(value)+' kiwi_idx='+dq(i)+' '+(enable?'':'disabled')+'>'+id+'</option>';});}
return s;}
function extint_open(name,delay){name=name.toLowerCase();if(name=='dsc')name='navtex';else
if(name=='ft4')name='ft8';else;var found=0;extint_enum_names(function(i,value,id,id_en){var enable=ext_get_cfg_param(id_en+'.enable');if(enable==null||ext_auth()==kiwi.AUTH_LOCAL)enable=true;if(!found&&enable&&id.toLowerCase().includes(name)){if(delay){setTimeout(function(){extint_select(value);},delay);}else{extint_select(value);}
found=1;}});}
function extint_audio_data(data,samps){if(isFunction(extint.audio_data_cb))
extint.audio_data_cb(data,samps);}



